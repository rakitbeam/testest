import{E as $,G as D,H as _,r as F,j as e,F as C,a as d,B as E,aq as I,bg as O,K as V,au as q,av as Y,aw as L,S as g,T as n,ax as U,bb as K,bh as Q,bi as Z,bj as J,f as y,e as A,d as X,t as ee,ar as te,b as S,ah as P,h as ne,i as ue,k as ae,bd as re,a2 as ie,af as oe,Z as M,$ as le}from"./index.068d49af.js";import{N as se,P as ce}from"./PageContent.d84932da.js";import{d as de}from"./Settings.eeecb109.js";import{d as pe,a as he}from"./ContentCopy.c8238f91.js";import{A as Fe}from"./ActionBar.e03fe381.js";import{B as fe,S as me,g as ve,a as Ce,v as ye,f as ge,G as j,b as xe,A as Se}from"./fleetSetupValidation.b97f4ab7.js";import{E as Be}from"./ExpandStack.c4c696d7.js";import{R as Ee}from"./ResponsiveDialog.2ea52978.js";import{T as be}from"./TextField.f4482617.js";import{P as Ae}from"./PageFooter.ab6b4e03.js";import"./domUtils.f64b5ed8.js";import"./MenuItem.dcc198ca.js";import"./sorting.c6946657.js";import"./Select.784d5b66.js";var R={},$e=D.exports;Object.defineProperty(R,"__esModule",{value:!0});var W=R.default=void 0,De=$e($),_e=_,Re=(0,De.default)((0,_e.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");W=R.default=Re;const ke=p=>{const{fleetSetups:t,fleetSetup:r,onChange:u,buttonProps:c}=p,o=F.exports.useMemo(()=>t.map(a=>({key:a.key,text:a.name,value:a.key})),[t]);return e(C,{children:e(fe,{icon:e(W,{}),text:"\u8266\u968A\u9078\u629E",value:r.key,options:o,onClick:u,buttonProps:c})})},we=p=>{const{fleetSetups:t,fleetSetup:r,grouping:u,onChangeFleet:c,onChangeGrouping:o,onEdit:a,onShare:l}=p;return e(Fe,{left:s=>d(C,{children:[e(me,{value:u,onChange:o,buttonProps:s}),e(ke,{fleetSetups:t,fleetSetup:r,onChange:c,buttonProps:s}),e(E,{variant:"outlined",startIcon:e(de,{}),onClick:a,...s,children:"\u7DE8\u96C6"},"edit")]}),right:s=>e(C,{children:e(E,{variant:"outlined",startIcon:e(pe,{}),onClick:l,...s,children:"\u5171\u6709"},"share")})})},Te=p=>{var a;const{initialFleetKey:t}=p,r=F.exports.useMemo(()=>ve(),[]),[u,c]=F.exports.useState(t&&(a=r.find(l=>l.key===t))!=null?a:r[0]),o=F.exports.useCallback(l=>{const s=r.find(v=>v.key===l);if(!s)throw new Error(`Invalid fleet key "${l}"`);c(s)},[r]);return{fleetSetups:r,fleetSetup:u,switchFleet:o}};var k={},Ie=D.exports;Object.defineProperty(k,"__esModule",{value:!0});var z=k.default=void 0,Oe=Ie($),Pe=_,Me=(0,Oe.default)((0,Pe.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");z=k.default=Me;var w={},je=D.exports;Object.defineProperty(w,"__esModule",{value:!0});var N=w.default=void 0,Ge=je($),We=_,ze=(0,Ge.default)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");N=w.default=ze;function Ne(p){const t={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return p.reduce((r,u)=>{const c=I(u.shipDefinition,u.moduleSelection);if(!c)return{...r,incomplete:!0};const o=O(c,u.count,r);return u.carriedShips.reduce((a,l)=>{const s=I(l.shipDefinition,null);return s?O(s,l.count,a):{...a,incomplete:!0}},o)},t)}const He=p=>{const{fleetSetup:t}=p,[r,u]=F.exports.useState(!1),{totalCost:c,shipCount:o,shipCountByType:a,shipCountByRow:l}=F.exports.useMemo(()=>Ce(t.ships),[t.ships]),s=F.exports.useMemo(()=>Ne(t.ships),[t.ships]),v=c>t.maxCost,x=t.totalReinforcementCount>t.maxReinforcement,f=F.exports.useMemo(()=>{const i=ye(t);return Object.keys(i).map(m=>{const[h,H]=m.split("#"),B=V(h);switch(H){case"self":return`${B.name}\uFF1A${i[m]}`;case"ally":return`${B.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09\uFF1A${i[m]}`;case"ally2":return`${B.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09\uFF1A${i[m]}`;case"ally3":return`${B.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09\uFF1A${i[m]}`;default:return`${B.name}\uFF1A${i[m]}`}})},[t]),b=v||x||f.length>0?e(N,{color:"error"}):e(z,{color:"primary"});return d(q,{expanded:r,onChange:()=>u(!r),children:[e(Y,{expandIcon:r?e(L,{}):b,children:d(g,{spacing:1,children:[e(n,{variant:"body1",children:t.name}),!r&&d("div",{children:[e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u5897\u63F4\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:x?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`}),e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u3001\u53F8\u4EE4Pt\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})]})]})}),e(U,{children:r&&e(K,{rows:[{key:"reinforcementCount",label:"\u5897\u63F4",value:e(n,{variant:"body2",sx:x?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`})},{key:"cost",label:"\u8266\u968A\u53F8\u4EE4Pt",value:e(n,{variant:"body2",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})},{key:"dpm",label:"\u5408\u8A08DPM",value:d(C,{children:[e(n,{variant:"body2",children:Q(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"hp",label:"\u5408\u8A08HP",value:d(C,{children:[e(n,{variant:"body2",children:Z(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"speed",label:"\u901F\u5EA6",value:d(C,{children:[e(n,{variant:"body2",children:J(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"shipCount",label:"\u8266\u8239",value:o>0?d(C,{children:[e(n,{variant:"body2",children:`\u5408\u8A08\u3000${o}`}),Object.keys(a).filter(i=>a[i]>0&&i!==y.CORVETTE&&i!==y.FIGHTER).map(i=>e(n,{variant:"body2",children:`${A(i)}\u3000${a[i]}`},i))]}):e(n,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:"\u8266\u8F09\u6A5F",value:a[y.FIGHTER]+a[y.CORVETTE]>0?d(C,{children:[a[y.FIGHTER]>0&&e(n,{variant:"body2",children:`${A(y.FIGHTER)}\u3000${a[y.FIGHTER]}`}),a[y.CORVETTE]>0&&e(n,{variant:"body2",children:`${A(y.CORVETTE)}\u3000${a[y.CORVETTE]}`})]}):e(n,{variant:"body2",children:"-"})},{key:"rowCount",label:"\u914D\u7F6E",value:o>0?e(C,{children:Object.keys(l).filter(i=>i!==X.NONE).map(i=>e(n,{variant:"body2",children:`${ee(i)}\u3000${l[i]}`},i))}):e(n,{variant:"body2",children:"-"})},...f.length>0?[{key:"warnings",label:"\u8B66\u544A",value:f.map((i,m)=>e(n,{variant:"body2",sx:{color:"red"},children:i},`warning_${m}`))}]:[]]})})]})},G=p=>{const{shipSelections:t}=p,{openShipDetailDialog:r}=te();return e(g,{spacing:1,children:t==null?void 0:t.map(u=>{var c;return d(F.exports.Fragment,{children:[d(g,{spacing:1,direction:"row",children:[d(g,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(S,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${u.count}\xD7`})}),e(n,{variant:"body2",children:e(P,{onClick:()=>{r(u.shipDefinition.id)},children:u.shipDefinition.name})}),u.reinforcement==="self"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u5897\u63F4\uFF09"}),u.reinforcement==="ally"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09"}),u.reinforcement==="ally2"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09"}),u.reinforcement==="ally3"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09"})]}),e(S,{sx:{width:"50px"},children:u.reinforcement===null&&e(n,{variant:"body2",textAlign:"end",children:`${u.shipDefinition.cost*u.count} Pt`})})]}),u.carriedShips.map(o=>{var a;return d(g,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(n,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(S,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${o.count}\xD7`})}),e(n,{variant:"body2",children:e(P,{onClick:()=>{r(o.shipDefinition.id)},children:o.shipDefinition.name})})]},`${o.shipDefinition.id}_${(a=o.reinforcement)!=null?a:"initial"}`)})]},`${u.shipDefinition.id}_${(c=u.reinforcement)!=null?c:"initial"}`)})})},Ve=p=>{const{fleetSetup:t,groupedShips:r,onClose:u}=p,[c,o]=F.exports.useState(!1),[a,l]=F.exports.useState(()=>ge(t,r)),s=()=>{a&&ue(a).then(()=>{o(!0)})},v=f=>{l(f.target.value)},x=()=>{u(),o(!1)};return e(Ee,{title:"\u5171\u6709",content:d(g,{spacing:1,children:[e(be,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:v,rows:10,defaultValue:a,fullWidth:!0}),!!navigator.clipboard&&e(E,{variant:"outlined",startIcon:c?e(ne,{}):e(he,{}),onClick:s,fullWidth:!0,children:"\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306B\u30B3\u30D4\u30FC"})]}),actions:e(E,{variant:"outlined",onClick:x,children:"\u9589\u3058\u308B"}),onClose:x})},rt=()=>{const p=ae(),{fleetKey:t}=re(),r=ie(),u=oe(r.breakpoints.up("lg")),[c,o]=F.exports.useState(!1),{fleetSetups:a,fleetSetup:l,switchFleet:s}=Te({initialFleetKey:t!=null?t:null}),[v,x]=F.exports.useState(j.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),f=F.exports.useMemo(()=>xe(v,l),[l,v]),T=()=>{p("/fleetSetup/edit/"+l.key)},b=()=>{o(!0)},i=()=>{o(!1)},m=u&&f.groupedBy===j.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return d(C,{children:[e(se,{currentRoute:"/fleetSetup"}),e(we,{fleetSetups:a,fleetSetup:l,grouping:v,onChangeFleet:s,onChangeGrouping:x,onEdit:T,onShare:b}),e(ce,{disableContainer:m==="row",children:e(S,{p:1,children:d(g,{spacing:1,children:[e(He,{fleetSetup:l}),l.ships.length>0?e(C,{children:m==="row"?e(g,{spacing:1,direction:"row",sx:{width:"100%"},children:f.groups.map(h=>e(M,{sx:{width:`${100/f.groups.length}%`},children:e(S,{p:1,children:d(g,{spacing:1,children:[e(n,{variant:"body1",children:`${h.name}${h.count>0?`\uFF08${h.count}\u96BB\uFF09`:""}`}),e(le,{}),e(G,{shipSelections:h.ships})]})})},h.id))}):e(Be,{expandables:f.groups.map(h=>({id:h.id,initiallyOpened:!0,summary:e(n,{variant:"body1",children:`${h.name}${h.count>0?`\uFF08${h.count}\u96BB\uFF09`:""}`}),details:e(G,{shipSelections:h.ships}),skip:h.ships.length===0}))},f.groupedBy)}):e(M,{children:e(S,{p:2,children:d(g,{spacing:1,children:[e(n,{variant:"body1",children:"\u7DE8\u6210"}),e(Se,{severity:"info",children:"\u3053\u306E\u8266\u968A\u306B\u306F\u307E\u3060\u8266\u8239\u304C\u8FFD\u52A0\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002\u4E0A\u306E\u300C\u7DE8\u96C6\u300D\u30DC\u30BF\u30F3\u3067\u7DE8\u96C6\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048\u308B\u3068\u8266\u8239\u306E\u8FFD\u52A0\u3084\u5897\u63F4\u306E\u8A2D\u5B9A\u7B49\u304C\u884C\u3048\u307E\u3059\u3002"})]})})}),e(n,{variant:"caption",align:"right",paragraph:!0,children:"\u203B\u8A2D\u5B9A\u30C7\u30FC\u30BF\u306F\u30D6\u30E9\u30A6\u30B6\u306E\u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u306B\u4FDD\u5B58\u3055\u308C\u3066\u3044\u307E\u3059\u3002"})]})})}),c&&e(Ve,{fleetSetup:l,groupedShips:f,onClose:i}),e(Ae,{disableContainer:m==="row"})]})};export{rt as FleetSetupPage,rt as default};
