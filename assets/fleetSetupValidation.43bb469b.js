var z=Object.defineProperty,W=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var k=(t,e,n)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,c=(t,e)=>{for(var n in e||(e={}))V.call(e,n)&&k(t,n,e[n]);if(v)for(var n of v(e))q.call(e,n)&&k(t,n,e[n]);return t},m=(t,e)=>W(t,K(e));import{r as b,b as I,F as L,j as d,y as J,h as Z,P as X,G as Q,A as ee,z as te,M as ne,E as re,I as ue,K as oe,v as ae,w as ie,x as se}from"./vendor.612e55a5.js";import{g as ce}from"./domUtils.e9df6b0f.js";import{c as F,b as me,S as _,t as le,s as $,h as B,V as E,j as fe}from"./index.cbe897e3.js";import{n as j}from"./sorting.c6946657.js";const de=t=>{const{options:e,icon:n,text:u,value:r,onClick:o,buttonProps:a}=t,[i,s]=b.exports.useState(!1),l=b.exports.useRef(null),p=h=>{s(!1),o(h)};return I(L,{children:[d(J,{variant:"outlined",fullWidth:a==null?void 0:a.fullWidth,ref:l,disabled:a==null?void 0:a.disabled,size:a==null?void 0:a.size,children:d(Z,{startIcon:n,onClick:h=>{h.stopPropagation(),s(!0)},disabled:a==null?void 0:a.disabled,children:u})}),d(X,{open:i,anchorEl:l.current,role:void 0,transition:!0,disablePortal:!0,style:{zIndex:2},children:({TransitionProps:h,placement:A})=>d(Q,m(c({},h),{style:{transformOrigin:A==="bottom"?"center top":"center bottom"},children:d(ee,{style:{maxHeight:ce(l.current),overflowY:"auto"},children:d(te,{onClickAway:()=>s(!1),children:d(ne,{children:e.map(y=>I(re,{selected:y.value===r,onClick:x=>{x.stopPropagation(),p(y.value)},disabled:y.disabled,children:[y.icon&&d(ue,{children:y.icon}),d(oe,{children:y.text})]},y.key))})})})}))})]})};var M={},pe=ie.exports;Object.defineProperty(M,"__esModule",{value:!0});var P=M.default=void 0,ye=pe(ae),he=se,Fe=(0,ye.default)((0,he.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");P=M.default=Fe;var f;(function(t){t.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",t.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",t.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",t.SORT_BY_NAME="sortByName"})(f||(f={}));const S={initial:0,self:1,ally:2,ally2:3,ally3:4},w=(t,e)=>{var n,u;return S[(n=t.reinforcement)!=null?n:"initial"]-S[(u=e.reinforcement)!=null?u:"initial"]},R=j([(t,e)=>t.shipDefinition.name.localeCompare(e.shipDefinition.name,"ja-JP"),w]),T=j([(t,e)=>$(t.shipDefinition.type,t.shipDefinition.subType)-$(e.shipDefinition.type,e.shipDefinition.subType),R,w]);function Ye(t,e){switch(t){case f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:_e(e.ships)};case f.GROUP_BY_TYPE_SORT_BY_NAME:return{groupedBy:t,groups:Ee(e.ships)};case f.SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:e.ships.map(n=>m(c({},n),{carriedShips:[...n.carriedShips].sort(T)})).sort(T),count:e.ships.map(n=>n.count).reduce((n,u)=>n+u,0)}]};case f.SORT_BY_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:e.ships.map(n=>m(c({},n),{carriedShips:[...n.carriedShips].sort(R)})).sort(R),count:e.ships.map(n=>n.count).reduce((n,u)=>n+u,0)}]};default:throw new Error(`Unknown group and sort option "${t}"`)}}function _e(t){return[_.FRONT,_.MIDDLE,_.BACK].map(e=>{const n=t.filter(r=>r.shipDefinition.row===e).map(r=>m(c({},r),{carriedShips:[...r.carriedShips].sort(T)})).sort(T),u=n.map(r=>r.count).reduce((r,o)=>r+o,0);return{id:e,name:le(e),ships:n,count:u}})}function Ee(t){return[F.CARRIER,F.AUXILIARY,F.BATTLE_CRUISER,F.CRUISER,F.DESTROYER,F.FRIGATE].map(e=>{const n=t.filter(r=>r.shipDefinition.type===e).map(r=>m(c({},r),{carriedShips:[...r.carriedShips].sort(R)})).sort(R),u=n.map(r=>r.count).reduce((r,o)=>r+o,0);return{id:e,name:me(e),ships:n,count:u}})}function ve(t,e){return[t.name,e.groups.filter(n=>n.ships.length>0).map(n=>[...e.groups.length>1?[`\u3010${n.name}\u3011`]:[],...n.ships.flatMap(u=>{const r=u.count*u.shipDefinition.cost,o=Re(u);switch(u.reinforcement){case"self":return[`${u.count}\xD7\u3000${u.shipDefinition.name}\uFF08\u5897\u63F4\uFF09`,...o?[o]:[],...g(u.carriedShips)];case"ally":return[`${u.count}\xD7\u3000${u.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09`,...o?[o]:[],...g(u.carriedShips)];case"ally2":return[`${u.count}\xD7\u3000${u.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09`,...o?[o]:[],...g(u.carriedShips)];case"ally3":return[`${u.count}\xD7\u3000${u.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09`,...o?[o]:[],...g(u.carriedShips)];default:return[`${u.count}\xD7\u3000${u.shipDefinition.name}\uFF08${r}Pt\uFF09`,...o?[o]:[],...g(u.carriedShips)]}})].join(`
`)).join(`

`),[`\u5897\u63F4\uFF1A${t.totalReinforcementCount}/${t.maxReinforcement}`,`\u6307\u4EE4Pt\uFF1A${t.totalCost}/${t.maxCost}`].join(`
`)].join(`

`)}function g(t){return t.map(e=>`\u3000\u3000${e.count}\xD7\u3000${e.shipDefinition.name}`)}function Re(t){if(t.moduleSelection===null||t.moduleSelection.static)return null;const e=["M","A","B","C"].flatMap(n=>{var a,i,s;const r=Object.keys((i=(a=t.moduleSelection)==null?void 0:a.groups[n])!=null?i:{}).find(l=>{var p;return((p=t.moduleSelection)==null?void 0:p.groups[n][l].usage)==="used"});if(!r)return[];const o=(s=t.moduleSelection)==null?void 0:s.groups[n][r];return!o||o.module.defaultModule?[]:o?[`${o.module.name}\uFF08${o.module.id}\uFF09`]:[]});return e.length===0?null:e.map(n=>`\u3000\u3000${n}`).join(`
`)}const ke=t=>{const{value:e,onChange:n,buttonProps:u}=t;return d(L,{children:d(de,{icon:d(P,{}),text:"\u8868\u793A",value:e,options:[{key:f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:"\u914D\u7F6E\u5225\u3001\u8266\u7A2E\u2192\u540D\u524D\u9806",value:f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:f.GROUP_BY_TYPE_SORT_BY_NAME,text:"\u8266\u7A2E\u5225\u3001\u540D\u524D\u9806",value:f.GROUP_BY_TYPE_SORT_BY_NAME},{key:f.SORT_BY_TYPE_AND_NAME,text:"\u8266\u7A2E\u2192\u540D\u524D\u9806",value:f.SORT_BY_TYPE_AND_NAME},{key:f.SORT_BY_NAME,text:"\u540D\u524D\u9806",value:f.SORT_BY_NAME}],onClick:n,buttonProps:u})})};function be(){var t,e,n,u,r;return[(t=C("fleet1"))!=null?t:D(1),(e=C("fleet2"))!=null?e:D(2),(n=C("fleet3"))!=null?n:D(3),(u=C("fleet4"))!=null?u:D(4),(r=C("fleet5"))!=null?r:D(5)]}function Ie(t){const e=JSON.stringify(Ce(t));window.localStorage.setItem(t.key,e)}function C(t){const e=window.localStorage.getItem(t);if(!e)return null;const n=Ae(e);return n?ge(n,t):null}function ge(t,e){const n=t.myListOnly===!0,u=t.ships.map(r=>{var o;return m(c({},G({shipDefinition:B(r.shipId),usedModules:(o=r.usedModules)!=null?o:null,count:r.count,reinforcement:r.reinforcement,maxReinforcement:t.maxReinforcement})),{carriedShips:r.carriedShips.map(a=>U({shipId:a.shipId,count:a.count,reinforcement:r.reinforcement}))})});return{key:e,name:t.name,ships:u,totalCost:N(u),totalReinforcementCount:Y(u),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:n}}function Ce(t){return{name:t.name,ships:t.ships.map(e=>({shipId:e.shipDefinition.id,usedModules:e.moduleSelection?De(e.moduleSelection):void 0,carriedShips:e.carriedShips.map(n=>({shipId:n.shipDefinition.id,count:n.count})),count:e.count,reinforcement:e.reinforcement})),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:t.myListOnly}}function De(t){const e=[];return Object.keys(t.groups).forEach(n=>{Object.keys(t.groups[n]).forEach(u=>{t.groups[n][u].usage==="used"&&e.push(t.groups[n][u].module.id)})}),e}function Ae(t){try{return JSON.parse(t)}catch(e){return alert("ERROR - Failed to restore fleet setup"),console.error(e),null}}function D(t){return{key:`fleet${t}`,name:`${t}\u53F7\u8266\u968A`,ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function G(t){const{shipDefinition:e,usedModules:n,count:u,reinforcement:r,maxReinforcement:o,temporary:a}=t,i=xe(e,n),s=O(e,i),l=r===null||e.type===F.FIGHTER||e.type===F.CORVETTE?e.operationLimit:Math.min(e.operationLimit,o);return{shipDefinition:e,carrierCapabilities:s,carriedShips:[],count:Math.max(0,u),reinforcement:r,maxCount:l,moduleSelection:i,temporary:a}}function xe(t,e){if(!t.modules||t.modules.length===0)return null;const n=e!=null?e:t.modules.filter(r=>r.defaultModule).map(r=>r.id),u={static:t.staticModules===!0,groups:{}};return t.modules.forEach(r=>{if(u.groups[r.category]||(u.groups[r.category]={}),u.static){u.groups[r.category][r.id]={module:r,usage:"used"};return}u.groups[r.category][r.id]={module:r,usage:n.includes(r.id)?"used":"not_used"}}),u}function O(t,e){var a;let n=0,u=0,r=0,o=(a=t.carryCorvette)!=null?a:0;if(t.carryFighter)switch(t.carryFighterType){case E.LARGE_FIGHTER:{n+=t.carryFighter;break}case E.MEDIUM_FIGHTER:{u+=t.carryFighter;break}case E.SMALL_FIGHTER:{r+=t.carryFighter;break}}return e&&Object.keys(e.groups).forEach(i=>{var s;Object.keys((s=e.groups[i])!=null?s:{}).forEach(l=>{var h,A,y,x;const p=e.groups[i][l];if(p.usage==="used"){switch(p.module.carryFighterType){case E.LARGE_FIGHTER:{n+=(h=p.module.carryFighter)!=null?h:0;break}case E.MEDIUM_FIGHTER:{u+=(A=p.module.carryFighter)!=null?A:0;break}case E.SMALL_FIGHTER:{r+=(y=p.module.carryFighter)!=null?y:0;break}}o+=(x=p.module.carryCorvette)!=null?x:0}})}),{canCarry:n+u+r+o>0,carryUpToLargeFighter:n,carryUpToMediumFighter:u,carryUpToSmallFighter:r,carryCorvette:o}}function U(t){const{shipId:e,count:n,reinforcement:u,temporary:r}=t;return{shipDefinition:B(e),count:Math.max(0,n),reinforcement:u,temporary:r}}function Le(t){const{shipId:e,count:n,reinforcement:u,fleetSetup:r,keepZero:o}=t,a=B(e);let i=!0;const s=m(c({},r),{ships:r.ships.flatMap(l=>l.shipDefinition.id!==e||l.reinforcement!==u?l:(i=!1,!o&&n<=0?[]:[m(c({},l),{count:n})]))});return i?m(c({},s),{ships:[...s.ships,G({shipDefinition:a,usedModules:null,count:n,reinforcement:u,maxReinforcement:r.maxReinforcement})],totalCost:N(s.ships),totalReinforcementCount:Y(s.ships)}):m(c({},s),{totalCost:N(s.ships),totalReinforcementCount:Y(s.ships)})}function $e(t){const{shipId:e,carrierShipId:n,count:u,reinforcement:r,fleetSetup:o,keepZero:a}=t;return m(c({},o),{ships:o.ships.map(i=>i.shipDefinition.id!==n||i.reinforcement!==r?i:i.carriedShips.find(s=>s.shipDefinition.id===e)?m(c({},i),{carriedShips:i.carriedShips.flatMap(s=>{if(s.shipDefinition.id!==e)return[s];if(s.reinforcement!==r)throw new Error("Detected invalid reinforcement");return!a&&u<=0?[]:[m(c({},s),{count:Math.max(0,u),reinforcement:r})]})}):m(c({},i),{carriedShips:[...i.carriedShips,U({shipId:e,count:u,reinforcement:r})]}))})}function je(t){const{shipId:e,reinforcement:n,moduleSelection:u,fleetSetup:r}=t;return m(c({},r),{ships:r.ships.map(o=>o.shipDefinition.id!==e?o:(n==null?void 0:n.includes("ally"))?o.reinforcement===n?m(c({},o),{moduleSelection:u,carrierCapabilities:O(o.shipDefinition,u)}):o:!o.reinforcement||!o.reinforcement.includes("ally")?m(c({},o),{moduleSelection:u,carrierCapabilities:O(o.shipDefinition,u)}):o)})}function Pe(t,e,n){return m(c({},n),{groups:m(c({},n.groups),{[t]:Object.keys(n.groups[t]).reduce((u,r)=>{const o=n.groups[t][r];return m(c({},u),{[r]:r===e?m(c({},o),{usage:"used"}):m(c({},o),{usage:"not_used"})})},n.groups[t])})})}function N(t){return t.filter(e=>e.reinforcement===null).map(e=>e.count*e.shipDefinition.cost).reduce((e,n)=>e+n,0)}function Y(t){return t.filter(e=>e.reinforcement!==null).map(e=>e.count).reduce((e,n)=>e+n,0)}function Se(t){let e=0;const n=t.map(o=>o.count).reduce((o,a)=>o+a,0),u=Object.keys(fe).reduce((o,a)=>m(c({},o),{[a]:0}),{}),r={[_.FRONT]:0,[_.MIDDLE]:0,[_.BACK]:0,[_.NONE]:0};return t.forEach(o=>{o.reinforcement===null&&(e+=o.count*o.shipDefinition.cost),u[o.shipDefinition.type]+=o.count,r[o.shipDefinition.row]+=o.count,o.carriedShips.length>0&&o.carriedShips.forEach(a=>{u[a.shipDefinition.type]+=a.count})}),{shipCount:n,shipCountByType:u,shipCountByRow:r,totalCost:e}}function we(t){var n,u;const e={};return t.name.length===0&&(e.name="\u5FC5\u9808\u9805\u76EE"),(!Number.isFinite(t.maxReinforcement)||t.maxReinforcement<0)&&(e.maxReinforcement="\u7121\u52B9\u306A\u5024"),(!Number.isFinite(t.maxCost)||t.maxCost<300||t.maxCost>450)&&(e.maxCost="\u7121\u52B9\u306A\u5024"),t.maxCost>400&&t.maxReinforcement>5&&(e.maxReinforcement=(n=e.maxReinforcement)!=null?n:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059",e.maxCost=(u=e.maxCost)!=null?u:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059"),e}function Ge(t){const e={},n={},u={};return t.ships.forEach(r=>{const o=H(r.shipDefinition.id,r.reinforcement);if(n[o]){const a=n[o];n[o]={count:r.reinforcement===null?r.count:a.count,reinforcementCount:r.reinforcement!==null?r.count:a.reinforcementCount,operationLimit:r.shipDefinition.operationLimit}}else n[o]={count:r.reinforcement===null?r.count:0,reinforcementCount:r.reinforcement!==null?r.count:0,operationLimit:r.shipDefinition.operationLimit};r.carriedShips.forEach(a=>{const i=H(a.shipDefinition.id,r.reinforcement);u[i]?u[i].count+=a.count:u[i]={count:a.count,operationLimit:a.shipDefinition.operationLimit}})}),Object.keys(n).forEach(r=>{const o=n[r];o.count+o.reinforcementCount>o.operationLimit&&(e[r]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),Object.keys(u).forEach(r=>{const o=u[r];o.count>o.operationLimit&&(e[r]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),e}function H(t,e){const n=(e==null?void 0:e.includes("ally"))?e:"self";return`${t}#${n}`}export{de as B,f as G,ke as S,Se as a,Ye as b,Le as c,$e as d,je as e,ve as f,be as g,D as h,we as i,G as j,Pe as k,H as l,U as m,Ie as s,Ge as v};
