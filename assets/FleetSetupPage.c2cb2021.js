import{J as D,K as k,L as R,r as f,j as e,F as g,t as y,a as d,B as A,ao as P,bm as M,O as Y,k as b,aB as q,aC as U,aD as J,S as x,T as n,aE as K,bg as Q,bn as X,bo as Z,bp as ee,i as S,h as _,f as te,e as ne,ax as ae,b as $,ap as j,m as re,n as oe,o as ie,bj as ue,a6 as le,al as se,a2 as G,a3 as ce,bi as de}from"./index.4c1627a9.js";import{N as pe,P as he}from"./PageContent.458fcd43.js";import{d as fe}from"./Settings.688fc412.js";import{d as me,a as Fe}from"./ContentCopy.acd3ff63.js";import{A as ve}from"./ActionBar.4145f370.js";import{B as ge,S as ye,g as Se,a as xe,v as Ce,f as be,G as W,b as $e,A as Be}from"./fleetSetupValidation.d4c3d89a.js";import{E as Ae}from"./ExpandStack.89096ade.js";import{R as Ee}from"./ResponsiveDialog.0f44d934.js";import{T as _e}from"./TextField.2d04e7ef.js";import{P as De}from"./PageFooter.a2adf88e.js";import"./domUtils.e3328ef3.js";import"./useFormControl.f57ee12d.js";import"./sorting.c6946657.js";import"./Select.e46657bb.js";var w={},ke=k.exports;Object.defineProperty(w,"__esModule",{value:!0});var z=w.default=void 0,Re=ke(D),we=R,Te=(0,Re.default)((0,we.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");z=w.default=Te;const Ie=p=>{const{fleetSetups:t,fleetSetup:o,onChange:a,buttonProps:c}=p,u=f.exports.useMemo(()=>t.map(r=>({key:r.key,text:r.name,value:r.key})),[t]);return e(g,{children:e(ge,{icon:e(z,{}),text:y("fleetSetup.selectFleet"),value:o.key,options:u,onClick:a,buttonProps:c})})},Oe=p=>{const{fleetSetups:t,fleetSetup:o,grouping:a,onChangeFleet:c,onChangeGrouping:u,onEdit:r,onShare:l}=p;return e(ve,{left:s=>d(g,{children:[e(ye,{value:a,onChange:u,buttonProps:s}),e(Ie,{fleetSetups:t,fleetSetup:o,onChange:c,buttonProps:s}),e(A,{variant:"outlined",startIcon:e(fe,{}),onClick:r,...s,children:y("button.edit")},"edit")]}),right:s=>e(g,{children:e(A,{variant:"outlined",startIcon:e(me,{}),onClick:l,...s,children:y("button.share")},"share")})})},Pe=p=>{var r;const{initialFleetKey:t}=p,o=f.exports.useMemo(()=>Se(),[]),[a,c]=f.exports.useState(t&&(r=o.find(l=>l.key===t))!=null?r:o[0]),u=f.exports.useCallback(l=>{const s=o.find(v=>v.key===l);if(!s)throw new Error(`Invalid fleet key "${l}"`);c(s)},[o]);return{fleetSetups:o,fleetSetup:a,switchFleet:u}};var T={},Me=k.exports;Object.defineProperty(T,"__esModule",{value:!0});var V=T.default=void 0,je=Me(D),Ge=R,We=(0,je.default)((0,Ge.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");V=T.default=We;var I={},Ne=k.exports;Object.defineProperty(I,"__esModule",{value:!0});var H=I.default=void 0,ze=Ne(D),Ve=R,He=(0,ze.default)((0,Ve.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");H=I.default=He;function Le(p){const t={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return p.reduce((o,a)=>{const c=P(a.shipDefinition,a.moduleSelection);if(!c)return{...o,incomplete:!0};const u=M(c,a.count,o);return a.carriedShips.reduce((r,l)=>{const s=P(l.shipDefinition,null);return s?M(s,l.count,r):{...r,incomplete:!0}},u)},t)}const Ye=p=>{const{fleetSetup:t}=p,[o,a]=f.exports.useState(!1),{totalCost:c,shipCount:u,shipCountByType:r,shipCountByRow:l}=f.exports.useMemo(()=>xe(t.ships),[t.ships]),s=f.exports.useMemo(()=>Le(t.ships),[t.ships]),v=c>t.maxCost,C=t.totalReinforcementCount>t.maxReinforcement,m=f.exports.useMemo(()=>{const i=Ce(t);return Object.keys(i).map(F=>{const[h,L]=F.split("#"),B=Y(h);switch(L){case"self":return`${b(B)}\uFF1A${i[F]}`;case"ally":return`${b(B)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09\uFF1A${i[F]}`;case"ally2":return`${b(B)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09\uFF1A${i[F]}`;case"ally3":return`${b(B)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09\uFF1A${i[F]}`;default:return`${b(B)}\uFF1A${i[F]}`}})},[t]),E=v||C||m.length>0?e(H,{color:"error"}):e(V,{color:"primary"});return d(q,{expanded:o,onChange:()=>a(!o),children:[e(U,{expandIcon:o?e(J,{}):E,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:t.name}),!o&&d("div",{children:[e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u5897\u63F4\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:C?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`}),e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u3001\u53F8\u4EE4Pt\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})]})]})}),e(K,{children:o&&e(Q,{rows:[{key:"reinforcementCount",label:"\u5897\u63F4",value:e(n,{variant:"body2",sx:C?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`})},{key:"cost",label:"\u8266\u968A\u53F8\u4EE4Pt",value:e(n,{variant:"body2",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})},{key:"dpm",label:"\u5408\u8A08DPM",value:d(g,{children:[e(n,{variant:"body2",children:X(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"hp",label:"\u5408\u8A08HP",value:d(g,{children:[e(n,{variant:"body2",children:Z(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"speed",label:"\u901F\u5EA6",value:d(g,{children:[e(n,{variant:"body2",children:ee(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"shipCount",label:"\u8266\u8239",value:u>0?d(g,{children:[e(n,{variant:"body2",children:`\u5408\u8A08\u3000${u}`}),Object.keys(r).filter(i=>r[i]>0&&i!==S.CORVETTE&&i!==S.FIGHTER).map(i=>e(n,{variant:"body2",children:`${_(i)}\u3000${r[i]}`},i))]}):e(n,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:"\u8266\u8F09\u6A5F",value:r[S.FIGHTER]+r[S.CORVETTE]>0?d(g,{children:[r[S.FIGHTER]>0&&e(n,{variant:"body2",children:`${_(S.FIGHTER)}\u3000${r[S.FIGHTER]}`}),r[S.CORVETTE]>0&&e(n,{variant:"body2",children:`${_(S.CORVETTE)}\u3000${r[S.CORVETTE]}`})]}):e(n,{variant:"body2",children:"-"})},{key:"rowCount",label:"\u914D\u7F6E",value:u>0?e(g,{children:Object.keys(l).filter(i=>i!==te.NONE).map(i=>e(n,{variant:"body2",children:`${ne(i)}\u3000${l[i]}`},i))}):e(n,{variant:"body2",children:"-"})},...m.length>0?[{key:"warnings",label:"\u8B66\u544A",value:m.map((i,F)=>e(n,{variant:"body2",sx:{color:"red"},children:i},`warning_${F}`))}]:[]]})})]})},N=p=>{const{shipSelections:t}=p,{openShipDetailDialog:o}=ae();return e(x,{spacing:1,children:t==null?void 0:t.map(a=>{var c;return d(f.exports.Fragment,{children:[d(x,{spacing:1,direction:"row",children:[d(x,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e($,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(n,{variant:"body2",children:e(j,{onClick:()=>{o(a.shipDefinition.id)},children:b(a.shipDefinition)})}),a.reinforcement==="self"&&e(n,{variant:"body2",noWrap:!0,children:y("fleetSetup.reinforcementBrackets")}),a.reinforcement==="ally"&&e(n,{variant:"body2",noWrap:!0,children:y("fleetSetup.orgReinforcementABrackets")}),a.reinforcement==="ally2"&&e(n,{variant:"body2",noWrap:!0,children:y("fleetSetup.orgReinforcementBBrackets")}),a.reinforcement==="ally3"&&e(n,{variant:"body2",noWrap:!0,children:y("fleetSetup.orgReinforcementCBrackets")})]}),e($,{sx:{width:"50px"},children:a.reinforcement===null&&e(n,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(u=>{var r;return d(x,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(n,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e($,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${u.count}\xD7`})}),e(n,{variant:"body2",children:e(j,{onClick:()=>{o(u.shipDefinition.id)},children:b(u.shipDefinition)})})]},`${u.shipDefinition.id}_${(r=u.reinforcement)!=null?r:"initial"}`)})]},`${a.shipDefinition.id}_${(c=a.reinforcement)!=null?c:"initial"}`)})})},qe=p=>{const{fleetSetup:t,groupedShips:o,onClose:a}=p,[c,u]=f.exports.useState(!1),[r,l]=f.exports.useState(()=>be(t,o)),s=()=>{r&&oe(r).then(()=>{u(!0)})},v=m=>{l(m.target.value)},C=()=>{a(),u(!1)};return e(Ee,{title:"\u5171\u6709",content:d(x,{spacing:1,children:[e(_e,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:v,rows:10,defaultValue:r,fullWidth:!0}),!!navigator.clipboard&&e(A,{variant:"outlined",startIcon:c?e(re,{}):e(Fe,{}),onClick:s,fullWidth:!0,children:"\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306B\u30B3\u30D4\u30FC"})]}),actions:e(A,{variant:"outlined",onClick:C,children:"\u9589\u3058\u308B"}),onClose:C})},lt=()=>{const p=ie(),{fleetKey:t}=ue(),o=le(),a=se(o.breakpoints.up("lg")),[c,u]=f.exports.useState(!1),{fleetSetups:r,fleetSetup:l,switchFleet:s}=Pe({initialFleetKey:t!=null?t:null}),[v,C]=f.exports.useState(W.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),m=f.exports.useMemo(()=>$e(v,l),[l,v]),O=()=>{p("/fleetSetup/edit/"+l.key)},E=()=>{u(!0)},i=()=>{u(!1)},F=a&&m.groupedBy===W.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return d(g,{children:[e(pe,{currentRoute:"/fleetSetup"}),e(Oe,{fleetSetups:r,fleetSetup:l,grouping:v,onChangeFleet:s,onChangeGrouping:C,onEdit:O,onShare:E}),e(he,{disableContainer:F==="row",children:e($,{p:1,children:d(x,{spacing:1,children:[e(Ye,{fleetSetup:l}),l.ships.length>0?e(g,{children:F==="row"?e(x,{spacing:1,direction:"row",sx:{width:"100%"},children:m.groups.map(h=>e(G,{sx:{width:`${100/m.groups.length}%`},children:e($,{p:1,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:`${h.name}${h.count>0?`\uFF08${h.count}\u96BB\uFF09`:""}`}),e(ce,{}),e(N,{shipSelections:h.ships})]})})},h.id))}):e(Ae,{expandables:m.groups.map(h=>({id:h.id,initiallyOpened:!0,summary:d(n,{variant:"body1",children:[h.name,de()&&e("span",{children:"\xA0"}),h.count>0?y("fleetSetup.shipCountBrackets",{value:h.count}):""]}),details:e(N,{shipSelections:h.ships}),skip:h.ships.length===0}))},m.groupedBy)}):e(G,{children:e($,{p:2,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:y("fleetSetup.fleetFormation")}),e(Be,{severity:"info",children:y("fleetSetup.fleetEmptyNotice")})]})})}),e(n,{variant:"caption",align:"right",paragraph:!0,children:y("fleetSetup.pageFootnote")})]})})}),c&&e(qe,{fleetSetup:l,groupedShips:m,onClose:i}),e(De,{disableContainer:F==="row"})]})};export{lt as FleetSetupPage,lt as default};
