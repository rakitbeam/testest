import{J as B,K as w,L as A,r as m,j as e,F as g,t,a as d,B as D,ao as W,bm as j,O as U,k as $,aB as J,aC as Q,aD as X,S as x,T as r,bi as F,aE as Z,bg as ee,bn as te,bo as ne,bp as re,i as y,h as T,f as ae,e as oe,ax as ie,b as k,ap as G,m as le,n as se,o as ce,bj as de,a6 as pe,al as ue,a2 as V,a3 as he}from"./index.ff95e7d1.js";import{N as fe,P as me}from"./PageContent.28896ce2.js";import{d as Se}from"./Settings.206f45b0.js";import{d as ve,a as ge}from"./ContentCopy.4baa8b5c.js";import{A as ye}from"./ActionBar.4f0301cd.js";import{B as xe,S as be,g as Ce,a as ke,v as _e,f as Re,G as N,b as De,A as Fe}from"./fleetSetupValidation.23070f8b.js";import{E as Ee}from"./ExpandStack.990d38b6.js";import{R as Te}from"./ResponsiveDialog.a1cf79fd.js";import{T as $e}from"./TextField.454b9e90.js";import{P as Be}from"./PageFooter.7e0dd46e.js";import"./domUtils.2a976d65.js";import"./useFormControl.ebe9e6a5.js";import"./sorting.c6946657.js";import"./Select.0553045a.js";var I={},we=w.exports;Object.defineProperty(I,"__esModule",{value:!0});var H=I.default=void 0,Ae=we(B),Ie=A,Oe=(0,Ae.default)((0,Ie.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");H=I.default=Oe;const Pe=h=>{const{fleetSetups:n,fleetSetup:i,onChange:a,buttonProps:u}=h,l=m.exports.useMemo(()=>n.map(o=>({key:o.key,text:o.name,value:o.key})),[n]);return e(g,{children:e(xe,{icon:e(H,{}),text:t("fleetSetup.selectFleet"),value:i.key,options:l,onClick:a,buttonProps:u})})},Me=h=>{const{fleetSetups:n,fleetSetup:i,grouping:a,onChangeFleet:u,onChangeGrouping:l,onEdit:o,onShare:s}=h;return e(ye,{left:c=>d(g,{children:[e(be,{value:a,onChange:l,buttonProps:c}),e(Pe,{fleetSetups:n,fleetSetup:i,onChange:u,buttonProps:c}),e(D,{variant:"outlined",startIcon:e(Se,{}),onClick:o,...c,children:t("button.edit")},"edit")]}),right:c=>e(g,{children:e(D,{variant:"outlined",startIcon:e(ve,{}),onClick:s,...c,children:t("button.share")},"share")})})},We=h=>{var o;const{initialFleetKey:n}=h,i=m.exports.useMemo(()=>Ce(),[]),[a,u]=m.exports.useState(n&&(o=i.find(s=>s.key===n))!=null?o:i[0]),l=m.exports.useCallback(s=>{const c=i.find(v=>v.key===s);if(!c)throw new Error(`Invalid fleet key "${s}"`);u(c)},[i]);return{fleetSetups:i,fleetSetup:a,switchFleet:l}};var O={},je=w.exports;Object.defineProperty(O,"__esModule",{value:!0});var L=O.default=void 0,Ge=je(B),Ve=A,Ne=(0,Ge.default)((0,Ve.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");L=O.default=Ne;var P={},ze=w.exports;Object.defineProperty(P,"__esModule",{value:!0});var Y=P.default=void 0,He=ze(B),Le=A,Ye=(0,He.default)((0,Le.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");Y=P.default=Ye;function qe(h){const n={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return h.reduce((i,a)=>{const u=W(a.shipDefinition,a.moduleSelection);if(!u)return{...i,incomplete:!0};const l=j(u,a.count,i);return a.carriedShips.reduce((o,s)=>{const c=W(s.shipDefinition,null);return c?j(c,s.count,o):{...o,incomplete:!0}},l)},n)}const Ke=h=>{const{fleetSetup:n}=h,[i,a]=m.exports.useState(!1),{totalCost:u,shipCount:l,shipCountByType:o,shipCountByRow:s}=m.exports.useMemo(()=>ke(n.ships),[n.ships]),c=m.exports.useMemo(()=>qe(n.ships),[n.ships]),v=u>n.maxCost,b=n.totalReinforcementCount>n.maxReinforcement,S=m.exports.useMemo(()=>{const p=_e(n);return Object.keys(p).map(C=>{const[f,q]=C.split("#"),K=U(f),_=$(K),R=p[C];switch(q){case"self":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.selfReinforcement"),errorText:R});case"ally":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementA"),errorText:R});case"ally2":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementB"),errorText:R});case"ally3":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementC"),errorText:R});default:return t("fleetSetup.shipWithValidationError",{shipName:_,errorText:R})}})},[n]),E=v||b||S.length>0?e(Y,{color:"error"}):e(L,{color:"primary"});return d(J,{expanded:i,onChange:()=>a(!i),children:[e(Q,{expandIcon:i?e(X,{}):E,children:d(x,{spacing:1,children:[e(r,{variant:"body1",children:n.name}),!i&&d("div",{children:[d(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.reinforcementColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:b?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`}),d(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.commaCommandPointColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:v?{color:"red"}:{},children:`${u} / ${n.maxCost}`})]})]})}),e(Z,{children:i&&e(ee,{rows:[{key:"reinforcementCount",label:t("fleetSetup.reinforcement"),value:e(r,{variant:"body2",sx:b?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`})},{key:"cost",label:t("fleetSetup.totalFleetCommandPoints"),value:e(r,{variant:"body2",sx:v?{color:"red"}:{},children:`${u} / ${n.maxCost}`})},{key:"dpm",label:t("fleetSetup.totalFleetDpm"),value:d(g,{children:[e(r,{variant:"body2",children:te(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"hp",label:t("fleetSetup.totalFleetHp"),value:d(g,{children:[e(r,{variant:"body2",children:ne(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"speed",label:t("label.speed"),value:d(g,{children:[e(r,{variant:"body2",children:re(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"shipCount",label:t("label.ships"),value:l>0?d(g,{children:[e(r,{variant:"body2",children:t("fleetSetup.totalShipCountValue",{value:l})}),Object.keys(o).filter(p=>o[p]>0&&p!==y.CORVETTE&&p!==y.FIGHTER).map(p=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(p),value:o[p]})},p))]}):e(r,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:t("shipType.aircraft"),value:o[y.FIGHTER]+o[y.CORVETTE]>0?d(g,{children:[o[y.FIGHTER]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(y.FIGHTER),value:o[y.FIGHTER]})}),o[y.CORVETTE]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(y.CORVETTE),value:o[y.CORVETTE]})})]}):e(r,{variant:"body2",children:"-"})},{key:"rowCount",label:t("label.rowPlacement"),value:l>0?e(g,{children:Object.keys(s).filter(p=>p!==ae.NONE&&s[p]>0).map(p=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:oe(p),value:s[p]})},p))}):e(r,{variant:"body2",children:"-"})},...S.length>0?[{key:"warnings",label:t("label.warning"),value:S.map((p,C)=>e(r,{variant:"body2",sx:{color:"red"},children:p},`warning_${C}`))}]:[]]})})]})},z=h=>{const{shipSelections:n}=h,{openShipDetailDialog:i}=ie();return e(x,{spacing:1,children:n==null?void 0:n.map(a=>{var u;return d(m.exports.Fragment,{children:[d(x,{spacing:1,direction:"row",children:[d(x,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(r,{variant:"body2",children:e(G,{onClick:()=>{i(a.shipDefinition.id)},children:$(a.shipDefinition)})}),a.reinforcement==="self"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.reinforcementBrackets")}),a.reinforcement==="ally"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementABrackets")}),a.reinforcement==="ally2"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementBBrackets")}),a.reinforcement==="ally3"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementCBrackets")})]}),e(k,{sx:{width:"50px"},children:a.reinforcement===null&&e(r,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(l=>{var o;return d(x,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(r,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${l.count}\xD7`})}),e(r,{variant:"body2",children:e(G,{onClick:()=>{i(l.shipDefinition.id)},children:$(l.shipDefinition)})})]},`${l.shipDefinition.id}_${(o=l.reinforcement)!=null?o:"initial"}`)})]},`${a.shipDefinition.id}_${(u=a.reinforcement)!=null?u:"initial"}`)})})},Ue=h=>{const{fleetSetup:n,groupedShips:i,onClose:a}=h,[u,l]=m.exports.useState(!1),[o,s]=m.exports.useState(()=>Re(n,i)),c=()=>{o&&se(o).then(()=>{l(!0)})},v=S=>{s(S.target.value)},b=()=>{a(),l(!1)};return e(Te,{title:t("button.share"),content:d(x,{spacing:1,children:[e($e,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:v,rows:10,defaultValue:o,fullWidth:!0}),!!navigator.clipboard&&e(D,{variant:"outlined",startIcon:u?e(le,{}):e(ge,{}),onClick:c,fullWidth:!0,children:t("button.copyToClipboard")})]}),actions:e(D,{variant:"outlined",onClick:b,children:t("button.close")}),onClose:b})},dt=()=>{const h=ce(),{fleetKey:n}=de(),i=pe(),a=ue(i.breakpoints.up("lg")),[u,l]=m.exports.useState(!1),{fleetSetups:o,fleetSetup:s,switchFleet:c}=We({initialFleetKey:n!=null?n:null}),[v,b]=m.exports.useState(N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),S=m.exports.useMemo(()=>De(v,s),[s,v]),M=()=>{h("/fleetSetup/edit/"+s.key)},E=()=>{l(!0)},p=()=>{l(!1)},C=a&&S.groupedBy===N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return d(g,{children:[e(fe,{currentRoute:"/fleetSetup"}),e(Me,{fleetSetups:o,fleetSetup:s,grouping:v,onChangeFleet:c,onChangeGrouping:b,onEdit:M,onShare:E}),e(me,{disableContainer:C==="row",children:e(k,{p:1,children:d(x,{spacing:1,children:[e(Ke,{fleetSetup:s}),s.ships.length>0?e(g,{children:C==="row"?e(x,{spacing:1,direction:"row",sx:{width:"100%"},children:S.groups.map(f=>e(V,{sx:{width:`${100/S.groups.length}%`},children:e(k,{p:1,children:d(x,{spacing:1,children:[d(r,{variant:"body1",children:[f.name,F()&&e("span",{children:"\xA0"}),f.count>0?t("fleetSetup.shipCountBrackets",{value:f.count}):""]}),e(he,{}),e(z,{shipSelections:f.ships})]})})},f.id))}):e(Ee,{expandables:S.groups.map(f=>({id:f.id,initiallyOpened:!0,summary:d(r,{variant:"body1",children:[f.name,F()&&e("span",{children:"\xA0"}),f.count>0?t("fleetSetup.shipCountBrackets",{value:f.count}):""]}),details:e(z,{shipSelections:f.ships}),skip:f.ships.length===0}))},S.groupedBy)}):e(V,{children:e(k,{p:2,children:d(x,{spacing:1,children:[e(r,{variant:"body1",children:t("fleetSetup.fleetFormation")}),e(Fe,{severity:"info",children:t("fleetSetup.fleetEmptyNotice")})]})})}),e(r,{variant:"caption",align:"right",paragraph:!0,children:t("fleetSetup.pageFootnote")})]})})}),u&&e(Ue,{fleetSetup:s,groupedShips:S,onClose:p}),e(Be,{disableContainer:C==="row"})]})};export{dt as FleetSetupPage,dt as default};
