import{P as B,Q as A,R as I,r as f,k as e,F as g,t as n,bF as te,j as p,B as E,aB as W,bG as j,Y as ne,g as $,aN as oe,aO as ae,aP as re,w as b,T as o,bB as R,aQ as ie,bz as le,bH as se,bI as ce,bJ as pe,c as x,b as w,S as de,a as ue,aJ as he,q as D,aC as G,x as fe,y as me,z as Se,bC as ve,ah as ye,ay as ge,aa as N,ab as xe,aw as V}from"./index.3f1417d9.js";import{N as be,P as Ce}from"./PageContent.e34bb37f.js";import{d as ke}from"./Settings.50a01ff5.js";import{A as De}from"./ActionBar.d0a7f30b.js";import{B as L}from"./ButtonMenu.434b1495.js";import{u as z,g as Y,f as q,m as _e,s as Te,S as Fe,a as Re,b as we,v as Ee,G as H}from"./fleetSetupValidation.dffabc0e.js";import{d as $e,a as J,b as Be,I as Ae,E as Ie}from"./ExportDataDialog.df5a831f.js";import{d as Oe}from"./ConfirmationDialog.8b13b108.js";import{E as Pe}from"./ExpandStack.6bd06e33.js";import{R as Me}from"./ResponsiveDialog.6416e540.js";import{T as We}from"./TextField.c3d25b24.js";import{P as je}from"./PageFooter.1bd0c021.js";import{A as Ge}from"./Alert.c0090804.js";import"./Grow.dd2d6515.js";import"./domUtils.b45e3f39.js";import"./Popper.a55426a4.js";import"./sorting.c6946657.js";import"./Download.69dbfde4.js";import"./DialogContentText.6a95e841.js";import"./Select.63f90b86.js";import"./useFormControl.e66845a3.js";var O={},Ne=A.exports;Object.defineProperty(O,"__esModule",{value:!0});var Q=O.default=void 0,Ve=Ne(B),ze=I,He=(0,Ve.default)((0,ze.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");Q=O.default=He;const Ke=u=>{const{fleetSetups:t,fleetSetup:i,onChange:a,buttonProps:d}=u,s=f.exports.useMemo(()=>t.map(r=>({key:r.key,text:r.name,value:r.key})),[t]);return e(g,{children:e(L,{icon:e(Q,{}),text:n("fleetSetup.selectFleet"),value:i.key,options:s,onClick:a,buttonProps:d})})},Le=u=>{const{fleetSetup:t,grouping:i,onCopyAsText:a,buttonProps:d}=u,[s,r]=f.exports.useState(!1),[h,c]=f.exports.useState(!1),C=f.exports.useCallback((y,l)=>{(async()=>{const v=await te();if(!v){l();return}const m=z(v,t.key);y(m)})()},[t]),S=f.exports.useCallback(y=>{let l;try{l=JSON.parse(y)}catch(v){return console.log(v),null}return z(l,t.key)},[t]),k=f.exports.useCallback(y=>{const l=Y(i,y);return q(y,l)},[i]),F=f.exports.useCallback(y=>{switch(y){case"copyAsText":{a();break}case"import":{r(!0);break}case"export":{c(!0);break}}},[t]);return p(g,{children:[e(L,{icon:e($e,{}),text:n("button.share"),value:void 0,buttonProps:d,onClick:F,options:[{key:"copyAsText",icon:e(J,{}),text:n("label.copyAsText"),value:"copyAsText"},{key:"export",icon:e(Oe,{}),text:n("label.dataExport"),value:"export"},{key:"import",icon:e(Be,{}),text:n("label.dataImport"),value:"import"}]}),s&&e(Ae,{confirmDialogTitle:n("fleetSetup.importConfirmTitle"),confirmWarning:n("fleetSetup.importConfirmWarning",{name:t.name}),createPreview:k,parseInput:S,onImport:Ye,onClose:()=>r(!1),onSelectFile:C}),h&&e(Ie,{fileName:t.name,jsonContent:JSON.stringify(_e(t)),onClose:()=>c(!1)})]})};function Ye(u){Te(u),setTimeout(()=>{const t=new URL(window.location.href);window.location.href=`${t.origin}${t.pathname}#/fleetSetup/${u.key}`,window.location.reload()},0)}const qe=u=>{const{fleetSetups:t,fleetSetup:i,grouping:a,onChangeFleet:d,onChangeGrouping:s,onEdit:r,onShare:h}=u;return e(De,{left:c=>p(g,{children:[e(Fe,{value:a,onChange:s,buttonProps:c}),e(Ke,{fleetSetups:t,fleetSetup:i,onChange:d,buttonProps:c}),e(E,{variant:"outlined",startIcon:e(ke,{}),onClick:r,...c,children:n("button.edit")},"edit")]}),right:c=>e(g,{children:e(Le,{fleetSetup:i,grouping:a,onCopyAsText:h,buttonProps:c})})})},Je=u=>{const{initialFleetKey:t}=u,i=f.exports.useMemo(()=>Re(),[]),a=f.exports.useMemo(()=>{var d;return t&&(d=i.find(s=>s.key===t))!=null?d:i[0]},[t]);return{fleetSetups:i,fleetSetup:a}};var P={},Qe=A.exports;Object.defineProperty(P,"__esModule",{value:!0});var U=P.default=void 0,Ue=Qe(B),Xe=I,Ze=(0,Ue.default)((0,Xe.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");U=P.default=Ze;var M={},et=A.exports;Object.defineProperty(M,"__esModule",{value:!0});var X=M.default=void 0,tt=et(B),nt=I,ot=(0,tt.default)((0,nt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");X=M.default=ot;function at(u){const t={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return u.reduce((i,a)=>{const d=W(a.shipDefinition,a.moduleSelection);if(!d)return{...i,incomplete:!0};const s=j(d,a.count,i);return a.carriedShips.reduce((r,h)=>{const c=W(h.shipDefinition,null);return c?j(c,h.count,r):{...r,incomplete:!0}},s)},t)}const rt=u=>{const{fleetSetup:t}=u,[i,a]=f.exports.useState(!1),{totalCost:d,shipCount:s,shipCountByType:r,shipCountByRow:h}=f.exports.useMemo(()=>we(t.ships),[t.ships]),c=f.exports.useMemo(()=>at(t.ships),[t.ships]),C=d>t.maxCost,S=t.totalReinforcementCount>t.maxReinforcement,k=f.exports.useMemo(()=>{const l=Ee(t);return Object.keys(l).map(v=>{const[m,Z]=v.split("#"),ee=ne(m),_=$(ee),T=l[v];switch(Z){case"self":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.selfReinforcement"),errorText:T});case"ally":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementA"),errorText:T});case"ally2":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementB"),errorText:T});case"ally3":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementC"),errorText:T});default:return n("fleetSetup.shipWithValidationError",{shipName:_,errorText:T})}})},[t]),y=C||S||k.length>0?e(X,{color:"error"}):e(U,{color:"primary"});return p(oe,{expanded:i,onChange:()=>a(!i),children:[e(ae,{expandIcon:i?e(re,{}):y,children:p(b,{spacing:1,children:[e(o,{variant:"body1",children:t.name}),!i&&p("div",{children:[p(o,{variant:"body2",color:"text.secondary",component:"span",children:[n("fleetSetup.reinforcementColon"),R()?" ":""]}),e(o,{variant:"body2",color:"text.secondary",component:"span",sx:S?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`}),p(o,{variant:"body2",color:"text.secondary",component:"span",children:[n("fleetSetup.commaCommandPointColon"),R()?" ":""]}),e(o,{variant:"body2",color:"text.secondary",component:"span",sx:C?{color:"red"}:{},children:`${d} / ${t.maxCost}`})]})]})}),e(ie,{children:i&&e(le,{rows:[{key:"reinforcementCount",label:n("fleetSetup.reinforcement"),value:e(o,{variant:"body2",sx:S?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`})},{key:"cost",label:n("fleetSetup.totalFleetCommandPoints"),value:e(o,{variant:"body2",sx:C?{color:"red"}:{},children:`${d} / ${t.maxCost}`})},{key:"dpm",label:n("fleetSetup.totalFleetDpm"),value:p(g,{children:[e(o,{variant:"body2",children:se(c)}),c.incomplete&&e(o,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"hp",label:n("fleetSetup.totalFleetHp"),value:p(g,{children:[e(o,{variant:"body2",children:ce(c)}),c.incomplete&&e(o,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"speed",label:n("label.speed"),value:p(g,{children:[e(o,{variant:"body2",children:pe(c)}),c.incomplete&&e(o,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"shipCount",label:n("label.ships"),value:s>0?p(g,{children:[e(o,{variant:"body2",children:n("fleetSetup.totalShipCountValue",{value:s})}),Object.keys(r).filter(l=>r[l]>0&&l!==x.CORVETTE&&l!==x.FIGHTER).map(l=>e(o,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:w(l),value:r[l]})},l))]}):e(o,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:n("shipType.aircraft"),value:r[x.FIGHTER]+r[x.CORVETTE]>0?p(g,{children:[r[x.FIGHTER]>0&&e(o,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:w(x.FIGHTER),value:r[x.FIGHTER]})}),r[x.CORVETTE]>0&&e(o,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:w(x.CORVETTE),value:r[x.CORVETTE]})})]}):e(o,{variant:"body2",children:"-"})},{key:"rowCount",label:n("label.rowPlacement"),value:s>0?e(g,{children:Object.keys(h).filter(l=>l!==de.NONE&&h[l]>0).map(l=>e(o,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:ue(l),value:h[l]})},l))}):e(o,{variant:"body2",children:"-"})},...k.length>0?[{key:"warnings",label:n("label.warning"),value:k.map((l,v)=>e(o,{variant:"body2",sx:{color:"red"},children:l},`warning_${v}`))}]:[]]})})]})},K=u=>{const{shipSelections:t}=u,{openShipDetailDialog:i}=he();return e(b,{spacing:1,children:t==null?void 0:t.map(a=>{var d;return p(f.exports.Fragment,{children:[p(b,{spacing:1,direction:"row",children:[p(b,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(D,{component:"div",sx:{width:"25px"},children:e(o,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(o,{variant:"body2",children:e(G,{onClick:()=>{i(a.shipDefinition.id)},children:$(a.shipDefinition)})}),a.reinforcement==="self"&&e(o,{variant:"body2",noWrap:!0,children:n("fleetSetup.reinforcementBrackets")}),a.reinforcement==="ally"&&e(o,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementABrackets")}),a.reinforcement==="ally2"&&e(o,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementBBrackets")}),a.reinforcement==="ally3"&&e(o,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementCBrackets")})]}),e(D,{component:"div",sx:{width:"50px"},children:a.reinforcement===null&&e(o,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(s=>{var r;return p(b,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(o,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(D,{component:"div",sx:{width:"25px"},children:e(o,{variant:"body2",textAlign:"end",children:`${s.count}\xD7`})}),e(o,{variant:"body2",children:e(G,{onClick:()=>{i(s.shipDefinition.id)},children:$(s.shipDefinition)})})]},`${s.shipDefinition.id}_${(r=s.reinforcement)!=null?r:"initial"}`)})]},`${a.shipDefinition.id}_${(d=a.reinforcement)!=null?d:"initial"}`)})})},it=u=>{const{fleetSetup:t,groupedShips:i,onClose:a}=u,[d,s]=f.exports.useState(!1),[r,h]=f.exports.useState(()=>q(t,i)),c=()=>{r&&me(r).then(()=>{s(!0)})},C=k=>{h(k.target.value)},S=()=>{a(),s(!1)};return e(Me,{title:n("button.share"),content:p(b,{spacing:1,children:[e(We,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:C,rows:10,defaultValue:r,fullWidth:!0}),!!navigator.clipboard&&e(E,{variant:"outlined",startIcon:d?e(fe,{}):e(J,{}),onClick:c,fullWidth:!0,children:n("button.copyToClipboard")})]}),actions:e(E,{variant:"outlined",onClick:S,children:n("button.close")}),onClose:S})},Rt=()=>{const u=Se(),{fleetKey:t}=ve(),i=ye(),a=ge(i.breakpoints.up("lg")),[d,s]=f.exports.useState(!1),{fleetSetups:r,fleetSetup:h}=Je({initialFleetKey:t!=null?t:null}),[c,C]=f.exports.useState(H.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),S=f.exports.useMemo(()=>Y(c,h),[h,c]),k=m=>{u(V.fleetSetupByKey.path(m))},F=()=>{u(V.fleetSetupEditByKey.path(h.key))},y=()=>{s(!0)},l=()=>{s(!1)},v=a&&S.groupedBy===H.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return p(g,{children:[e(be,{currentRoute:"/fleetSetup"}),e(qe,{fleetSetups:r,fleetSetup:h,grouping:c,onChangeFleet:k,onChangeGrouping:C,onEdit:F,onShare:y}),e(Ce,{disableContainer:v==="row",children:e(D,{component:"div",p:1,children:p(b,{spacing:1,children:[e(rt,{fleetSetup:h}),h.ships.length>0?e(g,{children:v==="row"?e(b,{spacing:1,direction:"row",sx:{width:"100%"},children:S.groups.map(m=>e(N,{sx:{width:`${100/S.groups.length}%`},children:e(D,{component:"div",p:1,children:p(b,{spacing:1,children:[p(o,{variant:"body1",children:[m.name,R()&&e("span",{children:"\xA0"}),m.count>0?n("fleetSetup.shipCountBrackets",{value:m.count}):""]}),e(xe,{}),e(K,{shipSelections:m.ships})]})})},m.id))}):e(Pe,{expandables:S.groups.map(m=>({id:m.id,initiallyOpened:!0,summary:p(o,{variant:"body1",children:[m.name,R()&&e("span",{children:"\xA0"}),m.count>0?n("fleetSetup.shipCountBrackets",{value:m.count}):""]}),details:e(K,{shipSelections:m.ships}),skip:m.ships.length===0}))},S.groupedBy)}):e(N,{children:e(D,{component:"div",p:2,children:p(b,{spacing:1,children:[e(o,{variant:"body1",children:n("fleetSetup.fleetFormation")}),e(Ge,{severity:"info",children:n("fleetSetup.fleetEmptyNotice")})]})})}),e(o,{variant:"caption",align:"right",paragraph:!0,children:n("fleetSetup.pageFootnote")})]})})}),d&&e(it,{fleetSetup:h,groupedShips:S,onClose:l}),e(je,{disableContainer:v==="row"})]})};export{Rt as FleetSetupPage,Rt as default};
