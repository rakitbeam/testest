var z=Object.defineProperty,W=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var k=(t,e,r)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,s=(t,e)=>{for(var r in e||(e={}))q.call(e,r)&&k(t,r,e[r]);if(Y)for(var r of Y(e))J.call(e,r)&&k(t,r,e[r]);return t},c=(t,e)=>W(t,K(e));import{r as L,b,F as P,j as d,y as V,h as Z,P as Q,G as X,A as ee,z as te,M as re,E as ne,I as ue,K as oe,v as ae,w as ie,x as se}from"./vendor.612e55a5.js";import{g as ce}from"./domUtils.e9df6b0f.js";import{b as F,a as fe,S as _,t as me,s as S,g as B,C as E,e as le}from"./index.c9d82ed2.js";import{n as I}from"./sorting.c6946657.js";import{P as pe}from"./WishState.3db35fd5.js";const de=t=>{const{options:e,icon:r,text:n,value:u,onClick:o,buttonProps:a}=t,[i,f]=L.exports.useState(!1),m=L.exports.useRef(null),l=y=>{f(!1),o(y)};return b(P,{children:[d(V,{variant:"outlined",fullWidth:a==null?void 0:a.fullWidth,ref:m,disabled:a==null?void 0:a.disabled,size:a==null?void 0:a.size,children:d(Z,{startIcon:r,onClick:y=>{y.stopPropagation(),f(!0)},disabled:a==null?void 0:a.disabled,children:n})}),d(Q,{open:i,anchorEl:m.current,role:void 0,transition:!0,disablePortal:!0,style:{zIndex:2},children:({TransitionProps:y,placement:x})=>d(X,c(s({},y),{style:{transformOrigin:x==="bottom"?"center top":"center bottom"},children:d(ee,{style:{maxHeight:ce(m.current),overflowY:"auto"},children:d(te,{onClickAway:()=>f(!1),children:d(re,{children:e.map(h=>b(ne,{selected:h.value===u,onClick:A=>{A.stopPropagation(),l(h.value)},disabled:h.disabled,children:[h.icon&&d(ue,{children:h.icon}),d(oe,{children:h.text})]},h.key))})})})}))})]})};var O={},ye=ie.exports;Object.defineProperty(O,"__esModule",{value:!0});var w=O.default=void 0,he=ye(ae),Fe=se,_e=(0,he.default)((0,Fe.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");w=O.default=_e;var p;(function(t){t.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",t.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",t.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",t.SORT_BY_NAME="sortByName"})(p||(p={}));const j={initial:0,self:1,ally:2,ally2:3,ally3:4},$=(t,e)=>{var r,n;return j[(r=t.reinforcement)!=null?r:"initial"]-j[(n=e.reinforcement)!=null?n:"initial"]},R=I([(t,e)=>t.shipDefinition.name.localeCompare(e.shipDefinition.name,"ja-JP"),$]),T=I([(t,e)=>S(t.shipDefinition.type,t.shipDefinition.subType)-S(e.shipDefinition.type,e.shipDefinition.subType),R,$]);function Ye(t,e){switch(t){case p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:Ee(e.ships)};case p.GROUP_BY_TYPE_SORT_BY_NAME:return{groupedBy:t,groups:Re(e.ships)};case p.SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:e.ships.map(r=>c(s({},r),{carriedShips:[...r.carriedShips].sort(T)})).sort(T),count:e.ships.map(r=>r.count).reduce((r,n)=>r+n,0)}]};case p.SORT_BY_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:e.ships.map(r=>c(s({},r),{carriedShips:[...r.carriedShips].sort(R)})).sort(R),count:e.ships.map(r=>r.count).reduce((r,n)=>r+n,0)}]};default:throw new Error(`Unknown group and sort option "${t}"`)}}function Ee(t){return[_.FRONT,_.MIDDLE,_.BACK].map(e=>{const r=t.filter(u=>u.shipDefinition.row===e).map(u=>c(s({},u),{carriedShips:[...u.carriedShips].sort(T)})).sort(T),n=r.map(u=>u.count).reduce((u,o)=>u+o,0);return{id:e,name:me(e),ships:r,count:n}})}function Re(t){return[F.CARRIER,F.BATTLE_CRUISER,F.CRUISER,F.DESTROYER,F.FRIGATE].map(e=>{const r=t.filter(u=>u.shipDefinition.type===e).map(u=>c(s({},u),{carriedShips:[...u.carriedShips].sort(R)})).sort(R),n=r.map(u=>u.count).reduce((u,o)=>u+o,0);return{id:e,name:fe(e),ships:r,count:n}})}function ke(t,e){return[t.name,e.groups.filter(r=>r.ships.length>0).map(r=>[...e.groups.length>1?[`\u3010${r.name}\u3011`]:[],...r.ships.flatMap(n=>{const u=n.count*n.shipDefinition.cost;switch(n.reinforcement){case"self":return[`${n.count}\xD7\u3000${n.shipDefinition.name}\uFF08\u5897\u63F4\uFF09`,...g(n.carriedShips)];case"ally":return[`${n.count}\xD7\u3000${n.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09`,...g(n.carriedShips)];case"ally2":return[`${n.count}\xD7\u3000${n.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09`,...g(n.carriedShips)];case"ally3":return[`${n.count}\xD7\u3000${n.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09`,...g(n.carriedShips)];default:return[`${n.count}\xD7\u3000${n.shipDefinition.name}\uFF08${u}Pt\uFF09`,...g(n.carriedShips)]}})].join(`
`)).join(`

`),[`\u5897\u63F4\uFF1A${t.totalReinforcementCount}/${t.maxReinforcement}`,`\u6307\u4EE4Pt\uFF1A${t.totalCost}/${t.maxCost}`].join(`
`)].join(`

`)}function g(t){return t.map(e=>`\u3000\u3000${e.count}\xD7\u3000${e.shipDefinition.name}`)}const Le=t=>{const{value:e,onChange:r,buttonProps:n}=t;return d(P,{children:d(de,{icon:d(w,{}),text:"\u8868\u793A",value:e,options:[{key:p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:"\u914D\u7F6E\u5225\u3001\u8266\u7A2E\u2192\u540D\u524D\u9806",value:p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:p.GROUP_BY_TYPE_SORT_BY_NAME,text:"\u8266\u7A2E\u5225\u3001\u540D\u524D\u9806",value:p.GROUP_BY_TYPE_SORT_BY_NAME},{key:p.SORT_BY_TYPE_AND_NAME,text:"\u8266\u7A2E\u2192\u540D\u524D\u9806",value:p.SORT_BY_TYPE_AND_NAME},{key:p.SORT_BY_NAME,text:"\u540D\u524D\u9806",value:p.SORT_BY_NAME}],onClick:r,buttonProps:n})})};function be(t){var e,r,n,u,o;return[(e=C("fleet1",t))!=null?e:D(1),(r=C("fleet2",t))!=null?r:D(2),(n=C("fleet3",t))!=null?n:D(3),(u=C("fleet4",t))!=null?u:D(4),(o=C("fleet5",t))!=null?o:D(5)]}function Pe(t){const e=JSON.stringify(Ce(t));window.localStorage.setItem(t.key,e)}function C(t,e){const r=window.localStorage.getItem(t);if(!r)return null;const n=xe(r);return n?ge(n,t,e):null}function ge(t,e,r){const n=t.myListOnly===!0,u=t.ships.map(o=>{var a;return c(s({},G({shipDefinition:B(o.shipId),usedModules:(a=o.usedModules)!=null?a:null,count:o.count,reinforcement:o.reinforcement,userSettings:r,maxReinforcement:t.maxReinforcement,myListOnly:n})),{carriedShips:o.carriedShips.map(i=>U({shipId:i.shipId,count:i.count,reinforcement:o.reinforcement}))})});return{key:e,name:t.name,ships:u,totalCost:N(u),totalReinforcementCount:v(u),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:n}}function Ce(t){return{name:t.name,ships:t.ships.map(e=>({shipId:e.shipDefinition.id,usedModules:e.moduleSelection?De(e.moduleSelection):void 0,carriedShips:e.carriedShips.map(r=>({shipId:r.shipDefinition.id,count:r.count})),count:e.count,reinforcement:e.reinforcement})),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:t.myListOnly}}function De(t){const e=[];return Object.keys(t.groups).forEach(r=>{Object.keys(t.groups[r]).forEach(n=>{t.groups[r][n].usage==="used"&&e.push(t.groups[r][n].module.id)})}),e}function xe(t){try{return JSON.parse(t)}catch(e){return alert("ERROR - Failed to restore fleet setup"),console.error(e),null}}function D(t){return{key:`fleet${t}`,name:`${t}\u53F7\u8266\u968A`,ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function G(t){const{shipDefinition:e,usedModules:r,count:n,reinforcement:u,userSettings:o,maxReinforcement:a,myListOnly:i,temporary:f}=t,m=Ae(e,r,o,u,!1),l=M(e,m),y=u===null||e.type===F.FIGHTER||e.type===F.CORVETTE?e.operationLimit:Math.min(e.operationLimit,a);return{shipDefinition:e,carrierCapabilities:l,carriedShips:[],count:Math.max(0,n),reinforcement:u,maxCount:y,moduleSelection:m,temporary:f}}function Ae(t,e,r,n,u){if(!t.modules||t.modules.length===0)return null;const o=e!=null?e:t.modules.filter(i=>i.defaultModule).map(i=>i.id),a={static:t.staticModules===!0,groups:{}};return t.modules.forEach(i=>{var f;if(a.groups[i.category]||(a.groups[i.category]={}),a.static){a.groups[i.category][i.id]={module:i,usage:"used"};return}if(i.defaultModule||!u||(n==null?void 0:n.includes("ally"))||((f=r.modules[i.id])==null?void 0:f.possession)===pe.POSSESSED){a.groups[i.category][i.id]={module:i,usage:o.includes(i.id)?"used":"not_used"};return}a.groups[i.category][i.id]={module:i,usage:"not_possessed"}}),a}function M(t,e){var a;let r=0,n=0,u=0,o=(a=t.carryCorvette)!=null?a:0;if(t.carryFighter)switch(t.carryFighterType){case E.LARGE_FIGHTER:{r+=t.carryFighter;break}case E.MEDIUM_FIGHTER:{n+=t.carryFighter;break}case E.SMALL_FIGHTER:{u+=t.carryFighter;break}}return e&&Object.keys(e.groups).forEach(i=>{var f;Object.keys((f=e.groups[i])!=null?f:{}).forEach(m=>{var y,x,h,A;const l=e.groups[i][m];if(l.usage==="used"){switch(l.module.carryFighterType){case E.LARGE_FIGHTER:{r+=(y=l.module.carryFighter)!=null?y:0;break}case E.MEDIUM_FIGHTER:{n+=(x=l.module.carryFighter)!=null?x:0;break}case E.SMALL_FIGHTER:{u+=(h=l.module.carryFighter)!=null?h:0;break}}o+=(A=l.module.carryCorvette)!=null?A:0}})}),{canCarry:r+n+u+o>0,carryUpToLargeFighter:r,carryUpToMediumFighter:n,carryUpToSmallFighter:u,carryCorvette:o}}function U(t){const{shipId:e,count:r,reinforcement:n,temporary:u}=t;return{shipDefinition:B(e),count:Math.max(0,r),reinforcement:n,temporary:u}}function Se(t){const{shipId:e,count:r,reinforcement:n,fleetSetup:u,userSettings:o,keepZero:a}=t,i=B(e);let f=!0;const m=c(s({},u),{ships:u.ships.flatMap(l=>l.shipDefinition.id!==e||l.reinforcement!==n?l:(f=!1,!a&&r<=0?[]:[c(s({},l),{count:r})]))});return f?c(s({},m),{ships:[...m.ships,G({shipDefinition:i,usedModules:null,count:r,reinforcement:n,userSettings:o,maxReinforcement:u.maxReinforcement,myListOnly:u.myListOnly})],totalCost:N(m.ships),totalReinforcementCount:v(m.ships)}):c(s({},m),{totalCost:N(m.ships),totalReinforcementCount:v(m.ships)})}function Ie(t){const{shipId:e,carrierShipId:r,count:n,reinforcement:u,fleetSetup:o,keepZero:a}=t;return c(s({},o),{ships:o.ships.map(i=>i.shipDefinition.id!==r||i.reinforcement!==u?i:i.carriedShips.find(f=>f.shipDefinition.id===e)?c(s({},i),{carriedShips:i.carriedShips.flatMap(f=>{if(f.shipDefinition.id!==e)return[f];if(f.reinforcement!==u)throw new Error("Detected invalid reinforcement");return!a&&n<=0?[]:[c(s({},f),{count:Math.max(0,n),reinforcement:u})]})}):c(s({},i),{carriedShips:[...i.carriedShips,U({shipId:e,count:n,reinforcement:u})]}))})}function we(t){const{shipId:e,reinforcement:r,moduleSelection:n,fleetSetup:u}=t;return c(s({},u),{ships:u.ships.map(o=>o.shipDefinition.id!==e?o:(r==null?void 0:r.includes("ally"))?o.reinforcement===r?c(s({},o),{moduleSelection:n,carrierCapabilities:M(o.shipDefinition,n)}):o:!o.reinforcement||!o.reinforcement.includes("ally")?c(s({},o),{moduleSelection:n,carrierCapabilities:M(o.shipDefinition,n)}):o)})}function je(t,e,r){return c(s({},r),{groups:c(s({},r.groups),{[t]:Object.keys(r.groups[t]).reduce((n,u)=>{const o=r.groups[t][u];return c(s({},n),{[u]:u===e?c(s({},o),{usage:"used"}):c(s({},o),{usage:o.usage==="not_possessed"?"not_possessed":"not_used"})})},r.groups[t])})})}function N(t){return t.filter(e=>e.reinforcement===null).map(e=>e.count*e.shipDefinition.cost).reduce((e,r)=>e+r,0)}function v(t){return t.filter(e=>e.reinforcement!==null).map(e=>e.count).reduce((e,r)=>e+r,0)}function $e(t){let e=0;const r=t.map(o=>o.count).reduce((o,a)=>o+a,0),n=Object.keys(le).reduce((o,a)=>c(s({},o),{[a]:0}),{}),u={[_.FRONT]:0,[_.MIDDLE]:0,[_.BACK]:0,[_.NONE]:0};return t.forEach(o=>{o.reinforcement===null&&(e+=o.count*o.shipDefinition.cost),n[o.shipDefinition.type]+=o.count,u[o.shipDefinition.row]+=o.count,o.carriedShips.length>0&&o.carriedShips.forEach(a=>{n[a.shipDefinition.type]+=a.count})}),{shipCount:r,shipCountByType:n,shipCountByRow:u,totalCost:e}}function Ge(t){var r,n;const e={};return t.name.length===0&&(e.name="\u5FC5\u9808\u9805\u76EE"),(!Number.isFinite(t.maxReinforcement)||t.maxReinforcement<0)&&(e.maxReinforcement="\u7121\u52B9\u306A\u5024"),(!Number.isFinite(t.maxCost)||t.maxCost<300||t.maxCost>450)&&(e.maxCost="\u7121\u52B9\u306A\u5024"),t.maxCost>400&&t.maxReinforcement>5&&(e.maxReinforcement=(r=e.maxReinforcement)!=null?r:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059",e.maxCost=(n=e.maxCost)!=null?n:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059"),e}function Ue(t){const e={},r={},n={};return t.ships.forEach(u=>{const o=H(u.shipDefinition.id,u.reinforcement);if(r[o]){const a=r[o];r[o]={count:u.reinforcement===null?u.count:a.count,reinforcementCount:u.reinforcement!==null?u.count:a.reinforcementCount,operationLimit:u.shipDefinition.operationLimit}}else r[o]={count:u.reinforcement===null?u.count:0,reinforcementCount:u.reinforcement!==null?u.count:0,operationLimit:u.shipDefinition.operationLimit};u.carriedShips.forEach(a=>{const i=H(a.shipDefinition.id,u.reinforcement);n[i]?n[i].count+=a.count:n[i]={count:a.count,operationLimit:a.shipDefinition.operationLimit}})}),Object.keys(r).forEach(u=>{const o=r[u];o.count+o.reinforcementCount>o.operationLimit&&(e[u]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),Object.keys(n).forEach(u=>{const o=n[u];o.count>o.operationLimit&&(e[u]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),e}function H(t,e){const r=(e==null?void 0:e.includes("ally"))?e:"self";return`${t}#${r}`}export{de as B,p as G,Le as S,$e as a,Ye as b,Se as c,Ie as d,we as e,ke as f,be as g,D as h,Ge as i,G as j,je as k,H as l,U as m,Pe as s,Ue as v};
