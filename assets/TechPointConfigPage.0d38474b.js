import{M as Ie,k as s,C as Pe,D as Ee,E as N,L as z,_ as S,b6 as Je,r as p,P as $e,H as he,aV as Ae,I as qe,ai as Me,bs as Qe,aj as ye,J as Fe,j as g,K as Z,O as Te,b8 as et,b7 as tt,x as I,T,t as y,aw as ot,v as te,aA as nt,g as Le,aK as it,f as st,aH as rt,F as ee,c as A,B as ae,bd as $,br as at,av as xe,m as ct,a4 as we,bF as lt}from"./index.727a79b0.js";import{g as dt,S as ut,c as ht,a as pt}from"./ShipTypeFilterButton.27e05ebb.js";import{N as ft,P as gt}from"./PageContent.211ca318.js";import{P as mt}from"./PageFooter.3cb196ec.js";import{d as vt,C as St}from"./ConfirmationDialog.723ffd3b.js";import{E as Ct}from"./ExpandStack.14a32e1e.js";import{v as bt}from"./visuallyHidden.c6275901.js";import{c as yt,b as Tt}from"./boolMapUtils.54d90c14.js";import{d as xt}from"./Save.e5a11c89.js";import{d as wt,a as kt}from"./DeleteForever.40f16355.js";import{A as Rt}from"./ActionBar.cf74cf13.js";import{S as It}from"./SearchInput.1079526c.js";import"./domUtils.3d280a7e.js";import"./MenuItem.0311c2dc.js";import"./Popper.6efdb898.js";import"./ClickAwayListener.906d35f5.js";import"./useFormControl.1f311ebc.js";import"./ResponsiveDialog.80774326.js";import"./DialogContentText.0ac21f20.js";import"./TextField.6cd890fe.js";import"./Select.6832f968.js";import"./InputAdornment.50bc7ce2.js";var Pt=Ie(s("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Et=Ie(s("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function $t(e){return Pe("MuiRating",e)}const At=Ee("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]);var K=At;const Mt=["value"],Ft=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Lt(e,t,o){return e<t?t:e>o?o:e}function Ot(e){const t=e.toString().split(".")[1];return t?t.length:0}function ce(e,t){if(e==null)return e;const o=Math.round(e/t)*t;return Number(o.toFixed(Ot(t)))}const Vt=e=>{const{classes:t,size:o,readOnly:n,disabled:i,emptyValueFocused:r,focusVisible:a}=e,c={root:["root",`size${z(o)}`,i&&"disabled",a&&"focusVisible",n&&"readyOnly"],label:["label","pristine"],labelEmptyValue:[r&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Fe(c,$t,t)},zt=N("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${K.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${z(o.size)}`],o.readOnly&&t.readOnly]}})(({theme:e,ownerState:t})=>S({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",WebkitTapHighlightColor:"transparent",[`&.${K.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${K.focusVisible} .${K.iconActive}`]:{outline:"1px solid #999"},[`& .${K.visuallyHidden}`]:bt},t.size==="small"&&{fontSize:e.typography.pxToRem(18)},t.size==="large"&&{fontSize:e.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),Oe=N("label",{name:"MuiRating",slot:"Label",overridesResolver:(e,t)=>t.label})(({ownerState:e})=>S({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Nt=N("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.icon,o.iconEmpty&&t.iconEmpty,o.iconFilled&&t.iconFilled,o.iconHover&&t.iconHover,o.iconFocus&&t.iconFocus,o.iconActive&&t.iconActive]}})(({theme:e,ownerState:t})=>S({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),Bt=N("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>Je(e)&&e!=="iconActive",overridesResolver:(e,t)=>{const{iconActive:o}=e;return[t.decimal,o&&t.iconActive]}})(({iconActive:e})=>S({position:"relative"},e&&{transform:"scale(1.2)"}));function Dt(e){const t=he(e,Mt);return s("span",S({},t))}function ke(e){const{classes:t,disabled:o,emptyIcon:n,focus:i,getLabelText:r,highlightSelectedOnly:a,hover:c,icon:h,IconContainerComponent:d,isActive:u,itemValue:l,labelProps:C,name:x,onBlur:M,onChange:P,onClick:f,onFocus:w,readOnly:v,ownerState:k,ratingValue:O,ratingValueRounded:ne}=e,_=a?l===O:l<=O,J=l<=c,H=l<=i,ie=l===ne,X=Ae(),B=s(Nt,{as:d,value:l,className:Z(t.icon,_?t.iconFilled:t.iconEmpty,J&&t.iconHover,H&&t.iconFocus,u&&t.iconActive),ownerState:S({},k,{iconEmpty:!_,iconFilled:_,iconHover:J,iconFocus:H,iconActive:u}),children:n&&!_?n:h});return v?s("span",S({},C,{children:B})):g(p.exports.Fragment,{children:[g(Oe,S({ownerState:S({},k,{emptyValueFocused:void 0}),htmlFor:X},C,{children:[B,s("span",{className:t.visuallyHidden,children:r(l)})]})),s("input",{className:t.visuallyHidden,onFocus:w,onBlur:M,onChange:P,onClick:f,disabled:o,value:l,id:X,type:"radio",name:x,checked:ie})]})}const _t=s(Pt,{fontSize:"inherit"}),Ht=s(Et,{fontSize:"inherit"});function jt(e){return`${e} Star${e!==1?"s":""}`}const Ut=p.exports.forwardRef(function(t,o){const n=$e({name:"MuiRating",props:t}),{className:i,defaultValue:r=null,disabled:a=!1,emptyIcon:c=Ht,emptyLabelText:h="Empty",getLabelText:d=jt,highlightSelectedOnly:u=!1,icon:l=_t,IconContainerComponent:C=Dt,max:x=5,name:M,onChange:P,onChangeActive:f,onMouseLeave:w,onMouseMove:v,precision:k=1,readOnly:O=!1,size:ne="medium",value:_}=n,J=he(n,Ft),H=Ae(M),[ie,X]=qe({controlled:_,default:r,name:"Rating"}),B=ce(ie,k),Ne=Me(),[{hover:F,focus:q},Y]=p.exports.useState({hover:-1,focus:-1});let j=B;F!==-1&&(j=F),q!==-1&&(j=q);const{isFocusVisibleRef:ve,onBlur:Be,onFocus:De,ref:_e}=Qe(),[He,se]=p.exports.useState(!1),Se=p.exports.useRef(),je=ye(_e,Se),Ue=ye(je,o),Ge=m=>{v&&v(m);const b=Se.current,{right:E,left:Q}=b.getBoundingClientRect(),{width:U}=b.firstChild.getBoundingClientRect();let G;Ne.direction==="rtl"?G=(E-m.clientX)/(U*x):G=(m.clientX-Q)/(U*x);let L=ce(x*G+k/2,k);L=Lt(L,k,x),Y(D=>D.hover===L&&D.focus===L?D:{hover:L,focus:L}),se(!1),f&&F!==L&&f(m,L)},Xe=m=>{w&&w(m);const b=-1;Y({hover:b,focus:b}),f&&F!==b&&f(m,b)},Ce=m=>{let b=m.target.value===""?null:parseFloat(m.target.value);F!==-1&&(b=F),X(b),P&&P(m,b)},Ye=m=>{m.clientX===0&&m.clientY===0||(Y({hover:-1,focus:-1}),X(null),P&&parseFloat(m.target.value)===B&&P(m,null))},We=m=>{De(m),ve.current===!0&&se(!0);const b=parseFloat(m.target.value);Y(E=>({hover:E.hover,focus:b}))},Ke=m=>{if(F!==-1)return;Be(m),ve.current===!1&&se(!1);const b=-1;Y(E=>({hover:E.hover,focus:b}))},[Ze,be]=p.exports.useState(!1),W=S({},n,{defaultValue:r,disabled:a,emptyIcon:c,emptyLabelText:h,emptyValueFocused:Ze,focusVisible:He,getLabelText:d,icon:l,IconContainerComponent:C,max:x,precision:k,readOnly:O,size:ne}),V=Vt(W);return g(zt,S({ref:Ue,onMouseMove:Ge,onMouseLeave:Xe,className:Z(V.root,i),ownerState:W,role:O?"img":null,"aria-label":O?d(j):null},J,{children:[Array.from(new Array(x)).map((m,b)=>{const E=b+1,Q={classes:V,disabled:a,emptyIcon:c,focus:q,getLabelText:d,highlightSelectedOnly:u,hover:F,icon:l,IconContainerComponent:C,name:H,onBlur:Ke,onChange:Ce,onClick:Ye,onFocus:We,ratingValue:j,ratingValueRounded:B,readOnly:O,ownerState:W},U=E===Math.ceil(j)&&(F!==-1||q!==-1);if(k<1){const G=Array.from(new Array(1/k));return s(Bt,{className:Z(V.decimal,U&&V.iconActive),ownerState:W,iconActive:U,children:G.map((L,D)=>{const re=ce(E-1+(D+1)*k,k);return s(ke,S({},Q,{isActive:!1,itemValue:re,labelProps:{style:G.length-1===D?{}:{width:re===j?`${(D+1)*k*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),re)})},E)}return s(ke,S({},Q,{isActive:U,itemValue:E}),E)}),!O&&!a&&g(Oe,{className:Z(V.label,V.labelEmptyValue),ownerState:W,children:[s("input",{className:V.visuallyHidden,value:"",id:`${H}-empty`,type:"radio",name:H,checked:B==null,onFocus:()=>be(!0),onBlur:()=>be(!1),onChange:Ce}),s("span",{className:V.visuallyHidden,children:h})]})]}))});var Gt=Ut;function Xt(e){return Pe("MuiSwitch",e)}const Yt=Ee("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var R=Yt;const Wt=["className","color","edge","size","sx"],Kt=e=>{const{classes:t,edge:o,size:n,color:i,checked:r,disabled:a}=e,c={root:["root",o&&`edge${z(o)}`,`size${z(n)}`],switchBase:["switchBase",`color${z(i)}`,r&&"checked",a&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=Fe(c,Xt,t);return S({},t,h)},Zt=N("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${z(o.edge)}`],t[`size${z(o.size)}`]]}})(({ownerState:e})=>S({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${R.thumb}`]:{width:16,height:16},[`& .${R.switchBase}`]:{padding:4,[`&.${R.checked}`]:{transform:"translateX(16px)"}}})),Jt=N(dt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${R.input}`]:t.input},o.color!=="default"&&t[`color${z(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${R.checked}`]:{transform:"translateX(20px)"},[`&.${R.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${R.checked} + .${R.track}`]:{opacity:.5},[`&.${R.disabled} + .${R.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${R.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>S({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${R.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${R.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?et(e.palette[t.color].main,.62):tt(e.palette[t.color].main,.55)}`}},[`&.${R.checked} + .${R.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),qt=N("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Qt=N("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),eo=p.exports.forwardRef(function(t,o){const n=$e({props:t,name:"MuiSwitch"}),{className:i,color:r="primary",edge:a=!1,size:c="medium",sx:h}=n,d=he(n,Wt),u=S({},n,{color:r,edge:a,size:c}),l=Kt(u),C=s(Qt,{className:l.thumb,ownerState:u});return g(Zt,{className:Z(l.root,i),sx:h,ownerState:u,children:[s(Jt,S({type:"checkbox",icon:C,checkedIcon:C,ref:o,ownerState:u},d,{classes:S({},l,{root:l.switchBase})})),s(qt,{className:l.track,ownerState:u})]})});var Ve=eo;const le="1.5rem",Re="1rem",pe=e=>{const{techPoints:t,maxTechPoints:o,unlockCost:n,selected:i,incomplete:r,showZero:a}=e,c=i===!0&&n!==null&&n>0,h=(t!=null?t:0)+(c&&n!=null?n:0),d=(o!=null?o:0)+(c&&n!=null?n:0),u=i===!0||a||t!==null&&t>0,l=c||o!==null&&o>0;return g(I,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[s(T,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:y("techPointConfig.techPointShortColon")}),u&&s(T,{variant:"body1",textAlign:"right",sx:{fontSize:le},children:`${h}`}),g(I,{direction:"row",alignItems:"center",children:[s(T,{variant:"body1",textAlign:"right",sx:{fontSize:u?Re:le},color:u||!l?"text.secondary":"text.primary",children:`${u?"/ ":""}${l?`${d}`:"?"}`}),l&&r&&s(T,{variant:"body1",color:"text.secondary",sx:{fontSize:u?Re:le},children:"+"})]})]})},to=e=>{const{shipId:t,selected:o,onToggle:n}=e,i=Me(),r=ot(i.breakpoints.up("sm"));return s(Gt,{name:"toggle-favorite",size:r?"medium":"small",value:o?1:0,onChange:()=>{n(t)},max:1})},oo=e=>{const{shipConfig:t,onClickName:o,onToggleFavorite:n}=e;return g(I,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},justifyContent:"end",flexWrap:"wrap",children:[s(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g("div",{children:[g(I,{spacing:1,direction:"row",alignItems:"center",children:[s(T,{variant:"body1",children:s(nt,{onClick:()=>{o(t.shipDefinition.id)},children:Le(t.shipDefinition)})}),s(to,{shipId:t.shipDefinition.id,selected:t.favorite,onToggle:n})]}),t.incomplete&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),s(pe,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,unlockCost:0,incomplete:t.incomplete})]})},no=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:i}=e,r=o.selectedEnhancementIds.includes(n.id);return g(I,{spacing:1,direction:"row",children:[s("div",{children:s(Ve,{checked:r,onChange:()=>{i(t.shipDefinition.id,o.module.id,n.id)},disabled:!r&&!!o.module.skillSlots&&o.selectedEnhancementIds.length>=o.module.skillSlots})}),s(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(I,{spacing:.5,sx:{flexGrow:1},children:[s(T,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((a,c)=>s(T,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:a},`property_${c}`)),n.enhancement.cost===null&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.maxCostUnknown")})]})})]})},io=e=>{var c;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:i}=e,{mode:r}=it(),a=t.selectedModuleIds.includes(o.module.id);return g(I,{p:2,spacing:1,sx:{backgroundColor:r==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[g(I,{spacing:1,direction:"row",children:[s("div",{children:s(Ve,{checked:a,disabled:o.module.category==="STATIC",onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),s(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(te,{component:"div",sx:{flexGrow:1},children:[s(T,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${st(t.shipDefinition.id,o.module)}`}),o.incomplete&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),s(pe,{techPoints:a?o.techPoints:0,maxTechPoints:o.maxTechPoints,unlockCost:o.module.category!=="STATIC"&&!o.module.defaultModule?10:null,selected:a,incomplete:o.incomplete,showZero:!0})]}),a&&g(I,{spacing:3,pl:5,pt:1,pb:2,children:[g("div",{children:[s(T,{variant:"body1",color:"text.secondary",children:y("techPointConfig.enhancementSlotsColonValue",{value:`${o.selectedEnhancementIds.length} / ${(c=o.module.skillSlots)!=null?c:"?"}`})}),!o.module.skillSlots&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]}),Object.values(o.enhancements).map(h=>s(no,{shipConfig:t,moduleConfig:o,enhancementConfig:h,onToggleEnhancement:i},h.id))]})]})},so=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return g(I,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(i=>s(io,{shipConfig:t,moduleConfig:i,onToggleModule:o,onToggleEnhancement:n},i.module.id)),s(I,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:s(pe,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete,unlockCost:0})})]})},ro=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n,onToggleFavorite:i}=e,{openShipDetailDialog:r}=rt(),a=p.exports.useMemo(()=>{const c=[],h=[];return Object.values(t.ships).forEach(d=>{(d.favorite?c:h).push(d)}),[...c,...h]},[t]);return s(Ct,{expandables:a.map(c=>({id:c.shipDefinition.id,initiallyOpened:!1,expandIcon:s(vt,{}),summary:s(oo,{shipConfig:c,onClickName:r,onToggleFavorite:i}),details:s(so,{shipConfig:c,onToggleModule:n,onToggleEnhancement:o})}))})},ao=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:i,onReset:r,onCancel:a,onSave:c}=e,[h,d]=p.exports.useState(!1),u=p.exports.useCallback(()=>{d(!1),r()},[r]);return g(ee,{children:[s(Rt,{left:l=>s(ee,{children:s(ut,{filter:t,onChange:i,buttonProps:l,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[A.AUXILIARY,A.CARRIER,A.BATTLE_CRUISER,A.CRUISER,A.CORVETTE,A.FIGHTER]},"filter")}),right:l=>g(ee,{children:[s(ae,{variant:"outlined",startIcon:s(wt,{}),onClick:()=>{d(!0)},disabled:!n,...l,children:y("button.reset")},"reset"),s(ae,{variant:"outlined",startIcon:s(kt,{}),onClick:a,disabled:!o,...l,children:y("button.cancel")},"cancel"),s(ae,{variant:"contained",startIcon:s(xt,{}),onClick:c,disabled:!o,...l,children:y("button.save")},"save")]})}),h&&s(St,{title:y("button.reset"),question:y("techPointConfig.confirmReset"),cancelText:y("button.cancel"),confirmText:y("button.reset"),onCancel:()=>{d(!1)},onConfirm:u})]})};function ue(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:co(n)}),{})}}function co(e){var a,c,h,d;const t=(c=(a=e.modules)==null?void 0:a.filter(u=>u.skillSlots!==0).reduce((u,l)=>({...u,[l.id]:lo(l)}),{}))!=null?c:{},o=(d=(h=e.modules)==null?void 0:h.filter(u=>u.skillSlots!==0&&u.category==="STATIC"||u.defaultModule===!0).map(u=>u.id))!=null?d:[],n=fe(t,o),i=ge(t,o),r=me(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,unlockCost:i,incomplete:r,favorite:!1}}function lo(e){var i,r;const t=[...(i=e.flagshipEffects)!=null?i:[],...(r=e.skills)!=null?r:[]].filter(a=>!a.isDefault).reduce((a,c,h)=>{const d=`${c.type}_${h}`;return{...a,[d]:uo(c,d)}},{}),o=ho(e),n=e.category!=="STATIC"&&!e.defaultModule?10:0;return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,unlockCost:n,incomplete:po(e)}}function uo(e,t){return{id:t,enhancement:e,techPoints:e.isDefault?null:e.cost}}function fe(e,t){return Object.keys(e).map(o=>e[o]).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function ge(e,t){return Object.keys(e).map(o=>t.includes(o)?e[o].unlockCost:0).reduce((o,n)=>o+n,0)}function ho(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(t=>t.cost).sort((t,o)=>(o!=null?o:0)-(t!=null?t:0)).slice(0,e.skillSlots).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),0)}function me(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function po(e){var t,o;return e.skillSlots?!e.skillSlots||e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null):!0}function fo(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function go(e,t,o){var a;const n=(a=e.ships[t])!=null?a:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const r={...n,selectedModuleIds:fo(n,o)};return{...e,ships:{...e.ships,[t]:{...r,techPoints:ze(r),maxTechPoints:fe(r.modules,r.selectedModuleIds),unlockCost:ge(r.modules,r.selectedModuleIds),incomplete:me(r.modules,r.selectedModuleIds)}}}}function mo(e,t,o,n){var h,d;const i=(d=(h=e.ships[t])==null?void 0:h.modules[o])!=null?d:null;if(!i)throw new Error(`Missing config for "${t}", "${o}"`);const r=So(i.selectedEnhancementIds,n);if(!!i.module.skillSlots&&r.length>i.module.skillSlots)return e;const a={...i,selectedEnhancementIds:r},c={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...a,techPoints:Co(a)}}};return{...e,ships:{...e.ships,[t]:{...c,techPoints:ze(c)}}}}function vo(e,t){return{...e,ships:{...e.ships,[t]:{...e.ships[t],favorite:!e.ships[t].favorite}}}}function So(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function ze(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function Co(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const oe="tp";function bo(){return!!window.localStorage.getItem(oe)}function yo(){window.localStorage.removeItem(oe)}function To(e){const t=xo(e);window.localStorage.setItem(oe,JSON.stringify(t))}function de(e){const t=ue(e),o=window.localStorage.getItem(oe);if(!o)return t;let n;try{n=JSON.parse(o)}catch(i){return console.warn("Invalid tech point config",i),t}return wo(t,n)}function xo(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],i=[o,[]];Object.keys(n.modules).forEach(r=>{const a=n.modules[r],c=n.selectedModuleIds.includes(r)?1:0,h=n.favorite?1:0,d=[r,a.selectedEnhancementIds,c,h];i[1].push(d)}),t.ships.push(i)}),t}function wo(e,t){return t.ships.forEach(([o,n])=>{const i=e.ships[o];if(!i){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([r,a,c,h])=>{const d=i.modules[r];if(!d){console.warn(`Invalid moduleId "${r}" for ship ${i.shipDefinition.id}`);return}if(d.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${r}" (duplicate)`);return}if(a.forEach(u=>{var C,x,M,P;const l=d.enhancements[u];if(!l){console.warn(`Invalid enhancement "${u}"`);return}d.selectedEnhancementIds.push(u),d.techPoints=((C=d.techPoints)!=null?C:0)+((x=l.enhancement.cost)!=null?x:0),i.techPoints=((M=i.techPoints)!=null?M:0)+((P=l.enhancement.cost)!=null?P:0)}),c===1&&!i.selectedModuleIds.includes(r)){const u=Object.keys(i.modules).filter(l=>{const{category:C}=i.modules[l].module;return C!=="STATIC"&&C===d.module.category});i.selectedModuleIds=[...i.selectedModuleIds.filter(l=>!u.includes(l)),r]}i.favorite=h===1}),i.maxTechPoints=fe(i.modules,i.selectedModuleIds),i.unlockCost=ge(i.modules,i.selectedModuleIds),i.incomplete=me(i.modules,i.selectedModuleIds)}),e}const ko=e=>{const{supportedShips:t,visibleShips:o}=e,[n,i]=p.exports.useState(()=>ue([])),[r,a]=p.exports.useState(!1),[c,h]=p.exports.useState(bo());p.exports.useEffect(()=>{const f=de(t);i(f)},[t]);const d=p.exports.useCallback((f,w)=>{a(!0),i(v=>go(v,f,w))},[]),u=p.exports.useCallback((f,w,v)=>{a(!0),i(k=>mo(k,f,w,v))},[]),l=p.exports.useCallback(f=>{a(!0),i(w=>vo(w,f))},[]),C=p.exports.useCallback(()=>{yo();const f=ue(t);i(f),a(!1),h(!1)},[t]),x=p.exports.useCallback(()=>{const f=de(t);i(f),a(!1)},[n,t]),M=p.exports.useCallback(()=>{To(n);const f=de(t);i(f),a(!1),h(!0)},[n,t]);return{config:p.exports.useMemo(()=>({ships:o.reduce((f,w)=>{const v=n.ships[w.id];return v?{...f,[w.id]:v}:f},{})}),[n,o]),modified:r,stored:c,handleToggleModule:d,handleToggleEnhancement:u,handleToggleFavorite:l,handleReset:C,handleCancel:x,handleSave:M}},Ro=[A.AUXILIARY,A.CARRIER,A.BATTLE_CRUISER,A.CRUISER,A.CORVETTE],Io=[$.AT021_A,$.AT021_B,$.AT021_C,$.HAYREDDINGS_LOYAL,$.MISTRAL,$.SANDRAKE,$.STINGRAY,$.STRIX_A100,$.VITAS_A021,$.VITAS_B010,$.BALANCER_ANDERSON],Zo=()=>{const[e,t]=at(),[o,n]=p.exports.useState(()=>yt(e.getAll("filter"),ht()));p.exports.useEffect(()=>{t(xe.techPointConfig.createSearchParams({filter:Tt(o)}))},[o]);const i=p.exports.useMemo(()=>ct.filter(v=>v.source===we.TECH_FILE||v.source===we.STARTER_SHIP).filter(v=>Ro.includes(v.type)||Io.includes(v.id)),[]),[r,a]=p.exports.useState(""),c=p.exports.useMemo(()=>{const v=pt(i,o);return lt(v)},[i,o]),h=p.exports.useMemo(()=>r?c.filter(v=>Le(v).toLowerCase().includes(r)):c,[c,r]),{config:d,modified:u,stored:l,handleToggleModule:C,handleToggleEnhancement:x,handleToggleFavorite:M,handleReset:P,handleCancel:f,handleSave:w}=ko({supportedShips:i,visibleShips:h});return g(ee,{children:[s(ft,{currentRoute:xe.techPointConfig.path}),s(ao,{shipFilter:o,modified:u,stored:l,onFilterChange:n,onReset:P,onCancel:f,onSave:w}),s(gt,{children:g(I,{spacing:2,p:1,children:[g(I,{pt:1,pb:1,spacing:2,children:[s(T,{variant:"body2",children:y("techPointConfig.pageDescription1")}),s(T,{variant:"body2",children:y("techPointConfig.pageDescription2")}),s(T,{variant:"body2",children:y("techPointConfig.pageDescription3")})]}),s(It,{id:"searchShip",lowerCase:!0,value:r,placeholder:y("label.shipName"),onChange:a}),s(ro,{config:d,onToggleModule:C,onToggleEnhancement:x,onToggleFavorite:M})]})}),s(mt,{})]})};export{Zo as TechPointConfigPage,Zo as default};
