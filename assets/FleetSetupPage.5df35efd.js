import{N as B,O as A,P,r as h,l as e,F as g,t,by as ee,bz as te,k as p,m as ne,n as x,B as k,T as r,p as $,ay as W,bA as G,V as re,g as E,aK as oe,aL as ae,aM as ie,bu as T,aN as le,bs as se,bB as ce,bC as pe,bD as de,c as b,b as R,S as ue,a as he,aG as fe,az as N,v as me,w as Se,x as ve,bv as ye,ag as ge,av as xe,a8 as V,a9 as be}from"./index.dab279a8.js";import{N as Ce,P as ke}from"./PageContent.22aaa99a.js";import{d as _e}from"./Settings.89f8b760.js";import{A as we}from"./ActionBar.600b990f.js";import{B as L}from"./ButtonMenu.903721d6.js";import{g as H,f as q,m as Fe,u as Te,s as De,S as Re,a as $e,b as Ee,v as Be,G as j}from"./fleetSetupValidation.c85e51f2.js";import{d as Ae,a as Y,b as Pe}from"./FileOpen.e502c506.js";import{d as Ie,C as Oe}from"./ConfirmationDialog.1ba90a1c.js";import{A as K,T as Me}from"./TextField.75000223.js";import{E as We}from"./ExpandStack.4c1f2e69.js";import{R as Ge}from"./ResponsiveDialog.6743b1ad.js";import{P as Ne}from"./PageFooter.454ffcb7.js";import"./domUtils.87e00c8a.js";import"./useFormControl.e597382c.js";import"./sorting.c6946657.js";import"./DialogContentText.b8d749e0.js";import"./Select.1a6c3df1.js";var I={},Ve=A.exports;Object.defineProperty(I,"__esModule",{value:!0});var J=I.default=void 0,je=Ve(B),ze=P,Le=(0,je.default)((0,ze.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");J=I.default=Le;const He=f=>{const{fleetSetups:n,fleetSetup:l,onChange:a,buttonProps:d}=f,i=h.exports.useMemo(()=>n.map(o=>({key:o.key,text:o.name,value:o.key})),[n]);return e(g,{children:e(L,{icon:e(J,{}),text:t("fleetSetup.selectFleet"),value:l.key,options:i,onClick:a,buttonProps:d})})},qe=f=>{const{fleetSetup:n,grouping:l,onCopyAsText:a,buttonProps:d}=f,[i,o]=h.exports.useState(null),s=h.exports.useMemo(()=>{if(!i)return null;const S=H(l,i);return q(i,S)},[i,l]),c=h.exports.useCallback(S=>{switch(S){case"copyAsText":{a();break}case"import":{(async()=>{const m=await te();if(m){const F=Te(m,n.key);o(F)}})();break}case"export":{const m=Fe(n);ee(JSON.stringify(m),n.name);break}}},[n]),y=h.exports.useCallback(()=>{if(i){De(i),o(null);const S=new URL(window.location.href);window.location.href=`${S.origin}${S.pathname}#/fleetSetup/${n.key}`,window.location.reload()}},[i,n]);return p(g,{children:[e(L,{icon:e(Ae,{}),text:t("button.share"),value:void 0,buttonProps:d,onClick:c,options:[{key:"copyAsText",icon:e(Y,{}),text:t("label.copyAsText"),value:"copyAsText"},{key:"export",icon:e(Ie,{}),text:t("label.exportToFile"),value:"export"},{key:"import",icon:e(Pe,{}),text:t("label.importFromFile"),value:"import",disabled:!ne()}]}),i&&e(Oe,{title:t("fleetSetup.importConfirmTitle"),question:p(x,{children:[e(K,{severity:"warning",children:t("fleetSetup.importConfirmWarning",{name:n.name})}),e(k,{p:1,children:e(r,{variant:"body2",component:"div",children:e("pre",{children:s})})})]}),onConfirm:y,onCancel:()=>o(null)})]})},Ye=f=>{const{fleetSetups:n,fleetSetup:l,grouping:a,onChangeFleet:d,onChangeGrouping:i,onEdit:o,onShare:s}=f;return e(we,{left:c=>p(g,{children:[e(Re,{value:a,onChange:i,buttonProps:c}),e(He,{fleetSetups:n,fleetSetup:l,onChange:d,buttonProps:c}),e($,{variant:"outlined",startIcon:e(_e,{}),onClick:o,...c,children:t("button.edit")},"edit")]}),right:c=>e(g,{children:e(qe,{fleetSetup:l,grouping:a,onCopyAsText:s,buttonProps:c})})})},Ke=f=>{var o;const{initialFleetKey:n}=f,l=h.exports.useMemo(()=>$e(),[]),[a,d]=h.exports.useState(n&&(o=l.find(s=>s.key===n))!=null?o:l[0]),i=h.exports.useCallback(s=>{const c=l.find(y=>y.key===s);if(!c)throw new Error(`Invalid fleet key "${s}"`);d(c)},[l]);return{fleetSetups:l,fleetSetup:a,switchFleet:i}};var O={},Je=A.exports;Object.defineProperty(O,"__esModule",{value:!0});var U=O.default=void 0,Ue=Je(B),Qe=P,Xe=(0,Ue.default)((0,Qe.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");U=O.default=Xe;var M={},Ze=A.exports;Object.defineProperty(M,"__esModule",{value:!0});var Q=M.default=void 0,et=Ze(B),tt=P,nt=(0,et.default)((0,tt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");Q=M.default=nt;function rt(f){const n={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return f.reduce((l,a)=>{const d=W(a.shipDefinition,a.moduleSelection);if(!d)return{...l,incomplete:!0};const i=G(d,a.count,l);return a.carriedShips.reduce((o,s)=>{const c=W(s.shipDefinition,null);return c?G(c,s.count,o):{...o,incomplete:!0}},i)},n)}const ot=f=>{const{fleetSetup:n}=f,[l,a]=h.exports.useState(!1),{totalCost:d,shipCount:i,shipCountByType:o,shipCountByRow:s}=h.exports.useMemo(()=>Ee(n.ships),[n.ships]),c=h.exports.useMemo(()=>rt(n.ships),[n.ships]),y=d>n.maxCost,S=n.totalReinforcementCount>n.maxReinforcement,m=h.exports.useMemo(()=>{const u=Be(n);return Object.keys(u).map(C=>{const[v,X]=C.split("#"),Z=re(v),_=E(Z),w=u[C];switch(X){case"self":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.selfReinforcement"),errorText:w});case"ally":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementA"),errorText:w});case"ally2":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementB"),errorText:w});case"ally3":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementC"),errorText:w});default:return t("fleetSetup.shipWithValidationError",{shipName:_,errorText:w})}})},[n]),D=y||S||m.length>0?e(Q,{color:"error"}):e(U,{color:"primary"});return p(oe,{expanded:l,onChange:()=>a(!l),children:[e(ae,{expandIcon:l?e(ie,{}):D,children:p(x,{spacing:1,children:[e(r,{variant:"body1",children:n.name}),!l&&p("div",{children:[p(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.reinforcementColon"),T()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:S?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`}),p(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.commaCommandPointColon"),T()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:y?{color:"red"}:{},children:`${d} / ${n.maxCost}`})]})]})}),e(le,{children:l&&e(se,{rows:[{key:"reinforcementCount",label:t("fleetSetup.reinforcement"),value:e(r,{variant:"body2",sx:S?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`})},{key:"cost",label:t("fleetSetup.totalFleetCommandPoints"),value:e(r,{variant:"body2",sx:y?{color:"red"}:{},children:`${d} / ${n.maxCost}`})},{key:"dpm",label:t("fleetSetup.totalFleetDpm"),value:p(g,{children:[e(r,{variant:"body2",children:ce(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"hp",label:t("fleetSetup.totalFleetHp"),value:p(g,{children:[e(r,{variant:"body2",children:pe(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"speed",label:t("label.speed"),value:p(g,{children:[e(r,{variant:"body2",children:de(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"shipCount",label:t("label.ships"),value:i>0?p(g,{children:[e(r,{variant:"body2",children:t("fleetSetup.totalShipCountValue",{value:i})}),Object.keys(o).filter(u=>o[u]>0&&u!==b.CORVETTE&&u!==b.FIGHTER).map(u=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:R(u),value:o[u]})},u))]}):e(r,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:t("shipType.aircraft"),value:o[b.FIGHTER]+o[b.CORVETTE]>0?p(g,{children:[o[b.FIGHTER]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:R(b.FIGHTER),value:o[b.FIGHTER]})}),o[b.CORVETTE]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:R(b.CORVETTE),value:o[b.CORVETTE]})})]}):e(r,{variant:"body2",children:"-"})},{key:"rowCount",label:t("label.rowPlacement"),value:i>0?e(g,{children:Object.keys(s).filter(u=>u!==ue.NONE&&s[u]>0).map(u=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:he(u),value:s[u]})},u))}):e(r,{variant:"body2",children:"-"})},...m.length>0?[{key:"warnings",label:t("label.warning"),value:m.map((u,C)=>e(r,{variant:"body2",sx:{color:"red"},children:u},`warning_${C}`))}]:[]]})})]})},z=f=>{const{shipSelections:n}=f,{openShipDetailDialog:l}=fe();return e(x,{spacing:1,children:n==null?void 0:n.map(a=>{var d;return p(h.exports.Fragment,{children:[p(x,{spacing:1,direction:"row",children:[p(x,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(r,{variant:"body2",children:e(N,{onClick:()=>{l(a.shipDefinition.id)},children:E(a.shipDefinition)})}),a.reinforcement==="self"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.reinforcementBrackets")}),a.reinforcement==="ally"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementABrackets")}),a.reinforcement==="ally2"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementBBrackets")}),a.reinforcement==="ally3"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementCBrackets")})]}),e(k,{sx:{width:"50px"},children:a.reinforcement===null&&e(r,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(i=>{var o;return p(x,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(r,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${i.count}\xD7`})}),e(r,{variant:"body2",children:e(N,{onClick:()=>{l(i.shipDefinition.id)},children:E(i.shipDefinition)})})]},`${i.shipDefinition.id}_${(o=i.reinforcement)!=null?o:"initial"}`)})]},`${a.shipDefinition.id}_${(d=a.reinforcement)!=null?d:"initial"}`)})})},at=f=>{const{fleetSetup:n,groupedShips:l,onClose:a}=f,[d,i]=h.exports.useState(!1),[o,s]=h.exports.useState(()=>q(n,l)),c=()=>{o&&Se(o).then(()=>{i(!0)})},y=m=>{s(m.target.value)},S=()=>{a(),i(!1)};return e(Ge,{title:t("button.share"),content:p(x,{spacing:1,children:[e(Me,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:y,rows:10,defaultValue:o,fullWidth:!0}),!!navigator.clipboard&&e($,{variant:"outlined",startIcon:d?e(me,{}):e(Y,{}),onClick:c,fullWidth:!0,children:t("button.copyToClipboard")})]}),actions:e($,{variant:"outlined",onClick:S,children:t("button.close")}),onClose:S})},kt=()=>{const f=ve(),{fleetKey:n}=ye(),l=ge(),a=xe(l.breakpoints.up("lg")),[d,i]=h.exports.useState(!1),{fleetSetups:o,fleetSetup:s,switchFleet:c}=Ke({initialFleetKey:n!=null?n:null}),[y,S]=h.exports.useState(j.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),m=h.exports.useMemo(()=>H(y,s),[s,y]),F=()=>{f("/fleetSetup/edit/"+s.key)},D=()=>{i(!0)},u=()=>{i(!1)},C=a&&m.groupedBy===j.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return p(g,{children:[e(Ce,{currentRoute:"/fleetSetup"}),e(Ye,{fleetSetups:o,fleetSetup:s,grouping:y,onChangeFleet:c,onChangeGrouping:S,onEdit:F,onShare:D}),e(ke,{disableContainer:C==="row",children:e(k,{p:1,children:p(x,{spacing:1,children:[e(ot,{fleetSetup:s}),s.ships.length>0?e(g,{children:C==="row"?e(x,{spacing:1,direction:"row",sx:{width:"100%"},children:m.groups.map(v=>e(V,{sx:{width:`${100/m.groups.length}%`},children:e(k,{p:1,children:p(x,{spacing:1,children:[p(r,{variant:"body1",children:[v.name,T()&&e("span",{children:"\xA0"}),v.count>0?t("fleetSetup.shipCountBrackets",{value:v.count}):""]}),e(be,{}),e(z,{shipSelections:v.ships})]})})},v.id))}):e(We,{expandables:m.groups.map(v=>({id:v.id,initiallyOpened:!0,summary:p(r,{variant:"body1",children:[v.name,T()&&e("span",{children:"\xA0"}),v.count>0?t("fleetSetup.shipCountBrackets",{value:v.count}):""]}),details:e(z,{shipSelections:v.ships}),skip:v.ships.length===0}))},m.groupedBy)}):e(V,{children:e(k,{p:2,children:p(x,{spacing:1,children:[e(r,{variant:"body1",children:t("fleetSetup.fleetFormation")}),e(K,{severity:"info",children:t("fleetSetup.fleetEmptyNotice")})]})})}),e(r,{variant:"caption",align:"right",paragraph:!0,children:t("fleetSetup.pageFootnote")})]})})}),d&&e(at,{fleetSetup:s,groupedShips:m,onClose:u}),e(Ne,{disableContainer:C==="row"})]})};export{kt as FleetSetupPage,kt as default};
