var q=Object.defineProperty,J=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var P=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))Z.call(e,n)&&P(t,n,e[n]);if(S)for(var n of S(e))K.call(e,n)&&P(t,n,e[n]);return t},p=(t,e)=>J(t,V(e));import{c as Q,i as X,r as ee}from"./NavigationBar.ff166a92.js";import{r as k,b as w,F as G,j as l,s as te,h as ne,P as re,G as ie,t as oe,v as ae,M as se,w as ue,x as ce,z as fe}from"./vendor.4663e7d5.js";import{g as me}from"./domUtils.e9df6b0f.js";import{b as T,a as pe,S as R,t as le,s as L,g,o as E,d as he}from"./index.bd9adf92.js";import{n as U}from"./sorting.c6946657.js";import{P as de}from"./WishState.3db35fd5.js";const ye=t=>{const{options:e,icon:n,text:r,value:i,onClick:o,buttonProps:a}=t,[u,s]=k.exports.useState(!1),c=k.exports.useRef(null),d=_=>{s(!1),o(_)};return w(G,{children:[l(te,{variant:"outlined",fullWidth:a==null?void 0:a.fullWidth,ref:c,disabled:a==null?void 0:a.disabled,size:a==null?void 0:a.size,children:l(ne,{startIcon:n,onClick:_=>{_.stopPropagation(),s(!0)},disabled:a==null?void 0:a.disabled,children:r})}),l(re,{open:u,anchorEl:c.current,role:void 0,transition:!0,disablePortal:!0,style:{zIndex:2},children:({TransitionProps:_,placement:B})=>l(ie,p(m({},_),{style:{transformOrigin:B==="bottom"?"center top":"center bottom"},children:l(oe,{style:{maxHeight:me(c.current),overflowY:"auto"},children:l(ae,{onClickAway:()=>s(!1),children:l(se,{children:e.map(h=>w(ue,{selected:h.value===i,onClick:y=>{y.stopPropagation(),d(h.value)},disabled:h.disabled,children:[h.icon&&l(ce,{children:h.icon}),l(fe,{children:h.text})]},h.key))})})})}))})]})};var x={},_e=X.exports;Object.defineProperty(x,"__esModule",{value:!0});var b=x.default=void 0,Re=_e(Q),Ee=ee,Te=(0,Re.default)((0,Ee.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");b=x.default=Te;var f;(function(t){t.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",t.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",t.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",t.SORT_BY_NAME="sortByName"})(f||(f={}));const $={initial:0,self:1,ally:2},j=(t,e)=>{var n,r;return $[(n=t.reinforcement)!=null?n:"initial"]-$[(r=e.reinforcement)!=null?r:"initial"]},A=U([(t,e)=>t.shipDefinition.name.localeCompare(e.shipDefinition.name,"ja-JP"),j]),H=U([(t,e)=>L(t.shipDefinition.type,t.shipDefinition.subType)-L(e.shipDefinition.type,e.shipDefinition.subType),A,j]);function Ie(t,e){switch(t){case f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:De(e.ships)};case f.GROUP_BY_TYPE_SORT_BY_NAME:return{groupedBy:t,groups:Fe(e.ships)};case f.SORT_BY_TYPE_AND_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:[...e.ships].sort(H),count:e.ships.map(n=>n.count).reduce((n,r)=>n+r,0)}]};case f.SORT_BY_NAME:return{groupedBy:t,groups:[{id:"all",name:"\u7DE8\u6210",ships:[...e.ships].sort(A),count:e.ships.map(n=>n.count).reduce((n,r)=>n+r,0)}]};default:throw new Error(`Unknown group and sort option "${t}"`)}}function De(t){return[R.FRONT,R.MIDDLE,R.BACK].map(e=>{const n=t.filter(i=>i.shipDefinition.row===e).sort(H),r=n.map(i=>i.count).reduce((i,o)=>i+o,0);return{id:e,name:le(e),ships:n,count:r}})}function Fe(t){return[T.CARRIER,T.BATTLE_CRUISER,T.CRUISER,T.DESTROYER,T.FRIGATE].map(e=>{const n=t.filter(i=>i.shipDefinition.type===e).sort(A),r=n.map(i=>i.count).reduce((i,o)=>i+o,0);return{id:e,name:pe(e),ships:n,count:r}})}function Se(t,e){return[t.name,e.groups.filter(n=>n.ships.length>0).map(n=>[...e.groups.length>1?[`\u3010${n.name}\u3011`]:[],...n.ships.map(r=>{const i=r.count*r.shipDefinition.cost;switch(r.reinforcement){case"self":return`${r.count}\xD7\u3000${r.shipDefinition.name}\uFF08\u5897\u63F4\uFF09`;case"ally":return`${r.count}\xD7\u3000${r.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF09`;default:return`${r.count}\xD7\u3000${r.shipDefinition.name}\uFF08${i}Pt\uFF09`}})].join(`
`)).join(`

`),[`\u5897\u63F4\uFF1A${t.totalReinforcementCount}/${t.maxReinforcement}`,`\u6307\u4EE4Pt\uFF1A${t.totalCost}/${t.maxCost}`].join(`
`)].join(`

`)}const Pe=t=>{const{value:e,onChange:n,buttonProps:r}=t;return l(G,{children:l(ye,{icon:l(b,{}),text:"\u8868\u793A",value:e,options:[{key:f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:"\u914D\u7F6E\u5225\u3001\u8266\u7A2E\u2192\u540D\u524D\u9806",value:f.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:f.GROUP_BY_TYPE_SORT_BY_NAME,text:"\u8266\u7A2E\u5225\u3001\u540D\u524D\u9806",value:f.GROUP_BY_TYPE_SORT_BY_NAME},{key:f.SORT_BY_TYPE_AND_NAME,text:"\u8266\u7A2E\u2192\u540D\u524D\u9806",value:f.SORT_BY_TYPE_AND_NAME},{key:f.SORT_BY_NAME,text:"\u540D\u524D\u9806",value:f.SORT_BY_NAME}],onClick:n,buttonProps:r})})};function ke(t){var e,n,r,i,o;return[(e=D("fleet1",t))!=null?e:F(1),(n=D("fleet2",t))!=null?n:F(2),(r=D("fleet3",t))!=null?r:F(3),(i=D("fleet4",t))!=null?i:F(4),(o=D("fleet5",t))!=null?o:F(5)]}function we(t){const e=JSON.stringify(ge(t));window.localStorage.setItem(t.key,e)}function D(t,e){const n=window.localStorage.getItem(t);if(!n)return null;const r=xe(n);return r?Be(r,t,e):null}function Be(t,e,n){const r=t.ships.map(i=>p(m({},z({shipDefinition:g(i.shipId),count:i.count,reinforcement:i.reinforcement,userSettings:n,maxReinforcement:t.maxReinforcement})),{carriedShips:i.carriedShips.map(o=>W({shipId:o.shipId,count:o.count,reinforcement:i.reinforcement}))}));return{key:e,name:t.name,ships:r,totalCost:C(r),totalReinforcementCount:O(r),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:t.myListOnly===!0}}function ge(t){return{name:t.name,ships:t.ships.map(e=>({shipId:e.shipDefinition.id,carriedShips:e.carriedShips.map(n=>({shipId:n.shipDefinition.id,count:n.count})),count:e.count,reinforcement:e.reinforcement})),maxReinforcement:t.maxReinforcement,maxCost:t.maxCost,myListOnly:t.myListOnly}}function xe(t){try{return JSON.parse(t)}catch(e){return alert("ERROR - Failed to restore fleet setup"),console.error(e),null}}function F(t){return{key:`fleet${t}`,name:`${t}\u53F7\u8266\u968A`,ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function z(t){var B,h;const{shipDefinition:e,count:n,reinforcement:r,userSettings:i,maxReinforcement:o,temporary:a}=t;let u=0,s=0,c=0,d=(B=e.carryCorvette)!=null?B:0;if(e.carryFighter)switch(e.carryFighterType){case E.LARGE_FIGHTER:{u+=e.carryFighter;break}case E.MEDIUM_FIGHTER:{s+=e.carryFighter;break}case E.SMALL_FIGHTER:{c+=e.carryFighter;break}}(h=e.modules)==null||h.forEach(y=>{var M,N,Y,v,I;if(e.staticModules||((M=i.modules[`${e.id}.${y.id}`])==null?void 0:M.possession)===de.POSSESSED){switch(y.carryFighterType){case E.LARGE_FIGHTER:{u+=(N=y.carryFighter)!=null?N:0;break}case E.MEDIUM_FIGHTER:{s+=(Y=y.carryFighter)!=null?Y:0;break}case E.SMALL_FIGHTER:{c+=(v=y.carryFighter)!=null?v:0;break}}d+=(I=y.carryCorvette)!=null?I:0}});const _=r===null?e.operationLimit:Math.min(e.operationLimit,o);return{shipDefinition:e,carryUpToLargeFighter:u,carryUpToMediumFighter:s,carryUpToSmallFighter:c,carryCorvette:d,carriedShips:[],count:Math.max(0,n),reinforcement:r,maxCount:_,temporary:a}}function W(t){const{shipId:e,count:n,reinforcement:r,temporary:i}=t;return{shipDefinition:g(e),count:Math.max(0,n),reinforcement:r,temporary:i}}function Ge(t){const{shipId:e,count:n,reinforcement:r,fleetSetup:i,userSettings:o,keepZero:a}=t,u=g(e);let s=!0;const c=p(m({},i),{ships:i.ships.flatMap(d=>d.shipDefinition.id!==e||d.reinforcement!==r?d:(s=!1,!a&&n<=0?[]:[p(m({},d),{count:n})]))});return s?p(m({},c),{ships:[...c.ships,z({shipDefinition:u,count:n,reinforcement:r,userSettings:o,maxReinforcement:i.maxReinforcement})],totalCost:C(c.ships),totalReinforcementCount:O(c.ships)}):p(m({},c),{totalCost:C(c.ships),totalReinforcementCount:O(c.ships)})}function Le(t){const{shipId:e,carrierShipId:n,count:r,reinforcement:i,fleetSetup:o,keepZero:a}=t;return p(m({},o),{ships:o.ships.map(u=>u.shipDefinition.id!==n||u.reinforcement!==i?u:u.carriedShips.find(s=>s.shipDefinition.id===e)?p(m({},u),{carriedShips:u.carriedShips.flatMap(s=>{if(s.shipDefinition.id!==e)return[s];if(s.reinforcement!==i)throw new Error("Detected invalid reinforcement");return!a&&r<=0?[]:[p(m({},s),{count:Math.max(0,r),reinforcement:i})]})}):p(m({},u),{carriedShips:[...u.carriedShips,W({shipId:e,count:r,reinforcement:i})]}))})}function C(t){return t.filter(e=>e.reinforcement===null).map(e=>e.count*e.shipDefinition.cost).reduce((e,n)=>e+n,0)}function O(t){return t.filter(e=>e.reinforcement!==null).map(e=>e.count).reduce((e,n)=>e+n,0)}function Ue(t){return t.carryCorvette>0||t.carryUpToLargeFighter>0||t.carryUpToMediumFighter>0||t.carryUpToSmallFighter>0}function be(t){let e=0;const n=t.map(o=>o.count).reduce((o,a)=>o+a,0),r=Object.keys(he).reduce((o,a)=>p(m({},o),{[a]:0}),{}),i={[R.FRONT]:0,[R.MIDDLE]:0,[R.BACK]:0,[R.NONE]:0};return t.forEach(o=>{o.reinforcement===null&&(e+=o.count*o.shipDefinition.cost),r[o.shipDefinition.type]+=o.count,i[o.shipDefinition.row]+=o.count,o.carriedShips.length>0&&o.carriedShips.forEach(a=>{r[a.shipDefinition.type]+=a.count})}),{shipCount:n,shipCountByType:r,shipCountByRow:i,totalCost:e}}export{ye as B,f as G,Pe as S,be as a,Ie as b,Ge as c,Le as d,F as e,Se as f,ke as g,z as h,Ue as i,we as s};
