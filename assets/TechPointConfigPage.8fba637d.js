import{D as K,C as V,E as R,L as P,_ as y,O as j,b8 as W,b7 as Y,r as p,P as q,H as Q,k as i,j as f,K as ee,J as te,x as v,T,t as m,v as E,aA as oe,g as H,aK as ne,f as se,aH as ie,F as $,c as b,B as A,br as re,av as L,m as ce,a4 as U,bF as le}from"./index.c0102965.js";import{g as ae,S as de,c as ue,a as he}from"./ShipTypeFilterButton.35400437.js";import{N as pe,P as fe}from"./PageContent.c57ff487.js";import{P as ge}from"./PageFooter.012d8f78.js";import{d as me}from"./Settings.4a8895dd.js";import{E as Se}from"./ExpandStack.5d22df3e.js";import{c as Ce,b as Te}from"./boolMapUtils.54d90c14.js";import{d as ve}from"./Save.d9f87c11.js";import{d as be,a as xe}from"./DeleteForever.c1dcc644.js";import{A as ke}from"./ActionBar.c4fe5a50.js";import{C as we}from"./ConfirmationDialog.2b1077d0.js";import{S as Pe}from"./SearchInput.563feff7.js";import"./domUtils.4f25a6c5.js";import"./MenuItem.b8435d40.js";import"./Popper.4ef64c1e.js";import"./ClickAwayListener.3fb97e7a.js";import"./useFormControl.a391276c.js";import"./ResponsiveDialog.af97cdd9.js";import"./DialogContentText.7e41b6fe.js";import"./TextField.2c2d20ca.js";import"./Select.50584adf.js";import"./InputAdornment.02bcd35c.js";function ye(e){return V("MuiSwitch",e)}const Ie=K("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var C=Ie;const $e=["className","color","edge","size","sx"],Ee=e=>{const{classes:t,edge:o,size:n,color:s,checked:r,disabled:c}=e,a={root:["root",o&&`edge${P(o)}`,`size${P(n)}`],switchBase:["switchBase",`color${P(s)}`,r&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=te(a,ye,t);return y({},t,d)},Re=R("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${P(o.edge)}`],t[`size${P(o.size)}`]]}})(({ownerState:e})=>y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${C.thumb}`]:{width:16,height:16},[`& .${C.switchBase}`]:{padding:4,[`&.${C.checked}`]:{transform:"translateX(16px)"}}})),Me=R(ae,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${C.input}`]:t.input},o.color!=="default"&&t[`color${P(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${C.checked}`]:{transform:"translateX(20px)"},[`&.${C.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${C.checked} + .${C.track}`]:{opacity:.5},[`&.${C.disabled} + .${C.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${C.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>y({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:j(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${C.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:j(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${C.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?W(e.palette[t.color].main,.62):Y(e.palette[t.color].main,.55)}`}},[`&.${C.checked} + .${C.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Ae=R("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Oe=R("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),De=p.exports.forwardRef(function(t,o){const n=q({props:t,name:"MuiSwitch"}),{className:s,color:r="primary",edge:c=!1,size:a="medium",sx:d}=n,h=Q(n,$e),l=y({},n,{color:r,edge:c,size:a}),u=Ee(l),x=i(Oe,{className:u.thumb,ownerState:l});return f(Re,{className:ee(u.root,s),sx:d,ownerState:l,children:[i(Me,y({type:"checkbox",icon:x,checkedIcon:x,ref:o,ownerState:l},h,{classes:y({},u,{root:u.switchBase})})),i(Ae,{className:u.track,ownerState:l})]})});var X=De;const O="1.5rem",G="1rem",N=e=>{const{techPoints:t,maxTechPoints:o,unlockCost:n,selected:s,incomplete:r,showZero:c}=e,a=s===!0&&n!==null&&n>0,d=(t!=null?t:0)+(a&&n!=null?n:0),h=(o!=null?o:0)+(a&&n!=null?n:0),l=s===!0||c||t!==null&&t>0,u=a||o!==null&&o>0;return f(v,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[i(T,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:m("techPointConfig.techPointShortColon")}),l&&i(T,{variant:"body1",textAlign:"right",sx:{fontSize:O},children:`${d}`}),f(v,{direction:"row",alignItems:"center",children:[i(T,{variant:"body1",textAlign:"right",sx:{fontSize:l?G:O},color:l||!u?"text.secondary":"text.primary",children:`${l?"/ ":""}${u?`${h}`:"?"}`}),u&&r&&i(T,{variant:"body1",color:"text.secondary",sx:{fontSize:l?G:O},children:"+"})]})]})},Be=e=>{const{shipConfig:t,onClickName:o}=e;return f(v,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},children:[i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f("div",{children:[i(T,{variant:"body1",children:i(oe,{onClick:()=>{o(t.shipDefinition.id)},children:H(t.shipDefinition)})}),t.incomplete&&i(T,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),i(N,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,unlockCost:0,incomplete:t.incomplete})]})},Ne=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:s}=e,r=o.selectedEnhancementIds.includes(n.id);return f(v,{spacing:1,direction:"row",children:[i("div",{children:i(X,{checked:r,onChange:()=>{s(t.shipDefinition.id,o.module.id,n.id)},disabled:!r&&!!o.module.skillSlots&&o.selectedEnhancementIds.length>=o.module.skillSlots})}),i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(v,{spacing:.5,sx:{flexGrow:1},children:[i(T,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((c,a)=>i(T,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:c},`property_${a}`)),n.enhancement.cost===null&&i(T,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.maxCostUnknown")})]})})]})},_e=e=>{var a;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:s}=e,{mode:r}=ne(),c=t.selectedModuleIds.includes(o.module.id);return f(v,{p:2,spacing:1,sx:{backgroundColor:r==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[f(v,{spacing:1,direction:"row",children:[i("div",{children:i(X,{checked:c,disabled:o.module.category==="STATIC",onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(E,{component:"div",sx:{flexGrow:1},children:[i(T,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${se(t.shipDefinition.id,o.module)}`}),o.incomplete&&i(T,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),i(N,{techPoints:c?o.techPoints:0,maxTechPoints:o.maxTechPoints,unlockCost:o.module.category!=="STATIC"&&!o.module.defaultModule?10:null,selected:c,incomplete:o.incomplete,showZero:!0})]}),c&&f(v,{spacing:3,pl:5,pt:1,pb:2,children:[f("div",{children:[i(T,{variant:"body1",color:"text.secondary",children:m("techPointConfig.enhancementSlotsColonValue",{value:`${o.selectedEnhancementIds.length} / ${(a=o.module.skillSlots)!=null?a:"?"}`})}),!o.module.skillSlots&&i(T,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]}),Object.values(o.enhancements).map(d=>i(Ne,{shipConfig:t,moduleConfig:o,enhancementConfig:d,onToggleEnhancement:s},d.id))]})]})},ze=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return f(v,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(s=>i(_e,{shipConfig:t,moduleConfig:s,onToggleModule:o,onToggleEnhancement:n},s.module.id)),i(v,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:i(N,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete,unlockCost:0})})]})},Fe=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n}=e,{openShipDetailDialog:s}=ie();return i(Se,{expandables:Object.values(t.ships).map(r=>({id:r.shipDefinition.id,initiallyOpened:!1,expandIcon:i(me,{}),summary:i(Be,{shipConfig:r,onClickName:s}),details:i(ze,{shipConfig:r,onToggleModule:n,onToggleEnhancement:o})}))})},je=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:s,onReset:r,onCancel:c,onSave:a}=e,[d,h]=p.exports.useState(!1),l=p.exports.useCallback(()=>{h(!1),r()},[r]);return f($,{children:[i(ke,{left:u=>i($,{children:i(de,{filter:t,onChange:s,buttonProps:u,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[b.AUXILIARY,b.CARRIER,b.BATTLE_CRUISER,b.CRUISER,b.CORVETTE]},"filter")}),right:u=>f($,{children:[i(A,{variant:"outlined",startIcon:i(be,{}),onClick:()=>{h(!0)},disabled:!n,...u,children:m("button.reset")},"reset"),i(A,{variant:"outlined",startIcon:i(xe,{}),onClick:c,disabled:!o,...u,children:m("button.cancel")},"cancel"),i(A,{variant:"contained",startIcon:i(ve,{}),onClick:a,disabled:!o,...u,children:m("button.save")},"save")]})}),d&&i(we,{title:m("button.reset"),question:m("techPointConfig.confirmReset"),cancelText:m("button.cancel"),confirmText:m("button.reset"),onCancel:()=>{h(!1)},onConfirm:l})]})};function B(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:Le(n)}),{})}}function Le(e){var c,a,d,h;const t=(a=(c=e.modules)==null?void 0:c.filter(l=>l.skillSlots!==0).reduce((l,u)=>({...l,[u.id]:Ue(u)}),{}))!=null?a:{},o=(h=(d=e.modules)==null?void 0:d.filter(l=>l.skillSlots!==0&&l.category==="STATIC"||l.defaultModule===!0).map(l=>l.id))!=null?h:[],n=_(t,o),s=z(t,o),r=F(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,unlockCost:s,incomplete:r}}function Ue(e){var s,r;const t=[...(s=e.flagshipEffects)!=null?s:[],...(r=e.skills)!=null?r:[]].filter(c=>!c.isDefault).reduce((c,a,d)=>{const h=`${a.type}_${d}`;return{...c,[h]:Ge(a,h)}},{}),o=He(e),n=e.category!=="STATIC"&&!e.defaultModule?10:0;return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,unlockCost:n,incomplete:Xe(e)}}function Ge(e,t){return{id:t,enhancement:e,techPoints:e.isDefault?null:e.cost}}function _(e,t){return Object.keys(e).map(o=>e[o]).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function z(e,t){return Object.keys(e).map(o=>t.includes(o)?e[o].unlockCost:0).reduce((o,n)=>o+n,0)}function He(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(t=>t.cost).sort((t,o)=>(o!=null?o:0)-(t!=null?t:0)).slice(0,e.skillSlots).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),0)}function F(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function Xe(e){var t,o;return e.skillSlots?!e.skillSlots||e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null):!0}function Ze(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function Je(e,t,o){var c;const n=(c=e.ships[t])!=null?c:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const r={...n,selectedModuleIds:Ze(n,o)};return{...e,ships:{...e.ships,[t]:{...r,techPoints:Z(r),maxTechPoints:_(r.modules,r.selectedModuleIds),unlockCost:z(r.modules,r.selectedModuleIds),incomplete:F(r.modules,r.selectedModuleIds)}}}}function Ke(e,t,o,n){var d,h;const s=(h=(d=e.ships[t])==null?void 0:d.modules[o])!=null?h:null;if(!s)throw new Error(`Missing config for "${t}", "${o}"`);const r=Ve(s.selectedEnhancementIds,n);if(!!s.module.skillSlots&&r.length>s.module.skillSlots)return e;const c={...s,selectedEnhancementIds:r},a={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...c,techPoints:We(c)}}};return{...e,ships:{...e.ships,[t]:{...a,techPoints:Z(a)}}}}function Ve(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function Z(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function We(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const M="tp";function Ye(){return!!window.localStorage.getItem(M)}function qe(){window.localStorage.removeItem(M)}function Qe(e){const t=et(e);window.localStorage.setItem(M,JSON.stringify(t))}function D(e){const t=B(e),o=window.localStorage.getItem(M);if(!o)return t;let n;try{n=JSON.parse(o)}catch(s){return console.warn("Invalid tech point config",s),t}return tt(t,n)}function et(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],s=[o,[]];Object.keys(n.modules).forEach(r=>{const c=n.modules[r],a=n.selectedModuleIds.includes(r)?1:0,d=[r,c.selectedEnhancementIds,a];s[1].push(d)}),t.ships.push(s)}),t}function tt(e,t){return t.ships.forEach(([o,n])=>{const s=e.ships[o];if(!s){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([r,c,a])=>{const d=s.modules[r];if(!d){console.warn(`Invalid moduleId "${r}"`);return}if(d.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${r}" (duplicate)`);return}if(c.forEach(h=>{var u,x,w,I;const l=d.enhancements[h];if(!l){console.warn(`Invalid enhancement "${h}"`);return}d.selectedEnhancementIds.push(h),d.techPoints=((u=d.techPoints)!=null?u:0)+((x=l.enhancement.cost)!=null?x:0),s.techPoints=((w=s.techPoints)!=null?w:0)+((I=l.enhancement.cost)!=null?I:0)}),a===1&&!s.selectedModuleIds.includes(r)){const h=Object.keys(s.modules).filter(l=>{const{category:u}=s.modules[l].module;return u!=="STATIC"&&u===d.module.category});s.selectedModuleIds=[...s.selectedModuleIds.filter(l=>!h.includes(l)),r]}}),s.maxTechPoints=_(s.modules,s.selectedModuleIds),s.unlockCost=z(s.modules,s.selectedModuleIds),s.incomplete=F(s.modules,s.selectedModuleIds)}),e}const ot=e=>{const{supportedShips:t,visibleShips:o}=e,[n,s]=p.exports.useState(()=>B([])),[r,c]=p.exports.useState(!1),[a,d]=p.exports.useState(Ye());p.exports.useEffect(()=>{const g=D(t);s(g)},[t]);const h=p.exports.useCallback((g,k)=>{c(!0),s(S=>Je(S,g,k))},[]),l=p.exports.useCallback((g,k,S)=>{c(!0),s(J=>Ke(J,g,k,S))},[]),u=p.exports.useCallback(()=>{qe();const g=B(t);s(g),c(!1),d(!1)},[t]),x=p.exports.useCallback(()=>{const g=D(t);s(g),c(!1)},[n,t]),w=p.exports.useCallback(()=>{Qe(n);const g=D(t);s(g),c(!1),d(!0)},[n,t]);return{config:p.exports.useMemo(()=>({ships:o.reduce((g,k)=>{const S=n.ships[k.id];return S?{...g,[k.id]:S}:g},{})}),[n,o]),modified:r,stored:a,handleToggleModule:h,handleToggleEnhancement:l,handleReset:u,handleCancel:x,handleSave:w}},nt=[b.AUXILIARY,b.CARRIER,b.BATTLE_CRUISER,b.CRUISER,b.CORVETTE],yt=()=>{const[e,t]=re(),[o,n]=p.exports.useState(()=>Ce(e.getAll("filter"),ue()));p.exports.useEffect(()=>{t(L.techPointConfig.createSearchParams({filter:Te(o)}))},[o]);const s=p.exports.useMemo(()=>ce.filter(S=>S.source===U.TECH_FILE||S.source===U.STARTER_SHIP).filter(S=>nt.includes(S.type)),[]),[r,c]=p.exports.useState(""),a=p.exports.useMemo(()=>{const S=he(s,o);return le(S)},[s,o]),d=p.exports.useMemo(()=>r?a.filter(S=>H(S).toLowerCase().includes(r)):a,[a,r]),{config:h,modified:l,stored:u,handleToggleModule:x,handleToggleEnhancement:w,handleReset:I,handleCancel:g,handleSave:k}=ot({supportedShips:s,visibleShips:d});return f($,{children:[i(pe,{currentRoute:L.techPointConfig.path}),i(je,{shipFilter:o,modified:l,stored:u,onFilterChange:n,onReset:I,onCancel:g,onSave:k}),i(fe,{children:f(v,{spacing:2,p:1,children:[f(v,{pt:1,pb:1,spacing:2,children:[i(T,{variant:"body2",children:m("techPointConfig.pageDescription1")}),i(T,{variant:"body2",children:m("techPointConfig.pageDescription2")})]}),i(Pe,{id:"searchShip",lowerCase:!0,value:r,placeholder:m("label.shipName"),onChange:c}),i(Fe,{config:h,onToggleModule:x,onToggleEnhancement:w})]})}),i(ge,{})]})};export{yt as TechPointConfigPage,yt as default};
