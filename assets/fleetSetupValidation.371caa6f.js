var H=Object.defineProperty,z=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var k=(e,t,r)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t)=>{for(var r in t||(t={}))q.call(t,r)&&k(e,r,t[r]);if(Y)for(var r of Y(t))J.call(t,r)&&k(e,r,t[r]);return e},c=(e,t)=>z(e,W(t));import{c as V,i as K,r as Z}from"./NavigationBar.0d38d227.js";import{r as b,b as L,F as P,j as d,s as Q,h as X,P as ee,G as te,t as re,v as ne,M as oe,w as ue,x as ie,z as ae}from"./vendor.da49bbc3.js";import{g as se}from"./domUtils.e9df6b0f.js";import{b as _,a as ce,S as E,t as fe,s as j,g as B,B as R,d as me}from"./index.7c8cee3c.js";import{n as S}from"./sorting.c6946657.js";import{P as le}from"./WishState.3db35fd5.js";const pe=e=>{const{options:t,icon:r,text:o,value:n,onClick:u,buttonProps:i}=e,[a,f]=b.exports.useState(!1),m=b.exports.useRef(null),l=y=>{f(!1),u(y)};return L(P,{children:[d(Q,{variant:"outlined",fullWidth:i==null?void 0:i.fullWidth,ref:m,disabled:i==null?void 0:i.disabled,size:i==null?void 0:i.size,children:d(X,{startIcon:r,onClick:y=>{y.stopPropagation(),f(!0)},disabled:i==null?void 0:i.disabled,children:o})}),d(ee,{open:a,anchorEl:m.current,role:void 0,transition:!0,disablePortal:!0,style:{zIndex:2},children:({TransitionProps:y,placement:D})=>d(te,c(s({},y),{style:{transformOrigin:D==="bottom"?"center top":"center bottom"},children:d(re,{style:{maxHeight:se(m.current),overflowY:"auto"},children:d(ne,{onClickAway:()=>f(!1),children:d(oe,{children:t.map(h=>L(ue,{selected:h.value===n,onClick:T=>{T.stopPropagation(),l(h.value)},disabled:h.disabled,children:[h.icon&&d(ie,{children:h.icon}),d(ae,{children:h.text})]},h.key))})})})}))})]})};var A={},de=K.exports;Object.defineProperty(A,"__esModule",{value:!0});var w=A.default=void 0,ye=de(V),he=Z,_e=(0,ye.default)((0,he.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");w=A.default=_e;var p;(function(e){e.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",e.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",e.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",e.SORT_BY_NAME="sortByName"})(p||(p={}));const I={initial:0,self:1,ally:2},G=(e,t)=>{var r,o;return I[(r=e.reinforcement)!=null?r:"initial"]-I[(o=t.reinforcement)!=null?o:"initial"]},g=S([(e,t)=>e.shipDefinition.name.localeCompare(t.shipDefinition.name,"ja-JP"),G]),x=S([(e,t)=>j(e.shipDefinition.type,e.shipDefinition.subType)-j(t.shipDefinition.type,t.shipDefinition.subType),g,G]);function Ye(e,t){switch(e){case p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME:return{groupedBy:e,groups:Ee(t.ships)};case p.GROUP_BY_TYPE_SORT_BY_NAME:return{groupedBy:e,groups:Re(t.ships)};case p.SORT_BY_TYPE_AND_NAME:return{groupedBy:e,groups:[{id:"all",name:"\u7DE8\u6210",ships:t.ships.map(r=>c(s({},r),{carriedShips:[...r.carriedShips].sort(x)})).sort(x),count:t.ships.map(r=>r.count).reduce((r,o)=>r+o,0)}]};case p.SORT_BY_NAME:return{groupedBy:e,groups:[{id:"all",name:"\u7DE8\u6210",ships:t.ships.map(r=>c(s({},r),{carriedShips:[...r.carriedShips].sort(g)})).sort(g),count:t.ships.map(r=>r.count).reduce((r,o)=>r+o,0)}]};default:throw new Error(`Unknown group and sort option "${e}"`)}}function Ee(e){return[E.FRONT,E.MIDDLE,E.BACK].map(t=>{const r=e.filter(n=>n.shipDefinition.row===t).map(n=>c(s({},n),{carriedShips:[...n.carriedShips].sort(x)})).sort(x),o=r.map(n=>n.count).reduce((n,u)=>n+u,0);return{id:t,name:fe(t),ships:r,count:o}})}function Re(e){return[_.CARRIER,_.BATTLE_CRUISER,_.CRUISER,_.DESTROYER,_.FRIGATE].map(t=>{const r=e.filter(n=>n.shipDefinition.type===t).map(n=>c(s({},n),{carriedShips:[...n.carriedShips].sort(g)})).sort(g),o=r.map(n=>n.count).reduce((n,u)=>n+u,0);return{id:t,name:ce(t),ships:r,count:o}})}function ke(e,t){return[e.name,t.groups.filter(r=>r.ships.length>0).map(r=>[...t.groups.length>1?[`\u3010${r.name}\u3011`]:[],...r.ships.flatMap(o=>{const n=o.count*o.shipDefinition.cost;switch(o.reinforcement){case"self":return[`${o.count}\xD7\u3000${o.shipDefinition.name}\uFF08\u5897\u63F4\uFF09`,...O(o.carriedShips)];case"ally":return[`${o.count}\xD7\u3000${o.shipDefinition.name}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF09`,...O(o.carriedShips)];default:return[`${o.count}\xD7\u3000${o.shipDefinition.name}\uFF08${n}Pt\uFF09`,...O(o.carriedShips)]}})].join(`
`)).join(`

`),[`\u5897\u63F4\uFF1A${e.totalReinforcementCount}/${e.maxReinforcement}`,`\u6307\u4EE4Pt\uFF1A${e.totalCost}/${e.maxCost}`].join(`
`)].join(`

`)}function O(e){return e.map(t=>`\u3000\u3000${t.count}\xD7\u3000${t.shipDefinition.name}`)}const be=e=>{const{value:t,onChange:r,buttonProps:o}=e;return d(P,{children:d(pe,{icon:d(w,{}),text:"\u8868\u793A",value:t,options:[{key:p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:"\u914D\u7F6E\u5225\u3001\u8266\u7A2E\u2192\u540D\u524D\u9806",value:p.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:p.GROUP_BY_TYPE_SORT_BY_NAME,text:"\u8266\u7A2E\u5225\u3001\u540D\u524D\u9806",value:p.GROUP_BY_TYPE_SORT_BY_NAME},{key:p.SORT_BY_TYPE_AND_NAME,text:"\u8266\u7A2E\u2192\u540D\u524D\u9806",value:p.SORT_BY_TYPE_AND_NAME},{key:p.SORT_BY_NAME,text:"\u540D\u524D\u9806",value:p.SORT_BY_NAME}],onClick:r,buttonProps:o})})};function Le(e){var t,r,o,n,u;return[(t=F("fleet1",e))!=null?t:C(1),(r=F("fleet2",e))!=null?r:C(2),(o=F("fleet3",e))!=null?o:C(3),(n=F("fleet4",e))!=null?n:C(4),(u=F("fleet5",e))!=null?u:C(5)]}function Pe(e){const t=JSON.stringify(Fe(e));window.localStorage.setItem(e.key,t)}function F(e,t){const r=window.localStorage.getItem(e);if(!r)return null;const o=De(r);return o?ge(o,e,t):null}function ge(e,t,r){const o=e.myListOnly===!0,n=e.ships.map(u=>{var i;return c(s({},U({shipDefinition:B(u.shipId),usedModules:(i=u.usedModules)!=null?i:null,count:u.count,reinforcement:u.reinforcement,userSettings:r,maxReinforcement:e.maxReinforcement,myListOnly:o})),{carriedShips:u.carriedShips.map(a=>$({shipId:a.shipId,count:a.count,reinforcement:u.reinforcement}))})});return{key:t,name:e.name,ships:n,totalCost:N(n),totalReinforcementCount:v(n),maxReinforcement:e.maxReinforcement,maxCost:e.maxCost,myListOnly:o}}function Fe(e){return{name:e.name,ships:e.ships.map(t=>({shipId:t.shipDefinition.id,usedModules:t.moduleSelection?Ce(t.moduleSelection):void 0,carriedShips:t.carriedShips.map(r=>({shipId:r.shipDefinition.id,count:r.count})),count:t.count,reinforcement:t.reinforcement})),maxReinforcement:e.maxReinforcement,maxCost:e.maxCost,myListOnly:e.myListOnly}}function Ce(e){const t=[];return Object.keys(e.groups).forEach(r=>{Object.keys(e.groups[r]).forEach(o=>{e.groups[r][o].usage==="used"&&t.push(e.groups[r][o].module.id)})}),t}function De(e){try{return JSON.parse(e)}catch(t){return alert("ERROR - Failed to restore fleet setup"),console.error(t),null}}function C(e){return{key:`fleet${e}`,name:`${e}\u53F7\u8266\u968A`,ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function U(e){const{shipDefinition:t,usedModules:r,count:o,reinforcement:n,userSettings:u,maxReinforcement:i,myListOnly:a,temporary:f}=e,m=Te(t,r,u,n,!1),l=M(t,m),y=n===null||t.type===_.FIGHTER||t.type===_.CORVETTE?t.operationLimit:Math.min(t.operationLimit,i);return{shipDefinition:t,carrierCapabilities:l,carriedShips:[],count:Math.max(0,o),reinforcement:n,maxCount:y,moduleSelection:m,temporary:f}}function Te(e,t,r,o,n){if(!e.modules||e.modules.length===0)return null;const u=t!=null?t:e.modules.filter(a=>a.defaultModule).map(a=>a.id),i={static:e.staticModules===!0,groups:{}};return e.modules.forEach(a=>{var f;if(i.groups[a.category]||(i.groups[a.category]={}),i.static){i.groups[a.category][a.id]={module:a,usage:"used"};return}if(a.defaultModule||!n||o==="ally"||((f=r.modules[a.id])==null?void 0:f.possession)===le.POSSESSED){i.groups[a.category][a.id]={module:a,usage:u.includes(a.id)?"used":"not_used"};return}i.groups[a.category][a.id]={module:a,usage:"not_possessed"}}),i}function M(e,t){var i;let r=0,o=0,n=0,u=(i=e.carryCorvette)!=null?i:0;if(e.carryFighter)switch(e.carryFighterType){case R.LARGE_FIGHTER:{r+=e.carryFighter;break}case R.MEDIUM_FIGHTER:{o+=e.carryFighter;break}case R.SMALL_FIGHTER:{n+=e.carryFighter;break}}return t&&Object.keys(t.groups).forEach(a=>{var f;Object.keys((f=t.groups[a])!=null?f:{}).forEach(m=>{var y,D,h,T;const l=t.groups[a][m];if(l.usage==="used"){switch(l.module.carryFighterType){case R.LARGE_FIGHTER:{r+=(y=l.module.carryFighter)!=null?y:0;break}case R.MEDIUM_FIGHTER:{o+=(D=l.module.carryFighter)!=null?D:0;break}case R.SMALL_FIGHTER:{n+=(h=l.module.carryFighter)!=null?h:0;break}}u+=(T=l.module.carryCorvette)!=null?T:0}})}),{canCarry:r+o+n+u>0,carryUpToLargeFighter:r,carryUpToMediumFighter:o,carryUpToSmallFighter:n,carryCorvette:u}}function $(e){const{shipId:t,count:r,reinforcement:o,temporary:n}=e;return{shipDefinition:B(t),count:Math.max(0,r),reinforcement:o,temporary:n}}function je(e){const{shipId:t,count:r,reinforcement:o,fleetSetup:n,userSettings:u,keepZero:i}=e,a=B(t);let f=!0;const m=c(s({},n),{ships:n.ships.flatMap(l=>l.shipDefinition.id!==t||l.reinforcement!==o?l:(f=!1,!i&&r<=0?[]:[c(s({},l),{count:r})]))});return f?c(s({},m),{ships:[...m.ships,U({shipDefinition:a,usedModules:null,count:r,reinforcement:o,userSettings:u,maxReinforcement:n.maxReinforcement,myListOnly:n.myListOnly})],totalCost:N(m.ships),totalReinforcementCount:v(m.ships)}):c(s({},m),{totalCost:N(m.ships),totalReinforcementCount:v(m.ships)})}function Se(e){const{shipId:t,carrierShipId:r,count:o,reinforcement:n,fleetSetup:u,keepZero:i}=e;return c(s({},u),{ships:u.ships.map(a=>a.shipDefinition.id!==r||a.reinforcement!==n?a:a.carriedShips.find(f=>f.shipDefinition.id===t)?c(s({},a),{carriedShips:a.carriedShips.flatMap(f=>{if(f.shipDefinition.id!==t)return[f];if(f.reinforcement!==n)throw new Error("Detected invalid reinforcement");return!i&&o<=0?[]:[c(s({},f),{count:Math.max(0,o),reinforcement:n})]})}):c(s({},a),{carriedShips:[...a.carriedShips,$({shipId:t,count:o,reinforcement:n})]}))})}function we(e){const{shipId:t,reinforcement:r,moduleSelection:o,fleetSetup:n}=e;return c(s({},n),{ships:n.ships.map(u=>u.shipDefinition.id!==t?u:r==="ally"?u.reinforcement==="ally"?c(s({},u),{moduleSelection:o,carrierCapabilities:M(u.shipDefinition,o)}):u:u.reinforcement!=="ally"?c(s({},u),{moduleSelection:o,carrierCapabilities:M(u.shipDefinition,o)}):u)})}function Ie(e,t,r){return c(s({},r),{groups:c(s({},r.groups),{[e]:Object.keys(r.groups[e]).reduce((o,n)=>{const u=r.groups[e][n];return c(s({},o),{[n]:n===t?c(s({},u),{usage:"used"}):c(s({},u),{usage:u.usage==="not_possessed"?"not_possessed":"not_used"})})},r.groups[e])})})}function N(e){return e.filter(t=>t.reinforcement===null).map(t=>t.count*t.shipDefinition.cost).reduce((t,r)=>t+r,0)}function v(e){return e.filter(t=>t.reinforcement!==null).map(t=>t.count).reduce((t,r)=>t+r,0)}function Ge(e){let t=0;const r=e.map(u=>u.count).reduce((u,i)=>u+i,0),o=Object.keys(me).reduce((u,i)=>c(s({},u),{[i]:0}),{}),n={[E.FRONT]:0,[E.MIDDLE]:0,[E.BACK]:0,[E.NONE]:0};return e.forEach(u=>{u.reinforcement===null&&(t+=u.count*u.shipDefinition.cost),o[u.shipDefinition.type]+=u.count,n[u.shipDefinition.row]+=u.count,u.carriedShips.length>0&&u.carriedShips.forEach(i=>{o[i.shipDefinition.type]+=i.count})}),{shipCount:r,shipCountByType:o,shipCountByRow:n,totalCost:t}}function Ue(e){var r,o;const t={};return e.name.length===0&&(t.name="\u5FC5\u9808\u9805\u76EE"),(!Number.isFinite(e.maxReinforcement)||e.maxReinforcement<0)&&(t.maxReinforcement="\u7121\u52B9\u306A\u5024"),(!Number.isFinite(e.maxCost)||e.maxCost<300||e.maxCost>450)&&(t.maxCost="\u7121\u52B9\u306A\u5024"),e.maxCost>400&&e.maxReinforcement>5&&(t.maxReinforcement=(r=t.maxReinforcement)!=null?r:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059",t.maxCost=(o=t.maxCost)!=null?o:"\u57FA\u5730\u7D50\u5408\u52B9\u679C\u306F\uFF11\u3064\u307E\u3067\u3067\u3059"),t}function $e(e){const t={},r={},o={};return e.ships.filter(n=>n.reinforcement!=="ally").forEach(n=>{const u=n.shipDefinition.id;if(r[u]){const i=r[u];r[u]={count:n.reinforcement===null?n.count:i.count,reinforcementCount:n.reinforcement!==null?n.count:i.reinforcementCount,operationLimit:n.shipDefinition.operationLimit}}else r[u]={count:n.reinforcement===null?n.count:0,reinforcementCount:n.reinforcement!==null?n.count:0,operationLimit:n.shipDefinition.operationLimit};n.carriedShips.forEach(i=>{const a=i.shipDefinition.id;o[a]?o[a].count+=i.count:o[a]={count:i.count,operationLimit:i.shipDefinition.operationLimit}})}),Object.keys(r).forEach(n=>{const u=r[n];u.count+u.reinforcementCount>u.operationLimit&&(t[n]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),Object.keys(o).forEach(n=>{const u=o[n];u.count>u.operationLimit&&(t[n]="\u914D\u5099\u3057\u305F\u5408\u8A08\u6570\u304C\u7A3C\u50CD\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u307E\u3059\u3002")}),t}export{pe as B,p as G,be as S,Ge as a,Ye as b,je as c,Se as d,we as e,ke as f,Le as g,C as h,Ue as i,U as j,Ie as k,$ as l,Pe as s,$e as v};
