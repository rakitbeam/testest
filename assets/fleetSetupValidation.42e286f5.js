import{P as j,Q as G,R as H,t as c,c as p,b as W,S as y,a as z,g as d,d as V,s as A,bz as q,f as J,k as F,F as K,Y as E,bI as k,bJ as g,Z}from"./index.a60674bf.js";import{B as Q}from"./ButtonMenu.0c779582.js";import{n as L}from"./sorting.c6946657.js";var N={},X=G.exports;Object.defineProperty(N,"__esModule",{value:!0});var Y=N.default=void 0,ee=X(j),te=H,ne=(0,ee.default)((0,te.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");Y=N.default=ne;var l=(e=>(e.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",e.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",e.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",e.SORT_BY_NAME="sortByName",e))(l||{});const b={initial:0,self:1,ally:2,ally2:3,ally3:4},w=(e,t)=>{var r,i;return b[(r=e.reinforcement)!=null?r:"initial"]-b[(i=t.reinforcement)!=null?i:"initial"]},T=L([(e,t)=>d(e.shipDefinition).localeCompare(d(t.shipDefinition),V()),w]),D=L([(e,t)=>A(e.shipDefinition.type,e.shipDefinition.subType)-A(t.shipDefinition.type,t.shipDefinition.subType),T,w]);function ye(e,t){switch(e){case"groupByRowSortByTypeAndName":return{groupedBy:e,groups:re(t.ships)};case"groupByTypeSortByName":return{groupedBy:e,groups:oe(t.ships)};case"sortByTypeAndName":return{groupedBy:e,groups:[{id:"all",name:c("fleetSetup.fleetFormation"),ships:t.ships.map(r=>({...r,carriedShips:[...r.carriedShips].sort(D)})).sort(D),count:t.ships.map(r=>r.count).reduce((r,i)=>r+i,0)}]};case"sortByName":return{groupedBy:e,groups:[{id:"all",name:c("fleetSetup.fleetFormation"),ships:t.ships.map(r=>({...r,carriedShips:[...r.carriedShips].sort(T)})).sort(T),count:t.ships.map(r=>r.count).reduce((r,i)=>r+i,0)}]};default:throw new Error(`Unknown group and sort option "${e}"`)}}function re(e){return[y.FRONT,y.MIDDLE,y.BACK].map(t=>{const r=e.filter(n=>n.shipDefinition.row===t).map(n=>({...n,carriedShips:[...n.carriedShips].sort(D)})).sort(D),i=r.map(n=>n.count).reduce((n,o)=>n+o,0);return{id:t,name:z(t),ships:r,count:i}})}function oe(e){return[p.CARRIER,p.AUXILIARY,p.BATTLE_CRUISER,p.CRUISER,p.DESTROYER,p.FRIGATE].map(t=>{const r=e.filter(n=>n.shipDefinition.type===t).map(n=>({...n,carriedShips:[...n.carriedShips].sort(T)})).sort(T),i=r.map(n=>n.count).reduce((n,o)=>n+o,0);return{id:t,name:W(t),ships:r,count:i}})}function ge(e,t){const r=q()?" ":"";return[e.name,t.groups.filter(i=>i.ships.length>0).map(i=>[...t.groups.length>1?[c("fleetSetup.groupNameForSharing",{name:i.name})]:[],...i.ships.flatMap(n=>{const o=n.count*n.shipDefinition.cost,a=ie(n);switch(n.reinforcement){case"self":return[`${h(n.count)}\xD7\u3000${d(n.shipDefinition)}${r}${c("fleetSetup.reinforcementBrackets")}`,...a?[a]:[],..._(n.carriedShips)];case"ally":return[`${h(n.count)}\xD7\u3000${d(n.shipDefinition)}${r}${c("fleetSetup.orgReinforcementABrackets")}`,...a?[a]:[],..._(n.carriedShips)];case"ally2":return[`${h(n.count)}\xD7\u3000${d(n.shipDefinition)}${r}${c("fleetSetup.orgReinforcementBBrackets")}`,...a?[a]:[],..._(n.carriedShips)];case"ally3":return[`${h(n.count)}\xD7\u3000${d(n.shipDefinition)}${r}${c("fleetSetup.orgReinforcementCBrackets")}`,...a?[a]:[],..._(n.carriedShips)];default:return[`${h(n.count)}\xD7\u3000${d(n.shipDefinition)}${r}${c("fleetSetup.commandPointsValueBrackets",{value:o})}`,...a?[a]:[],..._(n.carriedShips)]}})].join(`
`)).join(`

`),[`${c("fleetSetup.reinforcementColon")}${r}${e.totalReinforcementCount}/${e.maxReinforcement}`,`${c("label.commandPointsColon")}${r}${e.totalCost}/${e.maxCost}`].join(`
`)].join(`

`)}function _(e){return e.map(t=>`\u3000\u3000 ${h(t.count)}\xD7\u3000${d(t.shipDefinition)}`)}function ie(e){if(e.moduleSelection===null||e.moduleSelection.static)return null;const t=["M","A","B","C"].flatMap(r=>{var a,s,u;const n=Object.keys((s=(a=e.moduleSelection)==null?void 0:a.groups[r])!=null?s:{}).find(f=>{var m;return((m=e.moduleSelection)==null?void 0:m.groups[r][f].usage)==="used"});if(!n)return[];const o=(u=e.moduleSelection)==null?void 0:u.groups[r][n];return!o||o.module.defaultModule?[]:o?[`${J(e.shipDefinition.id,o.module)}\uFF08${o.module.id}\uFF09`]:[]});return t.length===0?null:t.map(r=>`\u3000\u3000 ${r}`).join(`
`)}function h(e){return e<10?`${e}`.padStart(3):`${e}`}const he=e=>{const{value:t,onChange:r,buttonProps:i}=e;return F(K,{children:F(Q,{icon:F(Y,{}),text:c("button.displayItems"),value:t,options:[{key:l.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:c("fleetSetup.groupByRowSortByShipTypeAndName"),value:l.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:l.GROUP_BY_TYPE_SORT_BY_NAME,text:c("fleetSetup.groupByShipTypeSortByName"),value:l.GROUP_BY_TYPE_SORT_BY_NAME},{key:l.SORT_BY_TYPE_AND_NAME,text:c("fleetSetup.sortByShipTypeAndName"),value:l.SORT_BY_TYPE_AND_NAME},{key:l.SORT_BY_NAME,text:c("fleetSetup.sortByName"),value:l.SORT_BY_NAME}],onClick:r,buttonProps:i})})};function Re(){var e,t,r,i,n;return[(e=C("fleet1"))!=null?e:B(1),(t=C("fleet2"))!=null?t:B(2),(r=C("fleet3"))!=null?r:B(3),(i=C("fleet4"))!=null?i:B(4),(n=C("fleet5"))!=null?n:B(5)]}function _e(e){const t=JSON.stringify(se(e));window.localStorage.setItem(e.key,t)}function C(e){const t=window.localStorage.getItem(e);if(!t)return null;const r=fe(t);return r?ae(r,e):null}function ae(e,t){const r=ue(e),i=r.myListOnly===!0,n=r.ships.map(o=>{var a;return{...P({shipDefinition:E(o.shipId),usedModules:(a=o.usedModules)!=null?a:null,count:o.count,reinforcement:o.reinforcement,maxReinforcement:r.maxReinforcement}),carriedShips:o.carriedShips.map(s=>U({shipId:s.shipId,count:s.count,reinforcement:o.reinforcement}))}});return{key:t,name:r.name,ships:n,totalCost:x(n),totalReinforcementCount:S(n),maxReinforcement:r.maxReinforcement,maxCost:r.maxCost,myListOnly:i}}function se(e){return{name:e.name,ships:e.ships.map(t=>({shipId:t.shipDefinition.id,usedModules:t.moduleSelection?ce(t.moduleSelection):void 0,carriedShips:t.carriedShips.map(r=>({shipId:r.shipDefinition.id,count:r.count})),count:t.count,reinforcement:t.reinforcement})),maxReinforcement:e.maxReinforcement,maxCost:e.maxCost,myListOnly:e.myListOnly}}function ue(e){const t=e.ships.reduce((i,n)=>{const o=k(n.shipId),a=E(o);if(!a)return i;let s;n.usedModules&&a.modules&&(s=n.usedModules.filter(f=>{var m;return!!((m=a.modules)!=null&&m.find(R=>R.id===f))}));const u=n.carriedShips.flatMap(f=>{const m=k(f.shipId);return E(m)?[{...f,shipId:m}]:[]});return[...i,{...n,shipId:o,usedModules:s,carriedShips:u}]},[]);return{...e,ships:t}}function ce(e){const t=[];return Object.keys(e.groups).forEach(r=>{Object.keys(e.groups[r]).forEach(i=>{e.groups[r][i].usage==="used"&&t.push(e.groups[r][i].module.id)})}),t}function fe(e){try{return JSON.parse(e)}catch(t){return alert("ERROR - Failed to restore fleet setup"),console.error(t),null}}function B(e){return{key:`fleet${e}`,name:c("fleetSetup.defaultFleetNameWithNumber",{fleetNumber:e}),ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function P(e){const{shipDefinition:t,usedModules:r,count:i,reinforcement:n,maxReinforcement:o,temporary:a}=e,s=me(t,r),u=M(t,s),f=n===null||t.type===p.FIGHTER||t.type===p.CORVETTE?t.operationLimit:Math.min(t.operationLimit,o);return{shipDefinition:t,carrierCapabilities:u,carriedShips:[],count:Math.max(0,i),reinforcement:n,maxCount:f,moduleSelection:s,temporary:a}}function me(e,t){if(!e.modules||e.modules.length===0)return null;const r=t!=null?t:e.modules.filter(n=>n.defaultModule).map(n=>n.id),i={static:e.staticModules===!0,groups:{}};return e.modules.forEach(n=>{if(i.groups[n.category]||(i.groups[n.category]={}),i.static){i.groups[n.category][n.id]={module:n,usage:"used"};return}i.groups[n.category][n.id]={module:n,usage:r.includes(n.id)?"used":"not_used"}}),i}function M(e,t){var a;let r=0,i=0,n=0,o=(a=e.carryCorvette)!=null?a:0;if(e.carryFighter)switch(e.carryFighterType){case g.LARGE_FIGHTER:{r+=e.carryFighter;break}case g.MEDIUM_FIGHTER:{i+=e.carryFighter;break}case g.SMALL_FIGHTER:{n+=e.carryFighter;break}}return t&&Object.keys(t.groups).forEach(s=>{var u;Object.keys((u=t.groups[s])!=null?u:{}).forEach(f=>{var R,O,$,v;const m=t.groups[s][f];if(m.usage==="used"){switch(m.module.carryFighterType){case g.LARGE_FIGHTER:{r+=(R=m.module.carryFighter)!=null?R:0;break}case g.MEDIUM_FIGHTER:{i+=(O=m.module.carryFighter)!=null?O:0;break}case g.SMALL_FIGHTER:{n+=($=m.module.carryFighter)!=null?$:0;break}}o+=(v=m.module.carryCorvette)!=null?v:0}})}),{canCarry:r+i+n+o>0,carryUpToLargeFighter:r,carryUpToMediumFighter:i,carryUpToSmallFighter:n,carryCorvette:o}}function U(e){const{shipId:t,count:r,reinforcement:i,temporary:n}=e;return{shipDefinition:E(t),count:Math.max(0,r),reinforcement:i,temporary:n}}function Ce(e){const{shipId:t,count:r,reinforcement:i,fleetSetup:n,keepZero:o}=e,a=E(t);let s=!0;const u={...n,ships:n.ships.flatMap(f=>f.shipDefinition.id!==t||f.reinforcement!==i?f:(s=!1,!o&&r<=0?[]:[{...f,count:r}]))};return s?{...u,ships:[...u.ships,P({shipDefinition:a,usedModules:null,count:r,reinforcement:i,maxReinforcement:n.maxReinforcement})],totalCost:x(u.ships),totalReinforcementCount:S(u.ships)}:{...u,totalCost:x(u.ships),totalReinforcementCount:S(u.ships)}}function Be(e){const{shipId:t,carrierShipId:r,count:i,reinforcement:n,fleetSetup:o,keepZero:a}=e;return{...o,ships:o.ships.map(s=>s.shipDefinition.id!==r||s.reinforcement!==n?s:s.carriedShips.find(u=>u.shipDefinition.id===t)?{...s,carriedShips:s.carriedShips.flatMap(u=>{if(u.shipDefinition.id!==t)return[u];if(u.reinforcement!==n)throw new Error("Detected invalid reinforcement");return!a&&i<=0?[]:[{...u,count:Math.max(0,i),reinforcement:n}]})}:{...s,carriedShips:[...s.carriedShips,U({shipId:t,count:i,reinforcement:n})]})}}function Ee(e){const{shipId:t,reinforcement:r,moduleSelection:i,fleetSetup:n}=e;return{...n,ships:n.ships.map(o=>o.shipDefinition.id!==t?o:r!=null&&r.includes("ally")?o.reinforcement===r?{...o,moduleSelection:i,carrierCapabilities:M(o.shipDefinition,i)}:o:!o.reinforcement||!o.reinforcement.includes("ally")?{...o,moduleSelection:i,carrierCapabilities:M(o.shipDefinition,i)}:o)}}function Te(e,t,r){return{...r,groups:{...r.groups,[e]:Object.keys(r.groups[e]).reduce((i,n)=>{const o=r.groups[e][n];return{...i,[n]:n===t?{...o,usage:"used"}:{...o,usage:"not_used"}}},r.groups[e])}}}function x(e){return e.filter(t=>t.reinforcement===null).map(t=>t.count*t.shipDefinition.cost).reduce((t,r)=>t+r,0)}function S(e){return e.filter(t=>t.reinforcement!==null).map(t=>t.count).reduce((t,r)=>t+r,0)}function De(e){let t=0;const r=e.map(o=>o.count).reduce((o,a)=>o+a,0),i=Object.keys(Z).reduce((o,a)=>({...o,[a]:0}),{}),n={[y.FRONT]:0,[y.MIDDLE]:0,[y.BACK]:0,[y.NONE]:0};return e.forEach(o=>{o.reinforcement===null&&(t+=o.count*o.shipDefinition.cost),i[o.shipDefinition.type]+=o.count,n[o.shipDefinition.row]+=o.count,o.carriedShips.length>0&&o.carriedShips.forEach(a=>{i[a.shipDefinition.type]+=a.count})}),{shipCount:r,shipCountByType:i,shipCountByRow:n,totalCost:t}}function Fe(e){var r,i;const t={};return e.name.length===0&&(t.name=c("validation.requiredField")),(!Number.isFinite(e.maxReinforcement)||e.maxReinforcement<0)&&(t.maxReinforcement=c("validation.invalidValue")),(!Number.isFinite(e.maxCost)||e.maxCost<300||e.maxCost>450)&&(t.maxCost=c("validation.invalidValue")),e.maxCost>400&&e.maxReinforcement>5&&(t.maxReinforcement=(r=t.maxReinforcement)!=null?r:c("fleetSetup.maxOneDockingEffect"),t.maxCost=(i=t.maxCost)!=null?i:c("fleetSetup.maxOneDockingEffect")),t}function Me(e){const t={},r={},i={};return e.ships.forEach(n=>{const o=I(n.shipDefinition.id,n.reinforcement);if(r[o]){const a=r[o];r[o]={count:n.reinforcement===null?n.count:a.count,reinforcementCount:n.reinforcement!==null?n.count:a.reinforcementCount,operationLimit:n.shipDefinition.operationLimit}}else r[o]={count:n.reinforcement===null?n.count:0,reinforcementCount:n.reinforcement!==null?n.count:0,operationLimit:n.shipDefinition.operationLimit};n.carriedShips.forEach(a=>{const s=I(a.shipDefinition.id,n.reinforcement);i[s]?i[s].count+=a.count:i[s]={count:a.count,operationLimit:a.shipDefinition.operationLimit}})}),Object.keys(r).forEach(n=>{const o=r[n];o.count+o.reinforcementCount>o.operationLimit&&(t[n]=c("fleetSetup.exceedingTotalOperationLimit"))}),Object.keys(i).forEach(n=>{const o=i[n];o.count>o.operationLimit&&(t[n]=c("fleetSetup.exceedingTotalOperationLimit"))}),t}function I(e,t){const r=t!=null&&t.includes("ally")?t:"self";return`${e}#${r}`}export{l as G,he as S,Re as a,De as b,Ce as c,Be as d,Ee as e,ge as f,ye as g,B as h,Fe as i,P as j,Te as k,I as l,se as m,U as n,_e as s,ae as u,Me as v};
