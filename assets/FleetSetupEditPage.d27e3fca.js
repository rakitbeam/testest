var Le=Object.defineProperty,je=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var re=(i,e,n)=>e in i?Le(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,x=(i,e)=>{for(var n in e||(e={}))Ge.call(e,n)&&re(i,n,e[n]);if(ie)for(var n of ie(e))We.call(e,n)&&re(i,n,e[n]);return i},S=(i,e)=>je(i,He(e));import{j as t,t as M,c as E,p as H,b as f,T as v,w as R,F as k,h as T,q as ue,r as h,J as ze,S as y,u as G,a as W,U as ae,ad as Pe,av as Ve,aw as oe,ax as se,ak as Ne,au as le,ay as w,at as Ue}from"./vendor.da49bbc3.js";import{c as z,i as P,r as V,N as qe,C as Ye}from"./NavigationBar.0d38d227.js";import{L as Je,c as ce,b as D,S as q,y as Ke,o as Qe,B as O}from"./index.8914962e.js";import{d as Ze,a as Xe,b as et,C as tt}from"./ConfirmationDialog.3fa89778.js";import{A as nt}from"./ActionBar.4a719c8f.js";import{B as it,S as rt,g as ut,c as de,d as at,e as ot,s as st,h as lt,i as ct,v as Y,j as pe,k as dt,l as pt,a as ht,G as he,b as ft}from"./fleetSetupValidation.451d4359.js";import{d as fe,g as Ft}from"./userSettingsUtils.a26776e7.js";import{R as J}from"./ResponsiveDialog.2443e0b2.js";import{c as Fe,S as me}from"./ShipTypeFilterButton.2995eaa5.js";import"./domUtils.e9df6b0f.js";import"./sorting.c6946657.js";import"./WishState.3db35fd5.js";const mt=i=>{const{fleetSetup:e,onChange:n,errors:r,columnCount:u}=i,a=c=>{n(S(x({},e),{name:c.target.value.trim()}))},o=c=>{n(S(x({},e),{maxCost:Number(c.target.value)}))},s=c=>{n(S(x({},e),{maxReinforcement:Number(c.target.value)}))},F=c=>{n(S(x({},e),{myListOnly:c.target.value==="myListOnly"}))};return t(M,{children:t(E,{p:1,children:t(Je,{sx:{alignItems:"center"},offsetValue:!1,rowGap:1,columnCount:u,rows:[{key:"name",label:"\u8266\u968A\u540D",value:c=>t(H,{variant:"outlined",size:"small",value:e.name,onChange:a,error:!!r.name,helperText:r.name,fullWidth:c})},{key:"reinforcementCount",label:"\u6700\u5927\u5897\u63F4\u6570",value:c=>f(H,{variant:"outlined",size:"small",select:!0,value:e.maxReinforcement,onChange:s,error:!!r.maxReinforcement,helperText:r.maxReinforcement,fullWidth:c,SelectProps:{renderValue:()=>t(v,{variant:"body1",whiteSpace:"normal",children:e.maxReinforcement})},children:[t(R,{value:"5",children:"\uFF15\u96BB\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(R,{value:"6",children:"\uFF16\u96BB\uFF08\u5C0F\u578B\u88DC\u7D66\u57FA\u5730\u306B\u7D50\u5408\uFF09"}),t(R,{value:"9",children:"\uFF19\u96BB\uFF08\u4E2D\u7D99\u88DC\u7D66\u65BD\u8A2D\u306B\u7D50\u5408\uFF09"})]})},{key:"maxCost",label:"\u6700\u5927\u53F8\u4EE4Pt",value:c=>f(H,{variant:"outlined",size:"small",select:!0,value:e.maxCost,onChange:o,error:!!r.maxCost,helperText:r.maxCost,fullWidth:c,SelectProps:{renderValue:()=>t(v,{variant:"body1",whiteSpace:"normal",children:e.maxCost})},children:[t(R,{value:"450",children:"\uFF14\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(R,{value:"430",children:"\uFF14\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(R,{value:"415",children:"\uFF14\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(R,{value:"400",children:"\uFF14\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(R,{value:"350",children:"\uFF13\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(R,{value:"330",children:"\uFF13\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(R,{value:"315",children:"\uFF13\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(R,{value:"300",children:"\uFF13\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"})]})},{key:"myListOnly",label:"\u8FFD\u52A0\u3067\u304D\u308B\u8266\u8239",value:c=>f(H,{variant:"outlined",size:"small",select:!0,value:e.myListOnly?"myListOnly":"all",onChange:F,error:!!r.myListOnly,helperText:r.myListOnly,fullWidth:c,SelectProps:{renderValue:()=>t(v,{variant:"body1",whiteSpace:"normal",children:e.myListOnly?"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239":"\u5168\u3066\u306E\u8266\u8239"})},children:[t(R,{value:"all",children:"\u5168\u3066\u306E\u8266\u8239"}),t(R,{value:"myListOnly",children:"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239"})]})}]})})})};var K={},gt=P.exports;Object.defineProperty(K,"__esModule",{value:!0});var Q=K.default=void 0,Ct=gt(z),vt=V,yt=(0,Ct.default)((0,vt.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");Q=K.default=yt;const ge=i=>{const{onOpenAddShips:e,filter:n,buttonProps:r}=i;return t(it,{icon:t(Q,{}),text:"\u8266\u8239\u3092\u8FFD\u52A0",onClick:a=>{switch(a){case"addInitialShip":{e(null,n);break}case"addSelfReinforcement":{e("self",n);break}case"addAllyReinforcement":{e("ally",n);break}}},buttonProps:r,options:[{key:"addInitialShip",text:"\u901A\u5E38\u914D\u5099",value:"addInitialShip"},{key:"addSelfReinforcement",text:"\u5897\u63F4",value:"addSelfReinforcement"},{key:"addAllyReinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4",value:"addAllyReinforcement"}]})},xt=i=>{const{grouping:e,onChangeGrouping:n,onCancel:r,onSave:u,onReset:a,onOpenAddShips:o,saveDisabled:s}=i;return t(nt,{left:F=>f(k,{children:[t(rt,{value:e,onChange:n,buttonProps:F}),t(ge,{onOpenAddShips:o,buttonProps:F})]}),right:F=>f(k,{children:[t(T,S(x({variant:"outlined",startIcon:t(Ze,{}),onClick:a},F),{children:"\u521D\u671F\u5316"}),"reset"),t(T,S(x({variant:"outlined",startIcon:t(Xe,{}),onClick:r},F),{children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),"cancel"),t(T,S(x({variant:"contained",startIcon:t(et,{}),onClick:u,disabled:s},F),{children:"\u4FDD\u5B58"}),"save")]})})},St=i=>{var g;const{initialFleetKey:e,userSettings:n}=i,r=ue(),u=h.exports.useMemo(()=>ut(n),[n]),[a,o]=h.exports.useState(e&&(g=u.find(C=>C.key===e))!=null?g:u[0]),s=h.exports.useCallback((C,b,A)=>{o(B=>de({shipId:C,count:b,reinforcement:A,fleetSetup:B,userSettings:n}))},[n]),F=h.exports.useCallback((C,b,A,B)=>{o(_=>at({shipId:C,carrierShipId:b,count:A,reinforcement:B,fleetSetup:_}))},[]),c=h.exports.useCallback((C,b,A)=>{o(B=>ot({shipId:C,reinforcement:b,moduleSelection:A,fleetSetup:B}))},[]),m=h.exports.useCallback(()=>{st(a),r("/fleetSetup")},[a]),l=h.exports.useCallback(()=>{const C=Number(a.key.substring("fleet".length));o(lt(C))},[a]),d=h.exports.useMemo(()=>ct(a),[a]),p=h.exports.useMemo(()=>Y(a),[a]);return{fleetSetup:a,errors:d,shipWarnings:p,setFleetSetup:o,setShipCount:s,setCarriedShipCount:F,setModule:c,save:m,reset:l}},Dt=i=>{const{fleetSetup:e,fleetShipCount:n}=i,r=n.totalCost>e.maxCost,u=e.totalReinforcementCount>e.maxReinforcement;return t(E,{sx:{height:"100px"},children:t(M,{square:!0,sx:{position:"fixed",right:0,bottom:0,zIndex:1,width:"100%",borderTop:"1px solid rgba(0, 0, 0, 0.2)"},children:t(ze,{maxWidth:"md",disableGutters:!0,children:t(E,{p:1,children:f(y,{spacing:1,flexWrap:"wrap",direction:"row",children:[t(E,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:f("div",{children:[t(v,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),t(v,{variant:"body1",sx:{color:u?"red":void 0},children:t("strong",{children:`${e.totalReinforcementCount} / ${e.maxReinforcement}`})})]})}),t(E,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:f("div",{children:[t(v,{variant:"body2",color:"text.secondary",children:"\u53F8\u4EE4pt"}),t(v,{variant:"body1",sx:{color:r?"red":void 0},children:t("strong",{children:`${n.totalCost} / ${e.maxCost}`})})]})})]})})})})})};function bt(i,e,n,r){const u={};e.ships.forEach(o=>{u[`${o.shipDefinition.id}_${o.reinforcement}`]=!0});const a=Et(ce,i,e.myListOnly,n);return{fleetSetup:S(x({},e),{ships:[...e.ships,...a.flatMap(o=>u[`${o.id}_${i}`]?[]:[pe({shipDefinition:o,usedModules:null,count:0,reinforcement:i,userSettings:n,maxReinforcement:e.maxReinforcement,temporary:!0,myListOnly:e.myListOnly})])]}),reinforcement:i,filter:r}}function Et(i,e,n,r){const u=i.filter(a=>a.type!==D.CORVETTE&&a.type!==D.FIGHTER);return e==="ally"||!n?u:u.filter(a=>fe(a.id,r))}function At(i){return S(x({},i.fleetSetup),{ships:i.fleetSetup.ships.flatMap(e=>e.temporary?e.count===0?[]:[S(x({},e),{temporary:!1})]:[e])})}function Bt(i,e){let n=S(x({},e),{fleetSetup:S(x({},e.fleetSetup),{ships:e.fleetSetup.ships.filter(r=>r.temporary===!0)})});return Object.keys(i).filter(r=>i[r]).forEach(r=>{switch(r){case q.FRONT:case q.MIDDLE:case q.BACK:{n=S(x({},n),{fleetSetup:S(x({},n.fleetSetup),{ships:n.fleetSetup.ships.filter(u=>u.shipDefinition.row===r)})});break}case D.CARRIER:case D.BATTLE_CRUISER:case D.CRUISER:case D.DESTROYER:case D.FRIGATE:{n=S(x({},n),{fleetSetup:S(x({},n.fleetSetup),{ships:n.fleetSetup.ships.filter(u=>u.shipDefinition.type===r)})});break}}}),n}const Rt=i=>{const{userSettings:e,fleetSetup:n,setFleetSetup:r}=i,[u,a]=h.exports.useState(null),o=h.exports.useCallback((l,d)=>{a(bt(l,n,e,d!=null?d:null))},[n,e]),s=h.exports.useCallback(()=>{a(null)},[]),F=h.exports.useCallback(()=>{u&&(r(At(u)),a(null))},[u,r]),c=h.exports.useCallback((l,d,p)=>{a(g=>g?S(x({},g),{fleetSetup:de({shipId:l,count:d,reinforcement:p,fleetSetup:g.fleetSetup,userSettings:e,keepZero:!0})}):null)},[e]),m=h.exports.useMemo(()=>u?Y(u.fleetSetup):{},[u]);return{dialogData:u,shipWarnings:m,open:o,cancel:s,apply:F,setShipCount:c}};var Z={},Tt=P.exports;Object.defineProperty(Z,"__esModule",{value:!0});var Ce=Z.default=void 0,wt=Tt(z),kt=V,$t=(0,wt.default)((0,kt.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");Ce=Z.default=$t;var X={},Mt=P.exports;Object.defineProperty(X,"__esModule",{value:!0});var ve=X.default=void 0,_t=Mt(z),Ot=V,It=(0,_t.default)((0,Ot.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");ve=X.default=It;const Lt=i=>{const{shipDefinition:e,count:n,maxCount:r,reinforcement:u,showCost:a,showReinforcement:o,carrierShipId:s,shipWarning:F,onChangeShipCount:c,onChangeCarriedShipCount:m}=i,l=G(),d=W(l.breakpoints.down("sm")),{openShipDetailDialog:p}=Ke(),g=f(k,{children:[t(v,{variant:"body1",children:t(Qe,{onClick:()=>{p(e.id)},children:e.name})}),a&&u===null&&t(v,{variant:"body2",color:"text.secondary",children:`\u6307\u4EE4\uFF30\uFF54\uFF1A${e.cost}\u3000\u5408\u8A08\uFF1A${e.cost*n}`}),o&&u==="self"&&t(v,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),o&&u==="ally"&&t(v,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4"})]}),C=F&&t(v,{variant:"caption",color:"red",textAlign:"end",children:F}),b=t(T,{onClick:()=>{s?m==null||m(e.id,s,0,u):c==null||c(e.id,0,u)},disabled:n<=0,children:"\u5916\u3059"}),A=t(ae,{onClick:()=>{s?m==null||m(e.id,s,n-1,u):c==null||c(e.id,n-1,u)},disabled:n<=0,children:t(Ce,{color:n<=0?"disabled":"primary"})}),B=t(v,{variant:"body1",sx:{minWidth:"55px"},textAlign:"center",children:t("strong",{children:`${n} / ${r}`})}),_=t(ae,{onClick:()=>{s?m==null||m(e.id,s,n+1,u):c==null||c(e.id,n+1,u)},disabled:n>=r,children:t(ve,{color:n>=r?"disabled":"primary"})}),L=t(T,{onClick:()=>{s?m==null||m(e.id,s,r,u):c==null||c(e.id,r,u)},disabled:n>=r,children:"\u6700\u5927"});return f(k,{children:[d&&f(y,{spacing:1,children:[g,f(M,{variant:"outlined",sx:{display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[f(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[A,B,_]}),f(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[b,L]})]}),C]}),!d&&f(y,{spacing:1,children:[f(y,{spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[t(E,{pb:1,children:t(y,{spacing:1,children:g})}),t(E,{sx:{display:"flex",justifyContent:"end",flexGrow:1},children:t(M,{variant:"outlined",sx:{display:"inline-block"},children:f(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[b,A,B,_,L]})})})]}),C]})]})};function jt(i){const e={corvette:{key:"corvette",name:"\u8B77\u9001\u8266",count:i.carriedShips.filter(n=>n.shipDefinition.type===D.CORVETTE).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:i.carrierCapabilities.carryCorvette*i.count},upToLargeFighter:{key:"upToLargeFighter",name:"\u5C0F\uFF5E\u5927\u578B\u6226\u95D8\u6A5F",count:i.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.LARGE_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:i.carrierCapabilities.carryUpToLargeFighter*i.count},upToMediumFighter:{key:"upToMediumFighter",name:"\u5C0F\uFF5E\u4E2D\u91CF\u7D1A\u6226\u95D8\u6A5F",count:i.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.MEDIUM_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:i.carrierCapabilities.carryUpToMediumFighter*i.count},upToSmallFighter:{key:"upToSmallFighter",name:"\u5C0F\u578B\u6226\u95D8\u6A5F",count:i.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.SMALL_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:i.carrierCapabilities.carryUpToSmallFighter*i.count},removedHangar:{key:"removedHangar",name:"\u672A\u5BFE\u5FDC",count:0,maxCount:0}};return I(e.upToSmallFighter,[e.upToMediumFighter,e.upToLargeFighter]),I(e.upToMediumFighter,[e.upToLargeFighter]),e.upToSmallFighter.maxCount===0&&I(e.upToSmallFighter,[e.removedHangar]),e.upToMediumFighter.maxCount===0&&I(e.upToMediumFighter,[e.removedHangar]),e.upToLargeFighter.maxCount===0&&I(e.upToLargeFighter,[e.removedHangar]),e}function I(i,e){let n=i.count-i.maxCount;n<=0||(i.count-=n,e.forEach(r=>{if(n<=0||r.maxCount===0)return;const u=r.maxCount-r.count;if(u<=0)return;const a=Math.min(u,n);n-=a,r.count+=a}),n>0&&(i.count+=n))}function Ht(i){return i.count>0||i.maxCount>0}const Gt=i=>{const{shipSelection:e,onOpenAddCarriedShips:n}=i,r=G(),u=W(r.breakpoints.down("xs")),a=h.exports.useMemo(()=>jt(e),[e]);return f(y,{spacing:1,direction:u?"column":"row",alignItems:u?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[f(y,{sx:{flexGrow:1},spacing:3,direction:"row",alignItems:"center",justifyContent:"space-between",children:[t(v,{variant:"body2",color:"text.secondary",children:"\u30CF\u30F3\u30AC\u30FC\uFF1A"}),t(y,{spacing:1,direction:"row",alignItems:"center",children:t(y,{spacing:1,direction:"row",alignItems:"center",children:Object.keys(a).filter(o=>Ht(a[o])).map(o=>a[o]).map(o=>f(h.exports.Fragment,{children:[t(v,{variant:"body2",color:"text.secondary",children:o.name}),t(v,{variant:"body2",color:"text.secondary",sx:{color:o.count>o.maxCount?"red":void 0},children:t("strong",{children:`${o.count} / ${o.maxCount}`})})]},o.key))})})]}),t(T,{variant:"outlined",size:"small",startIcon:t(Q,{}),sx:{whiteSpace:"nowrap"},onClick:()=>{n==null||n(e.shipDefinition.id,e.reinforcement)},children:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0"})]})};var ee={},Wt=P.exports;Object.defineProperty(ee,"__esModule",{value:!0});var ye=ee.default=void 0,zt=Wt(z),Pt=V,Vt=(0,zt.default)((0,Pt.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");ye=ee.default=Vt;const Nt=i=>{const{shipId:e,reinforcement:n,moduleSelection:r,onChange:u,onClose:a}=i,[o,s]=h.exports.useState(r),F=()=>{u(e,n,o),a()},c=d=>{const[p,g]=d.target.value.split("#");s(C=>dt(p,g,C))},m=d=>{const p=Object.keys(o.groups[d]).find(g=>o.groups[d][g].usage==="used");return p?`${d}#${p}`:null},l=d=>!Object.keys(o.groups[d]).find(p=>o.groups[d][p].module.defaultModule);return t(J,{title:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5",content:t(y,{spacing:3,children:Object.keys(o.groups).map(d=>{const p=m(d),g=`${d}#none`;return t(M,{variant:"outlined",children:t(E,{pl:1,pr:1,children:t(Pe,{children:f(Ve,{defaultValue:"female",name:`group-${d}`,value:p!=null?p:g,onChange:c,children:[l(d)&&t(oe,{label:"\u7121\u3057",value:g,control:t(se,{})},g),Object.keys(o.groups[d]).map(C=>{const b=o.groups[d][C],A=n!=="ally"&&b.usage==="not_possessed",B=`${d}#${C}`;return t(oe,{label:`${b.module.category}${b.module.categoryNumber} ${b.module.name}`,value:B,control:t(se,{disabled:A}),disabled:A},C)})]})})})},d)})}),actions:f(k,{children:[t(T,{variant:"outlined",onClick:a,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:F,children:"\uFF2F\uFF2B"})]}),onClose:a})},Ut=i=>{const{shipId:e,reinforcement:n,moduleSelection:r,onChange:u}=i,a=G(),o=W(a.breakpoints.down("xs")),[s,F]=h.exports.useState(!1),c=()=>{F(!0)},m=()=>{F(!1)},l=[];return Object.keys(r.groups).map(d=>{Object.keys(r.groups[d]).map(p=>r.groups[d][p]).forEach(p=>{p.usage==="used"&&(l.length>0&&l.push(t(h.exports.Fragment,{children:t(v,{variant:"body2",component:"span",children:"\u3001"})},`before_${p.module.id}`)),l.push(t(h.exports.Fragment,{children:t(Ne,{arrow:!0,disableFocusListener:!0,title:p.module.name,children:t(v,{variant:"body2",component:"span",children:`${p.module.category}${p.module.categoryNumber}`})})},p.module.id)))})}),f(k,{children:[f(y,{spacing:1,direction:o?"column":"row",alignItems:o?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[t(E,{sx:{flexGrow:1},children:f(v,{variant:"body2",color:"text.secondary",children:["\u30B7\u30B9\u30C6\u30E0\uFF1A",l]})}),!r.static&&t(E,{sx:{display:"flex",alignContent:"end"},children:t(T,{variant:"outlined",size:"small",startIcon:t(ye,{}),sx:{whiteSpace:"nowrap"},onClick:c,children:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5"})})]}),s&&t(Nt,{shipId:e,reinforcement:n,moduleSelection:r,onChange:u,onClose:m})]})},xe=h.exports.memo(Lt),te=i=>{const{shipSelections:e,showCost:n,showReinforcement:r,showHangar:u,shipWarnings:a,carrierShipId:o,onChangeShipCount:s,onChangeCarriedShipCount:F,onOpenAddCarriedShips:c,onChangeModule:m}=i;return t(y,{spacing:1,children:e==null?void 0:e.map(l=>{var d,p;return t(M,{variant:"outlined",children:t(E,{p:1,children:f(y,{spacing:1,children:[t(xe,{shipDefinition:l.shipDefinition,count:l.count,maxCount:l.maxCount,reinforcement:l.reinforcement,showCost:n,showReinforcement:r,carrierShipId:o,onChangeShipCount:s,onChangeCarriedShipCount:F,shipWarning:a[l.shipDefinition.id]}),l.moduleSelection&&m&&t(Ut,{shipId:l.shipDefinition.id,reinforcement:l.reinforcement,moduleSelection:l.moduleSelection,onChange:m}),u&&l.carrierCapabilities.canCarry&&f(y,{spacing:1,children:[t(Gt,{shipSelection:l,onOpenAddCarriedShips:c}),(d=l.carriedShips)==null?void 0:d.map(g=>{var C;return t(xe,{shipDefinition:g.shipDefinition,count:g.count,maxCount:g.shipDefinition.operationLimit,reinforcement:g.reinforcement,carrierShipId:l.shipDefinition.id,showCost:!1,showReinforcement:!1,onChangeCarriedShipCount:F,shipWarning:a[g.shipDefinition.id]},`${l.shipDefinition.id}_${g.shipDefinition.id}_${(C=g.reinforcement)!=null?C:"initial"}`)})]})]})})},`${l.shipDefinition.id}_${(p=l.reinforcement)!=null?p:"initial"}`)})})},qt=i=>{const{dialogData:e,shipWarnings:n,onCancel:r,onApply:u,onChangeShipCount:a}=i,[o,s]=h.exports.useState(!1),[F,c]=h.exports.useState(()=>{const l=Fe();return e.filter&&typeof l[e.filter]=="boolean"?S(x({},l),{[e.filter]:!0}):l}),m=h.exports.useMemo(()=>Bt(F,e),[F,e]);return h.exports.useEffect(()=>{const l=setTimeout(()=>{s(!0)},0);return()=>{clearTimeout(l)}},[]),t(J,{title:f(y,{spacing:1,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t(v,{variant:"h6",children:Yt(e.reinforcement)}),e.reinforcement===null?f("div",{children:[t(v,{variant:"body1",component:"span",children:"\u6307\u4EE4Pt\uFF1A"}),t(v,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalCost>e.fleetSetup.maxCost?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalCost} / ${e.fleetSetup.maxCost}`})})]}):f("div",{children:[t(v,{variant:"body1",component:"span",children:"\u5897\u63F4\uFF1A"}),t(v,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalReinforcementCount>e.fleetSetup.maxReinforcement?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalReinforcementCount} / ${e.fleetSetup.maxReinforcement}`})})]})]}),content:f(y,{spacing:2,children:[t(v,{variant:"body2",children:Jt(e.reinforcement)}),t("div",{children:t(me,{filter:F,shipTypes:[D.CARRIER,D.BATTLE_CRUISER,D.CRUISER,D.DESTROYER,D.FRIGATE],onChange:c,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),m.fleetSetup.ships.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8239\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),o?t(te,{shipSelections:m.fleetSetup.ships,showCost:!m.reinforcement,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,onChangeShipCount:a}):f(y,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:f(k,{children:[t(T,{variant:"outlined",onClick:r,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:u,children:"\uFF2F\uFF2B"})]}),onClose:r})};function Yt(i){switch(i){case"ally":case"self":return"\u5897\u63F4\u3092\u8FFD\u52A0";default:return"\u8266\u8239\u3092\u8FFD\u52A0"}}function Jt(i){switch(i){case"ally":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"self":return"\u81EA\u8EAB\u306E\u57FA\u5730\u304B\u3089\u9001\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002";default:return"\u8266\u8239\u3092\u901A\u5E38\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}}function Kt(i,e,n,r){const u=n.ships.find(s=>s.shipDefinition.id===i&&s.reinforcement===e);if(!u)throw new Error("Invalid carrier");const a={};u.carriedShips.forEach(s=>{a[`${s.shipDefinition.id}_${s.reinforcement}`]=!0});const o=Qt(u,ce,e,n.myListOnly,r);return{carrierShipId:i,reinforcement:e,shipSelections:o.flatMap(s=>a[`${s.id}_${e}`]?[]:[pe({shipDefinition:s,usedModules:null,count:0,reinforcement:e,userSettings:r,maxReinforcement:n.maxReinforcement,temporary:!0,myListOnly:n.myListOnly})]),filter:null}}function Qt(i,e,n,r,u){const a=e.filter(o=>{switch(o.type){case D.CORVETTE:return i.carrierCapabilities.carryCorvette>0;case D.FIGHTER:switch(o.subType){case O.LARGE_FIGHTER:return i.carrierCapabilities.carryUpToLargeFighter>0;case O.MEDIUM_FIGHTER:return i.carrierCapabilities.carryUpToMediumFighter>0||i.carrierCapabilities.carryUpToLargeFighter>0;case O.SMALL_FIGHTER:return i.carrierCapabilities.carryUpToSmallFighter>0||i.carrierCapabilities.carryUpToMediumFighter>0||i.carrierCapabilities.carryUpToLargeFighter>0}}return!1});return n==="ally"||!r?a:a.filter(o=>fe(o.id,u))}function Se(i,e){return S(x({},e),{ships:e.ships.map(n=>n.shipDefinition.id!==i.carrierShipId||n.reinforcement!==i.reinforcement?n:S(x({},n),{carriedShips:[...n.carriedShips,...i.shipSelections.filter(r=>r.count>0).map(r=>pt({shipId:r.shipDefinition.id,count:r.count,reinforcement:i.reinforcement}))]}))})}function Zt(i,e){let n=e;return Object.keys(i).filter(r=>i[r]).forEach(r=>{switch(r){case D.CORVETTE:case D.FIGHTER:{n=S(x({},n),{shipSelections:n.shipSelections.filter(u=>u.shipDefinition.type===r)});break}}}),n}const Xt=i=>{const{userSettings:e,fleetSetup:n,setFleetSetup:r}=i,[u,a]=h.exports.useState(null),o=h.exports.useCallback((l,d)=>{a(Kt(l,d,n,e))},[n,e]),s=h.exports.useCallback(()=>{a(null)},[]),F=h.exports.useCallback(()=>{u&&(r(Se(u,n)),a(null))},[u,n,r]),c=h.exports.useCallback((l,d,p)=>{a(g=>g?S(x({},g),{shipSelections:g.shipSelections.map(C=>C.shipDefinition.id!==l||C.reinforcement!==p?C:S(x({},C),{count:d}))}):null)},[e]),m=h.exports.useMemo(()=>{if(!u)return{};const l=Se(u,n);return Y(l)},[u,n]);return{dialogData:u,shipWarnings:m,open:o,cancel:s,apply:F,setShipCount:c}},en=i=>{const{dialogData:e,shipWarnings:n,onCancel:r,onApply:u,onChangeShipCount:a}=i,[o,s]=h.exports.useState(!1),[F,c]=h.exports.useState(()=>{const p=Fe();return e.filter&&typeof p[e.filter]=="boolean"?S(x({},p),{[e.filter]:!0}):p}),m=h.exports.useMemo(()=>Zt(F,e),[F,e]);h.exports.useEffect(()=>{const p=setTimeout(()=>{s(!0)},0);return()=>{clearTimeout(p)}},[]);const l=!!e.shipSelections.find(p=>p.shipDefinition.type===D.CORVETTE),d=!!e.shipSelections.find(p=>p.shipDefinition.type===D.FIGHTER);return t(J,{title:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0",content:f(y,{spacing:2,children:[t(v,{variant:"body2",children:"\u8266\u8F09\u6A5F\u3092\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8F09\u6A5F\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}),l&&d&&t("div",{children:t(me,{filter:F,shipTypes:[D.CORVETTE,D.FIGHTER],shipRows:[],onChange:c,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),m.shipSelections.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8F09\u6A5F\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),o?t(te,{shipSelections:m.shipSelections,showCost:!1,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,onChangeShipCount:a}):f(y,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:f(k,{children:[t(T,{variant:"outlined",onClick:r,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:u,children:"\uFF2F\uFF2B"})]}),onClose:r})},Fn=()=>{const i=ue(),{fleetKey:e}=Ue(),n=G(),r=W(n.breakpoints.up("lg")),u=h.exports.useMemo(()=>Ft(),[]),[a,o]=h.exports.useState(!1),{fleetSetup:s,errors:F,shipWarnings:c,setFleetSetup:m,setShipCount:l,setCarriedShipCount:d,setModule:p,save:g,reset:C}=St({initialFleetKey:e,userSettings:u}),{dialogData:b,shipWarnings:A,open:B,cancel:_,apply:L,setShipCount:De}=Rt({userSettings:u,fleetSetup:s,setFleetSetup:m}),{dialogData:ne,shipWarnings:be,open:Ee,cancel:Ae,apply:Be,setShipCount:Re}=Xt({userSettings:u,fleetSetup:s,setFleetSetup:m}),Te=h.exports.useMemo(()=>ht(s.ships),[s.ships]),[N,we]=h.exports.useState(he.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),U=h.exports.useMemo(()=>ft(N,s),[s,N]),ke=()=>{i(`/fleetSetup/${s.key}`)},$e=()=>{Object.keys(F).length>0||(g(),i(`/fleetSetup/${s.key}`))},Me=()=>{o(!1)},_e=()=>{o(!0)},Oe=()=>{o(!1),C()},j=r&&U.groupedBy===he.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column",Ie=j==="row"?4:2;return f(k,{children:[t(qe,{currentRoute:"/fleetSetup"}),t(xt,{grouping:N,onChangeGrouping:we,onSave:$e,onCancel:ke,onReset:_e,onOpenAddShips:B,saveDisabled:Object.keys(F).length>0}),t(Ye,{disabled:j==="row",children:t(E,{p:1,children:f(y,{spacing:1,children:[t(mt,{fleetSetup:s,onChange:m,errors:F,columnCount:Ie}),t(y,{spacing:1,direction:j,children:U.groups.map($=>t(M,{sx:{width:j==="row"?`${100/U.groups.length}%`:void 0},children:t(E,{p:1,children:f(y,{spacing:1,children:[f(y,{spacing:1,direction:"row",alignItems:"center",sx:{width:"100%"},children:[t(E,{sx:{flexGrow:1},children:t(v,{variant:"body1",children:`${$.name}${$.count>0?`\uFF08${$.count}\u96BB\uFF09`:""}`})}),t(ge,{filter:$.id,onOpenAddShips:B,buttonProps:{size:"small"}})]}),$.ships.length>0&&t(te,{shipSelections:$.ships,onChangeShipCount:l,onChangeCarriedShipCount:d,onOpenAddCarriedShips:Ee,onChangeModule:p,showCost:!0,showReinforcement:!0,showHangar:!0,shipWarnings:c,carrierShipId:null})]})})},$.id))})]})})}),t(Dt,{fleetSetup:s,fleetShipCount:Te}),b&&t(qt,{dialogData:b,shipWarnings:A,onCancel:_,onApply:L,onChangeShipCount:De}),ne&&t(en,{dialogData:ne,shipWarnings:be,onCancel:Ae,onApply:Be,onChangeShipCount:Re}),a&&t(tt,{title:"\u521D\u671F\u5316",question:"\u8266\u968A\u3092\u521D\u671F\u72B6\u614B\u306B\u623B\u3057\u307E\u3059\u304B\uFF1F",cancelText:"\u30AD\u30E3\u30F3\u30BB\u30EB",confirmText:"\u521D\u671F\u5316",onCancel:Me,onConfirm:Oe})]})};export{Fn as FleetSetupEditPage,Fn as default};
