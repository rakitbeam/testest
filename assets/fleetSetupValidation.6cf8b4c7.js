import{c as j,i as G,r as H,t as c,d as p,b as W,S as y,a as V,g as d,e as z,s as A,bu as q,h as K,p as M,F as J,V as E,bC as b,bD as g,X}from"./index.9f278538.js";import{B as Z}from"./ButtonMenu.af4c49a8.js";import{n as L}from"./sorting.c6946657.js";var O={},Q=G.exports;Object.defineProperty(O,"__esModule",{value:!0});var Y=O.default=void 0,ee=Q(j),te=H,re=(0,ee.default)((0,te.jsx)("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");Y=O.default=re;var l=(e=>(e.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME="groupByRowSortByTypeAndName",e.GROUP_BY_TYPE_SORT_BY_NAME="groupByTypeSortByName",e.SORT_BY_TYPE_AND_NAME="sortByTypeAndName",e.SORT_BY_NAME="sortByName",e))(l||{});const k={initial:0,self:1,ally:2,ally2:3,ally3:4},w=(e,t)=>{var n,o;return k[(n=e.reinforcement)!=null?n:"initial"]-k[(o=t.reinforcement)!=null?o:"initial"]},D=L([(e,t)=>d(e.shipDefinition).localeCompare(d(t.shipDefinition),z()),w]),T=L([(e,t)=>A(e.shipDefinition.type,e.shipDefinition.subType)-A(t.shipDefinition.type,t.shipDefinition.subType),D,w]);function ye(e,t){switch(e){case"groupByRowSortByTypeAndName":return{groupedBy:e,groups:ne(t.ships)};case"groupByTypeSortByName":return{groupedBy:e,groups:oe(t.ships)};case"sortByTypeAndName":return{groupedBy:e,groups:[{id:"all",name:c("fleetSetup.fleetFormation"),ships:t.ships.map(n=>({...n,carriedShips:[...n.carriedShips].sort(T)})).sort(T),count:t.ships.map(n=>n.count).reduce((n,o)=>n+o,0)}]};case"sortByName":return{groupedBy:e,groups:[{id:"all",name:c("fleetSetup.fleetFormation"),ships:t.ships.map(n=>({...n,carriedShips:[...n.carriedShips].sort(D)})).sort(D),count:t.ships.map(n=>n.count).reduce((n,o)=>n+o,0)}]};default:throw new Error(`Unknown group and sort option "${e}"`)}}function ne(e){return[y.FRONT,y.MIDDLE,y.BACK].map(t=>{const n=e.filter(r=>r.shipDefinition.row===t).map(r=>({...r,carriedShips:[...r.carriedShips].sort(T)})).sort(T),o=n.map(r=>r.count).reduce((r,i)=>r+i,0);return{id:t,name:V(t),ships:n,count:o}})}function oe(e){return[p.CARRIER,p.AUXILIARY,p.BATTLE_CRUISER,p.CRUISER,p.DESTROYER,p.FRIGATE].map(t=>{const n=e.filter(r=>r.shipDefinition.type===t).map(r=>({...r,carriedShips:[...r.carriedShips].sort(D)})).sort(D),o=n.map(r=>r.count).reduce((r,i)=>r+i,0);return{id:t,name:W(t),ships:n,count:o}})}function ge(e,t){const n=q()?" ":"";return[e.name,t.groups.filter(o=>o.ships.length>0).map(o=>[...t.groups.length>1?[c("fleetSetup.groupNameForSharing",{name:o.name})]:[],...o.ships.flatMap(r=>{const i=r.count*r.shipDefinition.cost,a=ie(r);switch(r.reinforcement){case"self":return[`${h(r.count)}\xD7\u3000${d(r.shipDefinition)}${n}${c("fleetSetup.reinforcementBrackets")}`,...a?[a]:[],..._(r.carriedShips)];case"ally":return[`${h(r.count)}\xD7\u3000${d(r.shipDefinition)}${n}${c("fleetSetup.orgReinforcementABrackets")}`,...a?[a]:[],..._(r.carriedShips)];case"ally2":return[`${h(r.count)}\xD7\u3000${d(r.shipDefinition)}${n}${c("fleetSetup.orgReinforcementBBrackets")}`,...a?[a]:[],..._(r.carriedShips)];case"ally3":return[`${h(r.count)}\xD7\u3000${d(r.shipDefinition)}${n}${c("fleetSetup.orgReinforcementCBrackets")}`,...a?[a]:[],..._(r.carriedShips)];default:return[`${h(r.count)}\xD7\u3000${d(r.shipDefinition)}${n}${c("fleetSetup.commandPointsValueBrackets",{value:i})}`,...a?[a]:[],..._(r.carriedShips)]}})].join(`
`)).join(`

`),[`${c("fleetSetup.reinforcementColon")}${n}${e.totalReinforcementCount}/${e.maxReinforcement}`,`${c("label.commandPointsColon")}${n}${e.totalCost}/${e.maxCost}`].join(`
`)].join(`

`)}function _(e){return e.map(t=>`\u3000\u3000 ${h(t.count)}\xD7\u3000${d(t.shipDefinition)}`)}function ie(e){if(e.moduleSelection===null||e.moduleSelection.static)return null;const t=["M","A","B","C"].flatMap(n=>{var a,s,u;const r=Object.keys((s=(a=e.moduleSelection)==null?void 0:a.groups[n])!=null?s:{}).find(f=>{var m;return((m=e.moduleSelection)==null?void 0:m.groups[n][f].usage)==="used"});if(!r)return[];const i=(u=e.moduleSelection)==null?void 0:u.groups[n][r];return!i||i.module.defaultModule?[]:i?[`${K(e.shipDefinition.id,i.module)}\uFF08${i.module.id}\uFF09`]:[]});return t.length===0?null:t.map(n=>`\u3000\u3000 ${n}`).join(`
`)}function h(e){return e<10?`${e}`.padStart(3):`${e}`}const he=e=>{const{value:t,onChange:n,buttonProps:o}=e;return M(J,{children:M(Z,{icon:M(Y,{}),text:c("button.displayItems"),value:t,options:[{key:l.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME,text:c("fleetSetup.groupByRowSortByShipTypeAndName"),value:l.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME},{key:l.GROUP_BY_TYPE_SORT_BY_NAME,text:c("fleetSetup.groupByShipTypeSortByName"),value:l.GROUP_BY_TYPE_SORT_BY_NAME},{key:l.SORT_BY_TYPE_AND_NAME,text:c("fleetSetup.sortByShipTypeAndName"),value:l.SORT_BY_TYPE_AND_NAME},{key:l.SORT_BY_NAME,text:c("fleetSetup.sortByName"),value:l.SORT_BY_NAME}],onClick:n,buttonProps:o})})};function Re(){var e,t,n,o,r;return[(e=C("fleet1"))!=null?e:B(1),(t=C("fleet2"))!=null?t:B(2),(n=C("fleet3"))!=null?n:B(3),(o=C("fleet4"))!=null?o:B(4),(r=C("fleet5"))!=null?r:B(5)]}function _e(e){const t=JSON.stringify(se(e));window.localStorage.setItem(e.key,t)}function C(e){const t=window.localStorage.getItem(e);if(!t)return null;const n=fe(t);return n?ae(ue(n),e):null}function ae(e,t){const n=e.myListOnly===!0,o=e.ships.map(r=>{var i;return{...P({shipDefinition:E(r.shipId),usedModules:(i=r.usedModules)!=null?i:null,count:r.count,reinforcement:r.reinforcement,maxReinforcement:e.maxReinforcement}),carriedShips:r.carriedShips.map(a=>U({shipId:a.shipId,count:a.count,reinforcement:r.reinforcement}))}});return{key:t,name:e.name,ships:o,totalCost:F(o),totalReinforcementCount:N(o),maxReinforcement:e.maxReinforcement,maxCost:e.maxCost,myListOnly:n}}function se(e){return{name:e.name,ships:e.ships.map(t=>({shipId:t.shipDefinition.id,usedModules:t.moduleSelection?ce(t.moduleSelection):void 0,carriedShips:t.carriedShips.map(n=>({shipId:n.shipDefinition.id,count:n.count})),count:t.count,reinforcement:t.reinforcement})),maxReinforcement:e.maxReinforcement,maxCost:e.maxCost,myListOnly:e.myListOnly}}function ue(e){const t=e.ships.reduce((o,r)=>{const i=b(r.shipId),a=E(i);if(!a)return o;let s;r.usedModules&&a.modules&&(s=r.usedModules.filter(f=>{var m;return!!((m=a.modules)!=null&&m.find(R=>R.id===f))}));const u=r.carriedShips.flatMap(f=>{const m=b(f.shipId);return E(m)?[{...f,shipId:m}]:[]});return[...o,{...r,shipId:i,usedModules:s,carriedShips:u}]},[]);return{...e,ships:t}}function ce(e){const t=[];return Object.keys(e.groups).forEach(n=>{Object.keys(e.groups[n]).forEach(o=>{e.groups[n][o].usage==="used"&&t.push(e.groups[n][o].module.id)})}),t}function fe(e){try{return JSON.parse(e)}catch(t){return alert("ERROR - Failed to restore fleet setup"),console.error(t),null}}function B(e){return{key:`fleet${e}`,name:c("fleetSetup.defaultFleetNameWithNumber",{fleetNumber:e}),ships:[],totalCost:0,totalReinforcementCount:0,maxReinforcement:5,maxCost:400,myListOnly:!0}}function P(e){const{shipDefinition:t,usedModules:n,count:o,reinforcement:r,maxReinforcement:i,temporary:a}=e,s=me(t,n),u=x(t,s),f=r===null||t.type===p.FIGHTER||t.type===p.CORVETTE?t.operationLimit:Math.min(t.operationLimit,i);return{shipDefinition:t,carrierCapabilities:u,carriedShips:[],count:Math.max(0,o),reinforcement:r,maxCount:f,moduleSelection:s,temporary:a}}function me(e,t){if(!e.modules||e.modules.length===0)return null;const n=t!=null?t:e.modules.filter(r=>r.defaultModule).map(r=>r.id),o={static:e.staticModules===!0,groups:{}};return e.modules.forEach(r=>{if(o.groups[r.category]||(o.groups[r.category]={}),o.static){o.groups[r.category][r.id]={module:r,usage:"used"};return}o.groups[r.category][r.id]={module:r,usage:n.includes(r.id)?"used":"not_used"}}),o}function x(e,t){var a;let n=0,o=0,r=0,i=(a=e.carryCorvette)!=null?a:0;if(e.carryFighter)switch(e.carryFighterType){case g.LARGE_FIGHTER:{n+=e.carryFighter;break}case g.MEDIUM_FIGHTER:{o+=e.carryFighter;break}case g.SMALL_FIGHTER:{r+=e.carryFighter;break}}return t&&Object.keys(t.groups).forEach(s=>{var u;Object.keys((u=t.groups[s])!=null?u:{}).forEach(f=>{var R,S,$,v;const m=t.groups[s][f];if(m.usage==="used"){switch(m.module.carryFighterType){case g.LARGE_FIGHTER:{n+=(R=m.module.carryFighter)!=null?R:0;break}case g.MEDIUM_FIGHTER:{o+=(S=m.module.carryFighter)!=null?S:0;break}case g.SMALL_FIGHTER:{r+=($=m.module.carryFighter)!=null?$:0;break}}i+=(v=m.module.carryCorvette)!=null?v:0}})}),{canCarry:n+o+r+i>0,carryUpToLargeFighter:n,carryUpToMediumFighter:o,carryUpToSmallFighter:r,carryCorvette:i}}function U(e){const{shipId:t,count:n,reinforcement:o,temporary:r}=e;return{shipDefinition:E(t),count:Math.max(0,n),reinforcement:o,temporary:r}}function Ce(e){const{shipId:t,count:n,reinforcement:o,fleetSetup:r,keepZero:i}=e,a=E(t);let s=!0;const u={...r,ships:r.ships.flatMap(f=>f.shipDefinition.id!==t||f.reinforcement!==o?f:(s=!1,!i&&n<=0?[]:[{...f,count:n}]))};return s?{...u,ships:[...u.ships,P({shipDefinition:a,usedModules:null,count:n,reinforcement:o,maxReinforcement:r.maxReinforcement})],totalCost:F(u.ships),totalReinforcementCount:N(u.ships)}:{...u,totalCost:F(u.ships),totalReinforcementCount:N(u.ships)}}function Be(e){const{shipId:t,carrierShipId:n,count:o,reinforcement:r,fleetSetup:i,keepZero:a}=e;return{...i,ships:i.ships.map(s=>s.shipDefinition.id!==n||s.reinforcement!==r?s:s.carriedShips.find(u=>u.shipDefinition.id===t)?{...s,carriedShips:s.carriedShips.flatMap(u=>{if(u.shipDefinition.id!==t)return[u];if(u.reinforcement!==r)throw new Error("Detected invalid reinforcement");return!a&&o<=0?[]:[{...u,count:Math.max(0,o),reinforcement:r}]})}:{...s,carriedShips:[...s.carriedShips,U({shipId:t,count:o,reinforcement:r})]})}}function Ee(e){const{shipId:t,reinforcement:n,moduleSelection:o,fleetSetup:r}=e;return{...r,ships:r.ships.map(i=>i.shipDefinition.id!==t?i:n!=null&&n.includes("ally")?i.reinforcement===n?{...i,moduleSelection:o,carrierCapabilities:x(i.shipDefinition,o)}:i:!i.reinforcement||!i.reinforcement.includes("ally")?{...i,moduleSelection:o,carrierCapabilities:x(i.shipDefinition,o)}:i)}}function De(e,t,n){return{...n,groups:{...n.groups,[e]:Object.keys(n.groups[e]).reduce((o,r)=>{const i=n.groups[e][r];return{...o,[r]:r===t?{...i,usage:"used"}:{...i,usage:"not_used"}}},n.groups[e])}}}function F(e){return e.filter(t=>t.reinforcement===null).map(t=>t.count*t.shipDefinition.cost).reduce((t,n)=>t+n,0)}function N(e){return e.filter(t=>t.reinforcement!==null).map(t=>t.count).reduce((t,n)=>t+n,0)}function Te(e){let t=0;const n=e.map(i=>i.count).reduce((i,a)=>i+a,0),o=Object.keys(X).reduce((i,a)=>({...i,[a]:0}),{}),r={[y.FRONT]:0,[y.MIDDLE]:0,[y.BACK]:0,[y.NONE]:0};return e.forEach(i=>{i.reinforcement===null&&(t+=i.count*i.shipDefinition.cost),o[i.shipDefinition.type]+=i.count,r[i.shipDefinition.row]+=i.count,i.carriedShips.length>0&&i.carriedShips.forEach(a=>{o[a.shipDefinition.type]+=a.count})}),{shipCount:n,shipCountByType:o,shipCountByRow:r,totalCost:t}}function Me(e){var n,o;const t={};return e.name.length===0&&(t.name=c("validation.requiredField")),(!Number.isFinite(e.maxReinforcement)||e.maxReinforcement<0)&&(t.maxReinforcement=c("validation.invalidValue")),(!Number.isFinite(e.maxCost)||e.maxCost<300||e.maxCost>450)&&(t.maxCost=c("validation.invalidValue")),e.maxCost>400&&e.maxReinforcement>5&&(t.maxReinforcement=(n=t.maxReinforcement)!=null?n:c("fleetSetup.maxOneDockingEffect"),t.maxCost=(o=t.maxCost)!=null?o:c("fleetSetup.maxOneDockingEffect")),t}function xe(e){const t={},n={},o={};return e.ships.forEach(r=>{const i=I(r.shipDefinition.id,r.reinforcement);if(n[i]){const a=n[i];n[i]={count:r.reinforcement===null?r.count:a.count,reinforcementCount:r.reinforcement!==null?r.count:a.reinforcementCount,operationLimit:r.shipDefinition.operationLimit}}else n[i]={count:r.reinforcement===null?r.count:0,reinforcementCount:r.reinforcement!==null?r.count:0,operationLimit:r.shipDefinition.operationLimit};r.carriedShips.forEach(a=>{const s=I(a.shipDefinition.id,r.reinforcement);o[s]?o[s].count+=a.count:o[s]={count:a.count,operationLimit:a.shipDefinition.operationLimit}})}),Object.keys(n).forEach(r=>{const i=n[r];i.count+i.reinforcementCount>i.operationLimit&&(t[r]=c("fleetSetup.exceedingTotalOperationLimit"))}),Object.keys(o).forEach(r=>{const i=o[r];i.count>i.operationLimit&&(t[r]=c("fleetSetup.exceedingTotalOperationLimit"))}),t}function I(e,t){const n=t!=null&&t.includes("ally")?t:"self";return`${e}#${n}`}export{l as G,he as S,Te as a,ye as b,Ce as c,Be as d,Ee as e,ge as f,Re as g,B as h,Me as i,P as j,De as k,I as l,U as m,_e as s,xe as v};
