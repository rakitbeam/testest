import{M as Ie,k as s,C as Pe,D as Ee,E as O,L,_ as S,b6 as Je,r as p,P as $e,H as he,aV as Me,I as qe,ai as Fe,bs as Qe,aj as ye,J as Ae,j as g,K as Z,O as Te,b8 as eo,b7 as oo,x as I,T,t as y,aw as to,v as oe,aA as no,g as Ve,aK as io,f as so,aH as ro,F as ee,c as $,B as ae,bd as G,br as ao,av as xe,m as co,a4 as we,bF as lo}from"./index.df85f92e.js";import{g as uo,S as ho,c as po,a as fo}from"./ShipTypeFilterButton.6fe60a9f.js";import{N as go,P as mo}from"./PageContent.cc85bb3f.js";import{P as vo}from"./PageFooter.6b831cd5.js";import{d as So}from"./Settings.147ad276.js";import{E as Co}from"./ExpandStack.3f614f55.js";import{v as bo}from"./visuallyHidden.c6275901.js";import{c as yo,b as To}from"./boolMapUtils.54d90c14.js";import{d as xo}from"./Save.51ec841b.js";import{d as wo,a as ko}from"./DeleteForever.4cfe072f.js";import{A as Ro}from"./ActionBar.81378f2c.js";import{C as Io}from"./ConfirmationDialog.b27cc3b1.js";import{S as Po}from"./SearchInput.356ab5d8.js";import"./domUtils.73a219ab.js";import"./MenuItem.78b6d8ce.js";import"./Popper.29b778a2.js";import"./ClickAwayListener.cc09d3a9.js";import"./useFormControl.e7ebc594.js";import"./ResponsiveDialog.342e0f66.js";import"./DialogContentText.a7ee75c6.js";import"./TextField.3caa3940.js";import"./Select.cb2b95a1.js";import"./InputAdornment.b7585ae8.js";var Eo=Ie(s("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),$o=Ie(s("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Mo(e){return Pe("MuiRating",e)}const Fo=Ee("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]);var W=Fo;const Ao=["value"],Vo=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function zo(e,o,t){return e<o?o:e>t?t:e}function Lo(e){const o=e.toString().split(".")[1];return o?o.length:0}function ce(e,o){if(e==null)return e;const t=Math.round(e/o)*o;return Number(t.toFixed(Lo(o)))}const Oo=e=>{const{classes:o,size:t,readOnly:n,disabled:i,emptyValueFocused:r,focusVisible:a}=e,c={root:["root",`size${L(t)}`,i&&"disabled",a&&"focusVisible",n&&"readyOnly"],label:["label","pristine"],labelEmptyValue:[r&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Ae(c,Mo,o)},No=O("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[{[`& .${W.visuallyHidden}`]:o.visuallyHidden},o.root,o[`size${L(t.size)}`],t.readOnly&&o.readOnly]}})(({theme:e,ownerState:o})=>S({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",WebkitTapHighlightColor:"transparent",[`&.${W.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${W.focusVisible} .${W.iconActive}`]:{outline:"1px solid #999"},[`& .${W.visuallyHidden}`]:bo},o.size==="small"&&{fontSize:e.typography.pxToRem(18)},o.size==="large"&&{fontSize:e.typography.pxToRem(30)},o.readOnly&&{pointerEvents:"none"})),ze=O("label",{name:"MuiRating",slot:"Label",overridesResolver:(e,o)=>o.label})(({ownerState:e})=>S({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Bo=O("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[o.icon,t.iconEmpty&&o.iconEmpty,t.iconFilled&&o.iconFilled,t.iconHover&&o.iconHover,t.iconFocus&&o.iconFocus,t.iconActive&&o.iconActive]}})(({theme:e,ownerState:o})=>S({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},o.iconActive&&{transform:"scale(1.2)"},o.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),Do=O("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>Je(e)&&e!=="iconActive",overridesResolver:(e,o)=>{const{iconActive:t}=e;return[o.decimal,t&&o.iconActive]}})(({iconActive:e})=>S({position:"relative"},e&&{transform:"scale(1.2)"}));function Ho(e){const o=he(e,Ao);return s("span",S({},o))}function ke(e){const{classes:o,disabled:t,emptyIcon:n,focus:i,getLabelText:r,highlightSelectedOnly:a,hover:c,icon:h,IconContainerComponent:d,isActive:u,itemValue:l,labelProps:C,name:x,onBlur:M,onChange:P,onClick:f,onFocus:w,readOnly:v,ownerState:k,ratingValue:V,ratingValueRounded:ne}=e,D=a?l===V:l<=V,J=l<=c,H=l<=i,ie=l===ne,X=Me(),N=s(Bo,{as:d,value:l,className:Z(o.icon,D?o.iconFilled:o.iconEmpty,J&&o.iconHover,H&&o.iconFocus,u&&o.iconActive),ownerState:S({},k,{iconEmpty:!D,iconFilled:D,iconHover:J,iconFocus:H,iconActive:u}),children:n&&!D?n:h});return v?s("span",S({},C,{children:N})):g(p.exports.Fragment,{children:[g(ze,S({ownerState:S({},k,{emptyValueFocused:void 0}),htmlFor:X},C,{children:[N,s("span",{className:o.visuallyHidden,children:r(l)})]})),s("input",{className:o.visuallyHidden,onFocus:w,onBlur:M,onChange:P,onClick:f,disabled:t,value:l,id:X,type:"radio",name:x,checked:ie})]})}const _o=s(Eo,{fontSize:"inherit"}),jo=s($o,{fontSize:"inherit"});function Uo(e){return`${e} Star${e!==1?"s":""}`}const Go=p.exports.forwardRef(function(o,t){const n=$e({name:"MuiRating",props:o}),{className:i,defaultValue:r=null,disabled:a=!1,emptyIcon:c=jo,emptyLabelText:h="Empty",getLabelText:d=Uo,highlightSelectedOnly:u=!1,icon:l=_o,IconContainerComponent:C=Ho,max:x=5,name:M,onChange:P,onChangeActive:f,onMouseLeave:w,onMouseMove:v,precision:k=1,readOnly:V=!1,size:ne="medium",value:D}=n,J=he(n,Vo),H=Me(M),[ie,X]=qe({controlled:D,default:r,name:"Rating"}),N=ce(ie,k),Ne=Fe(),[{hover:F,focus:q},Y]=p.exports.useState({hover:-1,focus:-1});let _=N;F!==-1&&(_=F),q!==-1&&(_=q);const{isFocusVisibleRef:ve,onBlur:Be,onFocus:De,ref:He}=Qe(),[_e,se]=p.exports.useState(!1),Se=p.exports.useRef(),je=ye(He,Se),Ue=ye(je,t),Ge=m=>{v&&v(m);const b=Se.current,{right:E,left:Q}=b.getBoundingClientRect(),{width:j}=b.firstChild.getBoundingClientRect();let U;Ne.direction==="rtl"?U=(E-m.clientX)/(j*x):U=(m.clientX-Q)/(j*x);let A=ce(x*U+k/2,k);A=zo(A,k,x),Y(B=>B.hover===A&&B.focus===A?B:{hover:A,focus:A}),se(!1),f&&F!==A&&f(m,A)},Xe=m=>{w&&w(m);const b=-1;Y({hover:b,focus:b}),f&&F!==b&&f(m,b)},Ce=m=>{let b=m.target.value===""?null:parseFloat(m.target.value);F!==-1&&(b=F),X(b),P&&P(m,b)},Ye=m=>{m.clientX===0&&m.clientY===0||(Y({hover:-1,focus:-1}),X(null),P&&parseFloat(m.target.value)===N&&P(m,null))},Ke=m=>{De(m),ve.current===!0&&se(!0);const b=parseFloat(m.target.value);Y(E=>({hover:E.hover,focus:b}))},We=m=>{if(F!==-1)return;Be(m),ve.current===!1&&se(!1);const b=-1;Y(E=>({hover:E.hover,focus:b}))},[Ze,be]=p.exports.useState(!1),K=S({},n,{defaultValue:r,disabled:a,emptyIcon:c,emptyLabelText:h,emptyValueFocused:Ze,focusVisible:_e,getLabelText:d,icon:l,IconContainerComponent:C,max:x,precision:k,readOnly:V,size:ne}),z=Oo(K);return g(No,S({ref:Ue,onMouseMove:Ge,onMouseLeave:Xe,className:Z(z.root,i),ownerState:K,role:V?"img":null,"aria-label":V?d(_):null},J,{children:[Array.from(new Array(x)).map((m,b)=>{const E=b+1,Q={classes:z,disabled:a,emptyIcon:c,focus:q,getLabelText:d,highlightSelectedOnly:u,hover:F,icon:l,IconContainerComponent:C,name:H,onBlur:We,onChange:Ce,onClick:Ye,onFocus:Ke,ratingValue:_,ratingValueRounded:N,readOnly:V,ownerState:K},j=E===Math.ceil(_)&&(F!==-1||q!==-1);if(k<1){const U=Array.from(new Array(1/k));return s(Do,{className:Z(z.decimal,j&&z.iconActive),ownerState:K,iconActive:j,children:U.map((A,B)=>{const re=ce(E-1+(B+1)*k,k);return s(ke,S({},Q,{isActive:!1,itemValue:re,labelProps:{style:U.length-1===B?{}:{width:re===_?`${(B+1)*k*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),re)})},E)}return s(ke,S({},Q,{isActive:j,itemValue:E}),E)}),!V&&!a&&g(ze,{className:Z(z.label,z.labelEmptyValue),ownerState:K,children:[s("input",{className:z.visuallyHidden,value:"",id:`${H}-empty`,type:"radio",name:H,checked:N==null,onFocus:()=>be(!0),onBlur:()=>be(!1),onChange:Ce}),s("span",{className:z.visuallyHidden,children:h})]})]}))});var Xo=Go;function Yo(e){return Pe("MuiSwitch",e)}const Ko=Ee("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var R=Ko;const Wo=["className","color","edge","size","sx"],Zo=e=>{const{classes:o,edge:t,size:n,color:i,checked:r,disabled:a}=e,c={root:["root",t&&`edge${L(t)}`,`size${L(n)}`],switchBase:["switchBase",`color${L(i)}`,r&&"checked",a&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=Ae(c,Yo,o);return S({},o,h)},Jo=O("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[o.root,t.edge&&o[`edge${L(t.edge)}`],o[`size${L(t.size)}`]]}})(({ownerState:e})=>S({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${R.thumb}`]:{width:16,height:16},[`& .${R.switchBase}`]:{padding:4,[`&.${R.checked}`]:{transform:"translateX(16px)"}}})),qo=O(uo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,o)=>{const{ownerState:t}=e;return[o.switchBase,{[`& .${R.input}`]:o.input},t.color!=="default"&&o[`color${L(t.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${R.checked}`]:{transform:"translateX(20px)"},[`&.${R.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${R.checked} + .${R.track}`]:{opacity:.5},[`&.${R.disabled} + .${R.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${R.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:o})=>S({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${R.checked}`]:{color:(e.vars||e).palette[o.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette[o.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${R.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${o.color}DisabledColor`]:`${e.palette.mode==="light"?eo(e.palette[o.color].main,.62):oo(e.palette[o.color].main,.55)}`}},[`&.${R.checked} + .${R.track}`]:{backgroundColor:(e.vars||e).palette[o.color].main}})),Qo=O("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,o)=>o.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),et=O("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,o)=>o.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),ot=p.exports.forwardRef(function(o,t){const n=$e({props:o,name:"MuiSwitch"}),{className:i,color:r="primary",edge:a=!1,size:c="medium",sx:h}=n,d=he(n,Wo),u=S({},n,{color:r,edge:a,size:c}),l=Zo(u),C=s(et,{className:l.thumb,ownerState:u});return g(Jo,{className:Z(l.root,i),sx:h,ownerState:u,children:[s(qo,S({type:"checkbox",icon:C,checkedIcon:C,ref:t,ownerState:u},d,{classes:S({},l,{root:l.switchBase})})),s(Qo,{className:l.track,ownerState:u})]})});var Le=ot;const le="1.5rem",Re="1rem",pe=e=>{const{techPoints:o,maxTechPoints:t,unlockCost:n,selected:i,incomplete:r,showZero:a}=e,c=i===!0&&n!==null&&n>0,h=(o!=null?o:0)+(c&&n!=null?n:0),d=(t!=null?t:0)+(c&&n!=null?n:0),u=i===!0||a||o!==null&&o>0,l=c||t!==null&&t>0;return g(I,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[s(T,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:y("techPointConfig.techPointShortColon")}),u&&s(T,{variant:"body1",textAlign:"right",sx:{fontSize:le},children:`${h}`}),g(I,{direction:"row",alignItems:"center",children:[s(T,{variant:"body1",textAlign:"right",sx:{fontSize:u?Re:le},color:u||!l?"text.secondary":"text.primary",children:`${u?"/ ":""}${l?`${d}`:"?"}`}),l&&r&&s(T,{variant:"body1",color:"text.secondary",sx:{fontSize:u?Re:le},children:"+"})]})]})},tt=e=>{const{shipId:o,selected:t,onToggle:n}=e,i=Fe(),r=to(i.breakpoints.up("sm"));return s(Xo,{name:"toggle-favorite",size:r?"medium":"small",value:t?1:0,onChange:()=>{n(o)},max:1})},nt=e=>{const{shipConfig:o,onClickName:t,onToggleFavorite:n}=e;return g(I,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},children:[s(oe,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g("div",{children:[g(I,{spacing:1,direction:"row",alignItems:"center",children:[s(T,{variant:"body1",children:s(no,{onClick:()=>{t(o.shipDefinition.id)},children:Ve(o.shipDefinition)})}),s(tt,{shipId:o.shipDefinition.id,selected:o.favorite,onToggle:n})]}),o.incomplete&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),s(pe,{techPoints:o.techPoints,maxTechPoints:o.maxTechPoints,unlockCost:0,incomplete:o.incomplete})]})},it=e=>{const{shipConfig:o,moduleConfig:t,enhancementConfig:n,onToggleEnhancement:i}=e,r=t.selectedEnhancementIds.includes(n.id);return g(I,{spacing:1,direction:"row",children:[s("div",{children:s(Le,{checked:r,onChange:()=>{i(o.shipDefinition.id,t.module.id,n.id)},disabled:!r&&!!t.module.skillSlots&&t.selectedEnhancementIds.length>=t.module.skillSlots})}),s(oe,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(I,{spacing:.5,sx:{flexGrow:1},children:[s(T,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((a,c)=>s(T,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:a},`property_${c}`)),n.enhancement.cost===null&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.maxCostUnknown")})]})})]})},st=e=>{var c;const{shipConfig:o,moduleConfig:t,onToggleModule:n,onToggleEnhancement:i}=e,{mode:r}=io(),a=o.selectedModuleIds.includes(t.module.id);return g(I,{p:2,spacing:1,sx:{backgroundColor:r==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[g(I,{spacing:1,direction:"row",children:[s("div",{children:s(Le,{checked:a,disabled:t.module.category==="STATIC",onChange:()=>{n(o.shipDefinition.id,t.module.id)}})}),s(oe,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(oe,{component:"div",sx:{flexGrow:1},children:[s(T,{variant:"body2",children:`${t.module.category!=="STATIC"?`${t.module.category}${t.module.categoryNumber}`:""} ${so(o.shipDefinition.id,t.module)}`}),t.incomplete&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),s(pe,{techPoints:a?t.techPoints:0,maxTechPoints:t.maxTechPoints,unlockCost:t.module.category!=="STATIC"&&!t.module.defaultModule?10:null,selected:a,incomplete:t.incomplete,showZero:!0})]}),a&&g(I,{spacing:3,pl:5,pt:1,pb:2,children:[g("div",{children:[s(T,{variant:"body1",color:"text.secondary",children:y("techPointConfig.enhancementSlotsColonValue",{value:`${t.selectedEnhancementIds.length} / ${(c=t.module.skillSlots)!=null?c:"?"}`})}),!t.module.skillSlots&&s(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]}),Object.values(t.enhancements).map(h=>s(it,{shipConfig:o,moduleConfig:t,enhancementConfig:h,onToggleEnhancement:i},h.id))]})]})},rt=e=>{const{shipConfig:o,onToggleModule:t,onToggleEnhancement:n}=e;return g(I,{spacing:1,justifyContent:"end",children:[Object.values(o.modules).map(i=>s(st,{shipConfig:o,moduleConfig:i,onToggleModule:t,onToggleEnhancement:n},i.module.id)),s(I,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:s(pe,{techPoints:o.techPoints,maxTechPoints:o.maxTechPoints,incomplete:o.incomplete,unlockCost:0})})]})},at=e=>{const{config:o,onToggleEnhancement:t,onToggleModule:n,onToggleFavorite:i}=e,{openShipDetailDialog:r}=ro(),a=p.exports.useMemo(()=>{const c=[],h=[];return Object.values(o.ships).forEach(d=>{(d.favorite?c:h).push(d)}),[...c,...h]},[o]);return s(Co,{expandables:a.map(c=>({id:c.shipDefinition.id,initiallyOpened:!1,expandIcon:s(So,{}),summary:s(nt,{shipConfig:c,onClickName:r,onToggleFavorite:i}),details:s(rt,{shipConfig:c,onToggleModule:n,onToggleEnhancement:t})}))})},ct=e=>{const{shipFilter:o,modified:t,stored:n,onFilterChange:i,onReset:r,onCancel:a,onSave:c}=e,[h,d]=p.exports.useState(!1),u=p.exports.useCallback(()=>{d(!1),r()},[r]);return g(ee,{children:[s(Ro,{left:l=>s(ee,{children:s(ho,{filter:o,onChange:i,buttonProps:l,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[$.AUXILIARY,$.CARRIER,$.BATTLE_CRUISER,$.CRUISER,$.CORVETTE,$.FIGHTER]},"filter")}),right:l=>g(ee,{children:[s(ae,{variant:"outlined",startIcon:s(wo,{}),onClick:()=>{d(!0)},disabled:!n,...l,children:y("button.reset")},"reset"),s(ae,{variant:"outlined",startIcon:s(ko,{}),onClick:a,disabled:!t,...l,children:y("button.cancel")},"cancel"),s(ae,{variant:"contained",startIcon:s(xo,{}),onClick:c,disabled:!t,...l,children:y("button.save")},"save")]})}),h&&s(Io,{title:y("button.reset"),question:y("techPointConfig.confirmReset"),cancelText:y("button.cancel"),confirmText:y("button.reset"),onCancel:()=>{d(!1)},onConfirm:u})]})};function ue(e){return{ships:e.reduce((t,n)=>({...t,[n.id]:lt(n)}),{})}}function lt(e){var a,c,h,d;const o=(c=(a=e.modules)==null?void 0:a.filter(u=>u.skillSlots!==0).reduce((u,l)=>({...u,[l.id]:dt(l)}),{}))!=null?c:{},t=(d=(h=e.modules)==null?void 0:h.filter(u=>u.skillSlots!==0&&u.category==="STATIC"||u.defaultModule===!0).map(u=>u.id))!=null?d:[],n=fe(o,t),i=ge(o,t),r=me(o,t);return{shipDefinition:e,modules:o,selectedModuleIds:t,techPoints:null,maxTechPoints:n,unlockCost:i,incomplete:r,favorite:!1}}function dt(e){var i,r;const o=[...(i=e.flagshipEffects)!=null?i:[],...(r=e.skills)!=null?r:[]].filter(a=>!a.isDefault).reduce((a,c,h)=>{const d=`${c.type}_${h}`;return{...a,[d]:ut(c,d)}},{}),t=ht(e),n=e.category!=="STATIC"&&!e.defaultModule?10:0;return{module:e,enhancements:o,selectedEnhancementIds:[],techPoints:null,maxTechPoints:t,unlockCost:n,incomplete:pt(e)}}function ut(e,o){return{id:o,enhancement:e,techPoints:e.isDefault?null:e.cost}}function fe(e,o){return Object.keys(e).map(t=>e[t]).filter(t=>t.module.category==="STATIC"||o.includes(t.module.id)).map(t=>t.maxTechPoints).reduce((t,n)=>(t!=null?t:0)+(n!=null?n:0),null)}function ge(e,o){return Object.keys(e).map(t=>o.includes(t)?e[t].unlockCost:0).reduce((t,n)=>t+n,0)}function ht(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(o=>o.cost).sort((o,t)=>(t!=null?t:0)-(o!=null?o:0)).slice(0,e.skillSlots).reduce((o,t)=>(o!=null?o:0)+(t!=null?t:0),0)}function me(e,o){const t=Object.keys(e);return t.length===0?!0:t.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||o.includes(n.module.id)).some(n=>n.incomplete)}function pt(e){var o,t;return e.skillSlots?!e.skillSlots||e.skillComplete!==!0||[...(o=e.flagshipEffects)!=null?o:[],...(t=e.skills)!=null?t:[]].some(n=>!n.isDefault&&n.cost===null):!0}function ft(e,o){if(e.selectedModuleIds.includes(o))return e.selectedModuleIds.filter(n=>n!==o);const{category:t}=e.modules[o].module;return t==="STATIC"?[...e.selectedModuleIds,o]:[...e.selectedModuleIds.filter(n=>t!==e.modules[n].module.category),o]}function gt(e,o,t){var a;const n=(a=e.ships[o])!=null?a:null;if(!n)throw new Error(`Missing config for "${o}"`);if(!n.modules[t])throw new Error(`Invalid module for "${o}", "${t}"`);const r={...n,selectedModuleIds:ft(n,t)};return{...e,ships:{...e.ships,[o]:{...r,techPoints:Oe(r),maxTechPoints:fe(r.modules,r.selectedModuleIds),unlockCost:ge(r.modules,r.selectedModuleIds),incomplete:me(r.modules,r.selectedModuleIds)}}}}function mt(e,o,t,n){var h,d;const i=(d=(h=e.ships[o])==null?void 0:h.modules[t])!=null?d:null;if(!i)throw new Error(`Missing config for "${o}", "${t}"`);const r=St(i.selectedEnhancementIds,n);if(!!i.module.skillSlots&&r.length>i.module.skillSlots)return e;const a={...i,selectedEnhancementIds:r},c={...e.ships[o],modules:{...e.ships[o].modules,[t]:{...a,techPoints:Ct(a)}}};return{...e,ships:{...e.ships,[o]:{...c,techPoints:Oe(c)}}}}function vt(e,o){return{...e,ships:{...e.ships,[o]:{...e.ships[o],favorite:!e.ships[o].favorite}}}}function St(e,o){return e.includes(o)?e.filter(t=>t!==o):[...e,o]}function Oe(e){return Object.values(e.modules).filter(o=>e.selectedModuleIds.includes(o.module.id)).map(o=>o.techPoints).reduce((o,t)=>(o!=null?o:0)+(t!=null?t:0),null)}function Ct(e){return Object.values(e.enhancements).filter(o=>e.selectedEnhancementIds.includes(o.id)).map(o=>o.techPoints).reduce((o,t)=>(o!=null?o:0)+(t!=null?t:0),null)}const te="tp";function bt(){return!!window.localStorage.getItem(te)}function yt(){window.localStorage.removeItem(te)}function Tt(e){const o=xt(e);window.localStorage.setItem(te,JSON.stringify(o))}function de(e){const o=ue(e),t=window.localStorage.getItem(te);if(!t)return o;let n;try{n=JSON.parse(t)}catch(i){return console.warn("Invalid tech point config",i),o}return wt(o,n)}function xt(e){const o={version:1,ships:[]};return Object.keys(e.ships).forEach(t=>{const n=e.ships[t],i=[t,[]];Object.keys(n.modules).forEach(r=>{const a=n.modules[r],c=n.selectedModuleIds.includes(r)?1:0,h=n.favorite?1:0,d=[r,a.selectedEnhancementIds,c,h];i[1].push(d)}),o.ships.push(i)}),o}function wt(e,o){return o.ships.forEach(([t,n])=>{const i=e.ships[t];if(!i){console.warn(`Invalid shipId "${t}"`);return}n.forEach(([r,a,c,h])=>{const d=i.modules[r];if(!d){console.warn(`Invalid moduleId "${r}"`);return}if(d.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${r}" (duplicate)`);return}if(a.forEach(u=>{var C,x,M,P;const l=d.enhancements[u];if(!l){console.warn(`Invalid enhancement "${u}"`);return}d.selectedEnhancementIds.push(u),d.techPoints=((C=d.techPoints)!=null?C:0)+((x=l.enhancement.cost)!=null?x:0),i.techPoints=((M=i.techPoints)!=null?M:0)+((P=l.enhancement.cost)!=null?P:0)}),c===1&&!i.selectedModuleIds.includes(r)){const u=Object.keys(i.modules).filter(l=>{const{category:C}=i.modules[l].module;return C!=="STATIC"&&C===d.module.category});i.selectedModuleIds=[...i.selectedModuleIds.filter(l=>!u.includes(l)),r]}i.favorite=h===1}),i.maxTechPoints=fe(i.modules,i.selectedModuleIds),i.unlockCost=ge(i.modules,i.selectedModuleIds),i.incomplete=me(i.modules,i.selectedModuleIds)}),e}const kt=e=>{const{supportedShips:o,visibleShips:t}=e,[n,i]=p.exports.useState(()=>ue([])),[r,a]=p.exports.useState(!1),[c,h]=p.exports.useState(bt());p.exports.useEffect(()=>{const f=de(o);i(f)},[o]);const d=p.exports.useCallback((f,w)=>{a(!0),i(v=>gt(v,f,w))},[]),u=p.exports.useCallback((f,w,v)=>{a(!0),i(k=>mt(k,f,w,v))},[]),l=p.exports.useCallback(f=>{a(!0),i(w=>vt(w,f))},[]),C=p.exports.useCallback(()=>{yt();const f=ue(o);i(f),a(!1),h(!1)},[o]),x=p.exports.useCallback(()=>{const f=de(o);i(f),a(!1)},[n,o]),M=p.exports.useCallback(()=>{Tt(n);const f=de(o);i(f),a(!1),h(!0)},[n,o]);return{config:p.exports.useMemo(()=>({ships:t.reduce((f,w)=>{const v=n.ships[w.id];return v?{...f,[w.id]:v}:f},{})}),[n,t]),modified:r,stored:c,handleToggleModule:d,handleToggleEnhancement:u,handleToggleFavorite:l,handleReset:C,handleCancel:x,handleSave:M}},Rt=[$.AUXILIARY,$.CARRIER,$.BATTLE_CRUISER,$.CRUISER,$.CORVETTE],It=[G.MISTRAL,G.SANDRAKE,G.STINGRAY,G.STRIX_A100,G.VITAS_A021,G.VITAS_B010],Jt=()=>{const[e,o]=ao(),[t,n]=p.exports.useState(()=>yo(e.getAll("filter"),po()));p.exports.useEffect(()=>{o(xe.techPointConfig.createSearchParams({filter:To(t)}))},[t]);const i=p.exports.useMemo(()=>co.filter(v=>v.source===we.TECH_FILE||v.source===we.STARTER_SHIP).filter(v=>Rt.includes(v.type)||It.includes(v.id)),[]),[r,a]=p.exports.useState(""),c=p.exports.useMemo(()=>{const v=fo(i,t);return lo(v)},[i,t]),h=p.exports.useMemo(()=>r?c.filter(v=>Ve(v).toLowerCase().includes(r)):c,[c,r]),{config:d,modified:u,stored:l,handleToggleModule:C,handleToggleEnhancement:x,handleToggleFavorite:M,handleReset:P,handleCancel:f,handleSave:w}=kt({supportedShips:i,visibleShips:h});return g(ee,{children:[s(go,{currentRoute:xe.techPointConfig.path}),s(ct,{shipFilter:t,modified:u,stored:l,onFilterChange:n,onReset:P,onCancel:f,onSave:w}),s(mo,{children:g(I,{spacing:2,p:1,children:[g(I,{pt:1,pb:1,spacing:2,children:[s(T,{variant:"body2",children:y("techPointConfig.pageDescription1")}),s(T,{variant:"body2",children:y("techPointConfig.pageDescription2")}),s(T,{variant:"body2",children:y("techPointConfig.pageDescription3")})]}),s(Po,{id:"searchShip",lowerCase:!0,value:r,placeholder:y("label.shipName"),onChange:a}),s(at,{config:d,onToggleModule:C,onToggleEnhancement:x,onToggleFavorite:M})]})}),s(vo,{})]})};export{Jt as TechPointConfigPage,Jt as default};
