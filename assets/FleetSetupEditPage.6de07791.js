var He=Object.defineProperty,Ge=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ie=(n,e,u)=>e in n?He(n,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[e]=u,v=(n,e)=>{for(var u in e||(e={}))ze.call(e,u)&&ie(n,u,e[u]);if(ne)for(var u of ne(e))Pe.call(e,u)&&ie(n,u,e[u]);return n},x=(n,e)=>Ge(n,We(e));import{j as t,A as $,c as B,s as j,b as p,T as C,E as b,v as H,w as G,x as W,F as k,h as R,t as re,r as h,Q as Ve,S as y,u as z,a as P,W as ae,af as Ne,ay as Ue,az as oe,aA as se,am as qe,ax as le,aB as w,aw as Ye}from"./vendor.612e55a5.js";import{N as Ke,C as Qe}from"./NavigationBar.e91af742.js";import{O as Xe,e as ce,K as de,c as D,S as U,C as Ze,r as Je,V as I,u as et,X as tt,L as ut}from"./index.50b861ee.js";import{d as nt,a as it,b as rt,C as at}from"./ConfirmationDialog.2bb0bdf0.js";import{A as ot}from"./ActionBar.a2802d77.js";import{B as st,S as lt,g as ct,c as pe,d as dt,e as pt,s as ht,h as Ft,i as ft,v as q,j as he,k as mt,l as Fe,m as Ct,a as gt,G as fe,b as yt}from"./fleetSetupValidation.7852ac33.js";import{R as Y}from"./ResponsiveDialog.418e97d8.js";import{c as me,S as Ce}from"./ShipTypeFilterButton.3256c46d.js";import"./domUtils.e9df6b0f.js";import"./sorting.c6946657.js";const vt=n=>{const{fleetSetup:e,onChange:u,errors:i,columnCount:r}=n,o=c=>{u(x(v({},e),{name:c.target.value.trim()}))},s=c=>{u(x(v({},e),{maxCost:Number(c.target.value)}))},l=c=>{u(x(v({},e),{maxReinforcement:Number(c.target.value)}))},F=c=>{u(x(v({},e),{myListOnly:c.target.value==="myListOnly"}))};return t($,{children:t(B,{p:1,children:t(Xe,{sx:{alignItems:"center"},offsetValue:!1,rowGap:1,columnCount:r,rows:[{key:"name",label:"\u8266\u968A\u540D",value:c=>t(j,{variant:"outlined",size:"small",value:e.name,onChange:o,error:!!i.name,helperText:i.name,fullWidth:c})},{key:"reinforcementCount",label:"\u6700\u5927\u5897\u63F4\u6570",value:c=>p(j,{variant:"outlined",size:"small",select:!0,value:e.maxReinforcement,onChange:l,error:!!i.maxReinforcement,helperText:i.maxReinforcement,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.maxReinforcement})},children:[t(b,{value:"5",children:"\uFF15\u96BB\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(b,{value:"6",children:"\uFF16\u96BB\uFF08\u5C0F\u578B\u88DC\u7D66\u57FA\u5730\u306B\u7D50\u5408\uFF09"}),t(b,{value:"9",children:"\uFF19\u96BB\uFF08\u4E2D\u7D99\u88DC\u7D66\u65BD\u8A2D\u306B\u7D50\u5408\uFF09"})]})},{key:"maxCost",label:"\u6700\u5927\u53F8\u4EE4Pt",value:c=>p(j,{variant:"outlined",size:"small",select:!0,value:e.maxCost,onChange:s,error:!!i.maxCost,helperText:i.maxCost,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.maxCost})},children:[t(b,{value:"450",children:"\uFF14\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(b,{value:"430",children:"\uFF14\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(b,{value:"415",children:"\uFF14\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(b,{value:"400",children:"\uFF14\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(b,{value:"350",children:"\uFF13\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(b,{value:"330",children:"\uFF13\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(b,{value:"315",children:"\uFF13\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(b,{value:"300",children:"\uFF13\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"})]})},{key:"myListOnly",label:"\u8FFD\u52A0\u3067\u304D\u308B\u8266\u8239",value:c=>p(j,{variant:"outlined",size:"small",select:!0,value:e.myListOnly?"myListOnly":"all",onChange:F,error:!!i.myListOnly,helperText:i.myListOnly,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.myListOnly?"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239":"\u5168\u3066\u306E\u8266\u8239"})},children:[t(b,{value:"all",children:"\u5168\u3066\u306E\u8266\u8239"}),t(b,{value:"myListOnly",children:"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239"})]})}]})})})};var K={},xt=G.exports;Object.defineProperty(K,"__esModule",{value:!0});var Q=K.default=void 0,Dt=xt(H),St=W,At=(0,Dt.default)((0,St.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");Q=K.default=At;const ge=n=>{const{onOpenAddShips:e,filter:u,buttonProps:i}=n;return t(st,{icon:t(Q,{}),text:"\u8266\u8239\u3092\u8FFD\u52A0",onClick:o=>{switch(o){case"addInitialShip":{e(null,u);break}case"addSelfReinforcement":{e("self",u);break}case"addAllyReinforcement":{e("ally",u);break}case"addAlly2Reinforcement":{e("ally2",u);break}case"addAlly3Reinforcement":{e("ally3",u);break}}},buttonProps:i,options:[{key:"addInitialShip",text:"\u901A\u5E38\u914D\u5099",value:"addInitialShip"},{key:"addSelfReinforcement",text:"\u5897\u63F4",value:"addSelfReinforcement"},{key:"addAllyReinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21",value:"addAllyReinforcement"},{key:"addAlly2Reinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22",value:"addAlly2Reinforcement"},{key:"addAlly3Reinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23",value:"addAlly3Reinforcement"}]})},Et=n=>{const{grouping:e,onChangeGrouping:u,onCancel:i,onSave:r,onReset:o,onOpenAddShips:s,saveDisabled:l}=n;return t(ot,{left:F=>p(k,{children:[t(lt,{value:e,onChange:u,buttonProps:F}),t(ge,{onOpenAddShips:s,buttonProps:F})]}),right:F=>p(k,{children:[t(R,x(v({variant:"outlined",startIcon:t(nt,{}),onClick:o},F),{children:"\u521D\u671F\u5316"}),"reset"),t(R,x(v({variant:"outlined",startIcon:t(it,{}),onClick:i},F),{children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),"cancel"),t(R,x(v({variant:"contained",startIcon:t(rt,{}),onClick:r,disabled:l},F),{children:"\u4FDD\u5B58"}),"save")]})})},Bt=n=>{var A;const{initialFleetKey:e}=n,u=re(),i=h.exports.useMemo(()=>ct(),[]),[r,o]=h.exports.useState(e&&(A=i.find(a=>a.key===e))!=null?A:i[0]),s=h.exports.useCallback((a,f,S)=>{o(E=>pe({shipId:a,count:f,reinforcement:S,fleetSetup:E}))},[]),l=h.exports.useCallback((a,f,S,E)=>{o(T=>dt({shipId:a,carrierShipId:f,count:S,reinforcement:E,fleetSetup:T}))},[]),F=h.exports.useCallback((a,f,S)=>{o(E=>pt({shipId:a,reinforcement:f,moduleSelection:S,fleetSetup:E}))},[]),c=h.exports.useCallback(()=>{ht(r),u("/fleetSetup")},[r]),m=h.exports.useCallback(()=>{const a=Number(r.key.substring("fleet".length));o(Ft(a))},[r]),g=h.exports.useMemo(()=>ft(r),[r]),d=h.exports.useMemo(()=>q(r),[r]);return{fleetSetup:r,errors:g,shipWarnings:d,setFleetSetup:o,setShipCount:s,setCarriedShipCount:l,setModule:F,save:c,reset:m}},bt=n=>{const{fleetSetup:e,fleetShipCount:u}=n,i=u.totalCost>e.maxCost,r=e.totalReinforcementCount>e.maxReinforcement;return t(B,{sx:{height:"100px"},children:t($,{square:!0,sx:{position:"fixed",right:0,bottom:0,zIndex:1,width:"100%",borderTop:"1px solid rgba(0, 0, 0, 0.2)"},children:t(Ve,{maxWidth:"md",disableGutters:!0,children:t(B,{p:1,children:p(y,{spacing:1,flexWrap:"wrap",direction:"row",children:[t(B,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:p("div",{children:[t(C,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),t(C,{variant:"body1",sx:{color:r?"red":void 0},children:t("strong",{children:`${e.totalReinforcementCount} / ${e.maxReinforcement}`})})]})}),t(B,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:p("div",{children:[t(C,{variant:"body2",color:"text.secondary",children:"\u53F8\u4EE4pt"}),t(C,{variant:"body1",sx:{color:i?"red":void 0},children:t("strong",{children:`${u.totalCost} / ${e.maxCost}`})})]})})]})})})})})};function Rt(n,e,u,i){const r={};e.ships.forEach(s=>{r[`${s.shipDefinition.id}_${s.reinforcement}`]=!0});const o=Tt(ce,n,e.myListOnly,u);return{fleetSetup:x(v({},e),{ships:[...e.ships,...o.flatMap(s=>r[`${s.id}_${n}`]?[]:[he({shipDefinition:s,usedModules:null,count:0,reinforcement:n,maxReinforcement:e.maxReinforcement,temporary:!0})])]}),reinforcement:n,filter:i}}function Tt(n,e,u,i){const r=n.filter(o=>o.type!==D.CORVETTE&&o.type!==D.FIGHTER);return(e==null?void 0:e.includes("ally"))||!u?r:r.filter(o=>de(o.id,i))}function wt(n){return x(v({},n.fleetSetup),{ships:n.fleetSetup.ships.flatMap(e=>e.temporary?e.count===0?[]:[x(v({},e),{temporary:!1})]:[e])})}function kt(n,e){let u=x(v({},e),{fleetSetup:x(v({},e.fleetSetup),{ships:e.fleetSetup.ships.filter(i=>i.temporary===!0)})});return Object.keys(n).filter(i=>n[i]).forEach(i=>{switch(i){case U.FRONT:case U.MIDDLE:case U.BACK:{u=x(v({},u),{fleetSetup:x(v({},u.fleetSetup),{ships:u.fleetSetup.ships.filter(r=>r.shipDefinition.row===i)})});break}case D.CARRIER:case D.BATTLE_CRUISER:case D.CRUISER:case D.DESTROYER:case D.FRIGATE:{u=x(v({},u),{fleetSetup:x(v({},u.fleetSetup),{ships:u.fleetSetup.ships.filter(r=>r.shipDefinition.type===i)})});break}}}),u}const Mt=n=>{const{userSettings:e,fleetSetup:u,setFleetSetup:i}=n,[r,o]=h.exports.useState(null),s=h.exports.useCallback((g,d)=>{o(Rt(g,u,e,d!=null?d:null))},[u,e]),l=h.exports.useCallback(()=>{o(null)},[]),F=h.exports.useCallback(()=>{r&&(i(wt(r)),o(null))},[r,i]),c=h.exports.useCallback((g,d,A)=>{o(a=>a?x(v({},a),{fleetSetup:pe({shipId:g,count:d,reinforcement:A,fleetSetup:a.fleetSetup,keepZero:!0})}):null)},[e]),m=h.exports.useMemo(()=>r?q(r.fleetSetup):{},[r]);return{dialogData:r,shipWarnings:m,open:s,cancel:l,apply:F,setShipCount:c}};var X={},Ot=G.exports;Object.defineProperty(X,"__esModule",{value:!0});var ye=X.default=void 0,$t=Ot(H),_t=W,It=(0,$t.default)((0,_t.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");ye=X.default=It;var Z={},Lt=G.exports;Object.defineProperty(Z,"__esModule",{value:!0});var ve=Z.default=void 0,jt=Lt(H),Ht=W,Gt=(0,jt.default)((0,Ht.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");ve=Z.default=Gt;const Wt=n=>{const{shipDefinition:e,count:u,maxCount:i,reinforcement:r,showCost:o,showReinforcement:s,carrierShipId:l,shipWarning:F,onChangeShipCount:c,onChangeCarriedShipCount:m}=n,g=z(),d=P(g.breakpoints.down("sm")),{openShipDetailDialog:A}=Ze(),a=p(k,{children:[t(C,{variant:"body1",children:t(Je,{onClick:()=>{A(e.id)},children:e.name})}),o&&r===null&&t(C,{variant:"body2",color:"text.secondary",children:`\u6307\u4EE4\uFF30\uFF54\uFF1A${e.cost}\u3000\u5408\u8A08\uFF1A${e.cost*u}`}),s&&r==="self"&&t(C,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),s&&r==="ally"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21"}),s&&r==="ally2"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22"}),s&&r==="ally3"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23"})]}),f=F&&t(C,{variant:"caption",color:"red",textAlign:"end",children:F}),S=t(R,{onClick:()=>{l?m==null||m(e.id,l,0,r):c==null||c(e.id,0,r)},disabled:u<=0,children:"\u5916\u3059"}),E=t(ae,{onClick:()=>{l?m==null||m(e.id,l,u-1,r):c==null||c(e.id,u-1,r)},disabled:u<=0,children:t(ye,{color:u<=0?"disabled":"primary"})}),T=t(C,{variant:"body1",sx:{minWidth:"55px"},textAlign:"center",children:t("strong",{children:`${u} / ${i}`})}),M=t(ae,{onClick:()=>{l?m==null||m(e.id,l,u+1,r):c==null||c(e.id,u+1,r)},disabled:u>=i,children:t(ve,{color:u>=i?"disabled":"primary"})}),_=t(R,{onClick:()=>{l?m==null||m(e.id,l,i,r):c==null||c(e.id,i,r)},disabled:u>=i,children:"\u6700\u5927"});return p(k,{children:[d&&p(y,{spacing:1,children:[a,p($,{variant:"outlined",sx:{display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[p(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[E,T,M]}),p(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[S,_]})]}),f]}),!d&&p(y,{spacing:1,children:[p(y,{spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[t(B,{pb:1,children:t(y,{spacing:1,children:a})}),t(B,{sx:{display:"flex",justifyContent:"end",flexGrow:1},children:t($,{variant:"outlined",sx:{display:"inline-block"},children:p(y,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[S,E,T,M,_]})})})]}),f]})]})};function zt(n){const e={corvette:{key:"corvette",name:"\u8B77\u9001\u8266",count:n.carriedShips.filter(u=>u.shipDefinition.type===D.CORVETTE).map(u=>u.count).reduce((u,i)=>u+i,0),maxCount:n.carrierCapabilities.carryCorvette*n.count},upToLargeFighter:{key:"upToLargeFighter",name:"\u5C0F\uFF5E\u5927\u578B\u6226\u95D8\u6A5F",count:n.carriedShips.filter(u=>u.shipDefinition.type===D.FIGHTER&&u.shipDefinition.subType===I.LARGE_FIGHTER).map(u=>u.count).reduce((u,i)=>u+i,0),maxCount:n.carrierCapabilities.carryUpToLargeFighter*n.count},upToMediumFighter:{key:"upToMediumFighter",name:"\u5C0F\uFF5E\u4E2D\u91CF\u7D1A\u6226\u95D8\u6A5F",count:n.carriedShips.filter(u=>u.shipDefinition.type===D.FIGHTER&&u.shipDefinition.subType===I.MEDIUM_FIGHTER).map(u=>u.count).reduce((u,i)=>u+i,0),maxCount:n.carrierCapabilities.carryUpToMediumFighter*n.count},upToSmallFighter:{key:"upToSmallFighter",name:"\u5C0F\u578B\u6226\u95D8\u6A5F",count:n.carriedShips.filter(u=>u.shipDefinition.type===D.FIGHTER&&u.shipDefinition.subType===I.SMALL_FIGHTER).map(u=>u.count).reduce((u,i)=>u+i,0),maxCount:n.carrierCapabilities.carryUpToSmallFighter*n.count},removedHangar:{key:"removedHangar",name:"\u672A\u5BFE\u5FDC",count:0,maxCount:0}};return xe(e.upToMediumFighter,[e.upToLargeFighter]),xe(e.upToSmallFighter,[e.upToMediumFighter,e.upToLargeFighter]),J(e.upToSmallFighter,e.upToMediumFighter),J(e.upToMediumFighter,e.upToLargeFighter),e.upToLargeFighter.maxCount===0&&J(e.upToLargeFighter,e.removedHangar),e}function xe(n,e){let u=n.count-n.maxCount;u<=0||(n.count-=u,e.forEach(i=>{if(u<=0||i.maxCount===0)return;const r=i.maxCount-i.count;if(r<=0)return;const o=Math.min(r,u);u-=o,i.count+=o}),u>0&&(n.count+=u))}function J(n,e){const u=n.count-n.maxCount;u>0&&(n.count-=u,e.count+=u)}function Pt(n){return n.count>0||n.maxCount>0}const Vt=n=>{const{shipSelection:e,onOpenAddCarriedShips:u}=n,i=z(),r=P(i.breakpoints.down("xs")),o=h.exports.useMemo(()=>zt(e),[e]);return p(y,{spacing:1,direction:r?"column":"row",alignItems:r?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[p(y,{sx:{flexGrow:1},spacing:3,direction:"row",alignItems:"center",justifyContent:"space-between",children:[t(C,{variant:"body2",color:"text.secondary",children:"\u30CF\u30F3\u30AC\u30FC\uFF1A"}),t(y,{spacing:1,direction:"row",alignItems:"center",children:t(y,{spacing:1,direction:"row",alignItems:"center",children:Object.keys(o).filter(s=>Pt(o[s])).map(s=>o[s]).map(s=>p(h.exports.Fragment,{children:[t(C,{variant:"body2",color:"text.secondary",children:s.name}),t(C,{variant:"body2",color:"text.secondary",sx:{color:s.count>s.maxCount?"red":void 0},children:t("strong",{children:`${s.count} / ${s.maxCount}`})})]},s.key))})})]}),t(R,{variant:"outlined",size:"small",startIcon:t(Q,{}),sx:{whiteSpace:"nowrap"},onClick:()=>{u==null||u(e.shipDefinition.id,e.reinforcement)},children:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0"})]})};var ee={},Nt=G.exports;Object.defineProperty(ee,"__esModule",{value:!0});var De=ee.default=void 0,Ut=Nt(H),qt=W,Yt=(0,Ut.default)((0,qt.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");De=ee.default=Yt;const Kt=n=>{const{shipId:e,reinforcement:u,moduleSelection:i,myListOnly:r,onChange:o,onClose:s}=n,{userSettings:l}=et(),[F,c]=h.exports.useState(i),m=()=>{o(e,u,F),s()},g=a=>{const[f,S]=a.target.value.split("#");c(E=>mt(f,S,E))},d=a=>{const f=Object.keys(F.groups[a]).find(S=>F.groups[a][S].usage==="used");return f?`${a}#${f}`:null},A=a=>!Object.keys(F.groups[a]).find(f=>F.groups[a][f].module.defaultModule);return t(Y,{title:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5",content:p(y,{spacing:3,children:[Object.keys(F.groups).map(a=>{const f=d(a),S=`${a}#none`;return t($,{variant:"outlined",children:t(B,{pl:1,pr:1,children:t(Ne,{children:p(Ue,{defaultValue:"female",name:`group-${a}`,value:f!=null?f:S,onChange:g,children:[A(a)&&t(oe,{label:"\u7121\u3057",value:S,control:t(se,{})},S),Object.keys(F.groups[a]).map(E=>{const T=F.groups[a][E],M=u!=="ally"&&u!=="ally2"&&u!=="ally3"&&r&&!T.module.defaultModule&&!tt(E,e,l),_=`${a}#${E}`;return t(oe,{label:`${T.module.category}${T.module.categoryNumber} ${T.module.name}`,value:_,control:t(se,{disabled:M}),disabled:M},E)})]})})})},a)}),r&&t(C,{variant:"caption",paragraph:!0,children:"\u203B\u6240\u6301\u3057\u3066\u3044\u308B\u8FFD\u52A0\u30B7\u30B9\u30C6\u30E0\u306F\u300C\u30DE\u30A4\u30EA\u30B9\u30C8\u300D\u3067\u8A2D\u5B9A\u3067\u304D\u307E\u3059\u3002\u300C\u8FFD\u52A0\u3067\u304D\u308B\u8266\u8239\u300D\u3092\u300C\u5168\u3066\u306E\u8266\u8239\u300D\u306B\u8A2D\u5B9A\u3057\u3066\u3044\u308B\u5834\u5408\u3068\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\u3067\u306F\u5168\u3066\u306E\u8FFD\u52A0\u30B7\u30B9\u30C6\u30E0\u304C\u9078\u3079\u307E\u3059\u3002"})]}),actions:p(k,{children:[t(R,{variant:"outlined",onClick:s,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(R,{variant:"contained",onClick:m,children:"\uFF2F\uFF2B"})]}),onClose:s})},Qt=n=>{const{shipId:e,reinforcement:u,moduleSelection:i,myListOnly:r,onChange:o}=n,s=z(),l=P(s.breakpoints.down("xs")),[F,c]=h.exports.useState(!1),m=()=>{c(!0)},g=()=>{c(!1)},d=[];return Object.keys(i.groups).map(A=>{Object.keys(i.groups[A]).map(a=>i.groups[A][a]).forEach(a=>{a.usage==="used"&&(d.length>0&&d.push(t(h.exports.Fragment,{children:t(C,{variant:"body2",component:"span",children:"\u3001"})},`before_${a.module.id}`)),d.push(t(h.exports.Fragment,{children:t(qe,{arrow:!0,disableFocusListener:!0,title:a.module.name,children:t(C,{variant:"body2",component:"span",children:`${a.module.category}${a.module.categoryNumber}`})})},a.module.id)))})}),p(k,{children:[p(y,{spacing:1,direction:l?"column":"row",alignItems:l?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[t(B,{sx:{flexGrow:1},children:p(C,{variant:"body2",color:"text.secondary",children:["\u30B7\u30B9\u30C6\u30E0\uFF1A",d]})}),!i.static&&t(B,{sx:{display:"flex",alignContent:"end"},children:t(R,{variant:"outlined",size:"small",startIcon:t(De,{}),sx:{whiteSpace:"nowrap"},onClick:m,children:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5"})})]}),F&&t(Kt,{shipId:e,reinforcement:u,moduleSelection:i,myListOnly:r,onChange:o,onClose:g})]})},Se=h.exports.memo(Wt),te=n=>{const{shipSelections:e,showCost:u,showReinforcement:i,showHangar:r,shipWarnings:o,carrierShipId:s,myListOnly:l,onChangeShipCount:F,onChangeCarriedShipCount:c,onOpenAddCarriedShips:m,onChangeModule:g}=n;return t(y,{spacing:1,children:e==null?void 0:e.map(d=>{var A,a;return t($,{variant:"outlined",children:t(B,{p:1,children:p(y,{spacing:1,children:[t(Se,{shipDefinition:d.shipDefinition,count:d.count,maxCount:d.maxCount,reinforcement:d.reinforcement,showCost:u,showReinforcement:i,carrierShipId:s,onChangeShipCount:F,onChangeCarriedShipCount:c,shipWarning:o[Fe(d.shipDefinition.id,d.reinforcement)]}),d.moduleSelection&&g&&t(Qt,{shipId:d.shipDefinition.id,reinforcement:d.reinforcement,moduleSelection:d.moduleSelection,myListOnly:l,onChange:g}),r&&d.carrierCapabilities.canCarry&&p(y,{spacing:1,children:[t(Vt,{shipSelection:d,onOpenAddCarriedShips:m}),(A=d.carriedShips)==null?void 0:A.map(f=>{var S;return t(Se,{shipDefinition:f.shipDefinition,count:f.count,maxCount:f.shipDefinition.operationLimit,reinforcement:f.reinforcement,carrierShipId:d.shipDefinition.id,showCost:!1,showReinforcement:!1,onChangeCarriedShipCount:c,shipWarning:o[Fe(f.shipDefinition.id,d.reinforcement)]},`${d.shipDefinition.id}_${f.shipDefinition.id}_${(S=f.reinforcement)!=null?S:"initial"}`)})]})]})})},`${d.shipDefinition.id}_${(a=d.reinforcement)!=null?a:"initial"}`)})})},Xt=n=>{const{dialogData:e,shipWarnings:u,myListOnly:i,onCancel:r,onApply:o,onChangeShipCount:s}=n,[l,F]=h.exports.useState(!1),[c,m]=h.exports.useState(()=>{const d=me();return e.filter&&typeof d[e.filter]=="boolean"?x(v({},d),{[e.filter]:!0}):d}),g=h.exports.useMemo(()=>kt(c,e),[c,e]);return h.exports.useEffect(()=>{const d=setTimeout(()=>{F(!0)},0);return()=>{clearTimeout(d)}},[]),t(Y,{title:p(y,{spacing:1,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t(C,{variant:"h6",children:Zt(e.reinforcement)}),e.reinforcement===null?p("div",{children:[t(C,{variant:"body1",component:"span",children:"\u6307\u4EE4Pt\uFF1A"}),t(C,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalCost>e.fleetSetup.maxCost?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalCost} / ${e.fleetSetup.maxCost}`})})]}):p("div",{children:[t(C,{variant:"body1",component:"span",children:"\u5897\u63F4\uFF1A"}),t(C,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalReinforcementCount>e.fleetSetup.maxReinforcement?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalReinforcementCount} / ${e.fleetSetup.maxReinforcement}`})})]})]}),content:p(y,{spacing:2,children:[t(C,{variant:"body2",children:Jt(e.reinforcement)}),t("div",{children:t(Ce,{filter:c,shipTypes:[D.CARRIER,D.BATTLE_CRUISER,D.CRUISER,D.DESTROYER,D.FRIGATE],onChange:m,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),g.fleetSetup.ships.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8239\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),l?t(te,{shipSelections:g.fleetSetup.ships,showCost:!g.reinforcement,showReinforcement:!1,showHangar:!1,shipWarnings:u,carrierShipId:null,myListOnly:i,onChangeShipCount:s}):p(y,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:p(k,{children:[t(R,{variant:"outlined",onClick:r,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(R,{variant:"contained",onClick:o,children:"\uFF2F\uFF2B"})]}),onClose:r})};function Zt(n){switch(n){case"ally":case"ally2":case"ally3":case"self":return"\u5897\u63F4\u3092\u8FFD\u52A0";default:return"\u8266\u8239\u3092\u8FFD\u52A0"}}function Jt(n){switch(n){case"ally":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF21\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"ally2":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF22\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"ally3":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF23\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"self":return"\u81EA\u8EAB\u306E\u57FA\u5730\u304B\u3089\u9001\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002";default:return"\u8266\u8239\u3092\u901A\u5E38\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}}function eu(n,e,u,i){const r=u.ships.find(l=>l.shipDefinition.id===n&&l.reinforcement===e);if(!r)throw new Error("Invalid carrier");const o={};r.carriedShips.forEach(l=>{o[`${l.shipDefinition.id}_${l.reinforcement}`]=!0});const s=tu(r,ce,e,u.myListOnly,i);return{carrierShipId:n,reinforcement:e,shipSelections:s.flatMap(l=>o[`${l.id}_${e}`]?[]:[he({shipDefinition:l,usedModules:null,count:0,reinforcement:e,maxReinforcement:u.maxReinforcement,temporary:!0})]),filter:null}}function tu(n,e,u,i,r){const o=e.filter(s=>{switch(s.type){case D.CORVETTE:return n.carrierCapabilities.carryCorvette>0;case D.FIGHTER:switch(s.subType){case I.LARGE_FIGHTER:return n.carrierCapabilities.carryUpToLargeFighter>0;case I.MEDIUM_FIGHTER:return n.carrierCapabilities.carryUpToMediumFighter>0||n.carrierCapabilities.carryUpToLargeFighter>0;case I.SMALL_FIGHTER:return n.carrierCapabilities.carryUpToSmallFighter>0||n.carrierCapabilities.carryUpToMediumFighter>0||n.carrierCapabilities.carryUpToLargeFighter>0}}return!1});return(u==null?void 0:u.includes("ally"))||!i?o:o.filter(s=>de(s.id,r))}function Ae(n,e){return x(v({},e),{ships:e.ships.map(u=>u.shipDefinition.id!==n.carrierShipId||u.reinforcement!==n.reinforcement?u:x(v({},u),{carriedShips:[...u.carriedShips,...n.shipSelections.filter(i=>i.count>0).map(i=>Ct({shipId:i.shipDefinition.id,count:i.count,reinforcement:n.reinforcement}))]}))})}function uu(n,e){let u=e;return Object.keys(n).filter(i=>n[i]).forEach(i=>{switch(i){case D.CORVETTE:case D.FIGHTER:{u=x(v({},u),{shipSelections:u.shipSelections.filter(r=>r.shipDefinition.type===i)});break}}}),u}const nu=n=>{const{userSettings:e,fleetSetup:u,setFleetSetup:i}=n,[r,o]=h.exports.useState(null),s=h.exports.useCallback((g,d)=>{o(eu(g,d,u,e))},[u,e]),l=h.exports.useCallback(()=>{o(null)},[]),F=h.exports.useCallback(()=>{r&&(i(Ae(r,u)),o(null))},[r,u,i]),c=h.exports.useCallback((g,d,A)=>{o(a=>a?x(v({},a),{shipSelections:a.shipSelections.map(f=>f.shipDefinition.id!==g||f.reinforcement!==A?f:x(v({},f),{count:d}))}):null)},[e]),m=h.exports.useMemo(()=>{if(!r)return{};const g=Ae(r,u);return q(g)},[r,u]);return{dialogData:r,shipWarnings:m,open:s,cancel:l,apply:F,setShipCount:c}},iu=n=>{const{dialogData:e,shipWarnings:u,myListOnly:i,onCancel:r,onApply:o,onChangeShipCount:s}=n,[l,F]=h.exports.useState(!1),[c,m]=h.exports.useState(()=>{const a=me();return e.filter&&typeof a[e.filter]=="boolean"?x(v({},a),{[e.filter]:!0}):a}),g=h.exports.useMemo(()=>uu(c,e),[c,e]);h.exports.useEffect(()=>{const a=setTimeout(()=>{F(!0)},0);return()=>{clearTimeout(a)}},[]);const d=!!e.shipSelections.find(a=>a.shipDefinition.type===D.CORVETTE),A=!!e.shipSelections.find(a=>a.shipDefinition.type===D.FIGHTER);return t(Y,{title:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0",content:p(y,{spacing:2,children:[t(C,{variant:"body2",children:"\u8266\u8F09\u6A5F\u3092\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8F09\u6A5F\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}),d&&A&&t("div",{children:t(Ce,{filter:c,shipTypes:[D.CORVETTE,D.FIGHTER],shipRows:[],onChange:m,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),g.shipSelections.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8F09\u6A5F\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),l?t(te,{shipSelections:g.shipSelections,showCost:!1,showReinforcement:!1,showHangar:!1,shipWarnings:u,carrierShipId:null,myListOnly:i,onChangeShipCount:s}):p(y,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:p(k,{children:[t(R,{variant:"outlined",onClick:r,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(R,{variant:"contained",onClick:o,children:"\uFF2F\uFF2B"})]}),onClose:r})},mu=()=>{const n=re(),{fleetKey:e}=Ye(),u=z(),i=P(u.breakpoints.up("lg")),r=h.exports.useMemo(()=>ut(),[]),[o,s]=h.exports.useState(!1),{fleetSetup:l,errors:F,shipWarnings:c,setFleetSetup:m,setShipCount:g,setCarriedShipCount:d,setModule:A,save:a,reset:f}=Bt({initialFleetKey:e}),{dialogData:S,shipWarnings:E,open:T,cancel:M,apply:_,setShipCount:Ee}=Mt({userSettings:r,fleetSetup:l,setFleetSetup:m}),{dialogData:ue,shipWarnings:Be,open:be,cancel:Re,apply:Te,setShipCount:we}=nu({userSettings:r,fleetSetup:l,setFleetSetup:m}),ke=h.exports.useMemo(()=>gt(l.ships),[l.ships]),[V,Me]=h.exports.useState(fe.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),N=h.exports.useMemo(()=>yt(V,l),[l,V]),Oe=()=>{n(`/fleetSetup/${l.key}`)},$e=()=>{Object.keys(F).length>0||(a(),n(`/fleetSetup/${l.key}`))},_e=()=>{s(!1)},Ie=()=>{s(!0)},Le=()=>{s(!1),f()},L=i&&N.groupedBy===fe.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column",je=L==="row"?4:2;return p(k,{children:[t(Ke,{currentRoute:"/fleetSetup"}),t(Et,{grouping:V,onChangeGrouping:Me,onSave:$e,onCancel:Oe,onReset:Ie,onOpenAddShips:T,saveDisabled:Object.keys(F).length>0}),t(Qe,{disabled:L==="row",children:t(B,{p:1,children:p(y,{spacing:1,children:[t(vt,{fleetSetup:l,onChange:m,errors:F,columnCount:je}),t(y,{spacing:1,direction:L,children:N.groups.map(O=>t($,{sx:{width:L==="row"?`${100/N.groups.length}%`:void 0},children:t(B,{p:1,children:p(y,{spacing:1,children:[p(y,{spacing:1,direction:"row",alignItems:"center",sx:{width:"100%"},children:[t(B,{sx:{flexGrow:1},children:t(C,{variant:"body1",children:`${O.name}${O.count>0?`\uFF08${O.count}\u96BB\uFF09`:""}`})}),t(ge,{filter:O.id,onOpenAddShips:T,buttonProps:{size:"small"}})]}),O.ships.length>0&&t(te,{shipSelections:O.ships,onChangeShipCount:g,onChangeCarriedShipCount:d,onOpenAddCarriedShips:be,onChangeModule:A,showCost:!0,showReinforcement:!0,showHangar:!0,shipWarnings:c,carrierShipId:null,myListOnly:l.myListOnly})]})})},O.id))})]})})}),t(bt,{fleetSetup:l,fleetShipCount:ke}),S&&t(Xt,{dialogData:S,shipWarnings:E,myListOnly:l.myListOnly,onCancel:M,onApply:_,onChangeShipCount:Ee}),ue&&t(iu,{dialogData:ue,shipWarnings:Be,myListOnly:l.myListOnly,onCancel:Re,onApply:Te,onChangeShipCount:we}),o&&t(at,{title:"\u521D\u671F\u5316",question:"\u8266\u968A\u3092\u521D\u671F\u72B6\u614B\u306B\u623B\u3057\u307E\u3059\u304B\uFF1F",cancelText:"\u30AD\u30E3\u30F3\u30BB\u30EB",confirmText:"\u521D\u671F\u5316",onCancel:_e,onConfirm:Le})]})};export{mu as FleetSetupEditPage,mu as default};
