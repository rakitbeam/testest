var je=Object.defineProperty,He=Object.defineProperties;var Ge=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ie=(u,e,n)=>e in u?je(u,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[e]=n,x=(u,e)=>{for(var n in e||(e={}))We.call(e,n)&&ie(u,n,e[n]);if(ue)for(var n of ue(e))ze.call(e,n)&&ie(u,n,e[n]);return u},S=(u,e)=>He(u,Ge(e));import{j as t,A as M,c as E,s as H,b as F,T as C,E as R,v as G,w as W,x as z,F as k,h as T,t as re,r as h,Q as Pe,S as v,u as P,a as V,W as ae,af as Ve,ay as Ne,az as oe,aA as se,am as Ue,ax as le,aB as w,aw as qe}from"./vendor.612e55a5.js";import{N as Ye,C as Ke}from"./NavigationBar.e91af742.js";import{L as Qe,d as ce,b as D,S as q,z as Ze,p as Je,C as O}from"./index.1d6337e7.js";import{d as Xe,a as et,b as tt,C as nt}from"./ConfirmationDialog.2bb0bdf0.js";import{A as ut}from"./ActionBar.a2802d77.js";import{B as it,S as rt,g as at,c as de,d as ot,e as st,s as lt,h as ct,i as dt,v as Y,j as pe,k as pt,l as he,m as ht,a as Ft,G as Fe,b as ft}from"./fleetSetupValidation.7a9f425d.js";import{d as fe,g as mt}from"./userSettingsUtils.ae5743e9.js";import{R as K}from"./ResponsiveDialog.418e97d8.js";import{c as me,S as ge}from"./ShipTypeFilterButton.97aa48b7.js";import"./domUtils.e9df6b0f.js";import"./sorting.c6946657.js";import"./WishState.3db35fd5.js";const gt=u=>{const{fleetSetup:e,onChange:n,errors:i,columnCount:r}=u,o=c=>{n(S(x({},e),{name:c.target.value.trim()}))},a=c=>{n(S(x({},e),{maxCost:Number(c.target.value)}))},l=c=>{n(S(x({},e),{maxReinforcement:Number(c.target.value)}))},f=c=>{n(S(x({},e),{myListOnly:c.target.value==="myListOnly"}))};return t(M,{children:t(E,{p:1,children:t(Qe,{sx:{alignItems:"center"},offsetValue:!1,rowGap:1,columnCount:r,rows:[{key:"name",label:"\u8266\u968A\u540D",value:c=>t(H,{variant:"outlined",size:"small",value:e.name,onChange:o,error:!!i.name,helperText:i.name,fullWidth:c})},{key:"reinforcementCount",label:"\u6700\u5927\u5897\u63F4\u6570",value:c=>F(H,{variant:"outlined",size:"small",select:!0,value:e.maxReinforcement,onChange:l,error:!!i.maxReinforcement,helperText:i.maxReinforcement,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.maxReinforcement})},children:[t(R,{value:"5",children:"\uFF15\u96BB\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(R,{value:"6",children:"\uFF16\u96BB\uFF08\u5C0F\u578B\u88DC\u7D66\u57FA\u5730\u306B\u7D50\u5408\uFF09"}),t(R,{value:"9",children:"\uFF19\u96BB\uFF08\u4E2D\u7D99\u88DC\u7D66\u65BD\u8A2D\u306B\u7D50\u5408\uFF09"})]})},{key:"maxCost",label:"\u6700\u5927\u53F8\u4EE4Pt",value:c=>F(H,{variant:"outlined",size:"small",select:!0,value:e.maxCost,onChange:a,error:!!i.maxCost,helperText:i.maxCost,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.maxCost})},children:[t(R,{value:"450",children:"\uFF14\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(R,{value:"430",children:"\uFF14\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(R,{value:"415",children:"\uFF14\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(R,{value:"400",children:"\uFF14\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"}),t(R,{value:"350",children:"\uFF13\uFF15\uFF10\uFF08\u6226\u5730\u6307\u4EE4\u30BB\u30F3\u30BF\u30FC\u306B\u7D50\u5408\uFF09"}),t(R,{value:"330",children:"\uFF13\uFF13\uFF10\uFF08\u5354\u540C\u4F5C\u6226\u6A5F\u69CB\u306B\u7D50\u5408\uFF09"}),t(R,{value:"315",children:"\uFF13\uFF11\uFF15\uFF08\u9060\u8DDD\u96E2\u6307\u4EE4\u5C40\u306B\u7D50\u5408\uFF09"}),t(R,{value:"300",children:"\uFF13\uFF10\uFF10\uFF08\u7D50\u5408\u52B9\u679C\u7121\u3057\uFF09"})]})},{key:"myListOnly",label:"\u8FFD\u52A0\u3067\u304D\u308B\u8266\u8239",value:c=>F(H,{variant:"outlined",size:"small",select:!0,value:e.myListOnly?"myListOnly":"all",onChange:f,error:!!i.myListOnly,helperText:i.myListOnly,fullWidth:c,SelectProps:{renderValue:()=>t(C,{variant:"body1",whiteSpace:"normal",children:e.myListOnly?"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239":"\u5168\u3066\u306E\u8266\u8239"})},children:[t(R,{value:"all",children:"\u5168\u3066\u306E\u8266\u8239"}),t(R,{value:"myListOnly",children:"\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239"})]})}]})})})};var Q={},Ct=W.exports;Object.defineProperty(Q,"__esModule",{value:!0});var Z=Q.default=void 0,yt=Ct(G),vt=z,xt=(0,yt.default)((0,vt.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");Z=Q.default=xt;const Ce=u=>{const{onOpenAddShips:e,filter:n,buttonProps:i}=u;return t(it,{icon:t(Z,{}),text:"\u8266\u8239\u3092\u8FFD\u52A0",onClick:o=>{switch(o){case"addInitialShip":{e(null,n);break}case"addSelfReinforcement":{e("self",n);break}case"addAllyReinforcement":{e("ally",n);break}case"addAlly2Reinforcement":{e("ally2",n);break}case"addAlly3Reinforcement":{e("ally3",n);break}}},buttonProps:i,options:[{key:"addInitialShip",text:"\u901A\u5E38\u914D\u5099",value:"addInitialShip"},{key:"addSelfReinforcement",text:"\u5897\u63F4",value:"addSelfReinforcement"},{key:"addAllyReinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21",value:"addAllyReinforcement"},{key:"addAlly2Reinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22",value:"addAlly2Reinforcement"},{key:"addAlly3Reinforcement",text:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23",value:"addAlly3Reinforcement"}]})},St=u=>{const{grouping:e,onChangeGrouping:n,onCancel:i,onSave:r,onReset:o,onOpenAddShips:a,saveDisabled:l}=u;return t(ut,{left:f=>F(k,{children:[t(rt,{value:e,onChange:n,buttonProps:f}),t(Ce,{onOpenAddShips:a,buttonProps:f})]}),right:f=>F(k,{children:[t(T,S(x({variant:"outlined",startIcon:t(Xe,{}),onClick:o},f),{children:"\u521D\u671F\u5316"}),"reset"),t(T,S(x({variant:"outlined",startIcon:t(et,{}),onClick:i},f),{children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),"cancel"),t(T,S(x({variant:"contained",startIcon:t(tt,{}),onClick:r,disabled:l},f),{children:"\u4FDD\u5B58"}),"save")]})})},Dt=u=>{var g;const{initialFleetKey:e,userSettings:n}=u,i=re(),r=h.exports.useMemo(()=>at(n),[n]),[o,a]=h.exports.useState(e&&(g=r.find(y=>y.key===e))!=null?g:r[0]),l=h.exports.useCallback((y,A,b)=>{a(B=>de({shipId:y,count:A,reinforcement:b,fleetSetup:B,userSettings:n}))},[n]),f=h.exports.useCallback((y,A,b,B)=>{a(_=>ot({shipId:y,carrierShipId:A,count:b,reinforcement:B,fleetSetup:_}))},[]),c=h.exports.useCallback((y,A,b)=>{a(B=>st({shipId:y,reinforcement:A,moduleSelection:b,fleetSetup:B}))},[]),m=h.exports.useCallback(()=>{lt(o),i("/fleetSetup")},[o]),s=h.exports.useCallback(()=>{const y=Number(o.key.substring("fleet".length));a(ct(y))},[o]),d=h.exports.useMemo(()=>dt(o),[o]),p=h.exports.useMemo(()=>Y(o),[o]);return{fleetSetup:o,errors:d,shipWarnings:p,setFleetSetup:a,setShipCount:l,setCarriedShipCount:f,setModule:c,save:m,reset:s}},At=u=>{const{fleetSetup:e,fleetShipCount:n}=u,i=n.totalCost>e.maxCost,r=e.totalReinforcementCount>e.maxReinforcement;return t(E,{sx:{height:"100px"},children:t(M,{square:!0,sx:{position:"fixed",right:0,bottom:0,zIndex:1,width:"100%",borderTop:"1px solid rgba(0, 0, 0, 0.2)"},children:t(Pe,{maxWidth:"md",disableGutters:!0,children:t(E,{p:1,children:F(v,{spacing:1,flexWrap:"wrap",direction:"row",children:[t(E,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:F("div",{children:[t(C,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),t(C,{variant:"body1",sx:{color:r?"red":void 0},children:t("strong",{children:`${e.totalReinforcementCount} / ${e.maxReinforcement}`})})]})}),t(E,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:F("div",{children:[t(C,{variant:"body2",color:"text.secondary",children:"\u53F8\u4EE4pt"}),t(C,{variant:"body1",sx:{color:i?"red":void 0},children:t("strong",{children:`${n.totalCost} / ${e.maxCost}`})})]})})]})})})})})};function Et(u,e,n,i){const r={};e.ships.forEach(a=>{r[`${a.shipDefinition.id}_${a.reinforcement}`]=!0});const o=bt(ce,u,e.myListOnly,n);return{fleetSetup:S(x({},e),{ships:[...e.ships,...o.flatMap(a=>r[`${a.id}_${u}`]?[]:[pe({shipDefinition:a,usedModules:null,count:0,reinforcement:u,userSettings:n,maxReinforcement:e.maxReinforcement,temporary:!0,myListOnly:e.myListOnly})])]}),reinforcement:u,filter:i}}function bt(u,e,n,i){const r=u.filter(o=>o.type!==D.CORVETTE&&o.type!==D.FIGHTER);return(e==null?void 0:e.includes("ally"))||!n?r:r.filter(o=>fe(o.id,i))}function Bt(u){return S(x({},u.fleetSetup),{ships:u.fleetSetup.ships.flatMap(e=>e.temporary?e.count===0?[]:[S(x({},e),{temporary:!1})]:[e])})}function Rt(u,e){let n=S(x({},e),{fleetSetup:S(x({},e.fleetSetup),{ships:e.fleetSetup.ships.filter(i=>i.temporary===!0)})});return Object.keys(u).filter(i=>u[i]).forEach(i=>{switch(i){case q.FRONT:case q.MIDDLE:case q.BACK:{n=S(x({},n),{fleetSetup:S(x({},n.fleetSetup),{ships:n.fleetSetup.ships.filter(r=>r.shipDefinition.row===i)})});break}case D.CARRIER:case D.BATTLE_CRUISER:case D.CRUISER:case D.DESTROYER:case D.FRIGATE:{n=S(x({},n),{fleetSetup:S(x({},n.fleetSetup),{ships:n.fleetSetup.ships.filter(r=>r.shipDefinition.type===i)})});break}}}),n}const Tt=u=>{const{userSettings:e,fleetSetup:n,setFleetSetup:i}=u,[r,o]=h.exports.useState(null),a=h.exports.useCallback((s,d)=>{o(Et(s,n,e,d!=null?d:null))},[n,e]),l=h.exports.useCallback(()=>{o(null)},[]),f=h.exports.useCallback(()=>{r&&(i(Bt(r)),o(null))},[r,i]),c=h.exports.useCallback((s,d,p)=>{o(g=>g?S(x({},g),{fleetSetup:de({shipId:s,count:d,reinforcement:p,fleetSetup:g.fleetSetup,userSettings:e,keepZero:!0})}):null)},[e]),m=h.exports.useMemo(()=>r?Y(r.fleetSetup):{},[r]);return{dialogData:r,shipWarnings:m,open:a,cancel:l,apply:f,setShipCount:c}};var J={},wt=W.exports;Object.defineProperty(J,"__esModule",{value:!0});var ye=J.default=void 0,kt=wt(G),$t=z,Mt=(0,kt.default)((0,$t.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");ye=J.default=Mt;var X={},_t=W.exports;Object.defineProperty(X,"__esModule",{value:!0});var ve=X.default=void 0,Ot=_t(G),It=z,Lt=(0,Ot.default)((0,It.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");ve=X.default=Lt;const jt=u=>{const{shipDefinition:e,count:n,maxCount:i,reinforcement:r,showCost:o,showReinforcement:a,carrierShipId:l,shipWarning:f,onChangeShipCount:c,onChangeCarriedShipCount:m}=u,s=P(),d=V(s.breakpoints.down("sm")),{openShipDetailDialog:p}=Ze(),g=F(k,{children:[t(C,{variant:"body1",children:t(Je,{onClick:()=>{p(e.id)},children:e.name})}),o&&r===null&&t(C,{variant:"body2",color:"text.secondary",children:`\u6307\u4EE4\uFF30\uFF54\uFF1A${e.cost}\u3000\u5408\u8A08\uFF1A${e.cost*n}`}),a&&r==="self"&&t(C,{variant:"body2",color:"text.secondary",children:"\u5897\u63F4"}),a&&r==="ally"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21"}),a&&r==="ally2"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22"}),a&&r==="ally3"&&t(C,{variant:"body2",color:"text.secondary",children:"\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23"})]}),y=f&&t(C,{variant:"caption",color:"red",textAlign:"end",children:f}),A=t(T,{onClick:()=>{l?m==null||m(e.id,l,0,r):c==null||c(e.id,0,r)},disabled:n<=0,children:"\u5916\u3059"}),b=t(ae,{onClick:()=>{l?m==null||m(e.id,l,n-1,r):c==null||c(e.id,n-1,r)},disabled:n<=0,children:t(ye,{color:n<=0?"disabled":"primary"})}),B=t(C,{variant:"body1",sx:{minWidth:"55px"},textAlign:"center",children:t("strong",{children:`${n} / ${i}`})}),_=t(ae,{onClick:()=>{l?m==null||m(e.id,l,n+1,r):c==null||c(e.id,n+1,r)},disabled:n>=i,children:t(ve,{color:n>=i?"disabled":"primary"})}),L=t(T,{onClick:()=>{l?m==null||m(e.id,l,i,r):c==null||c(e.id,i,r)},disabled:n>=i,children:"\u6700\u5927"});return F(k,{children:[d&&F(v,{spacing:1,children:[g,F(M,{variant:"outlined",sx:{display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[F(v,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[b,B,_]}),F(v,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[A,L]})]}),y]}),!d&&F(v,{spacing:1,children:[F(v,{spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[t(E,{pb:1,children:t(v,{spacing:1,children:g})}),t(E,{sx:{display:"flex",justifyContent:"end",flexGrow:1},children:t(M,{variant:"outlined",sx:{display:"inline-block"},children:F(v,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[A,b,B,_,L]})})})]}),y]})]})};function Ht(u){const e={corvette:{key:"corvette",name:"\u8B77\u9001\u8266",count:u.carriedShips.filter(n=>n.shipDefinition.type===D.CORVETTE).map(n=>n.count).reduce((n,i)=>n+i,0),maxCount:u.carrierCapabilities.carryCorvette*u.count},upToLargeFighter:{key:"upToLargeFighter",name:"\u5C0F\uFF5E\u5927\u578B\u6226\u95D8\u6A5F",count:u.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.LARGE_FIGHTER).map(n=>n.count).reduce((n,i)=>n+i,0),maxCount:u.carrierCapabilities.carryUpToLargeFighter*u.count},upToMediumFighter:{key:"upToMediumFighter",name:"\u5C0F\uFF5E\u4E2D\u91CF\u7D1A\u6226\u95D8\u6A5F",count:u.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.MEDIUM_FIGHTER).map(n=>n.count).reduce((n,i)=>n+i,0),maxCount:u.carrierCapabilities.carryUpToMediumFighter*u.count},upToSmallFighter:{key:"upToSmallFighter",name:"\u5C0F\u578B\u6226\u95D8\u6A5F",count:u.carriedShips.filter(n=>n.shipDefinition.type===D.FIGHTER&&n.shipDefinition.subType===O.SMALL_FIGHTER).map(n=>n.count).reduce((n,i)=>n+i,0),maxCount:u.carrierCapabilities.carryUpToSmallFighter*u.count},removedHangar:{key:"removedHangar",name:"\u672A\u5BFE\u5FDC",count:0,maxCount:0}};return I(e.upToSmallFighter,[e.upToMediumFighter,e.upToLargeFighter]),I(e.upToMediumFighter,[e.upToLargeFighter]),e.upToSmallFighter.maxCount===0&&I(e.upToSmallFighter,[e.removedHangar]),e.upToMediumFighter.maxCount===0&&I(e.upToMediumFighter,[e.removedHangar]),e.upToLargeFighter.maxCount===0&&I(e.upToLargeFighter,[e.removedHangar]),e}function I(u,e){let n=u.count-u.maxCount;n<=0||(u.count-=n,e.forEach(i=>{if(n<=0||i.maxCount===0)return;const r=i.maxCount-i.count;if(r<=0)return;const o=Math.min(r,n);n-=o,i.count+=o}),n>0&&(u.count+=n))}function Gt(u){return u.count>0||u.maxCount>0}const Wt=u=>{const{shipSelection:e,onOpenAddCarriedShips:n}=u,i=P(),r=V(i.breakpoints.down("xs")),o=h.exports.useMemo(()=>Ht(e),[e]);return F(v,{spacing:1,direction:r?"column":"row",alignItems:r?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[F(v,{sx:{flexGrow:1},spacing:3,direction:"row",alignItems:"center",justifyContent:"space-between",children:[t(C,{variant:"body2",color:"text.secondary",children:"\u30CF\u30F3\u30AC\u30FC\uFF1A"}),t(v,{spacing:1,direction:"row",alignItems:"center",children:t(v,{spacing:1,direction:"row",alignItems:"center",children:Object.keys(o).filter(a=>Gt(o[a])).map(a=>o[a]).map(a=>F(h.exports.Fragment,{children:[t(C,{variant:"body2",color:"text.secondary",children:a.name}),t(C,{variant:"body2",color:"text.secondary",sx:{color:a.count>a.maxCount?"red":void 0},children:t("strong",{children:`${a.count} / ${a.maxCount}`})})]},a.key))})})]}),t(T,{variant:"outlined",size:"small",startIcon:t(Z,{}),sx:{whiteSpace:"nowrap"},onClick:()=>{n==null||n(e.shipDefinition.id,e.reinforcement)},children:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0"})]})};var ee={},zt=W.exports;Object.defineProperty(ee,"__esModule",{value:!0});var xe=ee.default=void 0,Pt=zt(G),Vt=z,Nt=(0,Pt.default)((0,Vt.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");xe=ee.default=Nt;const Ut=u=>{const{shipId:e,reinforcement:n,moduleSelection:i,onChange:r,onClose:o}=u,[a,l]=h.exports.useState(i),f=()=>{r(e,n,a),o()},c=d=>{const[p,g]=d.target.value.split("#");l(y=>pt(p,g,y))},m=d=>{const p=Object.keys(a.groups[d]).find(g=>a.groups[d][g].usage==="used");return p?`${d}#${p}`:null},s=d=>!Object.keys(a.groups[d]).find(p=>a.groups[d][p].module.defaultModule);return t(K,{title:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5",content:t(v,{spacing:3,children:Object.keys(a.groups).map(d=>{const p=m(d),g=`${d}#none`;return t(M,{variant:"outlined",children:t(E,{pl:1,pr:1,children:t(Ve,{children:F(Ne,{defaultValue:"female",name:`group-${d}`,value:p!=null?p:g,onChange:c,children:[s(d)&&t(oe,{label:"\u7121\u3057",value:g,control:t(se,{})},g),Object.keys(a.groups[d]).map(y=>{const A=a.groups[d][y],b=n!=="ally"&&n!=="ally2"&&n!=="ally3"&&A.usage==="not_possessed",B=`${d}#${y}`;return t(oe,{label:`${A.module.category}${A.module.categoryNumber} ${A.module.name}`,value:B,control:t(se,{disabled:b}),disabled:b},y)})]})})})},d)})}),actions:F(k,{children:[t(T,{variant:"outlined",onClick:o,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:f,children:"\uFF2F\uFF2B"})]}),onClose:o})},qt=u=>{const{shipId:e,reinforcement:n,moduleSelection:i,onChange:r}=u,o=P(),a=V(o.breakpoints.down("xs")),[l,f]=h.exports.useState(!1),c=()=>{f(!0)},m=()=>{f(!1)},s=[];return Object.keys(i.groups).map(d=>{Object.keys(i.groups[d]).map(p=>i.groups[d][p]).forEach(p=>{p.usage==="used"&&(s.length>0&&s.push(t(h.exports.Fragment,{children:t(C,{variant:"body2",component:"span",children:"\u3001"})},`before_${p.module.id}`)),s.push(t(h.exports.Fragment,{children:t(Ue,{arrow:!0,disableFocusListener:!0,title:p.module.name,children:t(C,{variant:"body2",component:"span",children:`${p.module.category}${p.module.categoryNumber}`})})},p.module.id)))})}),F(k,{children:[F(v,{spacing:1,direction:a?"column":"row",alignItems:a?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[t(E,{sx:{flexGrow:1},children:F(C,{variant:"body2",color:"text.secondary",children:["\u30B7\u30B9\u30C6\u30E0\uFF1A",s]})}),!i.static&&t(E,{sx:{display:"flex",alignContent:"end"},children:t(T,{variant:"outlined",size:"small",startIcon:t(xe,{}),sx:{whiteSpace:"nowrap"},onClick:c,children:"\u30B7\u30B9\u30C6\u30E0\u3092\u63DB\u88C5"})})]}),l&&t(Ut,{shipId:e,reinforcement:n,moduleSelection:i,onChange:r,onClose:m})]})},Se=h.exports.memo(jt),te=u=>{const{shipSelections:e,showCost:n,showReinforcement:i,showHangar:r,shipWarnings:o,carrierShipId:a,onChangeShipCount:l,onChangeCarriedShipCount:f,onOpenAddCarriedShips:c,onChangeModule:m}=u;return t(v,{spacing:1,children:e==null?void 0:e.map(s=>{var d,p;return t(M,{variant:"outlined",children:t(E,{p:1,children:F(v,{spacing:1,children:[t(Se,{shipDefinition:s.shipDefinition,count:s.count,maxCount:s.maxCount,reinforcement:s.reinforcement,showCost:n,showReinforcement:i,carrierShipId:a,onChangeShipCount:l,onChangeCarriedShipCount:f,shipWarning:o[he(s.shipDefinition.id,s.reinforcement)]}),s.moduleSelection&&m&&t(qt,{shipId:s.shipDefinition.id,reinforcement:s.reinforcement,moduleSelection:s.moduleSelection,onChange:m}),r&&s.carrierCapabilities.canCarry&&F(v,{spacing:1,children:[t(Wt,{shipSelection:s,onOpenAddCarriedShips:c}),(d=s.carriedShips)==null?void 0:d.map(g=>{var y;return t(Se,{shipDefinition:g.shipDefinition,count:g.count,maxCount:g.shipDefinition.operationLimit,reinforcement:g.reinforcement,carrierShipId:s.shipDefinition.id,showCost:!1,showReinforcement:!1,onChangeCarriedShipCount:f,shipWarning:o[he(g.shipDefinition.id,s.reinforcement)]},`${s.shipDefinition.id}_${g.shipDefinition.id}_${(y=g.reinforcement)!=null?y:"initial"}`)})]})]})})},`${s.shipDefinition.id}_${(p=s.reinforcement)!=null?p:"initial"}`)})})},Yt=u=>{const{dialogData:e,shipWarnings:n,onCancel:i,onApply:r,onChangeShipCount:o}=u,[a,l]=h.exports.useState(!1),[f,c]=h.exports.useState(()=>{const s=me();return e.filter&&typeof s[e.filter]=="boolean"?S(x({},s),{[e.filter]:!0}):s}),m=h.exports.useMemo(()=>Rt(f,e),[f,e]);return h.exports.useEffect(()=>{const s=setTimeout(()=>{l(!0)},0);return()=>{clearTimeout(s)}},[]),t(K,{title:F(v,{spacing:1,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t(C,{variant:"h6",children:Kt(e.reinforcement)}),e.reinforcement===null?F("div",{children:[t(C,{variant:"body1",component:"span",children:"\u6307\u4EE4Pt\uFF1A"}),t(C,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalCost>e.fleetSetup.maxCost?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalCost} / ${e.fleetSetup.maxCost}`})})]}):F("div",{children:[t(C,{variant:"body1",component:"span",children:"\u5897\u63F4\uFF1A"}),t(C,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalReinforcementCount>e.fleetSetup.maxReinforcement?"red":void 0},children:t("strong",{children:`${e.fleetSetup.totalReinforcementCount} / ${e.fleetSetup.maxReinforcement}`})})]})]}),content:F(v,{spacing:2,children:[t(C,{variant:"body2",children:Qt(e.reinforcement)}),t("div",{children:t(ge,{filter:f,shipTypes:[D.CARRIER,D.BATTLE_CRUISER,D.CRUISER,D.DESTROYER,D.FRIGATE],onChange:c,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),m.fleetSetup.ships.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8239\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),a?t(te,{shipSelections:m.fleetSetup.ships,showCost:!m.reinforcement,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,onChangeShipCount:o}):F(v,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:F(k,{children:[t(T,{variant:"outlined",onClick:i,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:r,children:"\uFF2F\uFF2B"})]}),onClose:i})};function Kt(u){switch(u){case"ally":case"ally2":case"ally3":case"self":return"\u5897\u63F4\u3092\u8FFD\u52A0";default:return"\u8266\u8239\u3092\u8FFD\u52A0"}}function Qt(u){switch(u){case"ally":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF21\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"ally2":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF22\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"ally3":return"\u30E6\u30CB\u30AA\u30F3\u30E1\u30F3\u30D0\u30FC\uFF23\u304B\u3089\u9001\u3089\u308C\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002";case"self":return"\u81EA\u8EAB\u306E\u57FA\u5730\u304B\u3089\u9001\u308B\u5897\u63F4\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002";default:return"\u8266\u8239\u3092\u901A\u5E38\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8239\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}}function Zt(u,e,n,i){const r=n.ships.find(l=>l.shipDefinition.id===u&&l.reinforcement===e);if(!r)throw new Error("Invalid carrier");const o={};r.carriedShips.forEach(l=>{o[`${l.shipDefinition.id}_${l.reinforcement}`]=!0});const a=Jt(r,ce,e,n.myListOnly,i);return{carrierShipId:u,reinforcement:e,shipSelections:a.flatMap(l=>o[`${l.id}_${e}`]?[]:[pe({shipDefinition:l,usedModules:null,count:0,reinforcement:e,userSettings:i,maxReinforcement:n.maxReinforcement,temporary:!0,myListOnly:n.myListOnly})]),filter:null}}function Jt(u,e,n,i,r){const o=e.filter(a=>{switch(a.type){case D.CORVETTE:return u.carrierCapabilities.carryCorvette>0;case D.FIGHTER:switch(a.subType){case O.LARGE_FIGHTER:return u.carrierCapabilities.carryUpToLargeFighter>0;case O.MEDIUM_FIGHTER:return u.carrierCapabilities.carryUpToMediumFighter>0||u.carrierCapabilities.carryUpToLargeFighter>0;case O.SMALL_FIGHTER:return u.carrierCapabilities.carryUpToSmallFighter>0||u.carrierCapabilities.carryUpToMediumFighter>0||u.carrierCapabilities.carryUpToLargeFighter>0}}return!1});return(n==null?void 0:n.includes("ally"))||!i?o:o.filter(a=>fe(a.id,r))}function De(u,e){return S(x({},e),{ships:e.ships.map(n=>n.shipDefinition.id!==u.carrierShipId||n.reinforcement!==u.reinforcement?n:S(x({},n),{carriedShips:[...n.carriedShips,...u.shipSelections.filter(i=>i.count>0).map(i=>ht({shipId:i.shipDefinition.id,count:i.count,reinforcement:u.reinforcement}))]}))})}function Xt(u,e){let n=e;return Object.keys(u).filter(i=>u[i]).forEach(i=>{switch(i){case D.CORVETTE:case D.FIGHTER:{n=S(x({},n),{shipSelections:n.shipSelections.filter(r=>r.shipDefinition.type===i)});break}}}),n}const en=u=>{const{userSettings:e,fleetSetup:n,setFleetSetup:i}=u,[r,o]=h.exports.useState(null),a=h.exports.useCallback((s,d)=>{o(Zt(s,d,n,e))},[n,e]),l=h.exports.useCallback(()=>{o(null)},[]),f=h.exports.useCallback(()=>{r&&(i(De(r,n)),o(null))},[r,n,i]),c=h.exports.useCallback((s,d,p)=>{o(g=>g?S(x({},g),{shipSelections:g.shipSelections.map(y=>y.shipDefinition.id!==s||y.reinforcement!==p?y:S(x({},y),{count:d}))}):null)},[e]),m=h.exports.useMemo(()=>{if(!r)return{};const s=De(r,n);return Y(s)},[r,n]);return{dialogData:r,shipWarnings:m,open:a,cancel:l,apply:f,setShipCount:c}},tn=u=>{const{dialogData:e,shipWarnings:n,onCancel:i,onApply:r,onChangeShipCount:o}=u,[a,l]=h.exports.useState(!1),[f,c]=h.exports.useState(()=>{const p=me();return e.filter&&typeof p[e.filter]=="boolean"?S(x({},p),{[e.filter]:!0}):p}),m=h.exports.useMemo(()=>Xt(f,e),[f,e]);h.exports.useEffect(()=>{const p=setTimeout(()=>{l(!0)},0);return()=>{clearTimeout(p)}},[]);const s=!!e.shipSelections.find(p=>p.shipDefinition.type===D.CORVETTE),d=!!e.shipSelections.find(p=>p.shipDefinition.type===D.FIGHTER);return t(K,{title:"\u8266\u8F09\u6A5F\u3092\u8FFD\u52A0",content:F(v,{spacing:2,children:[t(C,{variant:"body2",children:"\u8266\u8F09\u6A5F\u3092\u914D\u5099\u3057\u307E\u3059\u3002\u6240\u6301\u3057\u3066\u3044\u308B\u8266\u8F09\u6A5F\u306F\u30DE\u30A4\u30EA\u30B9\u30C8\u3067\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}),s&&d&&t("div",{children:t(ge,{filter:f,shipTypes:[D.CORVETTE,D.FIGHTER],shipRows:[],onChange:c,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),m.shipSelections.length===0&&t(le,{severity:"info",children:"\u8A72\u5F53\u3059\u308B\u8266\u8F09\u6A5F\u304C\u3042\u308A\u307E\u305B\u3093\u3002"}),a?t(te,{shipSelections:m.shipSelections,showCost:!1,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,onChangeShipCount:o}):F(v,{spacing:1,children:[t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90}),t(w,{variant:"rectangular",animation:"wave",height:90}),t(w,{variant:"rectangular",height:90})]})]}),actions:F(k,{children:[t(T,{variant:"outlined",onClick:i,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),t(T,{variant:"contained",onClick:r,children:"\uFF2F\uFF2B"})]}),onClose:i})},mn=()=>{const u=re(),{fleetKey:e}=qe(),n=P(),i=V(n.breakpoints.up("lg")),r=h.exports.useMemo(()=>mt(),[]),[o,a]=h.exports.useState(!1),{fleetSetup:l,errors:f,shipWarnings:c,setFleetSetup:m,setShipCount:s,setCarriedShipCount:d,setModule:p,save:g,reset:y}=Dt({initialFleetKey:e,userSettings:r}),{dialogData:A,shipWarnings:b,open:B,cancel:_,apply:L,setShipCount:Ae}=Tt({userSettings:r,fleetSetup:l,setFleetSetup:m}),{dialogData:ne,shipWarnings:Ee,open:be,cancel:Be,apply:Re,setShipCount:Te}=en({userSettings:r,fleetSetup:l,setFleetSetup:m}),we=h.exports.useMemo(()=>Ft(l.ships),[l.ships]),[N,ke]=h.exports.useState(Fe.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),U=h.exports.useMemo(()=>ft(N,l),[l,N]),$e=()=>{u(`/fleetSetup/${l.key}`)},Me=()=>{Object.keys(f).length>0||(g(),u(`/fleetSetup/${l.key}`))},_e=()=>{a(!1)},Oe=()=>{a(!0)},Ie=()=>{a(!1),y()},j=i&&U.groupedBy===Fe.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column",Le=j==="row"?4:2;return F(k,{children:[t(Ye,{currentRoute:"/fleetSetup"}),t(St,{grouping:N,onChangeGrouping:ke,onSave:Me,onCancel:$e,onReset:Oe,onOpenAddShips:B,saveDisabled:Object.keys(f).length>0}),t(Ke,{disabled:j==="row",children:t(E,{p:1,children:F(v,{spacing:1,children:[t(gt,{fleetSetup:l,onChange:m,errors:f,columnCount:Le}),t(v,{spacing:1,direction:j,children:U.groups.map($=>t(M,{sx:{width:j==="row"?`${100/U.groups.length}%`:void 0},children:t(E,{p:1,children:F(v,{spacing:1,children:[F(v,{spacing:1,direction:"row",alignItems:"center",sx:{width:"100%"},children:[t(E,{sx:{flexGrow:1},children:t(C,{variant:"body1",children:`${$.name}${$.count>0?`\uFF08${$.count}\u96BB\uFF09`:""}`})}),t(Ce,{filter:$.id,onOpenAddShips:B,buttonProps:{size:"small"}})]}),$.ships.length>0&&t(te,{shipSelections:$.ships,onChangeShipCount:s,onChangeCarriedShipCount:d,onOpenAddCarriedShips:be,onChangeModule:p,showCost:!0,showReinforcement:!0,showHangar:!0,shipWarnings:c,carrierShipId:null})]})})},$.id))})]})})}),t(At,{fleetSetup:l,fleetShipCount:we}),A&&t(Yt,{dialogData:A,shipWarnings:b,onCancel:_,onApply:L,onChangeShipCount:Ae}),ne&&t(tn,{dialogData:ne,shipWarnings:Ee,onCancel:Be,onApply:Re,onChangeShipCount:Te}),o&&t(nt,{title:"\u521D\u671F\u5316",question:"\u8266\u968A\u3092\u521D\u671F\u72B6\u614B\u306B\u623B\u3057\u307E\u3059\u304B\uFF1F",cancelText:"\u30AD\u30E3\u30F3\u30BB\u30EB",confirmText:"\u521D\u671F\u5316",onCancel:_e,onConfirm:Ie})]})};export{mn as FleetSetupEditPage,mn as default};
