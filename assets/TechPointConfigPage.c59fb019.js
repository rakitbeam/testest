import{C as q,A as H,D as I,K as k,_ as y,N as _,b7 as V,b6 as W,r as u,O as Y,G as K,k as s,j as f,J as Q,I as ee,w as T,T as C,t as m,q as E,az as te,g as L,aJ as oe,f as ne,aG as ie,F as $,c as x,B as M,bq as se,au as z,m as re,a3 as N}from"./index.dba5565e.js";import{g as ce,S as ae,c as le,a as de}from"./ShipTypeFilterButton.5379630a.js";import{N as he,P as ue}from"./PageContent.88f45388.js";import{P as pe}from"./PageFooter.bcb20632.js";import{d as fe}from"./Settings.40d18d95.js";import{E as ge}from"./ExpandStack.b6f4a978.js";import{c as me,b as Se}from"./boolMapUtils.54d90c14.js";import{d as Ce}from"./Save.594ac3ff.js";import{d as ve,a as Te}from"./DeleteForever.aa872020.js";import{A as xe}from"./ActionBar.b9964bb5.js";import{C as be}from"./ConfirmationDialog.003b5416.js";import{S as we}from"./SearchInput.a26378c2.js";import"./domUtils.5e953d0e.js";import"./MenuItem.a7aa4996.js";import"./Popper.902fe77c.js";import"./ClickAwayListener.3afd8de5.js";import"./useFormControl.787c8aac.js";import"./ResponsiveDialog.386c050f.js";import"./DialogContentText.ad813c34.js";import"./TextField.fca4debd.js";import"./Select.f03aee62.js";import"./InputAdornment.f35066aa.js";function Pe(e){return H("MuiSwitch",e)}const ke=q("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var g=ke;const ye=["className","color","edge","size","sx"],$e=e=>{const{classes:t,edge:o,size:n,color:r,checked:i,disabled:c}=e,a={root:["root",o&&`edge${k(o)}`,`size${k(n)}`],switchBase:["switchBase",`color${k(r)}`,i&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=ee(a,Pe,t);return y({},t,l)},Ee=I("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${k(o.edge)}`],t[`size${k(o.size)}`]]}})(({ownerState:e})=>y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${g.thumb}`]:{width:16,height:16},[`& .${g.switchBase}`]:{padding:4,[`&.${g.checked}`]:{transform:"translateX(16px)"}}})),Ie=I(ce,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${g.input}`]:t.input},o.color!=="default"&&t[`color${k(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${g.checked}`]:{transform:"translateX(20px)"},[`&.${g.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${g.checked} + .${g.track}`]:{opacity:.5},[`&.${g.disabled} + .${g.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${g.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>y({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:_(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${g.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${g.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?V(e.palette[t.color].main,.62):W(e.palette[t.color].main,.55)}`}},[`&.${g.checked} + .${g.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Re=I("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Me=I("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Ae=u.exports.forwardRef(function(t,o){const n=Y({props:t,name:"MuiSwitch"}),{className:r,color:i="primary",edge:c=!1,size:a="medium",sx:l}=n,d=K(n,ye),h=y({},n,{color:i,edge:c,size:a}),p=$e(h),b=s(Me,{className:p.thumb,ownerState:h});return f(Ee,{className:Q(p.root,r),sx:l,ownerState:h,children:[s(Ie,y({type:"checkbox",icon:b,checkedIcon:b,ref:o,ownerState:h},d,{classes:y({},p,{root:p.switchBase})})),s(Re,{className:p.track,ownerState:h})]})});var U=Ae;const A="1.5rem",F="1rem",O=e=>{const{techPoints:t,maxTechPoints:o,incomplete:n,showZero:r}=e,i=r||t!==null&&t>0,c=o!==null&&o>0;return f(T,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[s(C,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:m("techPointConfig.techPointShortColon")}),i&&s(C,{variant:"body1",textAlign:"right",sx:{fontSize:A},children:t!=null?t:0}),f(T,{direction:"row",alignItems:"center",children:[s(C,{variant:"body1",textAlign:"right",sx:{fontSize:i?F:A},color:i||!c?"text.secondary":"text.primary",children:`${i?"/ ":""}${c?`${o}`:"?"}`}),c&&n&&s(C,{variant:"body1",color:"text.secondary",sx:{fontSize:i?F:A},children:"+"})]})]})},De=e=>{const{shipConfig:t,onClickName:o}=e;return f(T,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},children:[s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f("div",{children:[s(C,{variant:"body1",children:s(te,{onClick:()=>{o(t.shipDefinition.id)},children:L(t.shipDefinition)})}),t.incomplete&&s(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),s(O,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete})]})},Oe=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:r}=e,i=o.selectedEnhancementIds.includes(n.id);return f(T,{spacing:1,direction:"row",children:[s("div",{children:s(U,{checked:i,onChange:()=>{r(t.shipDefinition.id,o.module.id,n.id)},disabled:!i&&!!o.module.skillSlots&&o.selectedEnhancementIds.length>=o.module.skillSlots})}),s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(T,{spacing:.5,sx:{flexGrow:1},children:[s(C,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((c,a)=>s(C,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:c},`property_${a}`)),n.enhancement.cost===null&&s(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.maxCostUnknown")})]})})]})},Be=e=>{var a;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:r}=e,{mode:i}=oe(),c=t.selectedModuleIds.includes(o.module.id);return f(T,{p:2,spacing:1,sx:{backgroundColor:i==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[f(T,{spacing:1,direction:"row",children:[s("div",{children:s(U,{checked:c,onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(E,{component:"div",sx:{flexGrow:1},children:[s(C,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${ne(t.shipDefinition.id,o.module)}`}),o.incomplete&&s(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),s(O,{techPoints:c?o.techPoints:0,maxTechPoints:o.maxTechPoints,incomplete:o.incomplete,showZero:!0})]}),c&&f(T,{spacing:3,pl:5,pt:1,pb:2,children:[s(C,{variant:"body1",color:"text.secondary",children:m("techPointConfig.enhancementSlotsColonValue",{value:`${o.selectedEnhancementIds.length} / ${(a=o.module.skillSlots)!=null?a:"?"}`})}),Object.values(o.enhancements).map(l=>s(Oe,{shipConfig:t,moduleConfig:o,enhancementConfig:l,onToggleEnhancement:r},l.id))]})]})},_e=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return f(T,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(r=>s(Be,{shipConfig:t,moduleConfig:r,onToggleModule:o,onToggleEnhancement:n},r.module.id)),s(T,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:s(O,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete})})]})},ze=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n}=e,{openShipDetailDialog:r}=ie();return s(ge,{expandables:Object.values(t.ships).map(i=>({id:i.shipDefinition.id,initiallyOpened:!1,expandIcon:s(fe,{}),summary:s(De,{shipConfig:i,onClickName:r}),details:s(_e,{shipConfig:i,onToggleModule:n,onToggleEnhancement:o})}))})},Ne=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:r,onReset:i,onCancel:c,onSave:a}=e,[l,d]=u.exports.useState(!1),h=u.exports.useCallback(()=>{d(!1),i()},[i]);return f($,{children:[s(xe,{left:p=>s($,{children:s(ae,{filter:t,onChange:r,buttonProps:p,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[x.AUXILIARY,x.CARRIER,x.BATTLE_CRUISER,x.CRUISER,x.CORVETTE]},"filter")}),right:p=>f($,{children:[s(M,{variant:"outlined",startIcon:s(ve,{}),onClick:()=>{d(!0)},disabled:!n,...p,children:m("button.reset")},"reset"),s(M,{variant:"outlined",startIcon:s(Te,{}),onClick:c,disabled:!o,...p,children:m("button.cancel")},"cancel"),s(M,{variant:"contained",startIcon:s(Ce,{}),onClick:a,disabled:!o,...p,children:m("button.save")},"save")]})}),l&&s(be,{title:m("button.reset"),question:m("techPointConfig.confirmReset"),cancelText:m("button.cancel"),confirmText:m("button.reset"),onCancel:()=>{d(!1)},onConfirm:h})]})};function D(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:Fe(n)}),{})}}function Fe(e){var i,c,a,l;const t=(c=(i=e.modules)==null?void 0:i.filter(d=>d.skillSlots!==0).reduce((d,h)=>({...d,[h.id]:je(h)}),{}))!=null?c:{},o=(l=(a=e.modules)==null?void 0:a.filter(d=>d.skillSlots!==0&&d.category==="STATIC"||d.defaultModule===!0).map(d=>d.id))!=null?l:[],n=G(t,o),r=J(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,incomplete:r}}function je(e){var n,r;const t=[...(n=e.flagshipEffects)!=null?n:[],...(r=e.skills)!=null?r:[]].filter(i=>!i.isDefault).reduce((i,c,a)=>{const l=`${c.type}_${a}`;return{...i,[l]:Le(c,l)}},{}),o=Ue(e);return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,incomplete:Ge(e)}}function Le(e,t){return{id:t,enhancement:e,techPoints:e.isDefault?null:e.cost}}function G(e,t){return Object.values(e).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function Ue(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(t=>t.cost).sort((t,o)=>(o!=null?o:0)-(t!=null?t:0)).slice(0,e.skillSlots).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),0)}function J(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function Ge(e){var t,o;return e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null)}function Je(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function Xe(e,t,o){var c;const n=(c=e.ships[t])!=null?c:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const i={...n,selectedModuleIds:Je(n,o)};return{...e,ships:{...e.ships,[t]:{...i,techPoints:X(i),maxTechPoints:G(i.modules,i.selectedModuleIds),incomplete:J(i.modules,i.selectedModuleIds)}}}}function Ze(e,t,o,n){var l,d,h;const r=(d=(l=e.ships[t])==null?void 0:l.modules[o])!=null?d:null;if(!r)throw new Error(`Missing config for "${t}", "${o}"`);const i=qe(r.selectedEnhancementIds,n);if(i.length>((h=r.module.skillSlots)!=null?h:0))return e;const c={...r,selectedEnhancementIds:i},a={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...c,techPoints:He(c)}}};return{...e,ships:{...e.ships,[t]:{...a,techPoints:X(a)}}}}function qe(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function X(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function He(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const R="tp";function Ve(){return!!window.localStorage.getItem(R)}function We(){window.localStorage.removeItem(R)}function Ye(e){const t=Ke(e);window.localStorage.setItem(R,JSON.stringify(t))}function j(e){const t=D(e),o=window.localStorage.getItem(R);if(!o)return t;let n;try{n=JSON.parse(o)}catch(r){return console.warn("Invalid tech point config",r),t}return Qe(t,n)}function Ke(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],r=[o,[]];Object.keys(n.modules).forEach(i=>{const c=n.modules[i],a=[i,c.selectedEnhancementIds];r[1].push(a)}),t.ships.push(r)}),t}function Qe(e,t){return t.ships.forEach(([o,n])=>{const r=e.ships[o];if(!r){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([i,c])=>{const a=r.modules[i];if(!a){console.warn(`Invalid moduleId "${i}"`);return}if(a.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${i}" (duplicate)`);return}c.forEach(l=>{var h,p,b,P;const d=a.enhancements[l];if(!d){console.warn(`Invalid enhancement "${l}"`);return}a.selectedEnhancementIds.push(l),a.techPoints=((h=a.techPoints)!=null?h:0)+((p=d.enhancement.cost)!=null?p:0),r.techPoints=((b=r.techPoints)!=null?b:0)+((P=d.enhancement.cost)!=null?P:0)})})}),e}const et=e=>{const{supportedShips:t,visibleShips:o}=e,[n,r]=u.exports.useState(()=>D([])),[i,c]=u.exports.useState(!1),[a,l]=u.exports.useState(Ve());u.exports.useEffect(()=>{const S=j(t);r(S)},[t]);const d=u.exports.useCallback((S,w)=>{c(!0),r(v=>Xe(v,S,w))},[]),h=u.exports.useCallback((S,w,v)=>{c(!0),r(Z=>Ze(Z,S,w,v))},[]),p=u.exports.useCallback(()=>{We();const S=D(t);r(S),c(!1),l(!1)},[t]),b=u.exports.useCallback(()=>{const S=j(t);r(S),c(!1)},[n]),P=u.exports.useCallback(()=>{Ye(n),c(!1),l(!0)},[n]);return{config:u.exports.useMemo(()=>({ships:o.reduce((S,w)=>{const v=n.ships[w.id];return v?{...S,[w.id]:v}:S},{})}),[n,o]),modified:i,stored:a,handleToggleModule:d,handleToggleEnhancement:h,handleReset:p,handleCancel:b,handleSave:P}},tt=[x.AUXILIARY,x.CARRIER,x.BATTLE_CRUISER,x.CRUISER,x.CORVETTE],Pt=()=>{const[e,t]=se(),[o,n]=u.exports.useState(()=>me(e.getAll("filter"),le()));u.exports.useEffect(()=>{t(z.techPointConfig.createSearchParams({filter:Se(o)}))},[o]);const r=u.exports.useMemo(()=>re.filter(v=>v.source===N.TECH_FILE||v.source===N.STARTER_SHIP).filter(v=>tt.includes(v.type)),[]),[i,c]=u.exports.useState(""),a=u.exports.useMemo(()=>de(r,o),[r,o]),l=u.exports.useMemo(()=>i?a.filter(v=>L(v).toLowerCase().includes(i)):a,[a,i]),{config:d,modified:h,stored:p,handleToggleModule:b,handleToggleEnhancement:P,handleReset:B,handleCancel:S,handleSave:w}=et({supportedShips:r,visibleShips:l});return f($,{children:[s(he,{currentRoute:z.techPointConfig.path}),s(Ne,{shipFilter:o,modified:h,stored:p,onFilterChange:n,onReset:B,onCancel:S,onSave:w}),s(ue,{children:f(T,{spacing:2,p:1,children:[f(T,{pt:1,pb:1,spacing:2,children:[s(C,{variant:"body2",children:m("techPointConfig.pageDescription1")}),s(C,{variant:"body2",children:m("techPointConfig.pageDescription2")})]}),s(we,{id:"searchShip",lowerCase:!0,value:i,placeholder:m("label.shipName"),onChange:c}),s(ze,{config:d,onToggleModule:b,onToggleEnhancement:P})]})}),s(pe,{})]})};export{Pt as TechPointConfigPage,Pt as default};
