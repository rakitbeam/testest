import{M as Re,k as r,C as Ee,D as Pe,E as z,L,_ as S,b7 as Ke,r as p,P as Fe,H as he,aW as $e,I as qe,ai as Me,bt as et,aj as ye,J as Ae,j as g,K as J,O as Te,b9 as tt,b8 as ot,x as R,T,t as y,aw as nt,v as te,aA as it,g as Ne,aL as st,f as rt,aI as ct,F as ee,c as P,B as ce,be as G,bs as at,av as xe,m as lt,a4 as we,bG as dt}from"./index.8ed0cfaa.js";import{g as ut,S as ht,c as pt,a as ft}from"./ShipTypeFilterButton.ee7d76f4.js";import{N as gt,P as mt}from"./PageContent.f051be8e.js";import{P as vt}from"./PageFooter.47cf4193.js";import{d as St,C as Ct}from"./ConfirmationDialog.ce47246e.js";import{E as bt}from"./ExpandStack.5a8901e3.js";import{v as yt}from"./visuallyHidden.c6275901.js";import{c as Tt,b as xt}from"./boolMapUtils.54d90c14.js";import{d as wt}from"./Save.66a8c280.js";import{d as kt,a as It}from"./DeleteForever.88ea55c7.js";import{A as Rt}from"./ActionBar.55480ac4.js";import{S as Et}from"./SearchInput.cc0b8667.js";import"./domUtils.8833d667.js";import"./MenuItem.79a5f276.js";import"./Popper.90175788.js";import"./ClickAwayListener.ddac4858.js";import"./useFormControl.0f9ff7c3.js";import"./ResponsiveDialog.b0ba2915.js";import"./DialogContentText.36054a09.js";import"./TextField.fe667313.js";import"./Select.fb302d68.js";import"./InputAdornment.e277a3c0.js";var Pt=Re(r("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Ft=Re(r("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function $t(e){return Ee("MuiRating",e)}const Mt=Pe("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]);var Z=Mt;const At=["value"],Nt=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Ot(e,t,o){return e<t?t:e>o?o:e}function Lt(e){const t=e.toString().split(".")[1];return t?t.length:0}function ae(e,t){if(e==null)return e;const o=Math.round(e/t)*t;return Number(o.toFixed(Lt(t)))}const zt=e=>{const{classes:t,size:o,readOnly:n,disabled:s,emptyValueFocused:i,focusVisible:c}=e,a={root:["root",`size${L(o)}`,s&&"disabled",c&&"focusVisible",n&&"readyOnly"],label:["label","pristine"],labelEmptyValue:[i&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return Ae(a,$t,t)},Vt=z("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[{[`& .${Z.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${L(o.size)}`],o.readOnly&&t.readOnly]}})(({theme:e,ownerState:t})=>S({display:"inline-flex",position:"relative",fontSize:e.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",WebkitTapHighlightColor:"transparent",[`&.${Z.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${Z.focusVisible} .${Z.iconActive}`]:{outline:"1px solid #999"},[`& .${Z.visuallyHidden}`]:yt},t.size==="small"&&{fontSize:e.typography.pxToRem(18)},t.size==="large"&&{fontSize:e.typography.pxToRem(30)},t.readOnly&&{pointerEvents:"none"})),Oe=z("label",{name:"MuiRating",slot:"Label",overridesResolver:(e,t)=>t.label})(({ownerState:e})=>S({cursor:"inherit"},e.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})),Bt=z("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.icon,o.iconEmpty&&t.iconEmpty,o.iconFilled&&t.iconFilled,o.iconHover&&t.iconHover,o.iconFocus&&t.iconFocus,o.iconActive&&t.iconActive]}})(({theme:e,ownerState:t})=>S({display:"flex",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),pointerEvents:"none"},t.iconActive&&{transform:"scale(1.2)"},t.iconEmpty&&{color:(e.vars||e).palette.action.disabled})),Dt=z("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>Ke(e)&&e!=="iconActive",overridesResolver:(e,t)=>{const{iconActive:o}=e;return[t.decimal,o&&t.iconActive]}})(({iconActive:e})=>S({position:"relative"},e&&{transform:"scale(1.2)"}));function _t(e){const t=he(e,At);return r("span",S({},t))}function ke(e){const{classes:t,disabled:o,emptyIcon:n,focus:s,getLabelText:i,highlightSelectedOnly:c,hover:a,icon:h,IconContainerComponent:l,isActive:u,itemValue:d,labelProps:C,name:x,onBlur:$,onChange:E,onClick:f,onFocus:w,readOnly:v,ownerState:k,ratingValue:N,ratingValueRounded:ne}=e,D=c?d===N:d<=N,Q=d<=a,_=d<=s,ie=d===ne,X=$e(),V=r(Bt,{as:l,value:d,className:J(t.icon,D?t.iconFilled:t.iconEmpty,Q&&t.iconHover,_&&t.iconFocus,u&&t.iconActive),ownerState:S({},k,{iconEmpty:!D,iconFilled:D,iconHover:Q,iconFocus:_,iconActive:u}),children:n&&!D?n:h});return v?r("span",S({},C,{children:V})):g(p.exports.Fragment,{children:[g(Oe,S({ownerState:S({},k,{emptyValueFocused:void 0}),htmlFor:X},C,{children:[V,r("span",{className:t.visuallyHidden,children:i(d)})]})),r("input",{className:t.visuallyHidden,onFocus:w,onBlur:$,onChange:E,onClick:f,disabled:o,value:d,id:X,type:"radio",name:x,checked:ie})]})}const Ht=r(Pt,{fontSize:"inherit"}),jt=r(Ft,{fontSize:"inherit"});function Ut(e){return`${e} Star${e!==1?"s":""}`}const Gt=p.exports.forwardRef(function(t,o){const n=Fe({name:"MuiRating",props:t}),{className:s,defaultValue:i=null,disabled:c=!1,emptyIcon:a=jt,emptyLabelText:h="Empty",getLabelText:l=Ut,highlightSelectedOnly:u=!1,icon:d=Ht,IconContainerComponent:C=_t,max:x=5,name:$,onChange:E,onChangeActive:f,onMouseLeave:w,onMouseMove:v,precision:k=1,readOnly:N=!1,size:ne="medium",value:D}=n,Q=he(n,Nt),_=$e($),[ie,X]=qe({controlled:D,default:i,name:"Rating"}),V=ae(ie,k),Be=Me(),[{hover:M,focus:K},W]=p.exports.useState({hover:-1,focus:-1});let H=V;M!==-1&&(H=M),K!==-1&&(H=K);const{isFocusVisibleRef:ve,onBlur:De,onFocus:_e,ref:He}=et(),[je,se]=p.exports.useState(!1),Se=p.exports.useRef(),Ue=ye(He,Se),Ge=ye(Ue,o),Xe=m=>{v&&v(m);const b=Se.current,{right:F,left:q}=b.getBoundingClientRect(),{width:j}=b.firstChild.getBoundingClientRect();let U;Be.direction==="rtl"?U=(F-m.clientX)/(j*x):U=(m.clientX-q)/(j*x);let A=ae(x*U+k/2,k);A=Ot(A,k,x),W(B=>B.hover===A&&B.focus===A?B:{hover:A,focus:A}),se(!1),f&&M!==A&&f(m,A)},We=m=>{w&&w(m);const b=-1;W({hover:b,focus:b}),f&&M!==b&&f(m,b)},Ce=m=>{let b=m.target.value===""?null:parseFloat(m.target.value);M!==-1&&(b=M),X(b),E&&E(m,b)},Ye=m=>{m.clientX===0&&m.clientY===0||(W({hover:-1,focus:-1}),X(null),E&&parseFloat(m.target.value)===V&&E(m,null))},Ze=m=>{_e(m),ve.current===!0&&se(!0);const b=parseFloat(m.target.value);W(F=>({hover:F.hover,focus:b}))},Je=m=>{if(M!==-1)return;De(m),ve.current===!1&&se(!1);const b=-1;W(F=>({hover:F.hover,focus:b}))},[Qe,be]=p.exports.useState(!1),Y=S({},n,{defaultValue:i,disabled:c,emptyIcon:a,emptyLabelText:h,emptyValueFocused:Qe,focusVisible:je,getLabelText:l,icon:d,IconContainerComponent:C,max:x,precision:k,readOnly:N,size:ne}),O=zt(Y);return g(Vt,S({ref:Ge,onMouseMove:Xe,onMouseLeave:We,className:J(O.root,s),ownerState:Y,role:N?"img":null,"aria-label":N?l(H):null},Q,{children:[Array.from(new Array(x)).map((m,b)=>{const F=b+1,q={classes:O,disabled:c,emptyIcon:a,focus:K,getLabelText:l,highlightSelectedOnly:u,hover:M,icon:d,IconContainerComponent:C,name:_,onBlur:Je,onChange:Ce,onClick:Ye,onFocus:Ze,ratingValue:H,ratingValueRounded:V,readOnly:N,ownerState:Y},j=F===Math.ceil(H)&&(M!==-1||K!==-1);if(k<1){const U=Array.from(new Array(1/k));return r(Dt,{className:J(O.decimal,j&&O.iconActive),ownerState:Y,iconActive:j,children:U.map((A,B)=>{const re=ae(F-1+(B+1)*k,k);return r(ke,S({},q,{isActive:!1,itemValue:re,labelProps:{style:U.length-1===B?{}:{width:re===H?`${(B+1)*k*100}%`:"0%",overflow:"hidden",position:"absolute"}}}),re)})},F)}return r(ke,S({},q,{isActive:j,itemValue:F}),F)}),!N&&!c&&g(Oe,{className:J(O.label,O.labelEmptyValue),ownerState:Y,children:[r("input",{className:O.visuallyHidden,value:"",id:`${_}-empty`,type:"radio",name:_,checked:V==null,onFocus:()=>be(!0),onBlur:()=>be(!1),onChange:Ce}),r("span",{className:O.visuallyHidden,children:h})]})]}))});var Xt=Gt;function Wt(e){return Ee("MuiSwitch",e)}const Yt=Pe("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var I=Yt;const Zt=["className","color","edge","size","sx"],Jt=e=>{const{classes:t,edge:o,size:n,color:s,checked:i,disabled:c}=e,a={root:["root",o&&`edge${L(o)}`,`size${L(n)}`],switchBase:["switchBase",`color${L(s)}`,i&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=Ae(a,Wt,t);return S({},t,h)},Qt=z("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${L(o.edge)}`],t[`size${L(o.size)}`]]}})(({ownerState:e})=>S({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${I.thumb}`]:{width:16,height:16},[`& .${I.switchBase}`]:{padding:4,[`&.${I.checked}`]:{transform:"translateX(16px)"}}})),Kt=z(ut,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${I.input}`]:t.input},o.color!=="default"&&t[`color${L(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${I.checked}`]:{transform:"translateX(20px)"},[`&.${I.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${I.checked} + .${I.track}`]:{opacity:.5},[`&.${I.disabled} + .${I.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${I.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>S({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${I.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Te(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${I.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?tt(e.palette[t.color].main,.62):ot(e.palette[t.color].main,.55)}`}},[`&.${I.checked} + .${I.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),qt=z("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),eo=z("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),to=p.exports.forwardRef(function(t,o){const n=Fe({props:t,name:"MuiSwitch"}),{className:s,color:i="primary",edge:c=!1,size:a="medium",sx:h}=n,l=he(n,Zt),u=S({},n,{color:i,edge:c,size:a}),d=Jt(u),C=r(eo,{className:d.thumb,ownerState:u});return g(Qt,{className:J(d.root,s),sx:h,ownerState:u,children:[r(Kt,S({type:"checkbox",icon:C,checkedIcon:C,ref:o,ownerState:u},l,{classes:S({},d,{root:d.switchBase})})),r(qt,{className:d.track,ownerState:u})]})});var Le=to;const le="1.5rem",Ie="1rem",pe=e=>{const{techPoints:t,maxTechPoints:o,unlockCost:n,selected:s,incomplete:i,showZero:c}=e,a=s===!0&&n!==null&&n>0,h=(t!=null?t:0)+(a&&n!=null?n:0),l=(o!=null?o:0)+(a&&n!=null?n:0),u=s===!0||c||t!==null&&t>0,d=a||o!==null&&o>0;return g(R,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[r(T,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:y("techPointConfig.techPointShortColon")}),u&&r(T,{variant:"body1",textAlign:"right",sx:{fontSize:le},children:`${h}`}),g(R,{direction:"row",alignItems:"center",children:[r(T,{variant:"body1",textAlign:"right",sx:{fontSize:u?Ie:le},color:u||!d?"text.secondary":"text.primary",children:`${u?"/ ":""}${d?`${l}`:"?"}`}),d&&i&&r(T,{variant:"body1",color:"text.secondary",sx:{fontSize:u?Ie:le},children:"+"})]})]})},oo=e=>{const{shipId:t,selected:o,onToggle:n}=e,s=Me(),i=nt(s.breakpoints.up("sm"));return r(Xt,{name:"toggle-favorite",size:i?"medium":"small",value:o?1:0,onChange:()=>{n(t)},max:1})},no=e=>{const{shipConfig:t,onClickName:o,onToggleFavorite:n}=e;return g(R,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},justifyContent:"end",flexWrap:"wrap",children:[r(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g("div",{children:[g(R,{spacing:1,direction:"row",alignItems:"center",children:[r(T,{variant:"body1",children:r(it,{onClick:()=>{o(t.shipDefinition.id)},children:Ne(t.shipDefinition)})}),r(oo,{shipId:t.shipDefinition.id,selected:t.favorite,onToggle:n})]}),t.incomplete&&r(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),r(pe,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,unlockCost:0,incomplete:t.incomplete})]})};function ue(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:io(n)}),{})}}function io(e){var c,a,h,l;const t=(a=(c=e.modules)==null?void 0:c.filter(u=>u.skillSlots!==0).reduce((u,d)=>({...u,[d.id]:so(d)}),{}))!=null?a:{},o=(l=(h=e.modules)==null?void 0:h.filter(u=>u.skillSlots!==0&&u.category==="STATIC"||u.defaultModule===!0).map(u=>u.id))!=null?l:[],n=fe(t,o),s=ge(t,o),i=me(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,unlockCost:s,incomplete:i,favorite:!1}}function so(e){var s,i;const t=[...(s=e.flagshipEffects)!=null?s:[],...(i=e.skills)!=null?i:[]].filter(c=>Number.isFinite(c.cost)&&Number(c.cost)>0).reduce((c,a,h)=>{const l=`${a.type}_${h}`;return{...c,[l]:ro(a,l)}},{}),o=co(e),n=e.category!=="STATIC"&&!e.defaultModule?10:0;return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,unlockCost:n,incomplete:ao(e)}}function ro(e,t){return{id:t,enhancement:e,techPoints:e.cost}}function fe(e,t){return Object.keys(e).map(o=>e[o]).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function ge(e,t){return Object.keys(e).map(o=>t.includes(o)?e[o].unlockCost:0).reduce((o,n)=>o+n,0)}function co(e){var n,s;if(!e.skillSlots||!e.skills||e.skills.length===0)return null;const t=[...e.skills,...(n=e.flagshipEffects)!=null?n:[]].filter(i=>i.isDefault&&i.cost!==null).map(i=>Number(i.cost)).reduce((i,c)=>(i!=null?i:0)+(c!=null?c:0),0),o=[...e.skills,...(s=e.flagshipEffects)!=null?s:[]].filter(i=>!i.isDefault&&Number.isFinite(i.cost)).map(i=>Number(i.cost)).sort((i,c)=>(c!=null?c:0)-(i!=null?i:0)).slice(0,e.skillSlots).reduce((i,c)=>(i!=null?i:0)+(c!=null?c:0),0);return t+o}function me(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function ao(e){var t,o;return e.skillSlots?!e.skillSlots||e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null):!0}function lo(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function uo(e,t,o){var c;const n=(c=e.ships[t])!=null?c:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const i={...n,selectedModuleIds:lo(n,o)};return{...e,ships:{...e.ships,[t]:{...i,techPoints:Ve(i),maxTechPoints:fe(i.modules,i.selectedModuleIds),unlockCost:ge(i.modules,i.selectedModuleIds),incomplete:me(i.modules,i.selectedModuleIds)}}}}function ze(e,t){const o=e.filter(n=>{const{isDefault:s,cost:i}=t.enhancements[n].enhancement;return!s&&i!==null&&i>0}).length;return!!t.module.skillSlots&&o>t.module.skillSlots}function ho(e,t,o,n){var h,l;const s=(l=(h=e.ships[t])==null?void 0:h.modules[o])!=null?l:null;if(!s)throw new Error(`Missing config for "${t}", "${o}"`);const i=fo(s.selectedEnhancementIds,n);if(ze(i,s))return console.log("No more slots available"),e;const c={...s,selectedEnhancementIds:i},a={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...c,techPoints:go(c)}}};return{...e,ships:{...e.ships,[t]:{...a,techPoints:Ve(a)}}}}function po(e,t){return{...e,ships:{...e.ships,[t]:{...e.ships[t],favorite:!e.ships[t].favorite}}}}function fo(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function Ve(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function go(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const mo=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:s}=e,i=o.selectedEnhancementIds.includes(n.id),c=ze([...o.selectedEnhancementIds,n.id],o);return g(R,{spacing:1,direction:"row",children:[r("div",{children:r(Le,{checked:i,color:n.enhancement.isDefault?"secondary":"primary",onChange:()=>{s(t.shipDefinition.id,o.module.id,n.id)},disabled:!i&&c})}),r(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(R,{spacing:.5,sx:{flexGrow:1},children:[r(T,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((a,h)=>r(T,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:a},`property_${h}`)),n.enhancement.cost===null&&r(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.maxCostUnknown")})]})})]})},vo=e=>{var h;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:s}=e,{mode:i}=st(),c=t.selectedModuleIds.includes(o.module.id),a=o.selectedEnhancementIds.filter(l=>!o.enhancements[l].enhancement.isDefault).length;return g(R,{p:2,spacing:1,sx:{backgroundColor:i==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[g(R,{spacing:1,direction:"row",children:[r("div",{children:r(Le,{checked:c,disabled:o.module.category==="STATIC",onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),r(te,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(te,{component:"div",sx:{flexGrow:1},children:[r(T,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${rt(t.shipDefinition.id,o.module)}`}),o.incomplete&&r(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]})}),r(pe,{techPoints:c?o.techPoints:0,maxTechPoints:o.maxTechPoints,unlockCost:o.module.category!=="STATIC"&&!o.module.defaultModule?10:null,selected:c,incomplete:o.incomplete,showZero:!0})]}),c&&g(R,{spacing:3,pl:5,pt:1,pb:2,children:[g("div",{children:[r(T,{variant:"body1",color:"text.secondary",children:y("techPointConfig.enhancementSlotsColonValue",{value:`${a} / ${(h=o.module.skillSlots)!=null?h:"?"}`})}),!o.module.skillSlots&&r(T,{variant:"body2",sx:{color:"red"},children:y("techPointConfig.incomplete")})]}),Object.values(o.enhancements).map(l=>r(mo,{shipConfig:t,moduleConfig:o,enhancementConfig:l,onToggleEnhancement:s},l.id))]})]})},So=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return g(R,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(s=>r(vo,{shipConfig:t,moduleConfig:s,onToggleModule:o,onToggleEnhancement:n},s.module.id)),r(R,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:r(pe,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete,unlockCost:0})})]})},Co=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n,onToggleFavorite:s}=e,{openShipDetailDialog:i}=ct(),c=p.exports.useMemo(()=>{const a=[],h=[];return Object.values(t.ships).forEach(l=>{(l.favorite?a:h).push(l)}),[...a,...h]},[t]);return r(bt,{expandables:c.map(a=>({id:a.shipDefinition.id,initiallyOpened:!1,expandIcon:r(St,{}),summary:r(no,{shipConfig:a,onClickName:i,onToggleFavorite:s}),details:r(So,{shipConfig:a,onToggleModule:n,onToggleEnhancement:o})}))})},bo=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:s,onReset:i,onCancel:c,onSave:a}=e,[h,l]=p.exports.useState(!1),u=p.exports.useCallback(()=>{l(!1),i()},[i]);return g(ee,{children:[r(Rt,{left:d=>r(ee,{children:r(ht,{filter:t,onChange:s,buttonProps:d,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[P.AUXILIARY,P.CARRIER,P.BATTLE_CRUISER,P.CRUISER,P.CORVETTE,P.FIGHTER]},"filter")}),right:d=>g(ee,{children:[r(ce,{variant:"outlined",startIcon:r(kt,{}),onClick:()=>{l(!0)},disabled:!n,...d,children:y("button.reset")},"reset"),r(ce,{variant:"outlined",startIcon:r(It,{}),onClick:c,disabled:!o,...d,children:y("button.cancel")},"cancel"),r(ce,{variant:"contained",startIcon:r(wt,{}),onClick:a,disabled:!o,...d,children:y("button.save")},"save")]})}),h&&r(Ct,{title:y("button.reset"),question:y("techPointConfig.confirmReset"),cancelText:y("button.cancel"),confirmText:y("button.reset"),onCancel:()=>{l(!1)},onConfirm:u})]})},oe="tp";function yo(){return!!window.localStorage.getItem(oe)}function To(){window.localStorage.removeItem(oe)}function xo(e){const t=wo(e);window.localStorage.setItem(oe,JSON.stringify(t))}function de(e){const t=ue(e),o=window.localStorage.getItem(oe);if(!o)return t;let n;try{n=JSON.parse(o)}catch(s){return console.warn("Invalid tech point config",s),t}return ko(t,n)}function wo(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],s=[o,[]];Object.keys(n.modules).forEach(i=>{const c=n.modules[i],a=n.selectedModuleIds.includes(i)?1:0,h=n.favorite?1:0,l=[i,c.selectedEnhancementIds,a,h];s[1].push(l)}),t.ships.push(s)}),t}function ko(e,t){return t.ships.forEach(([o,n])=>{const s=e.ships[o];if(!s){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([i,c,a,h])=>{const l=s.modules[i];if(!l){console.warn(`Invalid moduleId "${i}" for ship ${s.shipDefinition.id}`);return}if(l.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${i}" (duplicate)`);return}if(c.forEach(u=>{var C,x,$,E;const d=l.enhancements[u];if(!d){console.warn(`Invalid enhancement "${u}"`);return}l.selectedEnhancementIds.push(u),l.techPoints=((C=l.techPoints)!=null?C:0)+((x=d.enhancement.cost)!=null?x:0),s.techPoints=(($=s.techPoints)!=null?$:0)+((E=d.enhancement.cost)!=null?E:0)}),a===1&&!s.selectedModuleIds.includes(i)){const u=Object.keys(s.modules).filter(d=>{const{category:C}=s.modules[d].module;return C!=="STATIC"&&C===l.module.category});s.selectedModuleIds=[...s.selectedModuleIds.filter(d=>!u.includes(d)),i]}s.favorite=h===1}),s.maxTechPoints=fe(s.modules,s.selectedModuleIds),s.unlockCost=ge(s.modules,s.selectedModuleIds),s.incomplete=me(s.modules,s.selectedModuleIds)}),e}const Io=e=>{const{supportedShips:t,visibleShips:o}=e,[n,s]=p.exports.useState(()=>ue([])),[i,c]=p.exports.useState(!1),[a,h]=p.exports.useState(yo());p.exports.useEffect(()=>{const f=de(t);s(f)},[t]);const l=p.exports.useCallback((f,w)=>{c(!0),s(v=>uo(v,f,w))},[]),u=p.exports.useCallback((f,w,v)=>{c(!0),s(k=>ho(k,f,w,v))},[]),d=p.exports.useCallback(f=>{c(!0),s(w=>po(w,f))},[]),C=p.exports.useCallback(()=>{To();const f=ue(t);s(f),c(!1),h(!1)},[t]),x=p.exports.useCallback(()=>{const f=de(t);s(f),c(!1)},[n,t]),$=p.exports.useCallback(()=>{xo(n);const f=de(t);s(f),c(!1),h(!0)},[n,t]);return{config:p.exports.useMemo(()=>({ships:o.reduce((f,w)=>{const v=n.ships[w.id];return v?{...f,[w.id]:v}:f},{})}),[n,o]),modified:i,stored:a,handleToggleModule:l,handleToggleEnhancement:u,handleToggleFavorite:d,handleReset:C,handleCancel:x,handleSave:$}},Ro=[P.AUXILIARY,P.CARRIER,P.BATTLE_CRUISER,P.CRUISER,P.CORVETTE,P.FIGHTER],Eo=[G.WINGED_HUSSAR_C,G.MARE_IMBRIUM_A,G.MARE_TRANQUILLITATIS_B,G.MARE_TRANQUILLITATIS_C,G.XENO_STINGER_A,G.XENO_STINGER_B],Qo=()=>{const[e,t]=at(),[o,n]=p.exports.useState(()=>Tt(e.getAll("filter"),pt()));p.exports.useEffect(()=>{t(xe.techPointConfig.createSearchParams({filter:xt(o)}))},[o]);const s=p.exports.useMemo(()=>lt.filter(v=>v.source===we.TECH_FILE||v.source===we.STARTER_SHIP).filter(v=>Ro.includes(v.type)||Eo.includes(v.id)),[]),[i,c]=p.exports.useState(""),a=p.exports.useMemo(()=>{const v=ft(s,o);return dt(v)},[s,o]),h=p.exports.useMemo(()=>i?a.filter(v=>Ne(v).toLowerCase().includes(i)):a,[a,i]),{config:l,modified:u,stored:d,handleToggleModule:C,handleToggleEnhancement:x,handleToggleFavorite:$,handleReset:E,handleCancel:f,handleSave:w}=Io({supportedShips:s,visibleShips:h});return g(ee,{children:[r(gt,{currentRoute:xe.techPointConfig.path}),r(bo,{shipFilter:o,modified:u,stored:d,onFilterChange:n,onReset:E,onCancel:f,onSave:w}),r(mt,{children:g(R,{spacing:2,p:1,children:[g(R,{pt:1,pb:1,spacing:2,children:[r(T,{variant:"body2",children:y("techPointConfig.pageDescription1")}),r(T,{variant:"body2",children:y("techPointConfig.pageDescription2")}),r(T,{variant:"body2",children:y("techPointConfig.pageDescription3")})]}),r(Et,{id:"searchShip",lowerCase:!0,value:i,placeholder:y("label.shipName"),onChange:c}),r(Co,{config:l,onToggleModule:C,onToggleEnhancement:x,onToggleFavorite:$})]})}),r(vt,{})]})};export{Qo as TechPointConfigPage,Qo as default};
