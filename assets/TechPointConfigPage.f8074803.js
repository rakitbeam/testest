import{C as H,A as V,D as R,K as P,_ as y,N as F,b7 as W,b6 as Y,r as p,O as K,G as Q,k as i,j as f,J as ee,I as te,w as v,T as C,t as m,q as E,az as oe,g as J,aJ as ne,f as se,aG as ie,F as $,c as b,B as A,bq as ce,au as L,m as re,a3 as U}from"./index.4e0e661f.js";import{g as le,S as ae,c as de,a as ue}from"./ShipTypeFilterButton.d90a129d.js";import{N as he,P as pe}from"./PageContent.7ce2bcda.js";import{P as fe}from"./PageFooter.a7f9fe59.js";import{d as ge}from"./Settings.3e98ee6a.js";import{E as me}from"./ExpandStack.1ddfda4f.js";import{c as Se,b as Ce}from"./boolMapUtils.54d90c14.js";import{d as Te}from"./Save.c05afbb1.js";import{d as ve,a as be}from"./DeleteForever.2d03a3f6.js";import{A as xe}from"./ActionBar.723d3658.js";import{C as ke}from"./ConfirmationDialog.75ba44f1.js";import{S as we}from"./SearchInput.13ecd9f0.js";import"./domUtils.4f8d4a17.js";import"./MenuItem.2ccb34fa.js";import"./Popper.efcbd08f.js";import"./ClickAwayListener.0b079662.js";import"./useFormControl.a18fc251.js";import"./ResponsiveDialog.37450837.js";import"./DialogContentText.0ee5aa1e.js";import"./TextField.b2f721f2.js";import"./Select.8cbefb07.js";import"./InputAdornment.2ed06a41.js";function Pe(e){return V("MuiSwitch",e)}const ye=H("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var S=ye;const Ie=["className","color","edge","size","sx"],$e=e=>{const{classes:t,edge:o,size:n,color:s,checked:c,disabled:r}=e,a={root:["root",o&&`edge${P(o)}`,`size${P(n)}`],switchBase:["switchBase",`color${P(s)}`,c&&"checked",r&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=te(a,Pe,t);return y({},t,d)},Ee=R("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${P(o.edge)}`],t[`size${P(o.size)}`]]}})(({ownerState:e})=>y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${S.thumb}`]:{width:16,height:16},[`& .${S.switchBase}`]:{padding:4,[`&.${S.checked}`]:{transform:"translateX(16px)"}}})),Re=R(le,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${S.input}`]:t.input},o.color!=="default"&&t[`color${P(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${S.checked}`]:{transform:"translateX(20px)"},[`&.${S.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${S.checked} + .${S.track}`]:{opacity:.5},[`&.${S.disabled} + .${S.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${S.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>y({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:F(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${S.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:F(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${S.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?W(e.palette[t.color].main,.62):Y(e.palette[t.color].main,.55)}`}},[`&.${S.checked} + .${S.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Me=R("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Ae=R("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Oe=p.exports.forwardRef(function(t,o){const n=K({props:t,name:"MuiSwitch"}),{className:s,color:c="primary",edge:r=!1,size:a="medium",sx:d}=n,h=Q(n,Ie),l=y({},n,{color:c,edge:r,size:a}),u=$e(l),x=i(Ae,{className:u.thumb,ownerState:l});return f(Ee,{className:ee(u.root,s),sx:d,ownerState:l,children:[i(Re,y({type:"checkbox",icon:x,checkedIcon:x,ref:o,ownerState:l},h,{classes:y({},u,{root:u.switchBase})})),i(Me,{className:u.track,ownerState:l})]})});var X=Oe;const O="1.5rem",G="1rem",N=e=>{const{techPoints:t,maxTechPoints:o,unlockCost:n,selected:s,incomplete:c,showZero:r}=e,a=s===!0&&n!==null&&n>0,d=(t!=null?t:0)+(a&&n!=null?n:0),h=(o!=null?o:0)+(a&&n!=null?n:0),l=s===!0||r||t!==null&&t>0,u=a||o!==null&&o>0;return f(v,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[i(C,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:m("techPointConfig.techPointShortColon")}),l&&i(C,{variant:"body1",textAlign:"right",sx:{fontSize:O},children:`${d}`}),f(v,{direction:"row",alignItems:"center",children:[i(C,{variant:"body1",textAlign:"right",sx:{fontSize:l?G:O},color:l||!u?"text.secondary":"text.primary",children:`${l?"/ ":""}${u?`${h}`:"?"}`}),u&&c&&i(C,{variant:"body1",color:"text.secondary",sx:{fontSize:l?G:O},children:"+"})]})]})},De=e=>{const{shipConfig:t,onClickName:o}=e;return f(v,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},children:[i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f("div",{children:[i(C,{variant:"body1",children:i(oe,{onClick:()=>{o(t.shipDefinition.id)},children:J(t.shipDefinition)})}),t.incomplete&&i(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),i(N,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,unlockCost:0,incomplete:t.incomplete})]})},Be=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:s}=e,c=o.selectedEnhancementIds.includes(n.id);return f(v,{spacing:1,direction:"row",children:[i("div",{children:i(X,{checked:c,onChange:()=>{s(t.shipDefinition.id,o.module.id,n.id)},disabled:!c&&!!o.module.skillSlots&&o.selectedEnhancementIds.length>=o.module.skillSlots})}),i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(v,{spacing:.5,sx:{flexGrow:1},children:[i(C,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((r,a)=>i(C,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:r},`property_${a}`)),n.enhancement.cost===null&&i(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.maxCostUnknown")})]})})]})},Ne=e=>{var a;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:s}=e,{mode:c}=ne(),r=t.selectedModuleIds.includes(o.module.id);return f(v,{p:2,spacing:1,sx:{backgroundColor:c==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[f(v,{spacing:1,direction:"row",children:[i("div",{children:i(X,{checked:r,disabled:o.module.category==="STATIC",onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),i(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:f(E,{component:"div",sx:{flexGrow:1},children:[i(C,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${se(t.shipDefinition.id,o.module)}`}),o.incomplete&&i(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]})}),i(N,{techPoints:r?o.techPoints:0,maxTechPoints:o.maxTechPoints,unlockCost:o.module.category!=="STATIC"&&!o.module.defaultModule?10:null,selected:r,incomplete:o.incomplete,showZero:!0})]}),r&&f(v,{spacing:3,pl:5,pt:1,pb:2,children:[f("div",{children:[i(C,{variant:"body1",color:"text.secondary",children:m("techPointConfig.enhancementSlotsColonValue",{value:`${o.selectedEnhancementIds.length} / ${(a=o.module.skillSlots)!=null?a:"?"}`})}),!o.module.skillSlots&&i(C,{variant:"body2",sx:{color:"red"},children:m("techPointConfig.incomplete")})]}),Object.values(o.enhancements).map(d=>i(Be,{shipConfig:t,moduleConfig:o,enhancementConfig:d,onToggleEnhancement:s},d.id))]})]})},_e=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return f(v,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(s=>i(Ne,{shipConfig:t,moduleConfig:s,onToggleModule:o,onToggleEnhancement:n},s.module.id)),i(v,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:i(N,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete,unlockCost:0})})]})},ze=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n}=e,{openShipDetailDialog:s}=ie();return i(me,{expandables:Object.values(t.ships).map(c=>({id:c.shipDefinition.id,initiallyOpened:!1,expandIcon:i(ge,{}),summary:i(De,{shipConfig:c,onClickName:s}),details:i(_e,{shipConfig:c,onToggleModule:n,onToggleEnhancement:o})}))})},je=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:s,onReset:c,onCancel:r,onSave:a}=e,[d,h]=p.exports.useState(!1),l=p.exports.useCallback(()=>{h(!1),c()},[c]);return f($,{children:[i(xe,{left:u=>i($,{children:i(ae,{filter:t,onChange:s,buttonProps:u,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[b.AUXILIARY,b.CARRIER,b.BATTLE_CRUISER,b.CRUISER,b.CORVETTE]},"filter")}),right:u=>f($,{children:[i(A,{variant:"outlined",startIcon:i(ve,{}),onClick:()=>{h(!0)},disabled:!n,...u,children:m("button.reset")},"reset"),i(A,{variant:"outlined",startIcon:i(be,{}),onClick:r,disabled:!o,...u,children:m("button.cancel")},"cancel"),i(A,{variant:"contained",startIcon:i(Te,{}),onClick:a,disabled:!o,...u,children:m("button.save")},"save")]})}),d&&i(ke,{title:m("button.reset"),question:m("techPointConfig.confirmReset"),cancelText:m("button.cancel"),confirmText:m("button.reset"),onCancel:()=>{h(!1)},onConfirm:l})]})};function B(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:Fe(n)}),{})}}function Fe(e){var r,a,d,h;const t=(a=(r=e.modules)==null?void 0:r.filter(l=>l.skillSlots!==0).reduce((l,u)=>({...l,[u.id]:Le(u)}),{}))!=null?a:{},o=(h=(d=e.modules)==null?void 0:d.filter(l=>l.skillSlots!==0&&l.category==="STATIC"||l.defaultModule===!0).map(l=>l.id))!=null?h:[],n=_(t,o),s=z(t,o),c=j(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,unlockCost:s,incomplete:c}}function Le(e){var s,c;const t=[...(s=e.flagshipEffects)!=null?s:[],...(c=e.skills)!=null?c:[]].filter(r=>!r.isDefault).reduce((r,a,d)=>{const h=`${a.type}_${d}`;return{...r,[h]:Ue(a,h)}},{}),o=Ge(e),n=e.category!=="STATIC"&&!e.defaultModule?10:0;return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,unlockCost:n,incomplete:Je(e)}}function Ue(e,t){return{id:t,enhancement:e,techPoints:e.isDefault?null:e.cost}}function _(e,t){return Object.keys(e).map(o=>e[o]).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function z(e,t){return Object.keys(e).map(o=>t.includes(o)?e[o].unlockCost:0).reduce((o,n)=>o+n,0)}function Ge(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(t=>t.cost).sort((t,o)=>(o!=null?o:0)-(t!=null?t:0)).slice(0,e.skillSlots).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),0)}function j(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function Je(e){var t,o;return e.skillSlots?!e.skillSlots||e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null):!0}function Xe(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function Ze(e,t,o){var r;const n=(r=e.ships[t])!=null?r:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const c={...n,selectedModuleIds:Xe(n,o)};return{...e,ships:{...e.ships,[t]:{...c,techPoints:Z(c),maxTechPoints:_(c.modules,c.selectedModuleIds),unlockCost:z(c.modules,c.selectedModuleIds),incomplete:j(c.modules,c.selectedModuleIds)}}}}function qe(e,t,o,n){var d,h;const s=(h=(d=e.ships[t])==null?void 0:d.modules[o])!=null?h:null;if(!s)throw new Error(`Missing config for "${t}", "${o}"`);const c=He(s.selectedEnhancementIds,n);if(!!s.module.skillSlots&&c.length>s.module.skillSlots)return e;const r={...s,selectedEnhancementIds:c},a={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...r,techPoints:Ve(r)}}};return{...e,ships:{...e.ships,[t]:{...a,techPoints:Z(a)}}}}function He(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function Z(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function Ve(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const M="tp";function We(){return!!window.localStorage.getItem(M)}function Ye(){window.localStorage.removeItem(M)}function Ke(e){const t=Qe(e);window.localStorage.setItem(M,JSON.stringify(t))}function D(e){const t=B(e),o=window.localStorage.getItem(M);if(!o)return t;let n;try{n=JSON.parse(o)}catch(s){return console.warn("Invalid tech point config",s),t}return et(t,n)}function Qe(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],s=[o,[]];Object.keys(n.modules).forEach(c=>{const r=n.modules[c],a=n.selectedModuleIds.includes(c)?1:0,d=[c,r.selectedEnhancementIds,a];s[1].push(d)}),t.ships.push(s)}),t}function et(e,t){return t.ships.forEach(([o,n])=>{const s=e.ships[o];if(!s){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([c,r,a])=>{const d=s.modules[c];if(!d){console.warn(`Invalid moduleId "${c}"`);return}if(d.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${c}" (duplicate)`);return}if(r.forEach(h=>{var u,x,w,I;const l=d.enhancements[h];if(!l){console.warn(`Invalid enhancement "${h}"`);return}d.selectedEnhancementIds.push(h),d.techPoints=((u=d.techPoints)!=null?u:0)+((x=l.enhancement.cost)!=null?x:0),s.techPoints=((w=s.techPoints)!=null?w:0)+((I=l.enhancement.cost)!=null?I:0)}),a===1&&!s.selectedModuleIds.includes(c)){const h=Object.keys(s.modules).filter(l=>{const{category:u}=s.modules[l].module;return u!=="STATIC"&&u===d.module.category});s.selectedModuleIds=[...s.selectedModuleIds.filter(l=>!h.includes(l)),c]}}),s.maxTechPoints=_(s.modules,s.selectedModuleIds),s.unlockCost=z(s.modules,s.selectedModuleIds),s.incomplete=j(s.modules,s.selectedModuleIds)}),e}const tt=e=>{const{supportedShips:t,visibleShips:o}=e,[n,s]=p.exports.useState(()=>B([])),[c,r]=p.exports.useState(!1),[a,d]=p.exports.useState(We());p.exports.useEffect(()=>{const g=D(t);s(g)},[t]);const h=p.exports.useCallback((g,k)=>{r(!0),s(T=>Ze(T,g,k))},[]),l=p.exports.useCallback((g,k,T)=>{r(!0),s(q=>qe(q,g,k,T))},[]),u=p.exports.useCallback(()=>{Ye();const g=B(t);s(g),r(!1),d(!1)},[t]),x=p.exports.useCallback(()=>{const g=D(t);s(g),r(!1)},[n,t]),w=p.exports.useCallback(()=>{Ke(n);const g=D(t);s(g),r(!1),d(!0)},[n,t]);return{config:p.exports.useMemo(()=>({ships:o.reduce((g,k)=>{const T=n.ships[k.id];return T?{...g,[k.id]:T}:g},{})}),[n,o]),modified:c,stored:a,handleToggleModule:h,handleToggleEnhancement:l,handleReset:u,handleCancel:x,handleSave:w}},ot=[b.AUXILIARY,b.CARRIER,b.BATTLE_CRUISER,b.CRUISER,b.CORVETTE],Pt=()=>{const[e,t]=ce(),[o,n]=p.exports.useState(()=>Se(e.getAll("filter"),de()));p.exports.useEffect(()=>{t(L.techPointConfig.createSearchParams({filter:Ce(o)}))},[o]);const s=p.exports.useMemo(()=>re.filter(T=>T.source===U.TECH_FILE||T.source===U.STARTER_SHIP).filter(T=>ot.includes(T.type)),[]),[c,r]=p.exports.useState(""),a=p.exports.useMemo(()=>ue(s,o),[s,o]),d=p.exports.useMemo(()=>c?a.filter(T=>J(T).toLowerCase().includes(c)):a,[a,c]),{config:h,modified:l,stored:u,handleToggleModule:x,handleToggleEnhancement:w,handleReset:I,handleCancel:g,handleSave:k}=tt({supportedShips:s,visibleShips:d});return f($,{children:[i(he,{currentRoute:L.techPointConfig.path}),i(je,{shipFilter:o,modified:l,stored:u,onFilterChange:n,onReset:I,onCancel:g,onSave:k}),i(pe,{children:f(v,{spacing:2,p:1,children:[f(v,{pt:1,pb:1,spacing:2,children:[i(C,{variant:"body2",children:m("techPointConfig.pageDescription1")}),i(C,{variant:"body2",children:m("techPointConfig.pageDescription2")})]}),i(we,{id:"searchShip",lowerCase:!0,value:c,placeholder:m("label.shipName"),onChange:r}),i(ze,{config:h,onToggleModule:x,onToggleEnhancement:w})]})}),i(fe,{})]})};export{Pt as TechPointConfigPage,Pt as default};
