import{C as Z,A as H,D as I,K as P,_ as y,N as z,b7 as V,b6 as W,r as p,O as Y,G as q,k as s,j as g,J as K,I as Q,w as v,T as S,t as x,q as E,az as ee,g as te,aJ as oe,f as ne,aG as ie,F as O,c as C,B as R,bq as se,au as D,m as ce,a3 as N}from"./index.7f2185b4.js";import{g as re,S as ae,c as le,a as de}from"./ShipTypeFilterButton.3b7482b0.js";import{N as he,P as ue}from"./PageContent.4aaa16d9.js";import{P as pe}from"./PageFooter.2f599df2.js";import{d as ge}from"./Settings.6990c4ff.js";import{E as fe}from"./ExpandStack.abad2a80.js";import{c as me,b as Se}from"./boolMapUtils.54d90c14.js";import{d as Ce}from"./Save.9468bd4e.js";import{d as ve,a as Te}from"./DeleteForever.ed279ed7.js";import{A as xe}from"./ActionBar.64210ef4.js";import"./domUtils.2a6fb7ae.js";import"./MenuItem.4fc0530d.js";import"./Popper.47dbe275.js";import"./ClickAwayListener.eafd4af4.js";import"./useFormControl.03e59aa4.js";function we(e){return H("MuiSwitch",e)}const be=Z("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var u=be;const ke=["className","color","edge","size","sx"],Pe=e=>{const{classes:t,edge:o,size:n,color:c,checked:i,disabled:r}=e,a={root:["root",o&&`edge${P(o)}`,`size${P(n)}`],switchBase:["switchBase",`color${P(c)}`,i&&"checked",r&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=Q(a,we,t);return y({},t,l)},ye=I("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${P(o.edge)}`],t[`size${P(o.size)}`]]}})(({ownerState:e})=>y({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${u.thumb}`]:{width:16,height:16},[`& .${u.switchBase}`]:{padding:4,[`&.${u.checked}`]:{transform:"translateX(16px)"}}})),$e=I(re,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${u.input}`]:t.input},o.color!=="default"&&t[`color${P(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${u.checked}`]:{transform:"translateX(20px)"},[`&.${u.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${u.checked} + .${u.track}`]:{opacity:.5},[`&.${u.disabled} + .${u.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${u.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>y({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:z(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${u.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:z(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${u.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?V(e.palette[t.color].main,.62):W(e.palette[t.color].main,.55)}`}},[`&.${u.checked} + .${u.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Ee=I("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Ie=I("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Me=p.exports.forwardRef(function(t,o){const n=Y({props:t,name:"MuiSwitch"}),{className:c,color:i="primary",edge:r=!1,size:a="medium",sx:l}=n,d=q(n,ke),h=y({},n,{color:i,edge:r,size:a}),f=Pe(h),T=s(Ie,{className:f.thumb,ownerState:h});return g(ye,{className:K(f.root,c),sx:l,ownerState:h,children:[s($e,y({type:"checkbox",icon:T,checkedIcon:T,ref:o,ownerState:h},d,{classes:y({},f,{root:f.switchBase})})),s(Ee,{className:f.track,ownerState:h})]})});var L=Me;const A="1.5rem",F="1rem",_=e=>{const{techPoints:t,maxTechPoints:o,incomplete:n,showZero:c}=e,i=c||t!==null&&t>0,r=o!==null&&o>0;return g(v,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"160px"},children:[s(S,{variant:"body2",color:"text.secondary",whiteSpace:"nowrap",children:x("techPointConfig.techPointShortColon")}),i&&s(S,{variant:"body1",textAlign:"right",sx:{fontSize:A},children:t!=null?t:0}),g(v,{direction:"row",alignItems:"center",children:[s(S,{variant:"body1",textAlign:"right",sx:{fontSize:i?F:A},color:i||!r?"text.secondary":"text.primary",children:`${i?"/ ":""}${r?`${o}`:"?"}`}),r&&n&&s(S,{variant:"body1",color:"text.secondary",sx:{fontSize:i?F:A},children:"+"})]})]})},Re=e=>{const{shipConfig:t,onClickName:o}=e;return g(v,{spacing:3,direction:"row",pr:2,sx:{flexGrow:1},children:[s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g("div",{children:[s(S,{variant:"body1",children:s(ee,{onClick:()=>{o(t.shipDefinition.id)},children:te(t.shipDefinition)})}),t.incomplete&&s(S,{variant:"body2",sx:{color:"red"},children:x("techPointConfig.incomplete")})]})}),s(_,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete})]})},Ae=e=>{const{shipConfig:t,moduleConfig:o,enhancementConfig:n,onToggleEnhancement:c}=e,i=o.selectedEnhancementIds.includes(n.id);return g(v,{spacing:1,direction:"row",children:[s("div",{children:s(L,{checked:i,onChange:()=>{c(t.shipDefinition.id,o.module.id,n.id)},disabled:!i&&!!o.module.skillSlots&&o.selectedEnhancementIds.length>=o.module.skillSlots})}),s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(v,{spacing:.5,sx:{flexGrow:1},children:[s(S,{variant:"body2",children:`${n.enhancement.name}`}),n.enhancement.properties.map((r,a)=>s(S,{variant:"body2",color:"text.secondary",sx:{maxWidth:"80%"},children:r},`property_${a}`)),n.enhancement.cost===null&&s(S,{variant:"body2",sx:{color:"red"},children:x("techPointConfig.maxCostUnknown")})]})})]})},Oe=e=>{var a;const{shipConfig:t,moduleConfig:o,onToggleModule:n,onToggleEnhancement:c}=e,{mode:i}=oe(),r=t.selectedModuleIds.includes(o.module.id);return g(v,{p:2,spacing:1,sx:{backgroundColor:i==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(229, 229, 229, 0.5)"},children:[g(v,{spacing:1,direction:"row",children:[s("div",{children:s(L,{checked:r,onChange:()=>{n(t.shipDefinition.id,o.module.id)}})}),s(E,{component:"div",sx:{display:"flex",flexGrow:1,alignItems:"center"},children:g(E,{component:"div",sx:{flexGrow:1},children:[s(S,{variant:"body2",children:`${o.module.category!=="STATIC"?`${o.module.category}${o.module.categoryNumber}`:""} ${ne(t.shipDefinition.id,o.module)}`}),o.incomplete&&s(S,{variant:"body2",sx:{color:"red"},children:x("techPointConfig.incomplete")})]})}),s(_,{techPoints:r?o.techPoints:0,maxTechPoints:o.maxTechPoints,incomplete:o.incomplete,showZero:!0})]}),r&&g(v,{spacing:3,pl:5,pt:1,pb:2,children:[s(S,{variant:"body1",color:"text.secondary",children:x("techPointConfig.enhancementSlotsColonValue",{value:`${o.selectedEnhancementIds.length} / ${(a=o.module.skillSlots)!=null?a:"?"}`})}),Object.values(o.enhancements).map(l=>s(Ae,{shipConfig:t,moduleConfig:o,enhancementConfig:l,onToggleEnhancement:c},l.id))]})]})},Be=e=>{const{shipConfig:t,onToggleModule:o,onToggleEnhancement:n}=e;return g(v,{spacing:1,justifyContent:"end",children:[Object.values(t.modules).map(c=>s(Oe,{shipConfig:t,moduleConfig:c,onToggleModule:o,onToggleEnhancement:n},c.module.id)),s(v,{justifyContent:"end",flexDirection:"row",sx:{paddingRight:"40px"},children:s(_,{techPoints:t.techPoints,maxTechPoints:t.maxTechPoints,incomplete:t.incomplete})})]})},_e=e=>{const{config:t,onToggleEnhancement:o,onToggleModule:n}=e,{openShipDetailDialog:c}=ie();return s(fe,{expandables:Object.values(t.ships).map(i=>({id:i.shipDefinition.id,initiallyOpened:!1,expandIcon:s(ge,{}),summary:s(Re,{shipConfig:i,onClickName:c}),details:s(Be,{shipConfig:i,onToggleModule:n,onToggleEnhancement:o})}))})},ze=e=>{const{shipFilter:t,modified:o,stored:n,onFilterChange:c,onReset:i,onCancel:r,onSave:a}=e;return s(xe,{left:l=>s(O,{children:s(ae,{filter:t,onChange:c,buttonProps:l,shipRows:[],manufacturer:[],researchManufacturer:!1,researchStrategyTypes:!1,researchTacticTypes:!1,shipSources:[],shipTypes:[C.AUXILIARY,C.CARRIER,C.BATTLE_CRUISER,C.CRUISER,C.CORVETTE]},"filter")}),right:l=>g(O,{children:[s(R,{variant:"outlined",startIcon:s(ve,{}),onClick:i,disabled:!n,...l,children:x("button.reset")},"reset"),s(R,{variant:"outlined",startIcon:s(Te,{}),onClick:r,disabled:!o,...l,children:x("button.cancel")},"cancel"),s(R,{variant:"contained",startIcon:s(Ce,{}),onClick:a,disabled:!o,...l,children:x("button.save")},"save")]})})};function B(e){return{ships:e.reduce((o,n)=>({...o,[n.id]:De(n)}),{})}}function De(e){var i,r,a,l;const t=(r=(i=e.modules)==null?void 0:i.filter(d=>d.skillSlots!==0).reduce((d,h)=>({...d,[h.id]:Ne(h)}),{}))!=null?r:{},o=(l=(a=e.modules)==null?void 0:a.filter(d=>d.skillSlots!==0&&d.category==="STATIC"||d.defaultModule===!0).map(d=>d.id))!=null?l:[],n=U(t,o),c=G(t,o);return{shipDefinition:e,modules:t,selectedModuleIds:o,techPoints:null,maxTechPoints:n,incomplete:c}}function Ne(e){var n,c;const t=[...(n=e.flagshipEffects)!=null?n:[],...(c=e.skills)!=null?c:[]].filter(i=>!i.isDefault).reduce((i,r,a)=>{const l=`${r.type}_${a}`;return{...i,[l]:Fe(r,l)}},{}),o=je(e);return{module:e,enhancements:t,selectedEnhancementIds:[],techPoints:null,maxTechPoints:o,incomplete:Le(e)}}function Fe(e,t){return{id:t,enhancement:e,techPoints:e.isDefault?null:e.cost}}function U(e,t){return Object.values(e).filter(o=>o.module.category==="STATIC"||t.includes(o.module.id)).map(o=>o.maxTechPoints).reduce((o,n)=>(o!=null?o:0)+(n!=null?n:0),null)}function je(e){return!e.skillSlots||!e.skills||e.skills.length===0?null:e.skills.map(t=>t.cost).sort((t,o)=>(o!=null?o:0)-(t!=null?t:0)).slice(0,e.skillSlots).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),0)}function G(e,t){const o=Object.keys(e);return o.length===0?!0:o.map(n=>e[n]).filter(n=>n.module.category==="STATIC"||t.includes(n.module.id)).some(n=>n.incomplete)}function Le(e){var t,o;return e.skillComplete!==!0||[...(t=e.flagshipEffects)!=null?t:[],...(o=e.skills)!=null?o:[]].some(n=>!n.isDefault&&n.cost===null)}function Ue(e,t){if(e.selectedModuleIds.includes(t))return e.selectedModuleIds.filter(n=>n!==t);const{category:o}=e.modules[t].module;return o==="STATIC"?[...e.selectedModuleIds,t]:[...e.selectedModuleIds.filter(n=>o!==e.modules[n].module.category),t]}function Ge(e,t,o){var r;const n=(r=e.ships[t])!=null?r:null;if(!n)throw new Error(`Missing config for "${t}"`);if(!n.modules[o])throw new Error(`Invalid module for "${t}", "${o}"`);const i={...n,selectedModuleIds:Ue(n,o)};return{...e,ships:{...e.ships,[t]:{...i,techPoints:J(i),maxTechPoints:U(i.modules,i.selectedModuleIds),incomplete:G(i.modules,i.selectedModuleIds)}}}}function Je(e,t,o,n){var l,d,h;const c=(d=(l=e.ships[t])==null?void 0:l.modules[o])!=null?d:null;if(!c)throw new Error(`Missing config for "${t}", "${o}"`);const i=Xe(c.selectedEnhancementIds,n);if(i.length>((h=c.module.skillSlots)!=null?h:0))return e;const r={...c,selectedEnhancementIds:i},a={...e.ships[t],modules:{...e.ships[t].modules,[o]:{...r,techPoints:Ze(r)}}};return{...e,ships:{...e.ships,[t]:{...a,techPoints:J(a)}}}}function Xe(e,t){return e.includes(t)?e.filter(o=>o!==t):[...e,t]}function J(e){return Object.values(e.modules).filter(t=>e.selectedModuleIds.includes(t.module.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}function Ze(e){return Object.values(e.enhancements).filter(t=>e.selectedEnhancementIds.includes(t.id)).map(t=>t.techPoints).reduce((t,o)=>(t!=null?t:0)+(o!=null?o:0),null)}const M="tp";function He(){return!!window.localStorage.getItem(M)}function Ve(){window.localStorage.removeItem(M)}function We(e){const t=Ye(e);window.localStorage.setItem(M,JSON.stringify(t))}function j(e){const t=B(e),o=window.localStorage.getItem(M);if(!o)return t;let n;try{n=JSON.parse(o)}catch(c){return console.warn("Invalid tech point config",c),t}return qe(t,n)}function Ye(e){const t={version:1,ships:[]};return Object.keys(e.ships).forEach(o=>{const n=e.ships[o],c=[o,[]];Object.keys(n.modules).forEach(i=>{const r=n.modules[i],a=[i,r.selectedEnhancementIds];c[1].push(a)}),t.ships.push(c)}),t}function qe(e,t){return t.ships.forEach(([o,n])=>{const c=e.ships[o];if(!c){console.warn(`Invalid shipId "${o}"`);return}n.forEach(([i,r])=>{const a=c.modules[i];if(!a){console.warn(`Invalid moduleId "${i}"`);return}if(a.selectedEnhancementIds.length>0){console.warn(`Skip moduleId "${i}" (duplicate)`);return}r.forEach(l=>{var h,f,T,w;const d=a.enhancements[l];if(!d){console.warn(`Invalid enhancement "${l}"`);return}a.selectedEnhancementIds.push(l),a.techPoints=((h=a.techPoints)!=null?h:0)+((f=d.enhancement.cost)!=null?f:0),c.techPoints=((T=c.techPoints)!=null?T:0)+((w=d.enhancement.cost)!=null?w:0)})})}),e}const Ke=e=>{const{supportedShips:t,visibleShips:o}=e,[n,c]=p.exports.useState(()=>B([])),[i,r]=p.exports.useState(!1),[a,l]=p.exports.useState(He());p.exports.useEffect(()=>{const m=j(t);c(m)},[t]);const d=p.exports.useCallback((m,b)=>{r(!0),c(k=>Ge(k,m,b))},[]),h=p.exports.useCallback((m,b,k)=>{r(!0),c(X=>Je(X,m,b,k))},[]),f=p.exports.useCallback(()=>{Ve();const m=B(t);c(m),r(!1),l(!1)},[t]),T=p.exports.useCallback(()=>{const m=j(t);c(m),r(!1)},[n]),w=p.exports.useCallback(()=>{We(n),r(!1),l(!0)},[n]);return{config:p.exports.useMemo(()=>o.length===0?n:{ships:o.reduce((m,b)=>{const k=n.ships[b.id];return k?{...m,[b.id]:k}:m},{})},[n,o]),modified:i,stored:a,handleToggleModule:d,handleToggleEnhancement:h,handleReset:f,handleCancel:T,handleSave:w}},Qe=[C.AUXILIARY,C.CARRIER,C.BATTLE_CRUISER,C.CRUISER,C.CORVETTE],ft=()=>{const[e,t]=se(),[o,n]=p.exports.useState(()=>me(e.getAll("filter"),le()));p.exports.useEffect(()=>{t(D.techPointConfig.createSearchParams({filter:Se(o)}))},[o]);const c=p.exports.useMemo(()=>ce.filter($=>$.source===N.TECH_FILE||$.source===N.STARTER_SHIP).filter($=>Qe.includes($.type)),[]),i=p.exports.useMemo(()=>de(c,o),[c,o]),{config:r,modified:a,stored:l,handleToggleModule:d,handleToggleEnhancement:h,handleReset:f,handleCancel:T,handleSave:w}=Ke({supportedShips:c,visibleShips:i});return g(O,{children:[s(he,{currentRoute:D.techPointConfig.path}),s(ze,{shipFilter:o,modified:a,stored:l,onFilterChange:n,onReset:f,onCancel:T,onSave:w}),s(ue,{children:s(E,{component:"div",p:1,children:s(_e,{config:r,onToggleModule:d,onToggleEnhancement:h})})}),s(pe,{})]})};export{ft as TechPointConfigPage,ft as default};
