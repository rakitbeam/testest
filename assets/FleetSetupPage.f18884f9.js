import{J as D,K as R,L as k,r as F,j as e,F as y,o as b,a as d,B,ao as P,bm as M,O as Y,i as S,aB as q,aC as U,aD as J,S as x,T as n,aE as K,bg as Q,bn as X,bo as Z,bp as ee,h as g,f as _,e as te,t as ne,ax as ae,b as $,ap as j,l as re,m as oe,n as ie,bj as ue,a6 as le,al as se,a2 as G,a3 as ce}from"./index.bfcd82d6.js";import{N as de,P as pe}from"./PageContent.cbb5aef4.js";import{d as he}from"./Settings.df9c8645.js";import{d as Fe,a as fe}from"./ContentCopy.31f2cb8f.js";import{A as me}from"./ActionBar.95475989.js";import{B as ve,S as ye,g as ge,a as xe,v as Ce,f as Se,G as N,b as be,A as $e}from"./fleetSetupValidation.435353a9.js";import{E as Ae}from"./ExpandStack.c667bf2d.js";import{R as Be}from"./ResponsiveDialog.947b5234.js";import{T as Ee}from"./TextField.7f5f2fbb.js";import{P as _e}from"./PageFooter.ca44d500.js";import"./domUtils.7c958e3f.js";import"./useFormControl.20b55ce4.js";import"./sorting.c6946657.js";import"./Select.2241b85f.js";var w={},De=R.exports;Object.defineProperty(w,"__esModule",{value:!0});var z=w.default=void 0,Re=De(D),ke=k,we=(0,Re.default)((0,ke.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");z=w.default=we;const Te=p=>{const{fleetSetups:t,fleetSetup:o,onChange:a,buttonProps:c}=p,u=F.exports.useMemo(()=>t.map(r=>({key:r.key,text:r.name,value:r.key})),[t]);return e(y,{children:e(ve,{icon:e(z,{}),text:b("fleetSetup.selectFleet"),value:o.key,options:u,onClick:a,buttonProps:c})})},Ie=p=>{const{fleetSetups:t,fleetSetup:o,grouping:a,onChangeFleet:c,onChangeGrouping:u,onEdit:r,onShare:l}=p;return e(me,{left:s=>d(y,{children:[e(ye,{value:a,onChange:u,buttonProps:s}),e(Te,{fleetSetups:t,fleetSetup:o,onChange:c,buttonProps:s}),e(B,{variant:"outlined",startIcon:e(he,{}),onClick:r,...s,children:b("button.edit")},"edit")]}),right:s=>e(y,{children:e(B,{variant:"outlined",startIcon:e(Fe,{}),onClick:l,...s,children:b("button.share")},"share")})})},Oe=p=>{var r;const{initialFleetKey:t}=p,o=F.exports.useMemo(()=>ge(),[]),[a,c]=F.exports.useState(t&&(r=o.find(l=>l.key===t))!=null?r:o[0]),u=F.exports.useCallback(l=>{const s=o.find(v=>v.key===l);if(!s)throw new Error(`Invalid fleet key "${l}"`);c(s)},[o]);return{fleetSetups:o,fleetSetup:a,switchFleet:u}};var T={},Pe=R.exports;Object.defineProperty(T,"__esModule",{value:!0});var V=T.default=void 0,Me=Pe(D),je=k,Ge=(0,Me.default)((0,je.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");V=T.default=Ge;var I={},Ne=R.exports;Object.defineProperty(I,"__esModule",{value:!0});var H=I.default=void 0,We=Ne(D),ze=k,Ve=(0,We.default)((0,ze.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");H=I.default=Ve;function He(p){const t={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return p.reduce((o,a)=>{const c=P(a.shipDefinition,a.moduleSelection);if(!c)return{...o,incomplete:!0};const u=M(c,a.count,o);return a.carriedShips.reduce((r,l)=>{const s=P(l.shipDefinition,null);return s?M(s,l.count,r):{...r,incomplete:!0}},u)},t)}const Le=p=>{const{fleetSetup:t}=p,[o,a]=F.exports.useState(!1),{totalCost:c,shipCount:u,shipCountByType:r,shipCountByRow:l}=F.exports.useMemo(()=>xe(t.ships),[t.ships]),s=F.exports.useMemo(()=>He(t.ships),[t.ships]),v=c>t.maxCost,C=t.totalReinforcementCount>t.maxReinforcement,f=F.exports.useMemo(()=>{const i=Ce(t);return Object.keys(i).map(m=>{const[h,L]=m.split("#"),A=Y(h);switch(L){case"self":return`${S(A)}\uFF1A${i[m]}`;case"ally":return`${S(A)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09\uFF1A${i[m]}`;case"ally2":return`${S(A)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09\uFF1A${i[m]}`;case"ally3":return`${S(A)}\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09\uFF1A${i[m]}`;default:return`${S(A)}\uFF1A${i[m]}`}})},[t]),E=v||C||f.length>0?e(H,{color:"error"}):e(V,{color:"primary"});return d(q,{expanded:o,onChange:()=>a(!o),children:[e(U,{expandIcon:o?e(J,{}):E,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:t.name}),!o&&d("div",{children:[e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u5897\u63F4\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:C?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`}),e(n,{variant:"body2",color:"text.secondary",component:"span",children:"\u3001\u53F8\u4EE4Pt\uFF1A"}),e(n,{variant:"body2",color:"text.secondary",component:"span",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})]})]})}),e(K,{children:o&&e(Q,{rows:[{key:"reinforcementCount",label:"\u5897\u63F4",value:e(n,{variant:"body2",sx:C?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`})},{key:"cost",label:"\u8266\u968A\u53F8\u4EE4Pt",value:e(n,{variant:"body2",sx:v?{color:"red"}:{},children:`${c} / ${t.maxCost}`})},{key:"dpm",label:"\u5408\u8A08DPM",value:d(y,{children:[e(n,{variant:"body2",children:X(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"hp",label:"\u5408\u8A08HP",value:d(y,{children:[e(n,{variant:"body2",children:Z(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"speed",label:"\u901F\u5EA6",value:d(y,{children:[e(n,{variant:"body2",children:ee(s)}),s.incomplete&&e(n,{variant:"caption",color:"text.secondary",children:"\uFF08\u30C7\u30FC\u30BF\u304C\u6B20\u843D\u3057\u3066\u3044\u308B\u305F\u3081\u4E0D\u6B63\u78BA\uFF09"})]})},{key:"shipCount",label:"\u8266\u8239",value:u>0?d(y,{children:[e(n,{variant:"body2",children:`\u5408\u8A08\u3000${u}`}),Object.keys(r).filter(i=>r[i]>0&&i!==g.CORVETTE&&i!==g.FIGHTER).map(i=>e(n,{variant:"body2",children:`${_(i)}\u3000${r[i]}`},i))]}):e(n,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:"\u8266\u8F09\u6A5F",value:r[g.FIGHTER]+r[g.CORVETTE]>0?d(y,{children:[r[g.FIGHTER]>0&&e(n,{variant:"body2",children:`${_(g.FIGHTER)}\u3000${r[g.FIGHTER]}`}),r[g.CORVETTE]>0&&e(n,{variant:"body2",children:`${_(g.CORVETTE)}\u3000${r[g.CORVETTE]}`})]}):e(n,{variant:"body2",children:"-"})},{key:"rowCount",label:"\u914D\u7F6E",value:u>0?e(y,{children:Object.keys(l).filter(i=>i!==te.NONE).map(i=>e(n,{variant:"body2",children:`${ne(i)}\u3000${l[i]}`},i))}):e(n,{variant:"body2",children:"-"})},...f.length>0?[{key:"warnings",label:"\u8B66\u544A",value:f.map((i,m)=>e(n,{variant:"body2",sx:{color:"red"},children:i},`warning_${m}`))}]:[]]})})]})},W=p=>{const{shipSelections:t}=p,{openShipDetailDialog:o}=ae();return e(x,{spacing:1,children:t==null?void 0:t.map(a=>{var c;return d(F.exports.Fragment,{children:[d(x,{spacing:1,direction:"row",children:[d(x,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e($,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(n,{variant:"body2",children:e(j,{onClick:()=>{o(a.shipDefinition.id)},children:S(a.shipDefinition)})}),a.reinforcement==="self"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u5897\u63F4\uFF09"}),a.reinforcement==="ally"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF21\uFF09"}),a.reinforcement==="ally2"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF22\uFF09"}),a.reinforcement==="ally3"&&e(n,{variant:"body2",noWrap:!0,children:"\uFF08\u30E6\u30CB\u30AA\u30F3\u5897\u63F4\uFF23\uFF09"})]}),e($,{sx:{width:"50px"},children:a.reinforcement===null&&e(n,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(u=>{var r;return d(x,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(n,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e($,{sx:{width:"25px"},children:e(n,{variant:"body2",textAlign:"end",children:`${u.count}\xD7`})}),e(n,{variant:"body2",children:e(j,{onClick:()=>{o(u.shipDefinition.id)},children:S(u.shipDefinition)})})]},`${u.shipDefinition.id}_${(r=u.reinforcement)!=null?r:"initial"}`)})]},`${a.shipDefinition.id}_${(c=a.reinforcement)!=null?c:"initial"}`)})})},Ye=p=>{const{fleetSetup:t,groupedShips:o,onClose:a}=p,[c,u]=F.exports.useState(!1),[r,l]=F.exports.useState(()=>Se(t,o)),s=()=>{r&&oe(r).then(()=>{u(!0)})},v=f=>{l(f.target.value)},C=()=>{a(),u(!1)};return e(Be,{title:"\u5171\u6709",content:d(x,{spacing:1,children:[e(Ee,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:v,rows:10,defaultValue:r,fullWidth:!0}),!!navigator.clipboard&&e(B,{variant:"outlined",startIcon:c?e(re,{}):e(fe,{}),onClick:s,fullWidth:!0,children:"\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306B\u30B3\u30D4\u30FC"})]}),actions:e(B,{variant:"outlined",onClick:C,children:"\u9589\u3058\u308B"}),onClose:C})},ut=()=>{const p=ie(),{fleetKey:t}=ue(),o=le(),a=se(o.breakpoints.up("lg")),[c,u]=F.exports.useState(!1),{fleetSetups:r,fleetSetup:l,switchFleet:s}=Oe({initialFleetKey:t!=null?t:null}),[v,C]=F.exports.useState(N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),f=F.exports.useMemo(()=>be(v,l),[l,v]),O=()=>{p("/fleetSetup/edit/"+l.key)},E=()=>{u(!0)},i=()=>{u(!1)},m=a&&f.groupedBy===N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return d(y,{children:[e(de,{currentRoute:"/fleetSetup"}),e(Ie,{fleetSetups:r,fleetSetup:l,grouping:v,onChangeFleet:s,onChangeGrouping:C,onEdit:O,onShare:E}),e(pe,{disableContainer:m==="row",children:e($,{p:1,children:d(x,{spacing:1,children:[e(Le,{fleetSetup:l}),l.ships.length>0?e(y,{children:m==="row"?e(x,{spacing:1,direction:"row",sx:{width:"100%"},children:f.groups.map(h=>e(G,{sx:{width:`${100/f.groups.length}%`},children:e($,{p:1,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:`${h.name}${h.count>0?`\uFF08${h.count}\u96BB\uFF09`:""}`}),e(ce,{}),e(W,{shipSelections:h.ships})]})})},h.id))}):e(Ae,{expandables:f.groups.map(h=>({id:h.id,initiallyOpened:!0,summary:e(n,{variant:"body1",children:`${h.name}${h.count>0?`\uFF08${h.count}\u96BB\uFF09`:""}`}),details:e(W,{shipSelections:h.ships}),skip:h.ships.length===0}))},f.groupedBy)}):e(G,{children:e($,{p:2,children:d(x,{spacing:1,children:[e(n,{variant:"body1",children:b("fleetSetup.fleetFormation")}),e($e,{severity:"info",children:b("fleetSetup.fleetEmptyNotice")})]})})}),e(n,{variant:"caption",align:"right",paragraph:!0,children:b("fleetSetup.pageFootnote")})]})})}),c&&e(Ye,{fleetSetup:l,groupedShips:f,onClose:i}),e(_e,{disableContainer:m==="row"})]})};export{ut as FleetSetupPage,ut as default};
