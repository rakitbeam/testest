import{c as B,i as w,r as A,j as m,p as e,F as y,t,n as d,v as D,ay as W,by as G,V as U,g as $,aK as Q,aL as J,aM as X,u as x,T as r,bu as F,aN as Z,bs as ee,bz as te,bA as ne,bB as re,d as g,b as T,S as ae,a as ie,aG as oe,B as k,az as j,y as le,z as se,A as ce,bv as de,ag as pe,av as ue,a8 as V,a9 as he}from"./index.9f278538.js";import{N as fe,P as me}from"./PageContent.8ddaee03.js";import{d as Se}from"./Settings.80c9f8c0.js";import{d as ve,a as ye}from"./ContentCopy.be58cb8f.js";import{A as ge}from"./ActionBar.4f21482f.js";import{B as xe}from"./ButtonMenu.af4c49a8.js";import{S as be,g as Ce,a as ke,v as _e,f as Re,G as N,b as De}from"./fleetSetupValidation.6cf8b4c7.js";import{E as Fe}from"./ExpandStack.739ae930.js";import{R as Ee}from"./ResponsiveDialog.f0cefff8.js";import{T as Te,A as $e}from"./TextField.efa68678.js";import{P as Be}from"./PageFooter.69b33f12.js";import"./domUtils.258b4431.js";import"./useFormControl.3bfcccba.js";import"./sorting.c6946657.js";import"./Select.44d3fc85.js";var I={},we=w.exports;Object.defineProperty(I,"__esModule",{value:!0});var H=I.default=void 0,Ae=we(B),Ie=A,Pe=(0,Ae.default)((0,Ie.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");H=I.default=Pe;const Me=h=>{const{fleetSetups:n,fleetSetup:o,onChange:a,buttonProps:u}=h,l=m.exports.useMemo(()=>n.map(i=>({key:i.key,text:i.name,value:i.key})),[n]);return e(y,{children:e(xe,{icon:e(H,{}),text:t("fleetSetup.selectFleet"),value:o.key,options:l,onClick:a,buttonProps:u})})},Oe=h=>{const{fleetSetups:n,fleetSetup:o,grouping:a,onChangeFleet:u,onChangeGrouping:l,onEdit:i,onShare:s}=h;return e(ge,{left:c=>d(y,{children:[e(be,{value:a,onChange:l,buttonProps:c}),e(Me,{fleetSetups:n,fleetSetup:o,onChange:u,buttonProps:c}),e(D,{variant:"outlined",startIcon:e(Se,{}),onClick:i,...c,children:t("button.edit")},"edit")]}),right:c=>e(y,{children:e(D,{variant:"outlined",startIcon:e(ve,{}),onClick:s,...c,children:t("button.share")},"share")})})},We=h=>{var i;const{initialFleetKey:n}=h,o=m.exports.useMemo(()=>Ce(),[]),[a,u]=m.exports.useState(n&&(i=o.find(s=>s.key===n))!=null?i:o[0]),l=m.exports.useCallback(s=>{const c=o.find(v=>v.key===s);if(!c)throw new Error(`Invalid fleet key "${s}"`);u(c)},[o]);return{fleetSetups:o,fleetSetup:a,switchFleet:l}};var P={},Ge=w.exports;Object.defineProperty(P,"__esModule",{value:!0});var L=P.default=void 0,je=Ge(B),Ve=A,Ne=(0,je.default)((0,Ve.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");L=P.default=Ne;var M={},ze=w.exports;Object.defineProperty(M,"__esModule",{value:!0});var Y=M.default=void 0,He=ze(B),Le=A,Ye=(0,He.default)((0,Le.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");Y=M.default=Ye;function qe(h){const n={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return h.reduce((o,a)=>{const u=W(a.shipDefinition,a.moduleSelection);if(!u)return{...o,incomplete:!0};const l=G(u,a.count,o);return a.carriedShips.reduce((i,s)=>{const c=W(s.shipDefinition,null);return c?G(c,s.count,i):{...i,incomplete:!0}},l)},n)}const Ke=h=>{const{fleetSetup:n}=h,[o,a]=m.exports.useState(!1),{totalCost:u,shipCount:l,shipCountByType:i,shipCountByRow:s}=m.exports.useMemo(()=>ke(n.ships),[n.ships]),c=m.exports.useMemo(()=>qe(n.ships),[n.ships]),v=u>n.maxCost,b=n.totalReinforcementCount>n.maxReinforcement,S=m.exports.useMemo(()=>{const p=_e(n);return Object.keys(p).map(C=>{const[f,q]=C.split("#"),K=U(f),_=$(K),R=p[C];switch(q){case"self":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.selfReinforcement"),errorText:R});case"ally":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementA"),errorText:R});case"ally2":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementB"),errorText:R});case"ally3":return t("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:t("fleetSetup.orgReinforcementC"),errorText:R});default:return t("fleetSetup.shipWithValidationError",{shipName:_,errorText:R})}})},[n]),E=v||b||S.length>0?e(Y,{color:"error"}):e(L,{color:"primary"});return d(Q,{expanded:o,onChange:()=>a(!o),children:[e(J,{expandIcon:o?e(X,{}):E,children:d(x,{spacing:1,children:[e(r,{variant:"body1",children:n.name}),!o&&d("div",{children:[d(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.reinforcementColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:b?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`}),d(r,{variant:"body2",color:"text.secondary",component:"span",children:[t("fleetSetup.commaCommandPointColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:v?{color:"red"}:{},children:`${u} / ${n.maxCost}`})]})]})}),e(Z,{children:o&&e(ee,{rows:[{key:"reinforcementCount",label:t("fleetSetup.reinforcement"),value:e(r,{variant:"body2",sx:b?{color:"red"}:{},children:`${n.totalReinforcementCount} / ${n.maxReinforcement}`})},{key:"cost",label:t("fleetSetup.totalFleetCommandPoints"),value:e(r,{variant:"body2",sx:v?{color:"red"}:{},children:`${u} / ${n.maxCost}`})},{key:"dpm",label:t("fleetSetup.totalFleetDpm"),value:d(y,{children:[e(r,{variant:"body2",children:te(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"hp",label:t("fleetSetup.totalFleetHp"),value:d(y,{children:[e(r,{variant:"body2",children:ne(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"speed",label:t("label.speed"),value:d(y,{children:[e(r,{variant:"body2",children:re(c)}),c.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:t("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"shipCount",label:t("label.ships"),value:l>0?d(y,{children:[e(r,{variant:"body2",children:t("fleetSetup.totalShipCountValue",{value:l})}),Object.keys(i).filter(p=>i[p]>0&&p!==g.CORVETTE&&p!==g.FIGHTER).map(p=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(p),value:i[p]})},p))]}):e(r,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:t("shipType.aircraft"),value:i[g.FIGHTER]+i[g.CORVETTE]>0?d(y,{children:[i[g.FIGHTER]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(g.FIGHTER),value:i[g.FIGHTER]})}),i[g.CORVETTE]>0&&e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:T(g.CORVETTE),value:i[g.CORVETTE]})})]}):e(r,{variant:"body2",children:"-"})},{key:"rowCount",label:t("label.rowPlacement"),value:l>0?e(y,{children:Object.keys(s).filter(p=>p!==ae.NONE&&s[p]>0).map(p=>e(r,{variant:"body2",children:t("fleetSetup.countPerKind",{kind:ie(p),value:s[p]})},p))}):e(r,{variant:"body2",children:"-"})},...S.length>0?[{key:"warnings",label:t("label.warning"),value:S.map((p,C)=>e(r,{variant:"body2",sx:{color:"red"},children:p},`warning_${C}`))}]:[]]})})]})},z=h=>{const{shipSelections:n}=h,{openShipDetailDialog:o}=oe();return e(x,{spacing:1,children:n==null?void 0:n.map(a=>{var u;return d(m.exports.Fragment,{children:[d(x,{spacing:1,direction:"row",children:[d(x,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(r,{variant:"body2",children:e(j,{onClick:()=>{o(a.shipDefinition.id)},children:$(a.shipDefinition)})}),a.reinforcement==="self"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.reinforcementBrackets")}),a.reinforcement==="ally"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementABrackets")}),a.reinforcement==="ally2"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementBBrackets")}),a.reinforcement==="ally3"&&e(r,{variant:"body2",noWrap:!0,children:t("fleetSetup.orgReinforcementCBrackets")})]}),e(k,{sx:{width:"50px"},children:a.reinforcement===null&&e(r,{variant:"body2",textAlign:"end",children:`${a.shipDefinition.cost*a.count} Pt`})})]}),a.carriedShips.map(l=>{var i;return d(x,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(r,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(k,{sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${l.count}\xD7`})}),e(r,{variant:"body2",children:e(j,{onClick:()=>{o(l.shipDefinition.id)},children:$(l.shipDefinition)})})]},`${l.shipDefinition.id}_${(i=l.reinforcement)!=null?i:"initial"}`)})]},`${a.shipDefinition.id}_${(u=a.reinforcement)!=null?u:"initial"}`)})})},Ue=h=>{const{fleetSetup:n,groupedShips:o,onClose:a}=h,[u,l]=m.exports.useState(!1),[i,s]=m.exports.useState(()=>Re(n,o)),c=()=>{i&&se(i).then(()=>{l(!0)})},v=S=>{s(S.target.value)},b=()=>{a(),l(!1)};return e(Ee,{title:t("button.share"),content:d(x,{spacing:1,children:[e(Te,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:v,rows:10,defaultValue:i,fullWidth:!0}),!!navigator.clipboard&&e(D,{variant:"outlined",startIcon:u?e(le,{}):e(ye,{}),onClick:c,fullWidth:!0,children:t("button.copyToClipboard")})]}),actions:e(D,{variant:"outlined",onClick:b,children:t("button.close")}),onClose:b})},pt=()=>{const h=ce(),{fleetKey:n}=de(),o=pe(),a=ue(o.breakpoints.up("lg")),[u,l]=m.exports.useState(!1),{fleetSetups:i,fleetSetup:s,switchFleet:c}=We({initialFleetKey:n!=null?n:null}),[v,b]=m.exports.useState(N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),S=m.exports.useMemo(()=>De(v,s),[s,v]),O=()=>{h("/fleetSetup/edit/"+s.key)},E=()=>{l(!0)},p=()=>{l(!1)},C=a&&S.groupedBy===N.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return d(y,{children:[e(fe,{currentRoute:"/fleetSetup"}),e(Oe,{fleetSetups:i,fleetSetup:s,grouping:v,onChangeFleet:c,onChangeGrouping:b,onEdit:O,onShare:E}),e(me,{disableContainer:C==="row",children:e(k,{p:1,children:d(x,{spacing:1,children:[e(Ke,{fleetSetup:s}),s.ships.length>0?e(y,{children:C==="row"?e(x,{spacing:1,direction:"row",sx:{width:"100%"},children:S.groups.map(f=>e(V,{sx:{width:`${100/S.groups.length}%`},children:e(k,{p:1,children:d(x,{spacing:1,children:[d(r,{variant:"body1",children:[f.name,F()&&e("span",{children:"\xA0"}),f.count>0?t("fleetSetup.shipCountBrackets",{value:f.count}):""]}),e(he,{}),e(z,{shipSelections:f.ships})]})})},f.id))}):e(Fe,{expandables:S.groups.map(f=>({id:f.id,initiallyOpened:!0,summary:d(r,{variant:"body1",children:[f.name,F()&&e("span",{children:"\xA0"}),f.count>0?t("fleetSetup.shipCountBrackets",{value:f.count}):""]}),details:e(z,{shipSelections:f.ships}),skip:f.ships.length===0}))},S.groupedBy)}):e(V,{children:e(k,{p:2,children:d(x,{spacing:1,children:[e(r,{variant:"body1",children:t("fleetSetup.fleetFormation")}),e($e,{severity:"info",children:t("fleetSetup.fleetEmptyNotice")})]})})}),e(r,{variant:"caption",align:"right",paragraph:!0,children:t("fleetSetup.pageFootnote")})]})})}),u&&e(Ue,{fleetSetup:s,groupedShips:S,onClose:p}),e(Be,{disableContainer:C==="row"})]})};export{pt as FleetSetupPage,pt as default};
