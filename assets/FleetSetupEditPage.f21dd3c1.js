import{q as W,v as U,w as O,D as V,_ as w,r as p,I as q,y as G,A as Y,T as S,j as o,a as g,C as K,E as Me,G as dt,H as Ae,bz as ut,z as pt,ac as ht,aN as ft,bA as Ie,bB as fe,a4 as _,b as T,bn as mt,t as u,J as X,K as J,L as Z,F as I,B as D,o as Le,S as R,p as Ee,b6 as _e,i as F,f as oe,ab as Q,aq as ee,aB as gt,au as yt,k as Ct,bp as L,by as P,u as vt,bC as bt,c as Oe,l as St,aD as xt,bq as Rt,bg as Ft}from"./index.f0bc6bc0.js";import{a as N,c as kt,I as me,N as wt,P as Tt}from"./PageContent.061d4794.js";import{T as z}from"./TextField.36ba6122.js";import{d as $t,a as Dt,b as Mt,C as At}from"./ConfirmationDialog.00532269.js";import{A as It}from"./ActionBar.3b1a0182.js";import{B as Lt,S as Et,g as _t,c as Pe,d as Ot,e as Pt,s as Gt,h as Bt,i as Nt,v as ae,j as Ge,k as zt,l as ge,A as Be,m as Ht,a as jt,G as ye,b as Wt}from"./fleetSetupValidation.da861eb2.js";import{R as ie}from"./ResponsiveDialog.9259f976.js";import{f as Ne,F as Ut}from"./Select.610084cf.js";import{u as ze}from"./useFormControl.db17cba1.js";import{g as Vt,c as He,S as je}from"./ShipTypeFilterButton.ea67a773.js";import{T as qt}from"./Tooltip.5eeddc1b.js";import"./domUtils.802b573c.js";import"./sorting.c6946657.js";function Yt(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function Kt(t){return parseFloat(t)}function Xt(t){return W("MuiFormControlLabel",t)}const Jt=U("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error"]);var H=Jt;const Zt=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","value"],Qt=t=>{const{classes:e,disabled:n,labelPlacement:r,error:a}=t,s={root:["root",n&&"disabled",`labelPlacement${V(r)}`,a&&"error"],label:["label",n&&"disabled"]};return Y(s,Xt,e)},en=O("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`& .${H.label}`]:e.label},e.root,e[`labelPlacement${V(n.labelPlacement)}`]]}})(({theme:t,ownerState:e})=>w({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${H.disabled}`]:{cursor:"default"}},e.labelPlacement==="start"&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},e.labelPlacement==="top"&&{flexDirection:"column-reverse",marginLeft:16},e.labelPlacement==="bottom"&&{flexDirection:"column",marginLeft:16},{[`& .${H.label}`]:{[`&.${H.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})),tn=p.exports.forwardRef(function(e,n){const r=q({props:e,name:"MuiFormControlLabel"}),{className:a,componentsProps:s={},control:l,disabled:c,disableTypography:m,label:h,labelPlacement:y="end"}=r,v=G(r,Zt),d=ze();let f=c;typeof f=="undefined"&&typeof l.props.disabled!="undefined"&&(f=l.props.disabled),typeof f=="undefined"&&d&&(f=d.disabled);const i={disabled:f};["checked","name","onChange","value","inputRef"].forEach($=>{typeof l.props[$]=="undefined"&&typeof r[$]!="undefined"&&(i[$]=r[$])});const C=Ne({props:r,muiFormControl:d,states:["error"]}),b=w({},r,{disabled:f,labelPlacement:y,error:C.error}),x=Qt(b);let k=h;return k!=null&&k.type!==S&&!m&&(k=o(S,w({component:"span",className:x.label},s.typography,{children:k}))),g(en,w({className:K(x.root,a),ownerState:b,ref:n},v,{children:[p.exports.cloneElement(l,i),k]}))});var Ce=tn;function nn(t){return W("MuiFormGroup",t)}U("MuiFormGroup",["root","row","error"]);const on=["className","row"],rn=t=>{const{classes:e,row:n,error:r}=t;return Y({root:["root",n&&"row",r&&"error"]},nn,e)},an=O("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.row&&e.row]}})(({ownerState:t})=>w({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})),sn=p.exports.forwardRef(function(e,n){const r=q({props:e,name:"MuiFormGroup"}),{className:a,row:s=!1}=r,l=G(r,on),c=ze(),m=Ne({props:r,muiFormControl:c,states:["error"]}),h=w({},r,{row:s,error:m.error}),y=rn(h);return o(an,w({className:K(y.root,a),ownerState:h,ref:n},l))});var ln=sn,cn=Me(o("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),dn=Me(o("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked");const un=O("span")({position:"relative",display:"flex"}),pn=O(cn)({transform:"scale(1)"}),hn=O(dn)(({theme:t,ownerState:e})=>w({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest})},e.checked&&{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}));function We(t){const{checked:e=!1,classes:n={},fontSize:r}=t,a=w({},t,{checked:e});return g(un,{className:n.root,ownerState:a,children:[o(pn,{fontSize:r,className:n.background,ownerState:a}),o(hn,{fontSize:r,className:n.dot,ownerState:a})]})}const fn=p.exports.createContext(void 0);var Ue=fn;function mn(){return p.exports.useContext(Ue)}function gn(t){return W("MuiRadio",t)}const yn=U("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary"]);var ve=yn;const Cn=["checked","checkedIcon","color","icon","name","onChange","size","className"],vn=t=>{const{classes:e,color:n}=t,r={root:["root",`color${V(n)}`]};return w({},e,Y(r,gn,e))},bn=O(Vt,{shouldForwardProp:t=>dt(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`color${V(n.color)}`]]}})(({theme:t,ownerState:e})=>w({color:(t.vars||t).palette.text.secondary,"&:hover":{backgroundColor:t.vars?`rgba(${e.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Ae(e.color==="default"?t.palette.action.active:t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},e.color!=="default"&&{[`&.${ve.checked}`]:{color:(t.vars||t).palette[e.color].main}},{[`&.${ve.disabled}`]:{color:(t.vars||t).palette.action.disabled}}));function Sn(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const be=o(We,{checked:!0}),Se=o(We,{}),xn=p.exports.forwardRef(function(e,n){var r,a;const s=q({props:e,name:"MuiRadio"}),{checked:l,checkedIcon:c=be,color:m="primary",icon:h=Se,name:y,onChange:v,size:d="medium",className:f}=s,i=G(s,Cn),C=w({},s,{color:m,size:d}),b=vn(C),x=mn();let k=l;const $=ut(v,x&&x.onChange);let M=y;return x&&(typeof k=="undefined"&&(k=Sn(x.value,s.value)),typeof M=="undefined"&&(M=x.name)),o(bn,w({type:"radio",icon:p.exports.cloneElement(h,{fontSize:(r=Se.props.fontSize)!=null?r:d}),checkedIcon:p.exports.cloneElement(c,{fontSize:(a=be.props.fontSize)!=null?a:d}),ownerState:C,classes:b,name:M,checked:k,onChange:$,ref:n,className:K(b.root,f)},i))});var xe=xn;const Rn=["actions","children","defaultValue","name","onChange","value"],Fn=p.exports.forwardRef(function(e,n){const{actions:r,children:a,defaultValue:s,name:l,onChange:c,value:m}=e,h=G(e,Rn),y=p.exports.useRef(null),[v,d]=pt({controlled:m,default:s,name:"RadioGroup"});p.exports.useImperativeHandle(r,()=>({focus:()=>{let b=y.current.querySelector("input:not(:disabled):checked");b||(b=y.current.querySelector("input:not(:disabled)")),b&&b.focus()}}),[]);const f=ht(n,y),i=b=>{d(b.target.value),c&&c(b,b.target.value)},C=ft(l);return o(Ue.Provider,{value:{name:C,onChange:i,value:v},children:o(ln,w({role:"radiogroup",ref:f},h,{children:a}))})});var kn=Fn;function wn(t){return W("MuiSkeleton",t)}U("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Tn=["animation","className","component","height","style","variant","width"];let j=t=>t,Re,Fe,ke,we;const $n=t=>{const{classes:e,variant:n,animation:r,hasChildren:a,width:s,height:l}=t;return Y({root:["root",n,r,a&&"withChildren",a&&!s&&"fitContent",a&&!l&&"heightAuto"]},wn,e)},Dn=Ie(Re||(Re=j`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Mn=Ie(Fe||(Fe=j`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),An=O("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],n.animation!==!1&&e[n.animation],n.hasChildren&&e.withChildren,n.hasChildren&&!n.width&&e.fitContent,n.hasChildren&&!n.height&&e.heightAuto]}})(({theme:t,ownerState:e})=>{const n=Yt(t.shape.borderRadius)||"px",r=Kt(t.shape.borderRadius);return w({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:Ae(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},e.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${r}${n}/${Math.round(r/.6*10)/10}${n}`,"&:empty:before":{content:'"\\00a0"'}},e.variant==="circular"&&{borderRadius:"50%"},e.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},e.hasChildren&&{"& > *":{visibility:"hidden"}},e.hasChildren&&!e.width&&{maxWidth:"fit-content"},e.hasChildren&&!e.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&fe(ke||(ke=j`
      animation: ${0} 1.5s ease-in-out 0.5s infinite;
    `),Dn),({ownerState:t,theme:e})=>t.animation==="wave"&&fe(we||(we=j`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 1.6s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Mn,(e.vars||e).palette.action.hover)),In=p.exports.forwardRef(function(e,n){const r=q({props:e,name:"MuiSkeleton"}),{animation:a="pulse",className:s,component:l="span",height:c,style:m,variant:h="text",width:y}=r,v=G(r,Tn),d=w({},r,{animation:a,component:l,variant:h,hasChildren:Boolean(v.children)}),f=$n(d);return o(An,w({as:l,ref:n,className:K(f.root,s),ownerState:d},v,{style:w({width:y,height:c},m)}))});var A=In;const Ln=t=>{const{fleetSetup:e,onChange:n,errors:r,columnCount:a}=t,[s,l]=p.exports.useTransition(),[c,m]=p.exports.useState(e.name),h=f=>{m(f.target.value.trim())};p.exports.useEffect(()=>{l(()=>{n({...e,name:c})})},[c,n]);const y=f=>{n({...e,maxCost:Number(f.target.value)})},v=f=>{n({...e,maxReinforcement:Number(f.target.value)})},d=f=>{n({...e,myListOnly:f.target.value==="myListOnly"})};return o(_,{children:o(T,{p:1,children:o(mt,{sx:{alignItems:"center"},offsetValue:!1,rowGap:1,columnCount:a,rows:[{key:"name",label:u("fleetSetup.fleetName"),value:f=>o(z,{variant:"outlined",size:"small",value:c,onChange:h,error:!!r.name,helperText:r.name,fullWidth:f})},{key:"reinforcementCount",label:u("fleetSetup.maxReinforcementCount"),value:f=>o(z,{variant:"outlined",size:"small",select:!0,value:e.maxReinforcement,onChange:v,error:!!r.maxReinforcement,helperText:r.maxReinforcement,fullWidth:f,SelectProps:{renderValue:()=>o(S,{variant:"body1",whiteSpace:"normal",children:e.maxReinforcement})},children:[5,6,7,9,10].map(i=>o(N,{value:`${i}`,children:u("fleetSetup.shipCount",{value:i})},`reinforcementCount${i}`))})},{key:"maxCost",label:u("fleetSetup.maxCommandPoints"),value:f=>o(z,{variant:"outlined",size:"small",select:!0,value:e.maxCost,onChange:y,error:!!r.maxCost,helperText:r.maxCost,fullWidth:f,SelectProps:{renderValue:()=>o(S,{variant:"body1",whiteSpace:"normal",children:e.maxCost})},children:[450,430,415,400,350,330,315,300].map(i=>o(N,{value:`${i}`,children:i},`maxCost${i}`))})},{key:"myListOnly",label:u("fleetSetup.availableShipsForAdding"),value:f=>g(z,{variant:"outlined",size:"small",select:!0,value:e.myListOnly?"myListOnly":"all",onChange:d,error:!!r.myListOnly,helperText:r.myListOnly,fullWidth:f,SelectProps:{renderValue:()=>o(S,{variant:"body1",whiteSpace:"normal",children:e.myListOnly?u("label.acquiredShips"):u("label.allShips")})},children:[o(N,{value:"all",children:u("label.allShips")}),o(N,{value:"myListOnly",children:u("label.acquiredShips")})]})}]})})})};var se={},En=J.exports;Object.defineProperty(se,"__esModule",{value:!0});var le=se.default=void 0,_n=En(X),On=Z,Pn=(0,_n.default)((0,On.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");le=se.default=Pn;const Ve=t=>{const{onOpenAddShips:e,filter:n,buttonProps:r}=t,a=s=>{switch(s){case"addInitialShip":{e(null,n);break}case"addSelfReinforcement":{e("self",n);break}case"addAllyReinforcement":{e("ally",n);break}case"addAlly2Reinforcement":{e("ally2",n);break}case"addAlly3Reinforcement":{e("ally3",n);break}}};return o(Lt,{icon:o(le,{}),text:u("fleetSetup.addShips"),onClick:a,buttonProps:r,options:[{key:"addInitialShip",text:u("fleetSetup.normalAssignment"),value:"addInitialShip"},{key:"addSelfReinforcement",text:u("fleetSetup.selfReinforcement"),value:"addSelfReinforcement"},{key:"addAllyReinforcement",text:u("fleetSetup.orgReinforcementA"),value:"addAllyReinforcement"},{key:"addAlly2Reinforcement",text:u("fleetSetup.orgReinforcementB"),value:"addAlly2Reinforcement"},{key:"addAlly3Reinforcement",text:u("fleetSetup.orgReinforcementC"),value:"addAlly3Reinforcement"}]})},Gn=t=>{const{grouping:e,onChangeGrouping:n,onCancel:r,onSave:a,onReset:s,onOpenAddShips:l,saveDisabled:c}=t;return o(It,{left:m=>g(I,{children:[o(Et,{value:e,onChange:n,buttonProps:m}),o(Ve,{onOpenAddShips:l,buttonProps:m})]}),right:m=>g(I,{children:[o(D,{variant:"outlined",startIcon:o($t,{}),onClick:s,...m,children:u("button.initialize")},"reset"),o(D,{variant:"outlined",startIcon:o(Dt,{}),onClick:r,...m,children:u("button.cancel")},"cancel"),o(D,{variant:"contained",startIcon:o(Mt,{}),onClick:a,disabled:c,...m,children:u("button.save")},"save")]})})},Bn=t=>{var f;const{initialFleetKey:e}=t,n=Le(),r=p.exports.useMemo(()=>_t(),[]),[a,s]=p.exports.useState(e&&(f=r.find(i=>i.key===e))!=null?f:r[0]),l=p.exports.useCallback((i,C,b)=>{s(x=>Pe({shipId:i,count:C,reinforcement:b,fleetSetup:x}))},[]),c=p.exports.useCallback((i,C,b,x)=>{s(k=>Ot({shipId:i,carrierShipId:C,count:b,reinforcement:x,fleetSetup:k}))},[]),m=p.exports.useCallback((i,C,b)=>{s(x=>Pt({shipId:i,reinforcement:C,moduleSelection:b,fleetSetup:x}))},[]),h=p.exports.useCallback(()=>{Gt(a),n("/fleetSetup")},[a]),y=p.exports.useCallback(()=>{const i=Number(a.key.substring(5));s(Bt(i))},[a]),v=p.exports.useMemo(()=>Nt(a),[a]),d=p.exports.useMemo(()=>ae(a),[a]);return{fleetSetup:a,errors:v,shipWarnings:d,setFleetSetup:s,setShipCount:l,setCarriedShipCount:c,setModule:m,save:h,reset:y}},Nn=t=>{const{fleetSetup:e,fleetShipCount:n}=t,r=n.totalCost>e.maxCost,a=e.totalReinforcementCount>e.maxReinforcement;return o(T,{sx:{height:"100px"},children:o(_,{square:!0,sx:{position:"fixed",right:0,bottom:0,zIndex:1,width:"100%",borderTop:"1px solid rgba(0, 0, 0, 0.2)"},children:o(kt,{maxWidth:"md",disableGutters:!0,children:o(T,{p:1,children:g(R,{spacing:1,flexWrap:"wrap",direction:"row",children:[o(T,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:g("div",{children:[o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.reinforcement")}),o(S,{variant:"body1",sx:{color:a?"red":void 0},children:o("strong",{children:`${e.totalReinforcementCount} / ${e.maxReinforcement}`})})]})}),o(T,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:g("div",{children:[o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.commandPoints")}),o(S,{variant:"body1",sx:{color:r?"red":void 0},children:o("strong",{children:`${n.totalCost} / ${e.maxCost}`})})]})})]})})})})})};function zn(t,e,n,r){const a={};e.ships.forEach(l=>{a[`${l.shipDefinition.id}_${l.reinforcement}`]=!0});const s=Hn(Ee,t,e.myListOnly,n);return{fleetSetup:{...e,ships:[...e.ships,...s.flatMap(l=>a[`${l.id}_${t}`]?[]:[Ge({shipDefinition:l,usedModules:null,count:0,reinforcement:t,maxReinforcement:e.maxReinforcement,temporary:!0})])]},reinforcement:t,filter:r}}function Hn(t,e,n,r){const a=t.filter(s=>s.type!==F.CORVETTE&&s.type!==F.FIGHTER);return(e==null?void 0:e.includes("ally"))||!n?a:a.filter(s=>_e(s.id,r))}function jn(t){return{...t.fleetSetup,ships:t.fleetSetup.ships.flatMap(e=>e.temporary?e.count===0?[]:[{...e,temporary:!1}]:[e])}}function Wn(t,e){let n={...e,fleetSetup:{...e.fleetSetup,ships:e.fleetSetup.ships.filter(r=>r.temporary===!0)}};return Object.keys(t).filter(r=>t[r]).forEach(r=>{switch(r){case oe.FRONT:case oe.MIDDLE:case oe.BACK:{n={...n,fleetSetup:{...n.fleetSetup,ships:n.fleetSetup.ships.filter(a=>a.shipDefinition.row===r)}};break}case F.CARRIER:case F.AUXILIARY:case F.BATTLE_CRUISER:case F.CRUISER:case F.DESTROYER:case F.FRIGATE:{n={...n,fleetSetup:{...n.fleetSetup,ships:n.fleetSetup.ships.filter(a=>a.shipDefinition.type===r)}};break}}}),n}const Un=t=>{const{userSettings:e,fleetSetup:n,setFleetSetup:r}=t,[a,s]=p.exports.useState(null),l=p.exports.useCallback((v,d)=>{s(zn(v,n,e,d!=null?d:null))},[n,e]),c=p.exports.useCallback(()=>{s(null)},[]),m=p.exports.useCallback(()=>{a&&(r(jn(a)),s(null))},[a,r]),h=p.exports.useCallback((v,d,f)=>{s(i=>i?{...i,fleetSetup:Pe({shipId:v,count:d,reinforcement:f,fleetSetup:i.fleetSetup,keepZero:!0})}:null)},[e]),y=p.exports.useMemo(()=>a?ae(a.fleetSetup):{},[a]);return{dialogData:a,shipWarnings:y,open:l,cancel:c,apply:m,setShipCount:h}};var ce={},Vn=J.exports;Object.defineProperty(ce,"__esModule",{value:!0});var qe=ce.default=void 0,qn=Vn(X),Yn=Z,Kn=(0,qn.default)((0,Yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");qe=ce.default=Kn;var de={},Xn=J.exports;Object.defineProperty(de,"__esModule",{value:!0});var Ye=de.default=void 0,Jn=Xn(X),Zn=Z,Qn=(0,Jn.default)((0,Zn.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");Ye=de.default=Qn;const eo=t=>{const{shipDefinition:e,count:n,maxCount:r,reinforcement:a,showCost:s,showReinforcement:l,carrierShipId:c,shipWarning:m,onChangeShipCount:h,onChangeCarriedShipCount:y}=t,v=Q(),d=ee(v.breakpoints.down("sm")),{openShipDetailDialog:f}=gt(),i=g(I,{children:[o(S,{variant:"body1",children:o(yt,{onClick:()=>{f(e.id)},children:Ct(e)})}),s&&a===null&&g(S,{variant:"body2",color:"text.secondary",children:[u("label.commandPointsColon"),L()?" ":"",e.cost,u("label.comma"),L()?" ":"",u("label.totalColon"),L()?" ":"",`${e.cost*n}`]}),l&&a==="self"&&o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.selfReinforcement")}),l&&a==="ally"&&o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.orgReinforcementA")}),l&&a==="ally2"&&o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.orgReinforcementB")}),l&&a==="ally3"&&o(S,{variant:"body2",color:"text.secondary",children:u("fleetSetup.orgReinforcementC")})]}),C=m&&o(S,{variant:"caption",color:"red",textAlign:"end",children:m}),b=o(D,{onClick:()=>{c?y==null||y(e.id,c,0,a):h==null||h(e.id,0,a)},disabled:n<=0,children:u("fleetSetup.clearAddedShips")}),x=o(me,{onClick:()=>{c?y==null||y(e.id,c,n-1,a):h==null||h(e.id,n-1,a)},disabled:n<=0,children:o(qe,{color:n<=0?"disabled":"primary"})}),k=o(S,{variant:"body1",sx:{minWidth:"55px"},textAlign:"center",children:o("strong",{children:`${n} / ${r}`})}),$=o(me,{onClick:()=>{c?y==null||y(e.id,c,n+1,a):h==null||h(e.id,n+1,a)},disabled:n>=r,children:o(Ye,{color:n>=r?"disabled":"primary"})}),M=o(D,{onClick:()=>{c?y==null||y(e.id,c,r,a):h==null||h(e.id,r,a)},disabled:n>=r,children:u("fleetSetup.fillUpAddedShips")});return g(I,{children:[d&&g(R,{spacing:1,children:[i,g(_,{variant:"outlined",sx:{display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[g(R,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[x,k,$]}),g(R,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[b,M]})]}),C]}),!d&&g(R,{spacing:1,children:[g(R,{spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[o(T,{pb:1,children:o(R,{spacing:1,children:i})}),o(T,{sx:{display:"flex",justifyContent:"end",flexGrow:1},children:o(_,{variant:"outlined",sx:{display:"inline-block"},children:g(R,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[b,x,k,$,M]})})})]}),C]})]})};function to(t){const e={corvette:{key:"corvette",name:u("shipType.corvette"),count:t.carriedShips.filter(n=>n.shipDefinition.type===F.CORVETTE).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:t.carrierCapabilities.carryCorvette*t.count},upToLargeFighter:{key:"upToLargeFighter",name:u("shipType.smallToLargeFighter"),count:t.carriedShips.filter(n=>n.shipDefinition.type===F.FIGHTER&&n.shipDefinition.subType===P.LARGE_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:t.carrierCapabilities.carryUpToLargeFighter*t.count},upToMediumFighter:{key:"upToMediumFighter",name:u("shipType.smallToMediumFighter"),count:t.carriedShips.filter(n=>n.shipDefinition.type===F.FIGHTER&&n.shipDefinition.subType===P.MEDIUM_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:t.carrierCapabilities.carryUpToMediumFighter*t.count},upToSmallFighter:{key:"upToSmallFighter",name:u("shipType.smallFighter"),count:t.carriedShips.filter(n=>n.shipDefinition.type===F.FIGHTER&&n.shipDefinition.subType===P.SMALL_FIGHTER).map(n=>n.count).reduce((n,r)=>n+r,0),maxCount:t.carrierCapabilities.carryUpToSmallFighter*t.count},removedHangar:{key:"removedHangar",name:u("label.unsupported"),count:0,maxCount:0}};return Te(e.upToMediumFighter,[e.upToLargeFighter]),Te(e.upToSmallFighter,[e.upToMediumFighter,e.upToLargeFighter]),re(e.upToSmallFighter,e.upToMediumFighter),re(e.upToMediumFighter,e.upToLargeFighter),e.upToLargeFighter.maxCount===0&&re(e.upToLargeFighter,e.removedHangar),e}function Te(t,e){let n=t.count-t.maxCount;n<=0||(t.count-=n,e.forEach(r=>{if(n<=0||r.maxCount===0)return;const a=r.maxCount-r.count;if(a<=0)return;const s=Math.min(a,n);n-=s,r.count+=s}),n>0&&(t.count+=n))}function re(t,e){const n=t.count-t.maxCount;n>0&&(t.count-=n,e.count+=n)}function no(t){return t.count>0||t.maxCount>0}const oo=t=>{const{shipSelection:e,onOpenAddCarriedShips:n}=t,r=Q(),a=ee(r.breakpoints.down("xs")),s=p.exports.useMemo(()=>to(e),[e]);return g(R,{spacing:1,direction:a?"column":"row",alignItems:a?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[g(R,{sx:{flexGrow:1},spacing:3,direction:"row",alignItems:"center",justifyContent:"space-between",children:[o(S,{variant:"body2",color:"text.secondary",children:u("label.hangarColon")}),o(R,{spacing:1,direction:"row",alignItems:"center",children:o(R,{spacing:1,direction:"row",alignItems:"center",children:Object.keys(s).filter(l=>no(s[l])).map(l=>s[l]).map(l=>g(p.exports.Fragment,{children:[o(S,{variant:"body2",color:"text.secondary",children:l.name}),o(S,{variant:"body2",color:"text.secondary",sx:{color:l.count>l.maxCount?"red":void 0},children:o("strong",{children:`${l.count} / ${l.maxCount}`})})]},l.key))})})]}),o(D,{variant:"outlined",size:"small",startIcon:o(le,{}),sx:{whiteSpace:"nowrap"},onClick:()=>{n==null||n(e.shipDefinition.id,e.reinforcement)},children:u("fleetSetup.addAircraft")})]})};var ue={},ro=J.exports;Object.defineProperty(ue,"__esModule",{value:!0});var Ke=ue.default=void 0,ao=ro(X),io=Z,so=(0,ao.default)((0,io.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");Ke=ue.default=so;const lo=t=>{const{shipId:e,reinforcement:n,moduleSelection:r,myListOnly:a,onChange:s,onClose:l}=t,{userSettings:c}=vt(),[m,h]=p.exports.useState(r),y=()=>{s(e,n,m),l()},v=i=>{const[C,b]=i.target.value.split("#");h(x=>zt(C,b,x))},d=i=>{const C=Object.keys(m.groups[i]).find(b=>m.groups[i][b].usage==="used");return C?`${i}#${C}`:null},f=i=>!Object.keys(m.groups[i]).find(C=>m.groups[i][C].module.defaultModule);return o(ie,{title:u("fleetSetup.configureModules"),content:g(R,{spacing:3,children:[Object.keys(m.groups).map(i=>{const C=d(i),b=`${i}#none`;return o(_,{variant:"outlined",children:o(T,{pl:1,pr:1,children:o(Ut,{children:g(kn,{defaultValue:"female",name:`group-${i}`,value:C!=null?C:b,onChange:v,children:[f(i)&&o(Ce,{label:`${u("label.notSelected")}`,value:b,control:o(xe,{})},b),Object.keys(m.groups[i]).map(x=>{const k=m.groups[i][x],$=n!=="ally"&&n!=="ally2"&&n!=="ally3"&&a&&!k.module.defaultModule&&!bt(x,e,c),M=`${i}#${x}`;return o(Ce,{label:g(T,{pt:1,pb:1,children:[o(S,{variant:"body1",children:`${k.module.category}${k.module.categoryNumber} ${Oe(e,k.module)}`}),St()===xt.JAPANESE&&k.module.description&&o(S,{variant:"body2",color:"text.secondary",children:`${k.module.description}`})]}),value:M,control:o(xe,{disabled:$}),disabled:$},x)})]})})})},i)}),a&&o(S,{variant:"caption",paragraph:!0,children:u("fleetSetup.configureModulesFootnote")})]}),actions:g(I,{children:[o(D,{variant:"outlined",onClick:l,children:u("button.cancel")}),o(D,{variant:"contained",onClick:y,children:u("button.confirm")})]}),onClose:l})},co=t=>{const{shipId:e,reinforcement:n,moduleSelection:r,myListOnly:a,onChange:s}=t,l=Q(),c=ee(l.breakpoints.down("xs")),[m,h]=p.exports.useState(!1),y=()=>{h(!0)},v=()=>{h(!1)},d=[];return Object.keys(r.groups).map(f=>{Object.keys(r.groups[f]).map(i=>r.groups[f][i]).forEach(i=>{i.module.category!=="UNKNOWN"&&i.usage==="used"&&(d.length>0&&d.push(o(p.exports.Fragment,{children:g(S,{variant:"body2",component:"span",children:[u("label.comma"),L()?" ":""]})},`before_${i.module.id}`)),d.push(o(p.exports.Fragment,{children:o(qt,{arrow:!0,disableFocusListener:!0,title:Oe(e,i.module),children:o(S,{variant:"body2",component:"span",children:`${i.module.category}${i.module.categoryNumber}`})})},i.module.id)))})}),d.length===0?null:g(I,{children:[g(R,{spacing:1,direction:c?"column":"row",alignItems:c?"flex-start":"center",justifyContent:"end",flexWrap:"wrap",children:[o(T,{sx:{flexGrow:1},children:g(S,{variant:"body2",color:"text.secondary",children:[u("label.systemModulesColon"),L()?" ":"",d]})}),!r.static&&o(T,{sx:{display:"flex",alignContent:"end"},children:o(D,{variant:"outlined",size:"small",startIcon:o(Ke,{}),sx:{whiteSpace:"nowrap"},onClick:y,children:u("fleetSetup.configureModules")})})]}),m&&o(lo,{shipId:e,reinforcement:n,moduleSelection:r,myListOnly:a,onChange:s,onClose:v})]})},$e=p.exports.memo(eo),pe=t=>{const{shipSelections:e,showCost:n,showReinforcement:r,showHangar:a,shipWarnings:s,carrierShipId:l,myListOnly:c,onChangeShipCount:m,onChangeCarriedShipCount:h,onOpenAddCarriedShips:y,onChangeModule:v}=t;return o(R,{spacing:1,children:e==null?void 0:e.map(d=>{var f,i;return o(_,{variant:"outlined",children:o(T,{p:1,children:g(R,{spacing:1,children:[o($e,{shipDefinition:d.shipDefinition,count:d.count,maxCount:d.maxCount,reinforcement:d.reinforcement,showCost:n,showReinforcement:r,carrierShipId:l,onChangeShipCount:m,onChangeCarriedShipCount:h,shipWarning:s[ge(d.shipDefinition.id,d.reinforcement)]}),d.moduleSelection&&v&&o(co,{shipId:d.shipDefinition.id,reinforcement:d.reinforcement,moduleSelection:d.moduleSelection,myListOnly:c,onChange:v}),a&&d.carrierCapabilities.canCarry&&g(R,{spacing:1,children:[o(oo,{shipSelection:d,onOpenAddCarriedShips:y}),(f=d.carriedShips)==null?void 0:f.map(C=>{var b;return o($e,{shipDefinition:C.shipDefinition,count:C.count,maxCount:C.shipDefinition.operationLimit,reinforcement:C.reinforcement,carrierShipId:d.shipDefinition.id,showCost:!1,showReinforcement:!1,onChangeCarriedShipCount:h,shipWarning:s[ge(C.shipDefinition.id,d.reinforcement)]},`${d.shipDefinition.id}_${C.shipDefinition.id}_${(b=C.reinforcement)!=null?b:"initial"}`)})]})]})})},`${d.shipDefinition.id}_${(i=d.reinforcement)!=null?i:"initial"}`)})})},uo=t=>{const{dialogData:e,shipWarnings:n,myListOnly:r,onCancel:a,onApply:s,onChangeShipCount:l}=t,[c,m]=p.exports.useState(!1),[h,y]=p.exports.useState(()=>{const d=He();return e.filter&&typeof d[e.filter]=="boolean"?{...d,[e.filter]:!0}:d}),v=p.exports.useMemo(()=>Wn(h,e),[h,e]);return p.exports.useEffect(()=>{const d=setTimeout(()=>{m(!0)},0);return()=>{clearTimeout(d)}},[]),o(ie,{title:g(R,{spacing:1,direction:"row",justifyContent:"space-between",alignItems:"center",children:[o(S,{variant:"h6",children:po(e.reinforcement)}),e.reinforcement===null?g("div",{children:[g(S,{variant:"body1",component:"span",children:[u("label.commandPointsColon"),L()?" ":""]}),o(S,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalCost>e.fleetSetup.maxCost?"red":void 0},children:o("strong",{children:`${e.fleetSetup.totalCost} / ${e.fleetSetup.maxCost}`})})]}):g("div",{children:[g(S,{variant:"body1",component:"span",children:[u("fleetSetup.reinforcementColon"),L()?" ":""]}),o(S,{variant:"body1",component:"span",sx:{color:e.fleetSetup.totalReinforcementCount>e.fleetSetup.maxReinforcement?"red":void 0},children:o("strong",{children:`${e.fleetSetup.totalReinforcementCount} / ${e.fleetSetup.maxReinforcement}`})})]})]}),content:g(R,{spacing:2,children:[o(S,{variant:"body2",children:ho(e.reinforcement)}),o("div",{children:o(je,{filter:h,shipTypes:[F.CARRIER,F.AUXILIARY,F.BATTLE_CRUISER,F.CRUISER,F.DESTROYER,F.FRIGATE],onChange:y,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),v.fleetSetup.ships.length===0&&o(Be,{severity:"info",children:u("fleetSetup.noMatchingShip")}),c?o(pe,{shipSelections:v.fleetSetup.ships,showCost:!v.reinforcement,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,myListOnly:r,onChangeShipCount:l}):g(R,{spacing:1,children:[o(A,{variant:"rectangular",height:90}),o(A,{variant:"rectangular",animation:"wave",height:90}),o(A,{variant:"rectangular",height:90}),o(A,{variant:"rectangular",animation:"wave",height:90}),o(A,{variant:"rectangular",height:90})]})]}),actions:g(I,{children:[o(D,{variant:"outlined",onClick:a,children:u("button.cancel")}),o(D,{variant:"contained",onClick:s,children:u("button.confirm")})]}),onClose:a})};function po(t){switch(t){case"ally":case"ally2":case"ally3":case"self":return u("fleetSetup.addReinforcement");default:return u("fleetSetup.addShips")}}function ho(t){switch(t){case"ally":return u("fleetSetup.addReinforcementDescriptionAllyA");case"ally2":return u("fleetSetup.addReinforcementDescriptionAllyB");case"ally3":return u("fleetSetup.addReinforcementDescriptionAllyC");case"self":return u("fleetSetup.addReinforcementDescriptionSelf");default:return u("fleetSetup.addShipsDescription")}}function fo(t,e,n,r){const a=n.ships.find(c=>c.shipDefinition.id===t&&c.reinforcement===e);if(!a)throw new Error("Invalid carrier");const s={};a.carriedShips.forEach(c=>{s[`${c.shipDefinition.id}_${c.reinforcement}`]=!0});const l=mo(a,Ee,e,n.myListOnly,r);return{carrierShipId:t,reinforcement:e,shipSelections:l.flatMap(c=>s[`${c.id}_${e}`]?[]:[Ge({shipDefinition:c,usedModules:null,count:0,reinforcement:e,maxReinforcement:n.maxReinforcement,temporary:!0})]),filter:null}}function mo(t,e,n,r,a){const s=e.filter(l=>{switch(l.type){case F.CORVETTE:return t.carrierCapabilities.carryCorvette>0;case F.FIGHTER:switch(l.subType){case P.LARGE_FIGHTER:return t.carrierCapabilities.carryUpToLargeFighter>0;case P.MEDIUM_FIGHTER:return t.carrierCapabilities.carryUpToMediumFighter>0||t.carrierCapabilities.carryUpToLargeFighter>0;case P.SMALL_FIGHTER:return t.carrierCapabilities.carryUpToSmallFighter>0||t.carrierCapabilities.carryUpToMediumFighter>0||t.carrierCapabilities.carryUpToLargeFighter>0}}return!1});return(n==null?void 0:n.includes("ally"))||!r?s:s.filter(l=>_e(l.id,a))}function De(t,e){return{...e,ships:e.ships.map(n=>n.shipDefinition.id!==t.carrierShipId||n.reinforcement!==t.reinforcement?n:{...n,carriedShips:[...n.carriedShips,...t.shipSelections.filter(r=>r.count>0).map(r=>Ht({shipId:r.shipDefinition.id,count:r.count,reinforcement:t.reinforcement}))]})}}function go(t,e){let n=e;return Object.keys(t).filter(r=>t[r]).forEach(r=>{switch(r){case F.CORVETTE:case F.FIGHTER:{n={...n,shipSelections:n.shipSelections.filter(a=>a.shipDefinition.type===r)};break}}}),n}const yo=t=>{const{userSettings:e,fleetSetup:n,setFleetSetup:r}=t,[a,s]=p.exports.useState(null),l=p.exports.useCallback((v,d)=>{s(fo(v,d,n,e))},[n,e]),c=p.exports.useCallback(()=>{s(null)},[]),m=p.exports.useCallback(()=>{a&&(r(De(a,n)),s(null))},[a,n,r]),h=p.exports.useCallback((v,d,f)=>{s(i=>i?{...i,shipSelections:i.shipSelections.map(C=>C.shipDefinition.id!==v||C.reinforcement!==f?C:{...C,count:d})}:null)},[e]),y=p.exports.useMemo(()=>{if(!a)return{};const v=De(a,n);return ae(v)},[a,n]);return{dialogData:a,shipWarnings:y,open:l,cancel:c,apply:m,setShipCount:h}},Co=t=>{const{dialogData:e,shipWarnings:n,myListOnly:r,onCancel:a,onApply:s,onChangeShipCount:l}=t,[c,m]=p.exports.useState(!1),[h,y]=p.exports.useState(()=>{const i=He();return e.filter&&typeof i[e.filter]=="boolean"?{...i,[e.filter]:!0}:i}),v=p.exports.useMemo(()=>go(h,e),[h,e]);p.exports.useEffect(()=>{const i=setTimeout(()=>{m(!0)},0);return()=>{clearTimeout(i)}},[]);const d=!!e.shipSelections.find(i=>i.shipDefinition.type===F.CORVETTE),f=!!e.shipSelections.find(i=>i.shipDefinition.type===F.FIGHTER);return o(ie,{title:u("fleetSetup.addAircraft"),content:g(R,{spacing:2,children:[o(S,{variant:"body2",children:u("fleetSetup.addAircraftDescription")}),d&&f&&o("div",{children:o(je,{filter:h,shipTypes:[F.CORVETTE,F.FIGHTER],shipRows:[],onChange:y,popperProps:{disablePortal:!1,placement:"bottom-start",style:{zIndex:1300}}})}),v.shipSelections.length===0&&o(Be,{severity:"info",children:u("fleetSetup.noMatchingAircraft")}),c?o(pe,{shipSelections:v.shipSelections,showCost:!1,showReinforcement:!1,showHangar:!1,shipWarnings:n,carrierShipId:null,myListOnly:r,onChangeShipCount:l}):g(R,{spacing:1,children:[o(A,{variant:"rectangular",height:90}),o(A,{variant:"rectangular",animation:"wave",height:90}),o(A,{variant:"rectangular",height:90}),o(A,{variant:"rectangular",animation:"wave",height:90}),o(A,{variant:"rectangular",height:90})]})]}),actions:g(I,{children:[o(D,{variant:"outlined",onClick:a,children:u("button.cancel")}),o(D,{variant:"contained",onClick:s,children:u("button.confirm")})]}),onClose:a})},Io=()=>{const t=Le(),{fleetKey:e}=Rt(),n=Q(),r=ee(n.breakpoints.up("lg")),a=p.exports.useMemo(()=>Ft(),[]),[s,l]=p.exports.useState(!1),{fleetSetup:c,errors:m,shipWarnings:h,setFleetSetup:y,setShipCount:v,setCarriedShipCount:d,setModule:f,save:i,reset:C}=Bn({initialFleetKey:e}),{dialogData:b,shipWarnings:x,open:k,cancel:$,apply:M,setShipCount:Xe}=Un({userSettings:a,fleetSetup:c,setFleetSetup:y}),{dialogData:he,shipWarnings:Je,open:Ze,cancel:Qe,apply:et,setShipCount:tt}=yo({userSettings:a,fleetSetup:c,setFleetSetup:y}),nt=p.exports.useMemo(()=>jt(c.ships),[c.ships]),[te,ot]=p.exports.useState(ye.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),ne=p.exports.useMemo(()=>Wt(te,c),[c,te]),rt=()=>{t(`/fleetSetup/${c.key}`)},at=()=>{Object.keys(m).length>0||(i(),t(`/fleetSetup/${c.key}`))},it=()=>{l(!1)},st=()=>{l(!0)},lt=()=>{l(!1),C()},B=r&&ne.groupedBy===ye.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column",ct=B==="row"?4:2;return g(I,{children:[o(wt,{currentRoute:"/fleetSetup"}),o(Gn,{grouping:te,onChangeGrouping:ot,onSave:at,onCancel:rt,onReset:st,onOpenAddShips:k,saveDisabled:Object.keys(m).length>0}),o(Tt,{disableContainer:B==="row",children:o(T,{p:1,sx:{marginBottom:"60px"},children:g(R,{spacing:1,children:[o(Ln,{fleetSetup:c,onChange:y,errors:m,columnCount:ct}),o(R,{spacing:1,direction:B,children:ne.groups.map(E=>o(_,{sx:{width:B==="row"?`${100/ne.groups.length}%`:void 0},children:o(T,{p:1,children:g(R,{spacing:1,children:[g(R,{spacing:1,direction:"row",alignItems:"center",sx:{width:"100%"},children:[o(T,{sx:{flexGrow:1},children:g(S,{variant:"body1",children:[E.name,L()&&o("span",{children:"\xA0"}),E.count>0?u("fleetSetup.shipCountBrackets",{value:E.count}):""]})}),o(Ve,{filter:E.id,onOpenAddShips:k,buttonProps:{size:"small"}})]}),E.ships.length>0&&o(pe,{shipSelections:E.ships,onChangeShipCount:v,onChangeCarriedShipCount:d,onOpenAddCarriedShips:Ze,onChangeModule:f,showCost:!0,showReinforcement:!0,showHangar:!0,shipWarnings:h,carrierShipId:null,myListOnly:c.myListOnly})]})})},E.id))})]})})}),o(Nn,{fleetSetup:c,fleetShipCount:nt}),b&&o(uo,{dialogData:b,shipWarnings:x,myListOnly:c.myListOnly,onCancel:$,onApply:M,onChangeShipCount:Xe}),he&&o(Co,{dialogData:he,shipWarnings:Je,myListOnly:c.myListOnly,onCancel:Qe,onApply:et,onChangeShipCount:tt}),s&&o(At,{title:u("button.initialize"),question:u("fleetSetup.confirmInitializeFleet"),cancelText:u("button.cancel"),confirmText:u("button.initialize"),onCancel:it,onConfirm:lt})]})};export{Io as FleetSetupEditPage,Io as default};
